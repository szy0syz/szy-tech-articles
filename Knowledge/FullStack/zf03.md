# ç å³°å‰ç«¯å…¨æ ˆåŸ¹è®­ç¬¬ä¸‰å‘¨ï¼šdomç›’å­æ¨¡å‹å®æˆ˜å’Œdomåº“å°è£…

## è¯¾æ—¶48ï¼šç›’å­æ¨¡å‹å¸¸ç”¨çš„å±æ€§(å‰8ä¸ª)

#### JavaScriptç›’å­æ¨¡å‹æŒ‡çš„æ˜¯é€šè¿‡JSæä¾›çš„ä¸€äº›åˆ—å±æ€§å’Œæ–¹æ³•ï¼Œè·å–é¡µé¢ä¸­å…ƒç´ çš„æ ·å¼ä¿¡æ¯å€¼(å°±æ˜¯è·å–domå¯¹è±¡åæ“ä½œé‚£äº›å…³äºæ ·å¼çš„å±æ€§å’Œæ–¹æ³•)

![image.png-72.1kB][1]

å†…å®¹çš„å®½åº¦å’Œé«˜åº¦å°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„widthå’Œheightè¿™ä¸¤ä¸ªæ ·å¼å°±æ˜¯å†…å®¹çš„å®½å’Œé«˜ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®é«˜åº¦å€¼ï¼Œå®¹å™¨çš„é«˜åº¦ä¼šæ ¹æ®é‡Œé¢å†…å®¹è‡ªå·±è¿›è¡Œé€‚åº”ï¼Œè¿™æ ·è·å–çš„å€¼å°±æ˜¯çœŸå®å†…å®¹çš„é«˜ï¼›å¦‚æœè®¾ç½®äº†å›ºå®šçš„é«˜åº¦äº†ï¼Œä¸ç®¡å†…å®¹æ˜¯å¤šå°‘äº†è¿˜æ˜¯å°‘äº†ï¼Œå…¶å†…å®¹çš„é«˜åº¦ä¼šå›ºå®šä¸ºæˆ‘ä»¬è®¾ç½®çš„é‚£ä¸ªå€¼ã€‚

çœŸå®çš„å†…å®¹çš„é«˜åº¦å’Œå®½åº¦ï¼šè¿™ä¸ªä»£æŒ‡çš„æ˜¯æˆ‘ä»¬å®é™…å†…å®¹çš„é«˜åº¦(å’Œæˆ‘ä»¬è®¾ç½®çš„heightæ²¡æœ‰å¿…ç„¶å…³ç³»)ï¼Œä¾‹å¦‚ï¼šæˆ‘ä»¬è®¾ç½®é«˜åº¦ä¸º200pxï¼Œå¦‚æœå†…å®¹æœ‰æº¢å‡ºï¼Œé‚£ä¹ˆçœŸæ˜¯å†…å®¹çš„é«˜åº¦ä¼šæŠŠæº¢å‡ºå†…å®¹çš„é«˜åº¦ä¹ŸåŠ è¿›æ¥ã€‚

#### clientç³»åˆ—å±æ€§
- clientHeight/clientWidthï¼šå†…å®¹+ä¸Šä¸‹æˆ–å·¦å³paddingå¡«å……çš„å€¼(å’Œå†…å®¹æ˜¯å¦æº¢å‡ºæ²¡å…³ç³»)
- clientLeft/clientTopï¼šå·¦è¾¹æ¡†çš„å®½åº¦/ä¸Šè¾¹æ¡†çš„é«˜åº¦ (å°±æ˜¯border[Left/Top]Width)

#### offsetç³»åˆ—å±æ€§

- offsetHeight/offsetWidthï¼šå…¨ç­‰äº(clientHeight+ä¸Šä¸‹borderè¾¹æ¡†)/(clientWidth+å·¦å³borderè¾¹æ¡†) -> åŒæ ·çš„å’Œå†…å®¹æ˜¯å¦æº¢å‡ºæ²¡æœ‰ä»»ä½•å…³ç³»
- offsetParentï¼šå½“å‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©
- offsetLeft/offsetTopï¼šå½“å‰å…ƒç´ çš„å¤–è¾¹æ¡†è·ç¦»çˆ¶çº§å‚ç…§ç‰©å†…è¾¹æ¡†çš„åç§»é‡

#### scrollç³»åˆ—å±æ€§

- scrollHeight/scrollWidth
  - åœ¨å†…å®¹æ²¡æº¢å‡ºçš„å‰æä¸‹ï¼Œä¸¤è€…å’ŒclientHeigth/clientWidthä¸€æ ·ï¼›
  - åœ¨å†…å®¹æœ‰æº¢å‡ºçš„å‰æä¸‹ï¼Œä¸¤è€…è·å–çš„å€¼æœ‰å¦‚ä¸‹è§„åˆ™ï¼šscrollHeightä¸ºçœŸå®å†…å®¹çš„é«˜åº¦(åŒ…å«æº¢å‡º)+ä¸Špaddingå¡«å……ï¼ŒscrollWidthä¸ºçœŸå®å†…å®¹çš„å®½åº¦+å·¦paddingå¡«å……ï¼›ä¸¤è€…è·å–çš„ç»“æœå€¼éƒ½æ˜¯â€œçº¦ç­‰äºâ€çš„å€¼ï¼Œå› ä¸ºåœ¨ç»Ÿä¸€æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦è®¾ç½®äº†cssæ ·å¼`overflow:'ha  dden'`å¯¹äºæœ€ç»ˆçš„ç»“æœæ˜¯æœ‰å½±å“çš„ï¼›åœ¨ä¸åŒæµè§ˆå™¨ä¸­æˆ‘ä»¬å›å»çš„ç»“æœå€¼ä¹Ÿæ˜¯ä¸åŒ(IE6~7)

- scrollLeft/scrollTopï¼šæ»šåŠ¨æ¡å·å»çš„å®½åº¦æˆ–é«˜åº¦

#### å…³äºJavaScriptç›’å­æ¨¡å‹å–å€¼çš„é—®é¢˜

- æˆ‘ä»¬é€šè¿‡ğŸ‘†ä¸Šé¢ğŸ‘†è¿™13ä¸ªå±æ€§å€¼

#### å…³äºæ“ä½œæµè§ˆå™¨æœ¬èº«çš„ç›’å­æ¨¡å‹ä¿¡æ¯

```javascript
document.documentElement.scrollTop // -> æˆ‘ä»¬å‘ç°è¿™è´§å“ˆå“ˆéƒ½æ˜¯0ï¼Œä¸ä¼šå˜ï¼
document.body.scrollTop // -> åˆå‘ç°è¿™è´§ä¼šéšç€æ»šåŠ¨æ¡è€Œæ”¹å˜ï¼Œä½ è®¾ç½®å®ƒåæµè§ˆå™¨çš„å®é™…æ»šåŠ¨æ¡éƒ½ä¼šæ”¹å˜ï¼
```

- å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼ŒclientWidthå’ŒclientHeightæ˜¯å½“å‰å¯è§åŒºåŸŸ(ä¸‹é¢å¯èƒ½è¿˜æœ‰å†…å®¹)çš„å®½å’Œé«˜
- scrollWidth/scrollHeightå°±æ˜¯å½“å‰é¡µé¢çš„çœŸå®å®½åº¦å’Œé«˜åº¦(æ‰€æœ‰è¦æ˜¾ç¤ºå†…å®¹åŠ èµ·æ¥çš„å®½é«˜ï¼Œä½†æ˜¯ä¸ªçº¦ç­‰äºå€¼ï¼Œè‹¥æœ‰æ‡’æƒ°åŠ è½½çš„å›¾ç‰‡ä¼šå½±å“é«˜åº¦)
- ä»…å¯¹æ“ä½œæµè§ˆå™¨é¡µé¢---->æˆ‘ä»¬ä¸ç®¡è¦è¯»å†™å“ªäº›å±æ€§ï¼Œä¹Ÿä¸ç®¡æ˜¯ç”¨ä»€ä¹ˆæµè§ˆå™¨ï¼Œæƒ³è¦éƒ½å…¼å®¹çš„è¯ï¼Œéœ€è¦è¯»å†™ä¸¤å¥—å±æ€§ï¼š
  - `document.documentElement[attr] || document.body[attr]` 
  - è€Œä¸”åœ¨æ“ä½œæ—¶å¿…é¡»`document.documentElement[attr]`å…ˆæ“ä½œ

```javascript
// [è·å–å½“å‰é¡µé¢çš„çœŸå®å®½åº¦æˆ–é«˜åº¦]
var winHeight = document.documentElement.clientWidth || document.body.clientWidth
// [è®¾ç½®å½“å‰é¡µé¢æ»šåŠ¨æ¡çš„é«˜åº¦]
document.documentElement.scrollTop = 1000
document.body.scrollTop = 1000

// å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°å¯¹æµè§ˆå™¨å„é¡¹å±æ€§çš„è¯»å†™
function win (attr, val) {
  if (!attr) {
    return document.documentElement[attr] || document.body[attr]
  }
  document.documentElement[attr] = val
  document.body[attr] = val
}
```

----------

## è¯¾æ—¶49ï¼šè·å–å…ƒç´ çš„å…·ä½“æ ·å¼ä¿¡æ¯

#### è·å–å…ƒç´ çš„æŸä¸€ä¸ªå…·ä½“çš„æ ·å¼å±æ€§å€¼

- å…ƒç´ .style.å±æ€§å -> `xxxx.style.height` -> è¿™æ ·jsè·å–çš„æ˜¯æŸä¸ªdomå…ƒç´ çš„CSSStyleDeclarationè¡Œå†…æ ·å¼å±æ€§ï¼Œä¸èƒ½ç´¢å–åˆ°åœ¨æ ·å¼è¡¨ä¸­è®¾ç½®çš„heightå€¼ã€‚çœŸå®é¡¹ç›®ä¸­ä¸å¸¸ç”¨ï¼Œå› ä¸ºä¸èƒ½æŠŠæ‰€æœ‰æ ·å¼éƒ½å†™åœ¨è¡Œå†…æ ·å¼ä¸Šï¼Œè¿™æ ·æ— æ³•å®ç°csså’Œhtmlçš„åˆ†ç¦»ã€‚

- window.getComputedStyleï¼šæ–¹æ³•è·å–æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—è¿‡çš„æ ·å¼
  - æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—è¿‡çš„æ ·å¼ï¼šåªè¦å½“å‰çš„å…ƒç´ æ ‡ç­¾å¯ä»¥åœ¨é¡µé¢ä¸­å‘ˆç°å‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒçš„æ‰€æœ‰çš„æ ·å¼éƒ½æ˜¯ç»è¿‡æµè§ˆå™¨è®¡ç®—(æ¸²æŸ“)è¿‡çš„ï¼Œå“ªæ€•æœ‰äº›æ ·å¼æ²¡å†™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å–åˆ°ã€‚
  - æ­¤æ–¹æ³•è™½ç„¶å¥½ç”¨ï¼Œä½†åœ¨IE6~8ä¸‹ä¸å…¼å®¹ï¼Œå› ä¸ºwindowä¸‹æ²¡æœ‰getComputedStyleæ–¹æ³•
  - åœ¨IE6~8ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨`window.currentStyle`æ–¹æ³•æ¥è·å–æ‰€æœ‰é€šè¿‡æµè§ˆå™¨æ¸²æŸ“è¿‡çš„æ ·å¼

```javascript
window.getComputedStyle // -> function getComputedStyle() { [native code] }
window.getComputedStyle(box, null) // è¿”å›CSSStyleDeclarationè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œå…¶åŒ…å«äº†å½“å‰å…ƒç´ çš„æ‰€æœ‰æ ·å¼å’Œå€¼
// window.getComputedStyle(å‚æ•°1, å‚æ•°2) å‚æ•°1å†™domå…ƒç´ ï¼Œå‚æ•°2ä¸ºå½“å‰å…ƒç´ çš„ä¼ªç±»(ä¸€èˆ¬ä¸ç”¨ä¼ªç±»æ•…å†™null)

// æ–¹æ³•getCssï¼šå…¼å®¹(ie6~8)æ–¹å¼è·å–å…ƒç´ å½“å‰æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—æ¸²æŸ“è¿‡çš„æ ·å¼ä¸­çš„[attr]å¯¹åº”çš„å€¼
// curEl, domå¯¹è±¡
// attr, æ ·å¼çš„å±æ€§å
function getCss (curEl, attr) {
  // æ–¹æ³•1ï¼šä½¿ç”¨try catchå¤„ç†å…¼å®¹
  // æ­¤æ–¹æ³•é—®é¢˜ï¼šå¿…é¡»ä¿å­˜tryä¸­çš„ä»£ç åœ¨ä¸å…¼å®¹æµè§ˆå™¨ä¸­æ‰§è¡Œæ—¶æŠ¥é”™ï¼Œæ‰å¯ä»¥ç”¨catchæ•è·åˆ°å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚è€Œä¸ç®¡æ˜¯ä»€ä¹ˆæµè§ˆå™¨éƒ½éœ€è¦æ‰§è¡Œtryä¸­çš„ä»£ç ï¼Œå¦‚æœå·²ç»æ˜¯åœ¨IE6~8ä¸­ï¼Œä¹Ÿè¦æ‰§è¡Œä¸€éå»æŠ¥é”™äº†æ‰å¤„ç†ï¼Œæµªè´¹æ€§èƒ½ã€‚
//  try {
//    return window.getComputedStyle(curEl, null)[attr]
//  } catch (e) {
//    console.log('ä½ ç«Ÿç„¶åœ¨ç”¨IE6~8ï¼')
//    return curEl.currentStyle[attr]
//  }

  // æ–¹æ³•2ï¼šæå‰åˆ¤æ–­windowå¯¹è±¡æ˜¯å¦æœ‰getComputedStyleå±æ€§
//  var val = null
//  if("getComputedStyle" in window) {
//    val = window.getComputedStyle(curEl, null)[attr]
//  } else {
//    val = curEl.currentStyle[attr]
//  }

  // æ–¹æ³•3ï¼šé€šè¿‡æ£€æŸ¥æµè§ˆå™¨ç‰ˆæœ¬å’Œç±»å‹æ¥å¤„ç†å…¼å®¹
  // -> window.navigator.userAgent
  // MAC Chrome -> "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"
  if (/MSIE [678]/.test(window.navigator.userAgent)) {
    return window.getComputedStyle(curEl, null)[attr]
  } else {
    return curEl.currentStyle[attr]
  }
}
// getCss(box, "border") // åœ¨IE6~8ä¸­è¿˜æ˜¯æ²¡æœ‰
// getCss(box, "borderTop") // æŠŠå¤åˆå€¼æ‹†å¼€æ¥å†™é¿å…å‡ºç°ä¸å…¼å®¹é—®é¢˜
// å¯¹äºæ ‡å‡†æµè§ˆå™¨å’ŒIEæµè§ˆå™¨è·å–çš„ç»“æœè¿˜æ˜¯ä¸ä¸€æ ·çš„ -> å¯¹äºéƒ¨åˆ†æ ·å¼ï¼Œä¸åŒæµè§ˆå™¨ç»“æœä¸ä¸€æ ·ï¼Œä¸»è¦ç”±äºgetComputedStyleå’ŒcurrentStyleåœ¨æŸäº›æ–¹é¢è¿˜æ˜¯æœ‰ä¸ä¸€æ ·çš„ã€‚
```

#### å†™CSSçš„æ—¶å€™ï¼Œæœ€å¥½ç¬¬ä¸€æ­¥åˆå§‹åŒ–é»˜è®¤æ ·å¼ï¼Œé¿å…æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ï¼Œè€Œä¸”å†™çš„é»˜è®¤æ ·å¼å¯¹äºJSä»¥åè·å–åˆ°çš„ç»Ÿä¸€ç»“æœä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©

- getCssç¬¬ä¸€æ¬¡å‡çº§

```javascript
function getCss (curEl, attr) {
  var val = null
  var reg = /^-?\d+(\.\d+)?(px|pt|rem|em)?$/
  // var val = reg = null , è¿™æ ·å†™regå°±è¢«æ•´æˆå…¨å±€äº†ï¼
  if ("getComputedStyle" in window) {
    val = window.getComputedStyle(curEl, null)[attr]
  } else {
    val = curEl.currentStyle[attr]
  }
  // è¿”å›å‰å¿…é¡»å¤„ç†å¤åˆå€¼ï¼Œå¦‚padding backgroundï¼Œpositionï¼Œfloatç­‰
  // åŒ¹é…ï¼šè´Ÿå·å¯æœ‰å¯æ— åå†è·Ÿ1åˆ°å¤šä¸ºæ•°å­—, å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œå•ä½ç¬¦å·å¯æœ‰å¯æ— 
  return reg.test(val) ? parseFloat(val) : val
}
```

- getCssç¬¬äºŒæ¬¡å‡çº§ï¼šé’ˆå¯¹æœ‰äº›IE6~8ä¸å…¼å®¹opacityå±æ€§

```javascript
// CSS:
// opacity: 0.5; /*é€æ˜åº¦ï¼Œåœ¨IE6~8ä¸­ä¸å…¼å®¹*/
// fliter: alpha(opacity=10); /*å…¼å®¹æ–¹æ³•ä½¿ç”¨æ»¤é•œæ¥å¤„ç†*/
function getCss (curEl, attr) {
  var val = null
  // åŒ¹é…ï¼šè´Ÿå·å¯æœ‰å¯æ— åå†è·Ÿ1åˆ°å¤šä¸ºæ•°å­—, å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œå•ä½ç¬¦å·å¯æœ‰å¯æ— 
  var reg = /^-?\d+(\.\d+)?(px|pt|rem|em)?$/
  // var val = reg = null , è¿™æ ·å†™regå°±è¢«æ•´æˆå…¨å±€äº†ï¼
  if ("getComputedStyle" in window) {
    val = window.getComputedStyle(curEl, null)[attr]
  } else { // -> å¦‚æœæ˜¯IE6~8
    if (atrr === 'opacity') {
      val = curEl.currentStyle[attr]
      // æ­£åˆ™è§£é‡Šï¼šalphaå¼€å¤´ï¼Œå°æ‹¬å·å­—ç¬¦éœ€ç”¨è½¬ä¹‰ç¬¦è½¬ä¹‰ï¼Œç„¶åæ‹¬å·é‡Œæ˜¯1åˆ°å¤šä½æ•°ï¼Œåé¢å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œé‡Œé¢?:æŒ‡æ˜ä¸æ•è·å†…å®¹ï¼Œæœ€åå¿½ç•¥å¤§å°å†™
      reg = /^alpha\(opacity=(\d+(?:\.\d+)?)\)$/i
      // å…ˆåŒ¹é…ï¼Œåœ¨æ•è·ç¬¬ä¸€ä¸ªå°æ­£åˆ™å†…å®¹ï¼Œå¦‚æœä¸æ˜¯å°±è¿”å›1
      val = reg.test(val) ? reg.exec(val)[1] / 100 : 1
    } else {
      val = curEl.currentStyle[attr]
    }
  }
  // è¿”å›å‰å¿…é¡»å¤„ç†å¤åˆå€¼ï¼Œå¦‚padding backgroundï¼Œpositionï¼Œfloatç­‰
  return reg.test(val) ? parseFloat(val) : val
}
```

----------

## è¯¾æ—¶50ï¼šä¼ªç±»çš„åº”ç”¨

```css
/* :before  :after  -> åœ¨ä¸€ä¸ªå…ƒç´ æ ‡ç­¾çš„å‰é¢æˆ–åé¢åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿçš„æ ‡ç­¾ï¼Œå¯ä»¥ç»™è¿™ä¸ªè™šæ‹Ÿæ ‡ç­¾å¢åŠ cssæ ·å¼æˆ–è€…å†…å®¹ç­‰...*/
.box p:before {
    display: block;
    background: lightgreen;
    content: "æˆ‘æ˜¯è€å¸æœº";
    text-align: center;
}

.box p:after {
    display: block;
    background: lightblue;
    content: "å¼€è½¦ä¸ŠçœåŸ";
    text-align: center;
}

/*-------------æ¶ˆé™¤æµ®åŠ¨--------------*/
.clear {
    zoom: 1;
}

.clear:after {
    display: block;
    width: 0;
    height: 0;
    content: "";
    overflow: hidden;
    clear: both;
}
```

```javascript
// è·å–ä¼ªç±»çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ ·å¼
var p1 = document.getElementById("boxP")
window.getComputedStyle(p1,"before").content // -> "æˆ‘æ˜¯è€å¸æœº"
window.getComputedStyle(p1,"before").background
```

----------

## è¯¾æ—¶51ï¼šè·å–å…ƒç´ çš„åç§»é‡

```html
<div id="outer">
    <div id="inner">
        <div id="center">
        </div>
    </div>
</div>
```

- `patentNode`ï¼šçˆ¶èŠ‚ç‚¹å±æ€§ï¼Œhtmlç»“æ„å±‚çº§å…³ç³»ä¸­çš„ä¸Šä¸€çº§èŠ‚ç‚¹ï¼

```javascript
center.parentNode //-> inner element
inner.parentNode // -> outer element
outer.parentNode // -> body element

document.parentNode // ->  null (æ ¹èŠ‚ç‚¹) -> å¼•æ“è‡ªå¸¦çš„å±æ€§ï¼šçˆ¶èŠ‚ç‚¹å±æ€§
document.parentnode // ->  undefiend -> å¯¹è±¡ä¸Šæ²¡è¿™ä¸ªå±æ€§
// ä»ä¸Šé¢çš„ä¾‹å­ä½“ç°å‡ºnullå’Œundefinedçš„åŒºåˆ«ï¼š
// ä¸¤è€…éƒ½æ˜¯è¡¨ç¤ºæ²¡æœ‰
// nullè¡¨ç¤ºå±æ€§æ˜¯å­˜åœ¨çš„åªæ˜¯å€¼æ²¡æœ‰ï¼Œè€Œundefinedè¡¨ç¤ºå±æ€§æ ¹æœ¬ä¸å­˜åœ¨
```

- `offsetParent`ï¼šçˆ¶çº§å‚ç…§ç‰©ï¼Œåœ¨åŒä¸€å¹³é¢ä¸­ï¼Œæœ€å¤–å±‚çš„å…ƒç´ æ˜¯é‡Œé¢æ‰€æœ‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©(ä¸HTMLçš„nodeå±‚çº§ç»“æ„æ²¡å…³ç³»)
  - ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé¡µé¢ä¸­æ‰€æœ‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©éƒ½æ˜¯`body`
  - æƒ³è¦æ”¹å˜çˆ¶çº§å‚ç…§ç‰©ï¼Œéœ€è¦é€šè¿‡ä¿®æ”¹CSSä¸­`position`å®šä½æ¥å®ç°

```javascript
center.offsetParent // -> body element
inner.offsetParent // ->  body element
outer.offsetParent // ->  body element
document.body.offsetParent // -> null
```

```css
/* åªæœ‰è¿™ä¸‰ä¸ªæ ·å¼çš„å±æ€§å¯ä»¥æ”¹å˜å…ƒç´ çˆ¶çº§å‚ç…§ç‰©ï¼
position: absolute; 
position: fixed;
position: relative;
*/
```

- `offsetLeft`ï¼šå…ƒç´ å·¦å¤–æ¡†è·ç¦»çˆ¶çº§å‚ç…§ç‰©çš„è·ç¦»

![image.png-25.6kB][2]

```javascript
// ä¿®æ”¹æœ€å¤–å±‚divçš„å®šä½ä¸ºï¼šç›¸å¯¹å®šä½
outer.style.position = "relative"
center.offsetParent  // -> outer element
inner.offsetParent  // ->  outer element
outer.offsetParent  // ->  body element

// ä¿®æ”¹ä¸¤å±‚divçš„å®šä½ä¸ºï¼šç›¸å¯¹å®šä½
outer.style.position = "relative"
inner.style.position = "relative"
center.offsetParent  // -> inner element
inner.offsetParent  // ->  outer element
outer.offsetParent  // ->  body element
```

- ä»¥ä¸Šä»£ç ç»“è®ºï¼šå½“ä¿®æ”¹æŸä¸ªå…ƒç´ positionä¸ºrelativeæ—¶ï¼Œä¼šå°†å…¶æ‰€æœ‰ä¸‹çº§èŠ‚ç‚¹çš„çˆ¶çº§å‚ç…§ç‰©éƒ½è®¾ç½®ä¸ºè¯¥å…ƒç´ ï¼›è€Œå¦‚æœæœ‰åµŒå¥—çš„relativeå®šä½ï¼Œåˆ™çˆ¶çº§å‚ç…§ç‰©ä¼šå‘ˆæ ‘å½¢ç»“æ„ã€‚

```javascript
// è·å–ä¸€ä¸ªå…ƒç´ ç›¸å¯¹äºbodyçš„offsetåç§»é‡
// è¿™é‡Œå¯¹äºçˆ¶çº§å‚ç…§ç‰©è®¾ç½®äº†relativeã€fixedã€absoluteçš„æƒ…å†µéƒ½è¿›è¡Œäº†è¡¥å¿
function offset (curElement) {
    var totalLfet = 0, totalTop = 0, parant = curElement.offsetParent
    // å…ˆç®—è‡ªå·±çš„
    totalLfet += curElement.offsetLeft
    totalTop += curElement.offsetTop

    while (parant) {
        // åˆ¤æ–­æ˜¯ä¸æ˜¯IE8
        if (window.navigator.userAgent.indexOf("MSIE 8.0") === -1) {
            // ç´¯åŠ çˆ¶çº§å‚ç…§ç‰©çš„è¾¹æ¡†
            totalLfet += parant.clientLeft
            totalTop += parant.clientTop
        }
        // ç´¯åŠ çˆ¶çº§å¤–è¾¹æ¡†åˆ°ä¸Šçº§å‚ç…§ç‰©çš„è·ç¦»
        totalLfet += parant.offsetLeft
        totalTop += parant.offsetTop
        // é‡æ–°è®¾ç½®çˆ¶çº§å‚ç…§ç‰©
        parant = parant.offsetParent
        }
    return {left: totalLfet, top: totalTop}
}
```

![HTMLElement_offsetLeft_plus.png-119.5kB][3]

----------

## è¯¾æ—¶52ï¼šæµè§ˆå™¨æ»šåŠ¨æ¡å·å»çš„é«˜åº¦scrollTop

> åœ¨ä¹‹å‰åœ¨JavaScriptç›’å­æ¨¡å‹ä¸­ï¼šclientç³»åˆ—ã€offsetç³»åˆ—å’ŒscrollWidth/scrollHeightéƒ½æ˜¯[åªè¯»]å±æ€§ -> åªèƒ½é€šè¿‡å±æ€§è·å–ï¼Œä¸èƒ½é€šè¿‡å±æ€§ä¿®æ”¹å…ƒç´ çš„æ ·å¼ï¼

> ä½†scrollTopå’ŒscrollLfetï¼šæ»šåŠ¨æ¡å·å»çš„é«˜åº¦å’Œå®½åº¦ï¼Œåˆ™æ˜¯[å¯è¯»å†™]çš„å±æ€§ï¼

- `scrollTop`çš„å€¼æ˜¯å­˜åœ¨è¾¹ç•Œå€¼(æœ€å°å€¼å’Œæœ€å¤§å€¼)ï¼Œæˆ‘ä»¬è®¾ç½®çš„å€¼æ¯”æœ€å°å€¼å°æˆ–è€…æ¯”æœ€å¤§å€¼æ‰“éƒ½æ²¡ç”¨ï¼Œè¿”å›çš„ä¾ç„¶æ˜¯è¾¹ç•Œå€¼ï¼Œå³è¿”å›æœ€å°å€¼æˆ–è€…æœ€å¤§å€¼ã€‚
  - æœ€å°å€¼ = 0
  - æœ€å¤§å€¼ = `curElement.scrollHeight - curElement.clientHeight`

```html
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "å¾®è½¯é›…é»‘";
            font-size: 14px;
            /*ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡å­—*/
            -webkit-user-select: none;
            /*å…¼å®¹éwebkitå¤„ç†*/
            user-select: none;
        }

        html,
        body {
            width: 100%;
            /*è®©é¡µé¢é«˜åº¦ä¸º5ä¸ªå±å¹•é«˜åº¦*/
            height: 500%;
            background: lightgreen;
            /*CSS3 èƒŒæ™¯é¢œè‰²æ¸å˜å®ç°*/
            background: -webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
            background: webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
        }

        a {
            /*è®©aæ ‡ç­¾æ²¡æœ‰ä¸‹åˆ’çº¿*/
            text-decoration: node;
            color: #000000;
        }

        a:hover,
        a:active,
        a:visited,
        a:target {
            text-decoration: none;
            color: #000000;
        }

        #goTop {
            /*display: block;*/
            /*è®¾ç½®äº†positionåè‡ªç„¶æˆå—çº§å…ƒç´ */
            position: fixed;
            bottom: 80px;
            right: 50px;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background: red;
            /*CSS3ç›’å­åœ†è§’*/
            border-radius: 50%;
            opacity: 0.2;
            /*ä¸ºå…¼å®¹è€æµè§ˆå™¨*/
            filter: alpha(opacity=20);
        }
        /*è®¾ç½®é‚£ä¸ªidä¸ºgoTopçš„Aæ ‡ç­¾çš„hoverä¼ªç±»(çŠ¶æ€)çš„æ ·å¼*/
        #goTop:hover {
            opacity: 1;
            filter: alpha(opacit=100);
        }
    </style>
</head>

<body>
    <!--aä¾¿ç­¾æœ¬èº«æ˜¯åšé¡µé¢è·³è½¬çš„ï¼Œ
      1.å¦‚æœhrefå€¼ä¸ºç©ºåˆ™æ•ˆæœä¸ºåˆ·æ–°æœ¬é¡µé¢
      2.å¦‚æœhrefå€¼ä¸º#idï¼Œåˆ™ä¸ºé”šç‚¹å®šä½ï¼Œå°†scrollTopå€¼è®¾ä¸ºå…ƒç´ ç›¸å¯¹bodyçš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯å®šä¸ºè¯¥å…ƒç´ ã€‚
      3.å¦‚æœhrefå€¼ä¸ºâ€œjavascript:;â€ï¼Œåˆ™è¡¨ç¤ºå–æ¶ˆaæ ‡ç­¾çš„é»˜è®¤è·³è½¬è¡Œä¸º
    -->
    <a href="javscript:;" id="goTop">Top</a>

    <script type="text/javascript">
        var goTop = document.getElementById("goTop")
        goTop.onclick = function () {
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
        }
    </script>
</body>
</html>
```

----------

## è¯¾æ—¶53ï¼šå®æˆ˜é¡¹ç›®-å›åˆ°é¡¶éƒ¨

#### å®šæ—¶å™¨

```javascript
// è®¾ç½®å®šæ—¶å™¨(setTimeout)ï¼Œç­‰åˆ°1000msåæ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå®šæ—¶å™¨ç»“æŸã€‚
window.setTimeout(function () {}, 1000)

// è®¾ç½®å®šæ—¶å™¨(setInterval)ï¼Œç­‰åˆ°1000msåå¼€å§‹æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå®šæ—¶å™¨å¹¶æ²¡æœ‰ç»“æŸï¼Œä¹‹åæ¯éš”1000mså®šæ—¶å™¨éƒ½ä¼šæŠŠæ–¹æ³•æ‰§è¡Œä¸€æ¬¡ï¼Œç›´åˆ°æ‰‹åŠ¨æ¸…é™¤å®šæ—¶å™¨ä¸ºæ­¢
window.setInterval(function () {}, 1000)

// è®¾ç½®å®šæ—¶å™¨çš„æ—¶å€™æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨å½“å‰æ˜¯ç¬¬å‡ ä¸ªå®šæ—¶å™¨
var timer1 = window.setTimeout(function () {}, 1000)
console.log(timer1)  // -> 1
var timer2 = window.setTimeout(function () {}, 1000)
console.log(timer2)  // -> 2
var timer3 = window.setInterval(function () {}, 1000)
console.log(timer3)  // -> 3
window.clearTimeout(1)  // æ¸…é™¤å®šæ—¶å™¨æ—¶ï¼Œå‚æ•°ä¸ºä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæ¸…é™¤ç¬¬å‡ ä¸ªå®šæ—¶å™¨
window.clearInterval(timer2) // ä½¿ç”¨setTimeoutå£°æ˜ï¼Œä½†å¯ä»¥ä½¿ç”¨clearIntervalæ¸…é™¤

// å…³äºå¤šæ¬¡åŠ¨ç”»çš„å®ç°
// 1. ä½¿ç”¨setIntervalå®ç°ç®€ç‰ˆå¤šæ¬¡åŠ¨ç”»æ•ˆæœ
var n = 0
var timer = window.setInterval(function () {
  n++
  console.log(n)
  if (n === 5) {
    window.clearInterval(timer)
  }
}, 1000)

// 2. ä½¿ç”¨setTimeoutå®ç°ç®€ç‰ˆå¤šæ¬¡åŠ¨ç”»æ•ˆæœ
// é¦–å…ˆæ˜ç™½å·¥setTimeoutå°±ä¸éœ€è¦è¯·è®¡æ•°å™¨äº†
var n = 0
var timer = null
function move () {
  n++
  console.log(n)
  if (n === 5) return
  timer = window.setTimeout(move, 1000)
}
// æ‰§è¡Œå‰å¿…é¡»å†åŒ…ä¸€å±‚ï¼Œè¦ä¸ç„¶ç«‹é©¬å°±æ‰“1å‡ºæ¥ï¼Œå’Œä¸Šé¢çš„ä¸ä¸€æ ·
window.setTimeout(move, 1000)
```

#### ä¸€å·å‘

```javascript
document.body.clientHeight             // -> ã€é¡µé¢æœ€å¤§é«˜åº¦ã€‘
document.documentElement.clientHeight  // -> ã€ä¸€ä¸ªæµè§ˆå™¨å¯è§†é¡µé¢æœ€å¤§é«˜åº¦ã€‘
```

- å…³äºè·å–å½“å‰æµè§ˆå™¨å¯è§†é¡µé¢å®½å’Œé«˜çš„è®°å½•

```javscript
// ä¸€èˆ¬æ¥è¯´ä»¥ä¸‹æ–¹å¼è·å–æµè§ˆå™¨å¯è§†é¡µé¢çš„é«˜åº¦
var curHeight = document.documentElement.clientHeight || document.body.clientHeight

// ä½†å¦‚æœè¯´ CSSä¸­åŠ äº†ä»¥ä¸‹å±æ€§å
// html, body { height: 500% }
// document.documentElement.clientHeight çš„é«˜åº¦å°±ä¼šè¢«æ”¾å¤§5å€
// document.body.clientHeight çš„é«˜åº¦è¿˜æ˜¯æµè§ˆå™¨å¯ç°å®é¡µé¢çš„é«˜åº¦
```

```html
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "å¾®è½¯é›…é»‘";
            font-size: 14px;
            /*ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡å­—*/
            -webkit-user-select: none;
            /*å…¼å®¹éwebkitå¤„ç†*/
            user-select: none;
        }

        html, body {
            width: 100%;
            /*è®©é¡µé¢é«˜åº¦ä¸º5ä¸ªå±å¹•é«˜åº¦*/
            height: 500%;
            background: lightgreen;
            /*CSS3 èƒŒæ™¯é¢œè‰²æ¸å˜å®ç°*/
            background: -webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
            background: linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
        }

        a {
            /*è®©aæ ‡ç­¾æ²¡æœ‰ä¸‹åˆ’çº¿*/
            text-decoration: none;
            color: #000000;
        }

        a:hover,
        a:active,
        a:visited,
        a:target {
            text-decoration: none;
            color: #000000;
        }

        #goTop {
            /*display: block;*/
            /*è®¾ç½®äº†positionåè‡ªç„¶æˆå—çº§å…ƒç´ */
            position: fixed;
            bottom: 80px;
            right: 50px;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background: red;
            /*CSS3ç›’å­åœ†è§’*/
            border-radius: 50%;
            opacity: 0.2;
            /*ä¸ºå…¼å®¹è€æµè§ˆå™¨*/
            filter: alpha(opacity=20);
            /*é»˜è®¤éšè—*/
            display: none;
        }

        #goTop:hover {
            opacity: 1;
            filter: alpha(opacity=100);
        }
    </style>
</head>

<body>
    <a href="javascript:;" id="goTop">Top</a>

    <script type="text/javascript">
        var goTop = document.getElementById("goTop");

        window.onscroll = function () {
            if (currentScrollTop() < getCurrentScreenHeight()) {
                goTop.style.display = "none"
            } else {
                goTop.style.display = "block"
            }
        };

        goTop.onclick = function () {
            var step = (currentScrollTop() / 100).toFixed(); // è·å–å½“ç‚¹å‡»æ—¶æ»šåŠ¨æ¡å·å»çš„é«˜åº¦å†é™¤ä»¥100ä¸ºæ­¥é•¿,ç®€å•æ¥è¯´å°±æ˜¯æ»š100å“ˆæ»šåˆ°å¤´
            var timer = window.setInterval(function () {
                var target = currentScrollTop() - step;
                currentScrollTop(target); // è®¾ç½®æ»šåŠ¨æ¡
                if (currentScrollTop() === 0) {
                    window.clearInterval(timer) // æ¸…é™¤è®¡æ—¶å™¨
                }
            }, 5); //5ms
        };

        function currentScrollTop (num) {
            if(num === undefined) return document.documentElement.scrollTop || document.body.scrollTop;
            document.documentElement.scrollTop = num;
            document.body.scrollTop = num;
        }
        // å½“å‰æµè§ˆå™¨å¯è§†é¡µé¢çš„é«˜åº¦
        function getCurrentScreenHeight () {
            // å•ç‹¬ä¸ºäº†å¤„ç† html,body{height:500%}çš„æƒ…å†µ
            if(document.documentElement.clientHeight !== 0 && document.documentElement.clientHeight > document.body.clientHeight) return document.body.clientHeight;
            return document.documentElement.clientHeight || document.body.clientHeight;
        }
    </script>
</body>
</html>
```

----------

## è¯¾æ—¶53ï¼šä½œä¸šé¢˜-äº¬ä¸œé¦–é¡µå¯¼èˆªæ å®ç°

- ver1
  - ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œç›´æ¥æŠŠäº¬ä¸œé¦–é¡µæ•´é¡µæˆªå›¾ï¼Œç„¶åç”¨10ä¸ªdivæŠŠå›¾ç‰‡åˆ†ä¸º12ä¸ªéƒ¨åˆ†ï¼Œè™½ç„¶åŠŸèƒ½éƒ½å®ç°äº†ï¼Œä½†å¯¼èˆªæ çš„åŒæ­¥å¾ˆä¸å®Œç¾å•Šï¼Œä¸ºäº†å’Œäº¬ä¸œé¦–é¡µçš„å¯¼èˆªæ åŒæ­¥ç‡é«˜è¾¾98.47%ï¼Œè¿˜æ˜¯æŠŠæ‰€æœ‰æ¿å—éƒ½åˆ†å¼€æˆªå›¾ï¼Œåˆ†å¼€æ”¾åœ¨12ä¸ªdivé‡Œã€‚

- ver2
  - é¦–é¡µæˆªå›¾ç»†åˆ†12ä¸ªæ¿å— 
 
----------

## è¯¾æ—¶54ï¼šå®æˆ˜é¡¹ç›®-è·‘é©¬ç¯

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ»šåŠ¨æ¡æ˜¾ç¤ºæ–‡å­—</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "PingFang SC";
            font-size: 16px;
        }

        #box {
            height: 30px;
            width: 600px;
            padding: 0 10px;
            margin: 50px auto;
            border: 2px dashed green;
            background: lightgreen;
            overflow: hidden;
        }

        #box div {
            height: 22px;
            /*å¦‚æœæº¢å‡ºï¼Œåˆ™æ˜¾ç¤ºæ»šåŠ¨æ¡*/
            /*overflow: auto;*/
            /*å¼ºåˆ¶æ–‡å­—æº¢å‡ºä¸æ¢è¡Œ*/
            white-space: nowrap;
            margin: 2px auto;
            display: inline-block;
        }

        .stitle {
            color: #c81623;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="box">
        <div id="wrap">
            <div id="conBegin">
                <span class="stitle">åè¨€è­¦å¥ï¼š</span>åªè¦ä¸‹å®šå†³å¿ƒå…‹æœææƒ§ï¼Œä¾¿å‡ ä¹èƒ½å…‹æœä»»ä½•ææƒ§ã€‚å› ä¸ºï¼Œè¯·è®°ä½ï¼Œé™¤äº†åœ¨è„‘æµ·ä¸­ï¼Œææƒ§æ— å¤„è—èº«ã€‚â€”â€”æˆ´å°”Â·å¡è€åŸº
            </div>
            <div id="conEnd">
                <span class="stitle">åè¨€è­¦å¥ï¼š</span>åªè¦ä¸‹å®šå†³å¿ƒå…‹æœææƒ§ï¼Œä¾¿å‡ ä¹èƒ½å…‹æœä»»ä½•ææƒ§ã€‚å› ä¸ºï¼Œè¯·è®°ä½ï¼Œé™¤äº†åœ¨è„‘æµ·ä¸­ï¼Œææƒ§æ— å¤„è—èº«ã€‚â€”â€”æˆ´å°”Â·å¡è€åŸº
            </div>
        </div>
    </div>
    <!--ä¸ºäº†è§£å†³æ»šåŠ¨åˆ°åº•åè°ƒå¤´æ˜¯çš„é—ªçƒï¼Œå†å¤åˆ¶ä¸€ä¸ªï¼Œæ’åˆ—åœ¨å…¶åï¼Œä½¿å…¶çœ‹ä¸Šå»åƒæ˜¯è¿ç»­çš„ï¼Œå’Œç”µå½±åŠ¨ç”»åˆ¶ä½œåŸç†ä¸€æ ·ã€‚-->
<script type="text/javascript">
    var box = document.getElementById("box");
    var wrap = document.getElementById("wrap");
    var conBegin = document.getElementById("conBegin");
    var timer = window.setInterval(function () {
        var target = conBegin.clientWidth;
        box.scrollLeft += 1;
        var cur = box.scrollLeft;
        if(cur >= target) {
            box.scrollLeft = 0;
        }
    }, 10)
</script>
</body>
</html>
```

----------

## å¯æ˜¯55ï¼šæ·±å…¥æ‰©å±•-JSåŒæ­¥ä¸å¼‚æ­¥ç¼–ç¨‹

- JavaScriptéƒ½æ˜¯å•çº¿ç¨‹çš„ -> JSå°±æ˜¯ä¸ªå•¥å­ï¼Œè„‘å­ä¸€æ ¹ç­‹ï¼Œåšç€æ‰‹å¤´ä¸Šçš„äº‹æƒ…ï¼Œæ²¡æœ‰å®Œæˆå‰ç»å¯¹ä¸ä¼šå»åšä¸‹ä¸€ä»¶äº‹ä»¶

- åŒæ­¥ï¼šä¸Šä¸€ä»¶äº‹æƒ…æ²¡æœ‰å®Œæˆï¼Œç»§ç»­å¤„ç†ä¸Šä¸€ä»¶äº‹æƒ…ï¼Œåªæœ‰ä¸Šä¸€ä»¶äº‹æƒ…å®Œæˆäº†ï¼Œæ‰ä¼šåšä¸‹ä¸€ä»¶äº‹æƒ…(JSä¸­å¤§éƒ¨åˆ†æ˜¯åŒæ­¥)

- å¼‚æ­¥
  - JavaScriptä¸­å¼‚æ­¥ç¼–ç¨‹çš„å››ç§æƒ…å†µï¼šå®šæ—¶å™¨éƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹ã€æ‰€æœ‰çš„äº‹ä»¶ç»‘å®šéƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹ã€Ajaxè¯»å–æ•°æ®ä¹Ÿæ˜¯å¼‚æ­¥çš„ã€å›è°ƒå‡½æ•°ä¹Ÿæ˜¯å¼‚æ­¥çš„

```javascript
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
} ,1000)
console.log(n)
// è¾“å‡ºç»“æœï¼š 0ï¼Œ1  (ä¸­é—´æœ‰1000msçš„ç­‰å¾…å†è¾“å‡º1)
//------------------------------
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
} ,0)
console.log(n)
// è¾“å‡ºç»“æœï¼š 0ï¼Œ1 
```

- æ¯ä¸ªæµè§ˆå™¨å¯¹äºå®šæ—¶å™¨çš„ç­‰å¾…æ—¶é—´éƒ½æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼šchrome:5~6ms, ie:10~13msã€‚å¦‚æœè®¾ç½®çš„ç­‰å¾…æ—¶é—´å°äºè¿™ä¸ªå€¼ï¼Œä¹Ÿä¸ä¼šèµ·ä½œç”¨çš„ï¼Œè¿˜æ˜¯éœ€è¦ç­‰åˆ°æœ€å°å€¼çš„æ—¶é—´åæ‰å»æ‰§è¡Œå®šæ—¶å™¨é‡Œçš„æ–¹æ³•ã€‚å°¤å…¶æ˜¯å†™0ä¹Ÿä¸æ˜¯ç«‹å³æ‰§è¡Œï¼

```javascript
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
}, 0)
console.log(n)
while (1) {
  n++
}
console.log(n)
// è¿™æ®µä»£ç ä¼šè¢«whileå¾ªç¯ä¸€è‡´å¡æ­»ï¼Œå¯¼è‡´å®šæ—¶å™¨æ²¡å¾—æ—¶é—´å…è®¸æ–¹æ³•ï¼Œä¹Ÿå¯¼è‡´æœ€åä¸€è¡Œä»£ç æ²¡å¾—æ‰§è¡Œ
// æœ€ååªè¾“å‡º 0
```

- å®šæ—¶å™¨è®¾ç½®çš„ç­‰å¾…æ—¶é—´ä¸ä¸€å®šæ˜¯å®é™…é¢„æœŸé‚£ä¸‹æ‰§è¡Œçš„æ—¶é—´ï¼Œå› ä¸ºå¦‚æœå®šæ—¶å™¨ä¹‹åè¿˜æœ‰åˆ«çš„ä¸€å¤§å †ä»£ç è¦æ‰§è¡Œï¼Œåˆ™ä¸ç®¡å®šæ—¶å™¨å®šæ—¶çš„æ—¶é—´æœ‰æ²¡æœ‰åˆ°ï¼Œéƒ½æ˜¯ä¸ä¼šå»æ‰§è¡Œå®šæ—¶å™¨çš„ï¼ --> å•çº¿ç¨‹çš„å®Œç¾ä½“ç°

```javascript
var n = 0
window.setTimeout(function () {
  n += 2
  console.log(n)
}, 50)

window.setTimeout(function () {
  n += 5
  console.log(n)
}, 5)
console.log(n)
for (var i=0;i<1000000;i++) {}
console.log(n)
// è¾“å‡ºç»“æœä¾æ¬¡ï¼š 0 0 5 7
```

![task-queue.png-76.6kB][4]

----------

## è¯¾æ—¶56ï¼šå»¶è¿ŸåŠ è½½æ€æƒ³å’Œé¦–å±å»¶è¿ŸåŠ è½½

> å»¶è¿ŸåŠ è½½çš„ä½œç”¨ï¼šä¿è¯é¡µé¢æ‰“å¼€çš„é€Ÿåº¦

- åŸç†
  1. å¯¹äºé¦–å±å†…å®¹ä¸­çš„å›¾ç‰‡ï¼šé¦–å…ˆç»™å¯¹åº”çš„åŒºåŸŸä¸€å¼ é»˜è®¤å›¾ç‰‡ç«™ç€ä½ç½®(é»˜è®¤å›¾ç‰‡éœ€è¦éå¸¸å°ï¼Œä¸€èˆ¬1~5kbä»¥å†…)ï¼Œå½“é¦–å±å†…å®¹éƒ½åŠ è½½å®Œæ¯•ä»¥å(ä¹Ÿå¯ä»¥é¢„è®¾ä¸€ä¸ªå»¶è¿ŸåŠ è½½æ—¶é—´)ï¼Œå†å¼€å§‹åŠ è½½çœŸå®å›¾ç‰‡
  2. å¯¹äºå…¶å®ƒå±ä¸­çš„å›¾ç‰‡ï¼Œä¹Ÿæ˜¯ç»™å®šä¸€ä¸ªé»˜è®¤çš„å›¾ç‰‡ç«™ä½ï¼Œå½“æ»šåŠ¨æ¡æ»šåˆ°å¯¹åº”åŒºåŸŸæ—¶ï¼Œå°±å¼€å§‹åŠ è½½æ”¹åŒºåŸŸçš„çœŸå®å›¾ç‰‡

- å…³äºè¯­å¥çš„å¼‚æ­¥åŠ è½½ï¼Œå¼€å§‹åªæŠŠå‰ä¸¤å±çš„æ•°æ®åŠ è½½ç»‘å®šå‡ºæ¥ï¼Œåé¢çš„æ•°æ®ä¸è¿›è¡Œå¤„ç†ï¼Œå½“é¡µé¢æ»šåˆ°å¯¹åº”åŒºåŸŸæ—¶å†å¼€å§‹ä»æ–°è¯·æ±‚æ•°æ®ç„¶åç»‘å®šæ¸²æŸ“æ•°æ®
  
#### DEMOå®ç°æ­¥éª¤

- ç»™imgåŒ…ä¸€ä¸ªå®¹å™¨divï¼Œæ ·å¼é‡Œé»˜è®¤ç»™imgæ ‡ç­¾é»˜è®¤éšè—ï¼Œå¹¶ä¸”ç»™åŒ…imgçš„å®¹å™¨divåŠ ä¸€ä¸ªé»˜è®¤å ä½å›¾ç‰‡ 
- jsä¸­å…ˆè®¾ä¸€ä¸ªå®šæ—¶å™¨æ¨¡æ‹Ÿå»¶æ—¶åŠ è½½ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªä¸´æ—¶imgæ ‡ç­¾ï¼Œç”¨è¿™ä¸ªä¸´æ—¶imgæ ‡ç­¾æ‹¿img.onloadäº‹ä»¶ç›‘å¬å›¾ç‰‡èƒ½æ­£å¸¸åŠ è½½äº‹ä»¶ï¼Œå¦‚æœæˆåŠŸå°±èµ‹å€¼çœŸå®å›¾ç‰‡åœ°å€ç»™img

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡å»¶è¿ŸåŠ è½½</title>
    <style type="text/css">
        #box {
            width: 1000px;
            height: 410px;
            border: 2px solid lightgray;
            padding: 2px;
            margin: 20px auto;
            background: url("./img/tb_default.gif") no-repeat center #fefefe;
        }
        #box img {
            height: 100%;
            width: 100%;
            display: none;
        }
    </style>
<body>
<div id="box">
    <img src="" rscr="./img/yngf.jpg" alt="yngf">
</div>

<script type="text/javascript">
    console.log(document.images[0].attributes["rscr"].nodeValue);
    var timer = window.setTimeout(function () {
        var rsrc = document.images[0].getAttribute("rscr");
        // åˆ›å»ºimgå¯¹è±¡çš„æ™®é€šæ–¹æ³•
        // var timg = document.createElement("img")
        // ä¹Ÿå¯ä»¥ç›´æ¥ç”¨Imageæ„é€ å‡½æ•°å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡
        var timg = new Image;
        timg.src = rsrc; // å¤åˆ¶ç›®æ ‡å›¾ç‰‡urlç»™ä¸´æ—¶å›¾ç‰‡å¯¹è±¡
        // Image.onload ç›‘å¬å›¾ç‰‡æ­£å¸¸åŠ è½½äº‹ä»¶
        timg.onload = function () {
            document.images[0].style.display = "block";
            document.images[0].src = rsrc;
        };
    }, 1000)
</script>
</body>
</html>
```

----------

## è¯¾æ—¶57ï¼šå•å¼ å›¾ç‰‡çš„å»¶è¿ŸåŠ è½½



----------

## è¯¾æ—¶58ï¼šå¤šå¼ å›¾ç‰‡çš„å»¶è¿ŸåŠ è½½å®æˆ˜

- å¤§æ¦‚æ­¥éª¤ï¼š
  - Ajaxè¿œç¨‹è·å–åç«¯æ•°æ® -> jsonæ ¼å¼
  - æ•°æ®ç»‘å®š -> æŠŠjsonæ•°æ®è½¬æ¢å¯¹è±¡åç»‘å®šåˆ°é¡µé¢å…ƒç´ ä¸Šï¼Œä¸‰ç§æ–¹æ³•ä¸­é€‰å­—ç¬¦ä¸²æ‹¼æ¥
  - å›¾ç‰‡å»¶è¿ŸåŠ è½½
  - é¡µé¢åŠ è½½å®Œæ¯•500msååŠ è½½é¦–å±å›¾ç‰‡
