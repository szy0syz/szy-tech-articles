# ç å³°å‰ç«¯å…¨æ ˆåŸ¹è®­ç¬¬ä¸‰å‘¨ï¼šdomç›’å­æ¨¡å‹å®æˆ˜å’Œdomåº“å°è£…

## è¯¾æ—¶48ï¼šç›’å­æ¨¡å‹å¸¸ç”¨çš„å±æ€§(å‰8ä¸ª)

***JavaScriptç›’å­æ¨¡å‹æŒ‡çš„æ˜¯é€šè¿‡JSæä¾›çš„ä¸€äº›åˆ—å±æ€§å’Œæ–¹æ³•ï¼Œè·å–é¡µé¢ä¸­å…ƒç´ çš„æ ·å¼ä¿¡æ¯å€¼(å°±æ˜¯è·å–domå¯¹è±¡åæ“ä½œé‚£äº›å…³äºæ ·å¼çš„å±æ€§å’Œæ–¹æ³•)***

![image.png-72.1kB][1]

å†…å®¹çš„å®½åº¦å’Œé«˜åº¦å°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„widthå’Œheightè¿™ä¸¤ä¸ªæ ·å¼å°±æ˜¯å†…å®¹çš„å®½å’Œé«˜ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®é«˜åº¦å€¼ï¼Œå®¹å™¨çš„é«˜åº¦ä¼šæ ¹æ®é‡Œé¢å†…å®¹è‡ªå·±è¿›è¡Œé€‚åº”ï¼Œè¿™æ ·è·å–çš„å€¼å°±æ˜¯çœŸå®å†…å®¹çš„é«˜ï¼›å¦‚æœè®¾ç½®äº†å›ºå®šçš„é«˜åº¦äº†ï¼Œä¸ç®¡å†…å®¹æ˜¯å¤šå°‘äº†è¿˜æ˜¯å°‘äº†ï¼Œå…¶å†…å®¹çš„é«˜åº¦ä¼šå›ºå®šä¸ºæˆ‘ä»¬è®¾ç½®çš„é‚£ä¸ªå€¼ã€‚

çœŸå®çš„å†…å®¹çš„é«˜åº¦å’Œå®½åº¦ï¼šè¿™ä¸ªä»£æŒ‡çš„æ˜¯æˆ‘ä»¬å®é™…å†…å®¹çš„é«˜åº¦(å’Œæˆ‘ä»¬è®¾ç½®çš„heightæ²¡æœ‰å¿…ç„¶å…³ç³»)ï¼Œä¾‹å¦‚ï¼šæˆ‘ä»¬è®¾ç½®é«˜åº¦ä¸º200pxï¼Œå¦‚æœå†…å®¹æœ‰æº¢å‡ºï¼Œé‚£ä¹ˆçœŸæ˜¯å†…å®¹çš„é«˜åº¦ä¼šæŠŠæº¢å‡ºå†…å®¹çš„é«˜åº¦ä¹ŸåŠ è¿›æ¥ã€‚

#### clientç³»åˆ—å±æ€§
- clientHeight/clientWidthï¼šå†…å®¹+ä¸Šä¸‹æˆ–å·¦å³paddingå¡«å……çš„å€¼(å’Œå†…å®¹æ˜¯å¦æº¢å‡ºæ²¡å…³ç³»)
- clientLeft/clientTopï¼šå·¦è¾¹æ¡†çš„å®½åº¦/ä¸Šè¾¹æ¡†çš„é«˜åº¦ (å°±æ˜¯border[Left/Top]Width)

#### offsetç³»åˆ—å±æ€§

- offsetHeight/offsetWidthï¼šå…¨ç­‰äº(clientHeight+ä¸Šä¸‹borderè¾¹æ¡†)/(clientWidth+å·¦å³borderè¾¹æ¡†) -> åŒæ ·çš„å’Œå†…å®¹æ˜¯å¦æº¢å‡ºæ²¡æœ‰ä»»ä½•å…³ç³»
- offsetParentï¼šå½“å‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©
- offsetLeft/offsetTopï¼šå½“å‰å…ƒç´ çš„å¤–è¾¹æ¡†è·ç¦»çˆ¶çº§å‚ç…§ç‰©å†…è¾¹æ¡†çš„åç§»é‡

#### scrollç³»åˆ—å±æ€§

- scrollHeight/scrollWidth
  - åœ¨å†…å®¹æ²¡æº¢å‡ºçš„å‰æä¸‹ï¼Œä¸¤è€…å’ŒclientHeigth/clientWidthä¸€æ ·ï¼›
  - åœ¨å†…å®¹æœ‰æº¢å‡ºçš„å‰æä¸‹ï¼Œä¸¤è€…è·å–çš„å€¼æœ‰å¦‚ä¸‹è§„åˆ™ï¼šscrollHeightä¸ºçœŸå®å†…å®¹çš„é«˜åº¦(åŒ…å«æº¢å‡º)+ä¸Špaddingå¡«å……ï¼ŒscrollWidthä¸ºçœŸå®å†…å®¹çš„å®½åº¦+å·¦paddingå¡«å……ï¼›ä¸¤è€…è·å–çš„ç»“æœå€¼éƒ½æ˜¯â€œçº¦ç­‰äºâ€çš„å€¼ï¼Œå› ä¸ºåœ¨ç»Ÿä¸€æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¦è®¾ç½®äº†cssæ ·å¼`overflow:'ha  dden'`å¯¹äºæœ€ç»ˆçš„ç»“æœæ˜¯æœ‰å½±å“çš„ï¼›åœ¨ä¸åŒæµè§ˆå™¨ä¸­æˆ‘ä»¬å›å»çš„ç»“æœå€¼ä¹Ÿæ˜¯ä¸åŒ(IE6~7)

- scrollLeft/scrollTopï¼šæ»šåŠ¨æ¡å·å»çš„å®½åº¦æˆ–é«˜åº¦

#### å…³äºJavaScriptç›’å­æ¨¡å‹å–å€¼çš„é—®é¢˜

- æˆ‘ä»¬é€šè¿‡ğŸ‘†ä¸Šé¢ğŸ‘†è¿™13ä¸ªå±æ€§å€¼

#### å…³äºæ“ä½œæµè§ˆå™¨æœ¬èº«çš„ç›’å­æ¨¡å‹ä¿¡æ¯

```javascript
document.documentElement.scrollTop // -> æˆ‘ä»¬å‘ç°è¿™è´§å“ˆå“ˆéƒ½æ˜¯0ï¼Œä¸ä¼šå˜ï¼
document.body.scrollTop // -> åˆå‘ç°è¿™è´§ä¼šéšç€æ»šåŠ¨æ¡è€Œæ”¹å˜ï¼Œä½ è®¾ç½®å®ƒåæµè§ˆå™¨çš„å®é™…æ»šåŠ¨æ¡éƒ½ä¼šæ”¹å˜ï¼
```

- å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼ŒclientWidthå’ŒclientHeightæ˜¯å½“å‰å¯è§åŒºåŸŸ(ä¸‹é¢å¯èƒ½è¿˜æœ‰å†…å®¹)çš„å®½å’Œé«˜
- scrollWidth/scrollHeightå°±æ˜¯å½“å‰é¡µé¢çš„çœŸå®å®½åº¦å’Œé«˜åº¦(æ‰€æœ‰è¦æ˜¾ç¤ºå†…å®¹åŠ èµ·æ¥çš„å®½é«˜ï¼Œä½†æ˜¯ä¸ªçº¦ç­‰äºå€¼ï¼Œè‹¥æœ‰æ‡’æƒ°åŠ è½½çš„å›¾ç‰‡ä¼šå½±å“é«˜åº¦)
- ä»…å¯¹æ“ä½œæµè§ˆå™¨é¡µé¢---->æˆ‘ä»¬ä¸ç®¡è¦è¯»å†™å“ªäº›å±æ€§ï¼Œä¹Ÿä¸ç®¡æ˜¯ç”¨ä»€ä¹ˆæµè§ˆå™¨ï¼Œæƒ³è¦éƒ½å…¼å®¹çš„è¯ï¼Œéœ€è¦è¯»å†™ä¸¤å¥—å±æ€§ï¼š
  - `document.documentElement[attr] || document.body[attr]` 
  - è€Œä¸”åœ¨æ“ä½œæ—¶å¿…é¡»`document.documentElement[attr]`å…ˆæ“ä½œ

```javascript
// [è·å–å½“å‰é¡µé¢çš„çœŸå®å®½åº¦æˆ–é«˜åº¦]
var winHeight = document.documentElement.clientWidth || document.body.clientWidth
// [è®¾ç½®å½“å‰é¡µé¢æ»šåŠ¨æ¡çš„é«˜åº¦]
document.documentElement.scrollTop = 1000
document.body.scrollTop = 1000

// å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œå®ç°å¯¹æµè§ˆå™¨å„é¡¹å±æ€§çš„è¯»å†™
function win (attr, val) {
  if (!attr) {
    return document.documentElement[attr] || document.body[attr]
  }
  document.documentElement[attr] = val
  document.body[attr] = val
}
```

----------

## è¯¾æ—¶49ï¼šè·å–å…ƒç´ çš„å…·ä½“æ ·å¼ä¿¡æ¯

#### è·å–å…ƒç´ çš„æŸä¸€ä¸ªå…·ä½“çš„æ ·å¼å±æ€§å€¼

- å…ƒç´ .style.å±æ€§å -> `xxxx.style.height` -> è¿™æ ·jsè·å–çš„æ˜¯æŸä¸ªdomå…ƒç´ çš„CSSStyleDeclarationè¡Œå†…æ ·å¼å±æ€§ï¼Œä¸èƒ½ç´¢å–åˆ°åœ¨æ ·å¼è¡¨ä¸­è®¾ç½®çš„heightå€¼ã€‚çœŸå®é¡¹ç›®ä¸­ä¸å¸¸ç”¨ï¼Œå› ä¸ºä¸èƒ½æŠŠæ‰€æœ‰æ ·å¼éƒ½å†™åœ¨è¡Œå†…æ ·å¼ä¸Šï¼Œè¿™æ ·æ— æ³•å®ç°csså’Œhtmlçš„åˆ†ç¦»ã€‚

- window.getComputedStyleï¼šæ–¹æ³•è·å–æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—è¿‡çš„æ ·å¼
  - æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—è¿‡çš„æ ·å¼ï¼šåªè¦å½“å‰çš„å…ƒç´ æ ‡ç­¾å¯ä»¥åœ¨é¡µé¢ä¸­å‘ˆç°å‡ºæ¥ï¼Œé‚£ä¹ˆå®ƒçš„æ‰€æœ‰çš„æ ·å¼éƒ½æ˜¯ç»è¿‡æµè§ˆå™¨è®¡ç®—(æ¸²æŸ“)è¿‡çš„ï¼Œå“ªæ€•æœ‰äº›æ ·å¼æ²¡å†™ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å–åˆ°ã€‚
  - æ­¤æ–¹æ³•è™½ç„¶å¥½ç”¨ï¼Œä½†åœ¨IE6~8ä¸‹ä¸å…¼å®¹ï¼Œå› ä¸ºwindowä¸‹æ²¡æœ‰getComputedStyleæ–¹æ³•
  - åœ¨IE6~8ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨`window.currentStyle`æ–¹æ³•æ¥è·å–æ‰€æœ‰é€šè¿‡æµè§ˆå™¨æ¸²æŸ“è¿‡çš„æ ·å¼

```javascript
window.getComputedStyle // -> function getComputedStyle() { [native code] }
window.getComputedStyle(box, null) // è¿”å›CSSStyleDeclarationè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œå…¶åŒ…å«äº†å½“å‰å…ƒç´ çš„æ‰€æœ‰æ ·å¼å’Œå€¼
// window.getComputedStyle(å‚æ•°1, å‚æ•°2) å‚æ•°1å†™domå…ƒç´ ï¼Œå‚æ•°2ä¸ºå½“å‰å…ƒç´ çš„ä¼ªç±»(ä¸€èˆ¬ä¸ç”¨ä¼ªç±»æ•…å†™null)

// æ–¹æ³•getCssï¼šå…¼å®¹(ie6~8)æ–¹å¼è·å–å…ƒç´ å½“å‰æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—æ¸²æŸ“è¿‡çš„æ ·å¼ä¸­çš„[attr]å¯¹åº”çš„å€¼
// curEl, domå¯¹è±¡
// attr, æ ·å¼çš„å±æ€§å
function getCss (curEl, attr) {
  // æ–¹æ³•1ï¼šä½¿ç”¨try catchå¤„ç†å…¼å®¹
  // æ­¤æ–¹æ³•é—®é¢˜ï¼šå¿…é¡»ä¿å­˜tryä¸­çš„ä»£ç åœ¨ä¸å…¼å®¹æµè§ˆå™¨ä¸­æ‰§è¡Œæ—¶æŠ¥é”™ï¼Œæ‰å¯ä»¥ç”¨catchæ•è·åˆ°å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚è€Œä¸ç®¡æ˜¯ä»€ä¹ˆæµè§ˆå™¨éƒ½éœ€è¦æ‰§è¡Œtryä¸­çš„ä»£ç ï¼Œå¦‚æœå·²ç»æ˜¯åœ¨IE6~8ä¸­ï¼Œä¹Ÿè¦æ‰§è¡Œä¸€éå»æŠ¥é”™äº†æ‰å¤„ç†ï¼Œæµªè´¹æ€§èƒ½ã€‚
//  try {
//    return window.getComputedStyle(curEl, null)[attr]
//  } catch (e) {
//    console.log('ä½ ç«Ÿç„¶åœ¨ç”¨IE6~8ï¼')
//    return curEl.currentStyle[attr]
//  }

  // æ–¹æ³•2ï¼šæå‰åˆ¤æ–­windowå¯¹è±¡æ˜¯å¦æœ‰getComputedStyleå±æ€§
//  var val = null
//  if("getComputedStyle" in window) {
//    val = window.getComputedStyle(curEl, null)[attr]
//  } else {
//    val = curEl.currentStyle[attr]
//  }

  // æ–¹æ³•3ï¼šé€šè¿‡æ£€æŸ¥æµè§ˆå™¨ç‰ˆæœ¬å’Œç±»å‹æ¥å¤„ç†å…¼å®¹
  // -> window.navigator.userAgent
  // MAC Chrome -> "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36"
  if (/MSIE [678]/.test(window.navigator.userAgent)) {
    return window.getComputedStyle(curEl, null)[attr]
  } else {
    return curEl.currentStyle[attr]
  }
}
// getCss(box, "border") // åœ¨IE6~8ä¸­è¿˜æ˜¯æ²¡æœ‰
// getCss(box, "borderTop") // æŠŠå¤åˆå€¼æ‹†å¼€æ¥å†™é¿å…å‡ºç°ä¸å…¼å®¹é—®é¢˜
// å¯¹äºæ ‡å‡†æµè§ˆå™¨å’ŒIEæµè§ˆå™¨è·å–çš„ç»“æœè¿˜æ˜¯ä¸ä¸€æ ·çš„ -> å¯¹äºéƒ¨åˆ†æ ·å¼ï¼Œä¸åŒæµè§ˆå™¨ç»“æœä¸ä¸€æ ·ï¼Œä¸»è¦ç”±äºgetComputedStyleå’ŒcurrentStyleåœ¨æŸäº›æ–¹é¢è¿˜æ˜¯æœ‰ä¸ä¸€æ ·çš„ã€‚
```

***å†™CSSçš„æ—¶å€™ï¼Œæœ€å¥½ç¬¬ä¸€æ­¥åˆå§‹åŒ–é»˜è®¤æ ·å¼ï¼Œé¿å…æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ï¼Œè€Œä¸”å†™çš„é»˜è®¤æ ·å¼å¯¹äºJSä»¥åè·å–åˆ°çš„ç»Ÿä¸€ç»“æœä¹Ÿæ˜¯å¾ˆæœ‰å¸®åŠ©***

- getCssç¬¬ä¸€æ¬¡å‡çº§

```javascript
function getCss (curEl, attr) {
  var val = null
  var reg = /^-?\d+(\.\d+)?(px|pt|rem|em)?$/
  // var val = reg = null , è¿™æ ·å†™regå°±è¢«æ•´æˆå…¨å±€äº†ï¼
  if ("getComputedStyle" in window) {
    val = window.getComputedStyle(curEl, null)[attr]
  } else {
    val = curEl.currentStyle[attr]
  }
  // è¿”å›å‰å¿…é¡»å¤„ç†å¤åˆå€¼ï¼Œå¦‚padding backgroundï¼Œpositionï¼Œfloatç­‰
  // åŒ¹é…ï¼šè´Ÿå·å¯æœ‰å¯æ— åå†è·Ÿ1åˆ°å¤šä¸ºæ•°å­—, å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œå•ä½ç¬¦å·å¯æœ‰å¯æ— 
  return reg.test(val) ? parseFloat(val) : val
}
```

- ***getCssç¬¬äºŒæ¬¡å‡çº§ï¼šé’ˆå¯¹æœ‰äº›IE6~8ä¸å…¼å®¹opacityå±æ€§***

```javascript
// getCss: å…¼å®¹(ie6~8)æ–¹å¼è·å–å…ƒç´ å½“å‰æ‰€æœ‰ç»è¿‡æµè§ˆå™¨è®¡ç®—æ¸²æŸ“è¿‡çš„æ ·å¼ä¸­çš„[attr]å¯¹åº”çš„å€¼
// opacity: 0.5; /*é€æ˜åº¦ï¼Œåœ¨IE6~8ä¸­ä¸å…¼å®¹*/
// fliter: alpha(opacity=10); /*å…¼å®¹æ–¹æ³•ä½¿ç”¨æ»¤é•œæ¥å¤„ç†*/
function getCss (curEl, attr) {
  var val = null
  // åŒ¹é…ï¼šè´Ÿå·å¯æœ‰å¯æ— åå†è·Ÿ1åˆ°å¤šä¸ºæ•°å­—, å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œå•ä½ç¬¦å·å¯æœ‰å¯æ— 
  var reg = /^-?\d+(\.\d+)?(px|pt|rem|em)?$/
  // var val = reg = null , è¿™æ ·å†™regå°±è¢«æ•´æˆå…¨å±€äº†ï¼
  if ("getComputedStyle" in window) {
    val = window.getComputedStyle(curEl, null)[attr]
  } else { // -> å¦‚æœæ˜¯IE6~8
    if (attr === 'opacity') {
      val = curEl.currentStyle[attr]
      // æ­£åˆ™è§£é‡Šï¼šalphaå¼€å¤´ï¼Œå°æ‹¬å·å­—ç¬¦éœ€ç”¨è½¬ä¹‰ç¬¦è½¬ä¹‰ï¼Œç„¶åæ‹¬å·é‡Œæ˜¯1åˆ°å¤šä½æ•°ï¼Œåé¢å°æ•°éƒ¨åˆ†å¯æœ‰å¯æ— ï¼Œé‡Œé¢?:æŒ‡æ˜ä¸æ•è·å†…å®¹ï¼Œæœ€åå¿½ç•¥å¤§å°å†™
      reg = /^alpha\(opacity=(\d+(?:\.\d+)?)\)$/i
      // å…ˆåŒ¹é…ï¼Œåœ¨æ•è·ç¬¬ä¸€ä¸ªå°æ­£åˆ™å†…å®¹ï¼Œå¦‚æœä¸æ˜¯å°±è¿”å›1
      val = reg.test(val) ? reg.exec(val)[1] / 100 : 1
    } else {
      val = curEl.currentStyle[attr]
    }
  }
  // è¿”å›å‰å¿…é¡»å¤„ç†å¤åˆå€¼ï¼Œå¦‚padding backgroundï¼Œpositionï¼Œfloatç­‰
  return reg.test(val) ? parseFloat(val) : val
}
```

----------

## è¯¾æ—¶50ï¼šä¼ªç±»çš„åº”ç”¨

```css
/* :before  :after  -> åœ¨ä¸€ä¸ªå…ƒç´ æ ‡ç­¾çš„å‰é¢æˆ–åé¢åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿçš„æ ‡ç­¾ï¼Œå¯ä»¥ç»™è¿™ä¸ªè™šæ‹Ÿæ ‡ç­¾å¢åŠ cssæ ·å¼æˆ–è€…å†…å®¹ç­‰...*/
.box p:before {
    display: block;
    background: lightgreen;
    content: "æˆ‘æ˜¯è€å¸æœº";
    text-align: center;
}

.box p:after {
    display: block;
    background: lightblue;
    content: "å¼€è½¦ä¸ŠçœåŸ";
    text-align: center;
}

/*-------------æ¶ˆé™¤æµ®åŠ¨--------------*/
.clear {
    zoom: 1;
}

.clear:after {
    display: block;
    width: 0;
    height: 0;
    content: "";
    overflow: hidden;
    clear: both;
}
```

```javascript
// è·å–ä¼ªç±»çš„å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ ·å¼
var p1 = document.getElementById("boxP")
window.getComputedStyle(p1,"before").content // -> "æˆ‘æ˜¯è€å¸æœº"
window.getComputedStyle(p1,"before").background
```

----------

## è¯¾æ—¶51ï¼šè·å–å…ƒç´ çš„åç§»é‡

```html
<div id="outer">
    <div id="inner">
        <div id="center">
        </div>
    </div>
</div>
```

- `patentNode`ï¼šçˆ¶èŠ‚ç‚¹å±æ€§ï¼Œhtmlç»“æ„å±‚çº§å…³ç³»ä¸­çš„ä¸Šä¸€çº§èŠ‚ç‚¹ï¼

```javascript
center.parentNode //-> inner element
inner.parentNode // -> outer element
outer.parentNode // -> body element

document.parentNode // ->  null (æ ¹èŠ‚ç‚¹) -> å¼•æ“è‡ªå¸¦çš„å±æ€§ï¼šçˆ¶èŠ‚ç‚¹å±æ€§
document.parentnode // ->  undefiend -> å¯¹è±¡ä¸Šæ²¡è¿™ä¸ªå±æ€§
// ä»ä¸Šé¢çš„ä¾‹å­ä½“ç°å‡ºnullå’Œundefinedçš„åŒºåˆ«ï¼š
// ä¸¤è€…éƒ½æ˜¯è¡¨ç¤ºæ²¡æœ‰
// nullè¡¨ç¤ºå±æ€§æ˜¯å­˜åœ¨çš„åªæ˜¯å€¼æ²¡æœ‰ï¼Œè€Œundefinedè¡¨ç¤ºå±æ€§æ ¹æœ¬ä¸å­˜åœ¨
// è‘›å¤§å¤§çš„å¥³æœ‹å‹è¿˜æ²¡æ‰¾åˆ°å°±æ˜¯nullï¼Œè‘›å¤§å¤§çš„ç”·æœ‹å‹å°±æœ¬èº«å°±æ²¡æœ‰undefined
```

- `offsetParent`ï¼šçˆ¶çº§å‚ç…§ç‰©ï¼Œåœ¨åŒä¸€å¹³é¢ä¸­ï¼Œæœ€å¤–å±‚çš„å…ƒç´ æ˜¯é‡Œé¢æ‰€æœ‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©(ä¸HTMLçš„nodeå±‚çº§ç»“æ„æ²¡å…³ç³»)
  - ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªé¡µé¢ä¸­æ‰€æœ‰å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©éƒ½æ˜¯`body`
  - æƒ³è¦æ”¹å˜çˆ¶çº§å‚ç…§ç‰©ï¼Œéœ€è¦é€šè¿‡ä¿®æ”¹CSSä¸­`position`å®šä½æ¥å®ç°

```javascript
center.offsetParent // -> body element
inner.offsetParent // ->  body element
outer.offsetParent // ->  body element
document.body.offsetParent // -> null
```

```css
/* åªæœ‰è¿™ä¸‰ä¸ªæ ·å¼çš„å±æ€§å¯ä»¥æ”¹å˜å…ƒç´ çˆ¶çº§å‚ç…§ç‰©ï¼
position: absolute; 
position: fixed;
position: relative;
*/
```

- `offsetLeft`ï¼šå…ƒç´ å·¦å¤–æ¡†è·ç¦»çˆ¶çº§å‚ç…§ç‰©çš„è·ç¦»

![image.png-25.6kB][2]

```javascript
// ä¿®æ”¹æœ€å¤–å±‚divçš„å®šä½ä¸ºï¼šç›¸å¯¹å®šä½
outer.style.position = "relative"
center.offsetParent  // -> outer element
inner.offsetParent  // ->  outer element
outer.offsetParent  // ->  body element

// ä¿®æ”¹ä¸¤å±‚divçš„å®šä½ä¸ºï¼šç›¸å¯¹å®šä½
outer.style.position = "relative"
inner.style.position = "relative"
center.offsetParent  // -> inner element
inner.offsetParent  // ->  outer element
outer.offsetParent  // ->  body element
```

- ä»¥ä¸Šä»£ç ç»“è®ºï¼šå½“ä¿®æ”¹æŸä¸ªå…ƒç´ positionä¸ºrelativeæ—¶ï¼Œä¼šå°†å…¶æ‰€æœ‰ä¸‹çº§èŠ‚ç‚¹çš„çˆ¶çº§å‚ç…§ç‰©éƒ½è®¾ç½®ä¸ºè¯¥å…ƒç´ ï¼›è€Œå¦‚æœæœ‰åµŒå¥—çš„relativeå®šä½ï¼Œåˆ™çˆ¶çº§å‚ç…§ç‰©ä¼šå‘ˆæ ‘å½¢ç»“æ„ã€‚

```javascript
// è·å–ä¸€ä¸ªå…ƒç´ ç›¸å¯¹äºbodyçš„offsetåç§»é‡
// è¿™é‡Œå¯¹äºçˆ¶çº§å‚ç…§ç‰©è®¾ç½®äº†relativeã€fixedã€absoluteçš„æƒ…å†µéƒ½è¿›è¡Œäº†è¡¥å¿
function offset (curElement) {
    var totalLfet = 0, totalTop = 0, parant = curElement.offsetParent
    // å…ˆç®—è‡ªå·±çš„
    totalLfet += curElement.offsetLeft
    totalTop += curElement.offsetTop

    while (parant) {
        // åˆ¤æ–­æ˜¯ä¸æ˜¯IE8
        if (window.navigator.userAgent.indexOf("MSIE 8.0") === -1) {
            // ç´¯åŠ çˆ¶çº§å‚ç…§ç‰©çš„è¾¹æ¡†
            totalLfet += parant.clientLeft
            totalTop += parant.clientTop
        }
        // ç´¯åŠ çˆ¶çº§å¤–è¾¹æ¡†åˆ°ä¸Šçº§å‚ç…§ç‰©çš„è·ç¦»
        totalLfet += parant.offsetLeft
        totalTop += parant.offsetTop
        // é‡æ–°è®¾ç½®çˆ¶çº§å‚ç…§ç‰©
        parant = parant.offsetParent
        }
    return {left: totalLfet, top: totalTop}
}
```

![HTMLElement_offsetLeft_plus.png-119.5kB][3]

----------

## è¯¾æ—¶52ï¼šæµè§ˆå™¨æ»šåŠ¨æ¡å·å»çš„é«˜åº¦scrollTop

> åœ¨ä¹‹å‰åœ¨JavaScriptç›’å­æ¨¡å‹ä¸­ï¼šclientç³»åˆ—ã€offsetç³»åˆ—å’ŒscrollWidth/scrollHeightéƒ½æ˜¯[åªè¯»]å±æ€§ -> åªèƒ½é€šè¿‡å±æ€§è·å–ï¼Œä¸èƒ½é€šè¿‡å±æ€§ä¿®æ”¹å…ƒç´ çš„æ ·å¼ï¼

> ä½†scrollTopå’ŒscrollLfetï¼šæ»šåŠ¨æ¡å·å»çš„é«˜åº¦å’Œå®½åº¦ï¼Œåˆ™æ˜¯[å¯è¯»å†™]çš„å±æ€§ï¼

- `scrollTop`çš„å€¼æ˜¯å­˜åœ¨è¾¹ç•Œå€¼(æœ€å°å€¼å’Œæœ€å¤§å€¼)ï¼Œæˆ‘ä»¬è®¾ç½®çš„å€¼æ¯”æœ€å°å€¼å°æˆ–è€…æ¯”æœ€å¤§å€¼æ‰“éƒ½æ²¡ç”¨ï¼Œè¿”å›çš„ä¾ç„¶æ˜¯è¾¹ç•Œå€¼ï¼Œå³è¿”å›æœ€å°å€¼æˆ–è€…æœ€å¤§å€¼ã€‚
  - æœ€å°å€¼ = 0
  - æœ€å¤§å€¼ = `curElement.scrollHeight - curElement.clientHeight`

```html
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "å¾®è½¯é›…é»‘";
            font-size: 14px;
            /*ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡å­—*/
            -webkit-user-select: none;
            /*å…¼å®¹éwebkitå¤„ç†*/
            user-select: none;
        }

        html,
        body {
            width: 100%;
            /*è®©é¡µé¢é«˜åº¦ä¸º5ä¸ªå±å¹•é«˜åº¦*/
            height: 500%;
            background: lightgreen;
            /*CSS3 èƒŒæ™¯é¢œè‰²æ¸å˜å®ç°*/
            background: -webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
            background: webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
        }

        a {
            /*è®©aæ ‡ç­¾æ²¡æœ‰ä¸‹åˆ’çº¿*/
            text-decoration: node;
            color: #000000;
        }

        a:hover,
        a:active,
        a:visited,
        a:target {
            text-decoration: none;
            color: #000000;
        }

        #goTop {
            /*display: block;*/
            /*è®¾ç½®äº†positionåè‡ªç„¶æˆå—çº§å…ƒç´ */
            position: fixed;
            bottom: 80px;
            right: 50px;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background: red;
            /*CSS3ç›’å­åœ†è§’*/
            border-radius: 50%;
            opacity: 0.2;
            /*ä¸ºå…¼å®¹è€æµè§ˆå™¨*/
            filter: alpha(opacity=20);
        }
        /*è®¾ç½®é‚£ä¸ªidä¸ºgoTopçš„Aæ ‡ç­¾çš„hoverä¼ªç±»(çŠ¶æ€)çš„æ ·å¼*/
        #goTop:hover {
            opacity: 1;
            filter: alpha(opacit=100);
        }
    </style>
</head>

<body>
    <!--aä¾¿ç­¾æœ¬èº«æ˜¯åšé¡µé¢è·³è½¬çš„ï¼Œ
      1.å¦‚æœhrefå€¼ä¸ºç©ºåˆ™æ•ˆæœä¸ºåˆ·æ–°æœ¬é¡µé¢
      2.å¦‚æœhrefå€¼ä¸º#idï¼Œåˆ™ä¸ºé”šç‚¹å®šä½ï¼Œå°†scrollTopå€¼è®¾ä¸ºå…ƒç´ ç›¸å¯¹bodyçš„è·ç¦»ï¼Œä¹Ÿå°±æ˜¯å®šä¸ºè¯¥å…ƒç´ ã€‚
      3.å¦‚æœhrefå€¼ä¸ºâ€œjavascript:;â€ï¼Œåˆ™è¡¨ç¤ºå–æ¶ˆaæ ‡ç­¾çš„é»˜è®¤è·³è½¬è¡Œä¸º
    -->
    <a href="javscript:;" id="goTop">Top</a>

    <script type="text/javascript">
        var goTop = document.getElementById("goTop")
        goTop.onclick = function () {
            document.documentElement.scrollTop = 0;
            document.body.scrollTop = 0;
        }
    </script>
</body>
</html>
```

----------

## è¯¾æ—¶53ï¼šå®æˆ˜é¡¹ç›®-å›åˆ°é¡¶éƒ¨

#### å®šæ—¶å™¨

```javascript
// è®¾ç½®å®šæ—¶å™¨(setTimeout)ï¼Œç­‰åˆ°1000msåæ‰§è¡Œå¯¹åº”æ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå®šæ—¶å™¨ç»“æŸã€‚
window.setTimeout(function () {}, 1000)

// è®¾ç½®å®šæ—¶å™¨(setInterval)ï¼Œç­‰åˆ°1000msåå¼€å§‹æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œæ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œå®šæ—¶å™¨å¹¶æ²¡æœ‰ç»“æŸï¼Œä¹‹åæ¯éš”1000mså®šæ—¶å™¨éƒ½ä¼šæŠŠæ–¹æ³•æ‰§è¡Œä¸€æ¬¡ï¼Œç›´åˆ°æ‰‹åŠ¨æ¸…é™¤å®šæ—¶å™¨ä¸ºæ­¢
window.setInterval(function () {}, 1000)

// è®¾ç½®å®šæ—¶å™¨çš„æ—¶å€™æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä»£è¡¨å½“å‰æ˜¯ç¬¬å‡ ä¸ªå®šæ—¶å™¨
var timer1 = window.setTimeout(function () {}, 1000)
console.log(timer1)  // -> 1
var timer2 = window.setTimeout(function () {}, 1000)
console.log(timer2)  // -> 2
var timer3 = window.setInterval(function () {}, 1000)
console.log(timer3)  // -> 3
window.clearTimeout(1)  // æ¸…é™¤å®šæ—¶å™¨æ—¶ï¼Œå‚æ•°ä¸ºä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºæ¸…é™¤ç¬¬å‡ ä¸ªå®šæ—¶å™¨
window.clearInterval(timer2) // ä½¿ç”¨setTimeoutå£°æ˜ï¼Œä½†å¯ä»¥ä½¿ç”¨clearIntervalæ¸…é™¤

// å…³äºå¤šæ¬¡åŠ¨ç”»çš„å®ç°
// 1. ä½¿ç”¨setIntervalå®ç°ç®€ç‰ˆå¤šæ¬¡åŠ¨ç”»æ•ˆæœ
var n = 0
var timer = window.setInterval(function () {
  n++
  console.log(n)
  if (n === 5) {
    window.clearInterval(timer)
  }
}, 1000)

// 2. ä½¿ç”¨setTimeoutå®ç°ç®€ç‰ˆå¤šæ¬¡åŠ¨ç”»æ•ˆæœ
// é¦–å…ˆæ˜ç™½å·¥setTimeoutå°±ä¸éœ€è¦è¯·è®¡æ•°å™¨äº†
var n = 0
var timer = null
function move () {
  n++
  console.log(n)
  if (n === 5) return
  timer = window.setTimeout(move, 1000)
}
// æ‰§è¡Œå‰å¿…é¡»å†åŒ…ä¸€å±‚ï¼Œè¦ä¸ç„¶ç«‹é©¬å°±æ‰“1å‡ºæ¥ï¼Œå’Œä¸Šé¢çš„ä¸ä¸€æ ·
window.setTimeout(move, 1000)
```

```javascript
// ä¸€ä¸ªå‘ï¼Œå°å¿ƒ
document.body.clientHeight             // -> ã€é¡µé¢æœ€å¤§é«˜åº¦ã€‘
document.documentElement.clientHeight  // -> ã€ä¸€ä¸ªæµè§ˆå™¨å¯è§†é¡µé¢æœ€å¤§é«˜åº¦ã€‘
```

- å…³äºè·å–å½“å‰æµè§ˆå™¨å¯è§†é¡µé¢å®½å’Œé«˜çš„è®°å½•

```javscript
// ä¸€èˆ¬æ¥è¯´ä»¥ä¸‹æ–¹å¼è·å–æµè§ˆå™¨å¯è§†é¡µé¢çš„é«˜åº¦
var curHeight = document.documentElement.clientHeight || document.body.clientHeight

// ä½†å¦‚æœè¯´ CSSä¸­åŠ äº†ä»¥ä¸‹å±æ€§å
// html, body { height: 500% }
// document.documentElement.clientHeight çš„é«˜åº¦å°±ä¼šè¢«æ”¾å¤§5å€
// document.body.clientHeight çš„é«˜åº¦è¿˜æ˜¯æµè§ˆå™¨å¯ç°å®é¡µé¢çš„é«˜åº¦
```

```html
<html>
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "å¾®è½¯é›…é»‘";
            font-size: 14px;
            /*ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡å­—*/
            -webkit-user-select: none;
            /*å…¼å®¹éwebkitå¤„ç†*/
            user-select: none;
        }

        html, body {
            width: 100%;
            /*è®©é¡µé¢é«˜åº¦ä¸º5ä¸ªå±å¹•é«˜åº¦*/
            height: 500%;
            background: lightgreen;
            /*CSS3 èƒŒæ™¯é¢œè‰²æ¸å˜å®ç°*/
            background: -webkit-linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
            background: linear-gradient(top, lightgreen, lightcoral, lightcyan, lightblue, limegreen, lightgray, lightsalmon);
        }

        a {
            /*è®©aæ ‡ç­¾æ²¡æœ‰ä¸‹åˆ’çº¿*/
            text-decoration: none;
            color: #000000;
        }

        a:hover,
        a:active,
        a:visited,
        a:target {
            text-decoration: none;
            color: #000000;
        }

        #goTop {
            /*display: block;*/
            /*è®¾ç½®äº†positionåè‡ªç„¶æˆå—çº§å…ƒç´ */
            position: fixed;
            bottom: 80px;
            right: 50px;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            background: red;
            /*CSS3ç›’å­åœ†è§’*/
            border-radius: 50%;
            opacity: 0.2;
            /*ä¸ºå…¼å®¹è€æµè§ˆå™¨*/
            filter: alpha(opacity=20);
            /*é»˜è®¤éšè—*/
            display: none;
        }

        #goTop:hover {
            opacity: 1;
            filter: alpha(opacity=100);
        }
    </style>
</head>

<body>
    <a href="javascript:;" id="goTop">Top</a>

    <script type="text/javascript">
        var goTop = document.getElementById("goTop");

        window.onscroll = function () {
            if (currentScrollTop() < getCurrentScreenHeight()) {
                goTop.style.display = "none"
            } else {
                goTop.style.display = "block"
            }
        };

        goTop.onclick = function () {
            var step = (currentScrollTop() / 100).toFixed(); // è·å–å½“ç‚¹å‡»æ—¶æ»šåŠ¨æ¡å·å»çš„é«˜åº¦å†é™¤ä»¥100ä¸ºæ­¥é•¿,ç®€å•æ¥è¯´å°±æ˜¯æ»š100å“ˆæ»šåˆ°å¤´
            var timer = window.setInterval(function () {
                var target = currentScrollTop() - step;
                currentScrollTop(target); // è®¾ç½®æ»šåŠ¨æ¡
                if (currentScrollTop() === 0) {
                    window.clearInterval(timer) // æ¸…é™¤è®¡æ—¶å™¨
                }
            }, 5); //5ms
        };

        function currentScrollTop (num) {
            if(num === undefined) return document.documentElement.scrollTop || document.body.scrollTop;
            document.documentElement.scrollTop = num;
            document.body.scrollTop = num;
        }
        // å½“å‰æµè§ˆå™¨å¯è§†é¡µé¢çš„é«˜åº¦
        function getCurrentScreenHeight () {
            // å•ç‹¬ä¸ºäº†å¤„ç† html,body{height:500%}çš„æƒ…å†µ
            if(document.documentElement.clientHeight !== 0 && document.documentElement.clientHeight > document.body.clientHeight) return document.body.clientHeight;
            return document.documentElement.clientHeight || document.body.clientHeight;
        }
    </script>
</body>
</html>
```

----------

## è¯¾æ—¶53ï¼šä½œä¸šé¢˜-äº¬ä¸œé¦–é¡µå¯¼èˆªæ å®ç°

- ver1
  - ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œç›´æ¥æŠŠäº¬ä¸œé¦–é¡µæ•´é¡µæˆªå›¾ï¼Œç„¶åç”¨10ä¸ªdivæŠŠå›¾ç‰‡åˆ†ä¸º12ä¸ªéƒ¨åˆ†ï¼Œè™½ç„¶åŠŸèƒ½éƒ½å®ç°äº†ï¼Œä½†å¯¼èˆªæ çš„åŒæ­¥å¾ˆä¸å®Œç¾å•Šï¼Œä¸ºäº†å’Œäº¬ä¸œé¦–é¡µçš„å¯¼èˆªæ åŒæ­¥ç‡é«˜è¾¾98.47%ï¼Œè¿˜æ˜¯æŠŠæ‰€æœ‰æ¿å—éƒ½åˆ†å¼€æˆªå›¾ï¼Œåˆ†å¼€æ”¾åœ¨12ä¸ªdivé‡Œã€‚

- ver2
  - é¦–é¡µæˆªå›¾ç»†åˆ†12ä¸ªæ¿å— 
 
----------

## è¯¾æ—¶54ï¼šå®æˆ˜é¡¹ç›®-è·‘é©¬ç¯

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ»šåŠ¨æ¡æ˜¾ç¤ºæ–‡å­—</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-family: "PingFang SC";
            font-size: 16px;
        }

        #box {
            height: 30px;
            width: 600px;
            padding: 0 10px;
            margin: 50px auto;
            border: 2px dashed green;
            background: lightgreen;
            overflow: hidden;
        }

        #box div {
            height: 22px;
            /*å¦‚æœæº¢å‡ºï¼Œåˆ™æ˜¾ç¤ºæ»šåŠ¨æ¡*/
            /*overflow: auto;*/
            /*å¼ºåˆ¶æ–‡å­—æº¢å‡ºä¸æ¢è¡Œ*/
            white-space: nowrap;
            margin: 2px auto;
            display: inline-block;
        }

        .stitle {
            color: #c81623;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="box">
        <div id="wrap">
            <div id="conBegin">
                <span class="stitle">åè¨€è­¦å¥ï¼š</span>åªè¦ä¸‹å®šå†³å¿ƒå…‹æœææƒ§ï¼Œä¾¿å‡ ä¹èƒ½å…‹æœä»»ä½•ææƒ§ã€‚å› ä¸ºï¼Œè¯·è®°ä½ï¼Œé™¤äº†åœ¨è„‘æµ·ä¸­ï¼Œææƒ§æ— å¤„è—èº«ã€‚â€”â€”æˆ´å°”Â·å¡è€åŸº
            </div>
            <div id="conEnd">
                <span class="stitle">åè¨€è­¦å¥ï¼š</span>åªè¦ä¸‹å®šå†³å¿ƒå…‹æœææƒ§ï¼Œä¾¿å‡ ä¹èƒ½å…‹æœä»»ä½•ææƒ§ã€‚å› ä¸ºï¼Œè¯·è®°ä½ï¼Œé™¤äº†åœ¨è„‘æµ·ä¸­ï¼Œææƒ§æ— å¤„è—èº«ã€‚â€”â€”æˆ´å°”Â·å¡è€åŸº
            </div>
        </div>
    </div>
    <!--ä¸ºäº†è§£å†³æ»šåŠ¨åˆ°åº•åè°ƒå¤´æ˜¯çš„é—ªçƒï¼Œå†å¤åˆ¶ä¸€ä¸ªï¼Œæ’åˆ—åœ¨å…¶åï¼Œä½¿å…¶çœ‹ä¸Šå»åƒæ˜¯è¿ç»­çš„ï¼Œå’Œç”µå½±åŠ¨ç”»åˆ¶ä½œåŸç†ä¸€æ ·ã€‚-->
<script type="text/javascript">
    var box = document.getElementById("box");
    var wrap = document.getElementById("wrap");
    var conBegin = document.getElementById("conBegin");
    var timer = window.setInterval(function () {
        var target = conBegin.clientWidth;
        box.scrollLeft += 1;
        var cur = box.scrollLeft;
        if(cur >= target) {
            box.scrollLeft = 0;
        }
    }, 10)
</script>
</body>
</html>
```

----------

## è¯¾æ—¶55ï¼šæ·±å…¥æ‰©å±•-JSåŒæ­¥ä¸å¼‚æ­¥ç¼–ç¨‹

- JavaScriptéƒ½æ˜¯å•çº¿ç¨‹çš„ -> JSå°±æ˜¯ä¸ªå•¥å­ï¼Œè„‘å­ä¸€æ ¹ç­‹ï¼Œåšç€æ‰‹å¤´ä¸Šçš„äº‹æƒ…ï¼Œæ²¡æœ‰å®Œæˆå‰ç»å¯¹ä¸ä¼šå»åšä¸‹ä¸€ä»¶äº‹ä»¶

- åŒæ­¥ï¼šä¸Šä¸€ä»¶äº‹æƒ…æ²¡æœ‰å®Œæˆï¼Œç»§ç»­å¤„ç†ä¸Šä¸€ä»¶äº‹æƒ…ï¼Œåªæœ‰ä¸Šä¸€ä»¶äº‹æƒ…å®Œæˆäº†ï¼Œæ‰ä¼šåšä¸‹ä¸€ä»¶äº‹æƒ…(JSä¸­å¤§éƒ¨åˆ†æ˜¯åŒæ­¥)

- å¼‚æ­¥
  - JavaScriptä¸­å¼‚æ­¥ç¼–ç¨‹çš„å››ç§æƒ…å†µï¼šå®šæ—¶å™¨éƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹ã€æ‰€æœ‰çš„äº‹ä»¶ç»‘å®šéƒ½æ˜¯å¼‚æ­¥ç¼–ç¨‹ã€Ajaxè¯»å–æ•°æ®ä¹Ÿæ˜¯å¼‚æ­¥çš„ã€å›è°ƒå‡½æ•°ä¹Ÿæ˜¯å¼‚æ­¥çš„

```javascript
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
} ,1000)
console.log(n)
// è¾“å‡ºç»“æœï¼š 0ï¼Œ1  (ä¸­é—´æœ‰1000msçš„ç­‰å¾…å†è¾“å‡º1)
//------------------------------
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
} ,0)
console.log(n)
// è¾“å‡ºç»“æœï¼š 0ï¼Œ1 
```

- æ¯ä¸ªæµè§ˆå™¨å¯¹äºå®šæ—¶å™¨çš„ç­‰å¾…æ—¶é—´éƒ½æœ‰ä¸€ä¸ªæœ€å°å€¼ï¼šchrome:5~6ms, ie:10~13msã€‚å¦‚æœè®¾ç½®çš„ç­‰å¾…æ—¶é—´å°äºè¿™ä¸ªå€¼ï¼Œä¹Ÿä¸ä¼šèµ·ä½œç”¨çš„ï¼Œè¿˜æ˜¯éœ€è¦ç­‰åˆ°æœ€å°å€¼çš„æ—¶é—´åæ‰å»æ‰§è¡Œå®šæ—¶å™¨é‡Œçš„æ–¹æ³•ã€‚å°¤å…¶æ˜¯å†™0ä¹Ÿä¸æ˜¯ç«‹å³æ‰§è¡Œï¼

```javascript
var n = 0
window.setTimeout(function () {
  n++
  console.log(n)
}, 0)
console.log(n)
while (1) {
  n++
}
console.log(n)
// è¿™æ®µä»£ç ä¼šè¢«whileå¾ªç¯ä¸€è‡´å¡æ­»ï¼Œå¯¼è‡´å®šæ—¶å™¨æ²¡å¾—æ—¶é—´å…è®¸æ–¹æ³•ï¼Œä¹Ÿå¯¼è‡´æœ€åä¸€è¡Œä»£ç æ²¡å¾—æ‰§è¡Œ
// æœ€ååªè¾“å‡º 0
```

- å®šæ—¶å™¨è®¾ç½®çš„ç­‰å¾…æ—¶é—´ä¸ä¸€å®šæ˜¯å®é™…é¢„æœŸé‚£ä¸‹æ‰§è¡Œçš„æ—¶é—´ï¼Œå› ä¸ºå¦‚æœå®šæ—¶å™¨ä¹‹åè¿˜æœ‰åˆ«çš„ä¸€å¤§å †ä»£ç è¦æ‰§è¡Œï¼Œåˆ™ä¸ç®¡å®šæ—¶å™¨å®šæ—¶çš„æ—¶é—´æœ‰æ²¡æœ‰åˆ°ï¼Œéƒ½æ˜¯ä¸ä¼šå»æ‰§è¡Œå®šæ—¶å™¨çš„ï¼ --> å•çº¿ç¨‹çš„å®Œç¾ä½“ç°

```javascript
var n = 0
window.setTimeout(function () {
  n += 2
  console.log(n)
}, 50)

window.setTimeout(function () {
  n += 5
  console.log(n)
}, 5)
console.log(n)
for (var i=0;i<1000000;i++) {}
console.log(n)
// è¾“å‡ºç»“æœä¾æ¬¡ï¼š 0 0 5 7
```

![task-queue.png-76.6kB][4]

----------

## è¯¾æ—¶56ï¼šå»¶è¿ŸåŠ è½½æ€æƒ³å’Œé¦–å±å»¶è¿ŸåŠ è½½

> å»¶è¿ŸåŠ è½½çš„ä½œç”¨ï¼šä¿è¯é¡µé¢æ‰“å¼€çš„é€Ÿåº¦

- åŸç†
  1. å¯¹äºé¦–å±å†…å®¹ä¸­çš„å›¾ç‰‡ï¼šé¦–å…ˆç»™å¯¹åº”çš„åŒºåŸŸä¸€å¼ é»˜è®¤å›¾ç‰‡ç«™ç€ä½ç½®(é»˜è®¤å›¾ç‰‡éœ€è¦éå¸¸å°ï¼Œä¸€èˆ¬1~5kbä»¥å†…)ï¼Œå½“é¦–å±å†…å®¹éƒ½åŠ è½½å®Œæ¯•ä»¥å(ä¹Ÿå¯ä»¥é¢„è®¾ä¸€ä¸ªå»¶è¿ŸåŠ è½½æ—¶é—´)ï¼Œå†å¼€å§‹åŠ è½½çœŸå®å›¾ç‰‡
  2. å¯¹äºå…¶å®ƒå±ä¸­çš„å›¾ç‰‡ï¼Œä¹Ÿæ˜¯ç»™å®šä¸€ä¸ªé»˜è®¤çš„å›¾ç‰‡ç«™ä½ï¼Œå½“æ»šåŠ¨æ¡æ»šåˆ°å¯¹åº”åŒºåŸŸæ—¶ï¼Œå°±å¼€å§‹åŠ è½½æ”¹åŒºåŸŸçš„çœŸå®å›¾ç‰‡

- å…³äºè¯­å¥çš„å¼‚æ­¥åŠ è½½ï¼Œå¼€å§‹åªæŠŠå‰ä¸¤å±çš„æ•°æ®åŠ è½½ç»‘å®šå‡ºæ¥ï¼Œåé¢çš„æ•°æ®ä¸è¿›è¡Œå¤„ç†ï¼Œå½“é¡µé¢æ»šåˆ°å¯¹åº”åŒºåŸŸæ—¶å†å¼€å§‹ä»æ–°è¯·æ±‚æ•°æ®ç„¶åç»‘å®šæ¸²æŸ“æ•°æ®
  
- DEMOå®ç°æ­¥éª¤
  - ç»™imgåŒ…ä¸€ä¸ªå®¹å™¨divï¼Œæ ·å¼é‡Œé»˜è®¤ç»™imgæ ‡ç­¾é»˜è®¤éšè—ï¼Œå¹¶ä¸”ç»™åŒ…imgçš„å®¹å™¨divåŠ ä¸€ä¸ªé»˜è®¤å ä½å›¾ç‰‡ 
  - jsä¸­å…ˆè®¾ä¸€ä¸ªå®šæ—¶å™¨æ¨¡æ‹Ÿå»¶æ—¶åŠ è½½ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªä¸´æ—¶imgæ ‡ç­¾ï¼Œç”¨è¿™ä¸ªä¸´æ—¶imgæ ‡ç­¾æ‹¿img.onloadäº‹ä»¶ç›‘å¬å›¾ç‰‡èƒ½æ­£å¸¸åŠ è½½äº‹ä»¶ï¼Œå¦‚æœæˆåŠŸå°±èµ‹å€¼çœŸå®å›¾ç‰‡åœ°å€ç»™img

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡å»¶è¿ŸåŠ è½½</title>
    <style type="text/css">
        #box {
            width: 1000px;
            height: 410px;
            border: 2px solid lightgray;
            padding: 2px;
            margin: 20px auto;
            background: url("./img/tb_default.gif") no-repeat center #fefefe;
        }
        #box img {
            height: 100%;
            width: 100%;
            display: none;
        }
    </style>
<body>
<div id="box">
    <img src="" rscr="./img/yngf.jpg" alt="yngf">
</div>

<script type="text/javascript">
    console.log(document.images[0].attributes["rscr"].nodeValue);
    var timer = window.setTimeout(function () {
        var rsrc = document.images[0].getAttribute("rscr");
        // åˆ›å»ºimgå¯¹è±¡çš„æ™®é€šæ–¹æ³•
        // var timg = document.createElement("img")
        // ä¹Ÿå¯ä»¥ç›´æ¥ç”¨Imageæ„é€ å‡½æ•°å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡
        var timg = new Image;
        timg.src = rsrc; // å¤åˆ¶ç›®æ ‡å›¾ç‰‡urlç»™ä¸´æ—¶å›¾ç‰‡å¯¹è±¡
        // Image.onload ç›‘å¬å›¾ç‰‡æ­£å¸¸åŠ è½½äº‹ä»¶
        timg.onload = function () {
            document.images[0].style.display = "block";
            document.images[0].src = rsrc;
        };
    }, 1000)
</script>
</body>
</html>
```

----------

## è¯¾æ—¶57ï¼šå•å¼ å›¾ç‰‡çš„å»¶è¿ŸåŠ è½½

![img-lazy-loading-base.png-54.3kB][5]

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>å›¾ç‰‡å»¶è¿ŸåŠ è½½_plus</title>
    <style type="text/css">
        #box {
            width: 1000px;
            height: 410px;
            border: 2px solid lightgray;
            padding: 2px;
            margin: 1000px auto;
            background: url("./img/tb_default.gif") no-repeat center #fefefe;
        }
        #box img {
            height: 100%;
            width: 100%;
            display: none;
        }
    </style>
<body>
<div id="box">
    <img id="img" src="" rscr="./img/yngf.jpg" alt="yngf">
</div>
<script type="text/javascript" src="../utils.js"></script>
<script type="text/javascript">
    var box = document.getElementById("box");
    var img = document.getElementById("img");

    window.onscroll = function () {
        if (img.isLoad) return;
        var A = utils.offset(box).top + box.offsetHeight;
        var B = (document.documentElement.clientHeight || document.body.clientHeight) + (document.documentElement.scrollTop || document.body.scrollTop)
        if (A < B) {
            var timg = new Image;
            var rsrc = img.getAttribute("rscr");
            timg.src = rsrc;
            timg.onload = function () {
                img.src = img.getAttribute("rscr");
                img.style.display = 'block';
                img.isLoad = true;
            }
        }
    }
</script>
</body>
</html>
```

----------

## è¯¾æ—¶58ï¼šå¤šå¼ å›¾ç‰‡çš„å»¶è¿ŸåŠ è½½å®æˆ˜

***å®ç°æ­¥éª¤ï¼š***

 1. è¿œç¨‹åŠ è½½æ•°æ® --> Ajax
    (1).åˆ›å»ºxhrå¯¹è±¡(å…¼å®¹IEğŸ’ª)
    (2).é…ç½®xhrå¯¹è±¡(openæ–¹æ³•ç¬¬ä¸‰ä¸ªå‚æ•°åˆ«å†™ğŸ¤)
    (3).ç›‘å¬xhrå¯¹è±¡çš„çŠ¶æ€å˜åŒ–å¹¶è®¾ç½®å›è°ƒå‡½æ•°
    (4).å‘é€xhrè¯·æ±‚(nullğŸ˜˜)
 2. æ•°æ®ç»‘å®š -> æŠŠjsonæ•°æ®è½¬æ¢å¯¹è±¡åç»‘å®šåˆ°é¡µé¢å…ƒç´ ä¸Šï¼Œä¸‰ç§æ–¹æ³•ä¸­é€‰å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»‘å®šå®Œè®°å¾—æ¥ä¸€èµ·å›¾ç‰‡å»¶è¿ŸåŠ è½½å‡½æ•°
 3. å›¾ç‰‡å»¶è¿ŸåŠ è½½
    (1).å…ˆå†™allImgLazyLoadå‡½æ•°ï¼Œè¿‡æ»¤å‡ºè¦å»¶è¿ŸåŠ è½½çš„å›¾ç‰‡
    (2).å¾ªç¯æ­¤å›¾ç‰‡æ˜¯å¦å·²ç»åŠ è½½è¿‡çœŸå®å›¾ç‰‡urlï¼Œå¦‚æœåŠ è½½åˆ™è·³è¿‡
    (3).å¦‚æœæ²¡åŠ è½½çœŸå®å›¾ç‰‡urlï¼Œè§†ä¸ºéœ€è¦å»¶è¿ŸåŠ è½½å›¾ç‰‡å¯¹è±¡
    (4).åˆ¤æ–­è¯¥å›¾ç‰‡å®¹å™¨offsetè·ç¦»å’Œæ»šåŠ¨æ¡è·ç¦»å…³ç³»ï¼Œè¯¥åŠ è½½å°±å¯åŠ¨å›¾ç‰‡åŠ è½½å‡½æ•°
    (5).å›¾ç‰‡åŠ è½½å‡½æ•°ä¸­è®¾ç½®å›¾ç‰‡å±æ€§ï¼Œå¹¶è®°å¾—åŠ è½½fadeInåŠ¨ç”»
 4. å›¾ç‰‡æ¸å…¥fadeInåŠ¨ç”»
    (1).ä¸€å®šè¦æŠŠå›¾ç‰‡å¯¹è±¡çš„æ ˆåœ°å€å½“å‚æ•°ä¼ å…¥ï¼Œå› ä¸ºå¼‚æ­¥å‘äºº
    (2).è®¾ç½®durtionã€targetã€intervalã€stepã€timerå¯¹è±¡
    (3).å¯åŠ¨å®šæ—¶å™¨
    (4).åœ¨å®šæ—¶å™¨ä¸­åˆ¤æ–­æ—¶ï¼Œå¿…é¡»ä½¿ç”¨`window.getComputedStyle`å°è£…çš„æ–¹æ³•æ¥åˆ¤æ–­å½“å‰å…ƒç´ çš„cssæ ·å¼å±æ€§ï¼Œå¦åˆ™å°±å‘ä¸€ä¸ªè·³å§ğŸ˜‚
    (5).èµ‹å€¼æ ·å¼å±æ€§å€¼(+step)
    (6).**åŠ¨ç”»ç»“æŸåæ¸…é™¤å®šæ—¶å™¨**
 5. `window.onscroll = allImglazyLoad`


```html
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-size: 14px;
        }

        ul, li {
            /*å»é™¤ulå’Œlié»˜è®¤æ ·å¼(å°åœ†ç‚¹)*/
            list-style: none;
        }

        img {
            display: block;
            border: none;
        }

        /*ç§»åŠ¨ç«¯å¸ƒå±€å°æŠ€å·§ï¼šæœ€å¤–å±‚ç›’å­æ˜¯ä¸è®¾ç½®å®½å’Œé«˜çš„*/

        .news {
            padding: 10px;
        }

        .news li {
            /*è®¾ç½®liä¸‹çº§å…ƒç´ çš„çˆ¶çº§å‚ç…§ç‰©ä¸ºli*/
            position: relative;
            height: 60px;
            padding: 10px 0;
            /*åœ¨æ¯ä¸ªliä¸‹é¢æ‹¿åº•è¾¹æ¡†åŠ ä¸€ä¸ªç°è‰²åˆ†å‰²çº¿*/
            border-bottom: 1px dashed #9c9a9c;
        }

        /*.news li > div:nth-child(1)*/
        .news li > div:first-child {
            /*å›ºå®šæ­¤divæ ¹æ®ä¸Šçº§liä¸ºçˆ¶çº§å‚ç…§ç‰©æ¥å®šä½*/
            position: absolute;
            top: 10px;
            left: 0;
            width: 120px;
            height: 80px;
            background: url("./img/58/tb_default.gif") no-repeat center #fefefe;
        }

        .news li > div:first-child img {
            /*è®¾ç½®å›¾ç‰‡çš„å®½é«˜ä¸ºçˆ¶çº§ç›’å­çš„åŒ¡å’Œé«˜*/
            height: 100%;
            width: 100%;
            display: none;
            opacity: 0;
        }

        .news li > div:last-child {
            height: 80px;
            margin-left: 125px;
        }

        .news li > div:last-child h2 {
            height: 20px;
            line-height: 20px;
            /*å®ç°æ–‡å­—æº¢å‡ºåå‡ºç°å°é˜¶*/
            overflow: hidden;
            /*æ–‡å­—è¶…å‡ºçš„æ‹†åˆ‡éƒ¨åˆ†ä»¥'...'ä»£è¡¨*/
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .news li > div:last-child p {
            height: 40px;
            line-height: 20px;
            font-size: 12px;
            color: #616161;
            overflow: hidden;
            /*æ–‡å­—è¶…å‡ºçš„æ‹†åˆ‡éƒ¨åˆ†ä»¥'...'ä»£è¡¨*/
            text-overflow: ellipsis;
            white-space: pre-wrap;
        }
    </style>
    
<script>
  function allImglazyLoad() {
    var imgList = utils.listToArray(oul.getElementsByTagName('img'));
    var curImg = null;
    for (var i = 0, len = imgList.length; i < len; i++) {
      curImg = imgList[i];
      // è¿‡æ»¤å›¾ç‰‡è¿˜æ²¡åŠ è½½çš„
      if (curImg.isLoad) {
        return
      }
      // A = åŒ…å›¾ç‰‡çš„ç›’å­å¤–è¾¹æ¡†åˆ°bodyçš„è·ç¦» + åŒ…å›¾ç‰‡ç›’å­è‡ªèº«å®¹å™¨çš„é«˜åº¦
      // var A = utils.offset(curImg.parentNode).top + curImg.parentNode.offsetHeight
      // A = åŒ…å›¾ç‰‡çš„ç›’å­å¤–è¾¹æ¡†åˆ°bodyçš„å…·ä½“ + åŒ…å›¾ç‰‡çš„è‡ªèº«å®¹å™¨ä¸€åŠçš„é«˜åº¦
      var A = utils.offset(curImg.parentNode).top + curImg.parentNode.offsetHeight / 2
      // B = å½“å‰æµè§ˆå™¨å¯è§†çª—å£çš„é«˜åº¦ + æ»šåŠ¨æ¡å·å»çš„é«˜åº¦
      var B = utils.win('clientHeight') + utils.win('scrollTop');
      if (A < B) {
        imgLoad(curImg);
        fadeIn(curImg);
      }
    }
  }

  function imgLoad(curImg) {
    //æ–°å»ºä¸€ä¸ªä¸´æ—¶Imageå®ä¾‹å¯¹è±¡ç”¨äºéªŒè¯å›¾ç‰‡urlæ˜¯å¦æœ‰é”™
    var tempImg = new Image();
    tempImg.src = curImg.src = curImg.getAttribute('rsrc');
    tempImg.onload = function () {
      curImg.style.display = 'block';
      curImg.src = this.src; // è¿™é‡Œthiså°±æ˜¯è°ƒç”¨ä¸»ä½“tempImg
      tempImg = null;  // æ¸…é™¤æ— ç”¨æ ˆå†…å­˜
    };
    curImg.isload = true; // è®¾ç½®å›¾ç‰‡çš„isloadå±æ€§ä¸ºtrueï¼Œä»¥åæ£€æµ‹æ˜¯ç›´æ¥è·³è¿‡è¯¥å…ƒç´ æ ‡ç­¾

    // è¿™é‡Œåœ¨ä½¿ç”¨onloadåŠ è½½æ—¶ï¼Œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ—¶é—´ï¼Œä»–æ‰¾ä¸åˆ°curImgäº†
    // å’‹ä¸ªå­è¯æ˜å‘¢ï¼Ÿ å®ƒé‡Œé¢çš„iå·²ç»æ˜¯30~~~~~~~~~~ï¼ï¼ï¼ï¼ï¼ï¼
    // è¿™é‡Œå¼‚æ­¥å’‹ç†è§£å‘¢ï¼Ÿå°±æ˜¯è¯´ï¼Œå¼•æ“ä¸ç­‰å›¾ç‰‡æ˜¯å¦ç»™åŠ è½½å®Œæˆï¼Œæ˜¯ç›´æ¥ä½ å°å­æ˜¯å¼‚æ­¥ï¼Œåé¢å¥½äº†ä½ å†æ›´æˆ‘è¯´ï¼Œè€å­å…ˆå¾€ä¸‹é¢æ‰§è¡Œç€ï¼Œæˆ‘å¥½äº†æˆ‘ä¼šå‘Šè¯‰ä½ ï¼Œä½ å†æ‰§è¡Œã€‚
    // å†è¯´æ¸…æ¥šç‚¹å§ï¼Œä¹Ÿå°±æ˜¯è¯´curImgé‡Œçš„iå·²ç»æ˜¯æœ€åä¸€ä¸ªindexäº†ï¼Œæ‰€ä»¥ä»–æ°¸è¿œæŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ 
    // è¿™ç§å¼‚æ­¥ï¼Œä¸€ä¸ªå›¾ç‰‡è¿˜å¥½æ•´ï¼Œä¸€å †å›¾ç‰‡å®ƒå°±ä¸ç­‰ä½ åŠ è½½å®Œå†å¤„ç†äº†
    // ä¸ºäº†è§£å†³å¼‚æ­¥é—®é¢˜ï¼ŒæŠŠå¤„ç†å‡½æ•°å•ç‹¬å†™æˆä¸€ä¸ªï¼Œä¼ å‚æ—¶ç›´æ¥ä¼ å†…å­˜åœ°å€å³å¯è§£å†³é—®é¢˜
    //var timg = new Image
    //timg.src = curImg.getAttribute('rsrc')
    //console.log(timg.src)
    //timg.onload = function () {
    //  console.dir(curImg)
    //  console.log("å›¾ç‰‡åœ°å€æ²¡é—®é¢˜")
    //  curImg.src = curImg.getAttribute('rsrc')
    //  curImg.isLoad = true
    //  curImg.style.display = 'block'
  }

  function fadeIn(curImg) {
    var duration = 1000; // åŠ¨ç”»çš„æŒç»­æ—¶é—´
    var target = 1; // åŠ¨ç”»å®Œæˆæ—¶çš„ç›®æ ‡æ•°å€¼
    var interval = 10; // åŠ¨ç”»æ¯éš”å¤šå°‘æ¯«ç±³æ‰§è¡Œä¸€æ¬¡
    var step = (target / duration) * interval;  // æ¯æ¬¡æ‰§è¡Œå®šæ—¶å™¨éœ€è¦åŠ ä¸Šçš„æ­¥é•¿
    var timer = window.setInterval(function () {
      if (curOpacity >= target) { // curOpacityä¸ºé¢„è§£é‡Šå£°æ˜ï¼Œç¬¬ä¸€æ¬¡å®šæ—¶å™¨æ‰§è¡Œæ—¶ä¸ºnull
        window.clearInterval(timer);
        return
      }
      var curOpacity = utils.getComputedCss(curImg, 'opacity');
      curOpacity += step;
      curImg.style.opacity = curOpacity;
      curImg.style.filter = 'alpha(opacity=' + curOpacity * 100 + ')'
    }, interval)
  }
</script>
    
```

- ç»†èŠ‚è®°å½•ï¼š
  - webstormä¸­htmlé‡Œï¼Œ`meta:vp`+`tab`å¿«é€Ÿç§»åŠ¨ç«¯å¸ƒå±€å¤´
  - ç§»åŠ¨ç«¯å¸ƒå±€å°æŠ€å·§ï¼šæœ€å¤–å±‚ç›’å­æ˜¯ä¸è®¾ç½®å®½å’Œé«˜çš„

----------

## è¯¾æ—¶59ï¼šå†…ç½®çš„domæ“ä½œå±æ€§å’Œæ–¹æ³•

- è·å–é¡µé¢å…ƒç´ çš„æ–¹æ³•
  - document.getElementById()
  - context.getElementsByTagName("tagname") -> æŠŠæŒ‡å®šå®¹å™¨ä¸­å­å­å­™å­™è¾ˆçš„æ‰€æœ‰æ ‡ç­¾åä¸ºtabnameçš„èŠ‚ç‚¹éƒ½è·å–åˆ°
  - context.getElementsByClassName("classname") -> åœ¨ie6~8ä¸‹ä¸å…¼å®¹
  - doucment.getElementsByName("name") -> åœ¨IEæµè§ˆå™¨ä¸­åªå¯¹è¡¨å•å…ƒç´ çš„nameèµ·ä½œç”¨
  - document.body -> è·å–bodyå¯¹è±¡
  - document.documentElement -> è·å–æ•´ä¸ªhtmlå¯¹è±¡
  - context.querySelector/context.querySelectAll -> åœ¨ie6~8ä¸‹ä¸å…¼å®¹ï¼Œä¸”é€šè¿‡é€‰æ‹©å™¨è·å–åˆ°çš„èŠ‚ç‚¹é›†åˆä¸å­˜åœ¨**dom mapping**ï¼ï¼

- æè¿°èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¹‹é—´å…³ç³»çš„å±æ€§(åœ¨æ ‡å‡†æµè§ˆå™¨ä¸­ä¼šæŠŠç©ºæ ¼å’Œæ¢è¡Œå½“åšæ–‡æœ¬èŠ‚ç‚¹å¤„ç†)
  - childNodes -> è·å–æ‰€æœ‰å­å­å­™å­™èŠ‚ç‚¹
  - children   -> è·å–æ‰€æœ‰å­å…ƒç´ èŠ‚ç‚¹ (ie6~8ä¸å…¼å®¹)
  - parnetNode -> è·å–çˆ¶èŠ‚ç‚¹
  - previousSibling/previousElementSibling -> è·å–ä¸Šä¸€ä¸ªå“¥å“¥èŠ‚ç‚¹/å“¥å“¥å…ƒç´ èŠ‚ç‚¹ã€æ³¨ï¼šæ‰€æœ‰å’ŒElementæœ‰å…³çš„å±æ€§åœ¨ie6~8ä¸å…¼å®¹ã€‘
  - nextSibling/nextElementSibling -> è·å–ä¸‹ä¸€ä¸ªå¼Ÿå¼ŸèŠ‚ç‚¹/å¼Ÿå¼Ÿå…ƒç´ èŠ‚ç‚¹ã€åŒä¸Šã€‘
  - lastChild/lastElementChild  -> è·å–æœ€åä¸€ä¸ªå­èŠ‚ç‚¹/å­å…ƒç´ èŠ‚ç‚¹ã€åŒä¸Šã€‘
  - firstChild/firstElementChild  -> è·å–ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹/å­å…ƒç´ èŠ‚ç‚¹ã€åŒä¸Šã€‘

- DOMçš„å¢åˆ æ”¹
  - createElement
  - document.createDocumentFragment
  - appendChild
  - insertBefore
  - cloneNode(true/false): trueå¯¹åº”å…‹éš†æ•´ä¸ªå…ƒç´ ï¼Œfalseå¯¹åº”åªå…‹éš†æ ‡ç­¾
  - replaceChild
  - removeChild
  - [get/set/remove]Attribute

- DOMç›’å­æ¨¡å‹(å¸¸ç”¨çš„13ä¸ª)
  -  clientç³»åˆ—
  -  offsetç³»åˆ—
  -  scrollç³»åˆ—

----------

## è¯¾æ—¶60ï¼šè·å–æ‰€æœ‰çš„å…ƒç´ å­èŠ‚ç‚¹

> å› ä¸º`children`å±æ€§åœ¨ie6~8ä¸­ä¸å…¼å®¹ï¼Œé‚£å°±è‡ªå·±å®ç°ä¸€ä¸ªå‘—ï¼

> äºŒæ¬¡å¾ªç¯ï¼Œæ‹…å¿ƒæ•°ç»„çš„å¡Œé™·é—®é¢˜ã€‚å¦‚æœåœ¨å¾ªç¯ä¸­æ“ä½œçš„æ•°ç»„å½“å‰å¯¹è±¡é•¿åº¦ä¼šå˜åŒ–ï¼Œæ³¨æ„è¡¥å¿ã€‚

```javascript
function children (curEle, tagName) {
    var arr = [];
    var flag = /MSIE [6|7|8]/.test(window.navigator.userAgent);
    if (flag) {
        var cnodes = utils.listToArray(curEle.childNodes);
        cnodes.forEach(function (item) {
            // å…ˆäº²å­é‰´å®šï¼ï¼ï¼å†é‰´å®šnodeTypeæ˜¯ä¸æ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œå…ƒç´ èŠ‚ç‚¹ä¸º1
            if (item.parentNode === curEle && item.nodeType === 1) {
                arr[arr.length] = item;
            }
        })
    } else {
        arr = utils.listToArray(curEle.children);
    }
    if (tagName !== undefined) {
        for (var j = 0; j < arr.length; j++) {
            // å¾ªç¯æ‰¾tabNameä¸åŒ¹é…çš„å…ƒç´ 
            if(arr[j].tagName.toLowerCase() !== tagName.toLowerCase()) {
                // æ‰¾åˆ°ä¸åŒ¹é…çš„å…ƒç´ å°±åˆ é™¤
                arr.splice(j, 1);
                // æ¢å¤ç´¢å¼•, è‹¥æ¢å¤ç´¢å¼•ä¼šå‡ºç°æ•°ç»„å¡Œé™·é—®é¢˜
                j--;
            }
        }
    }
    return arr;
}
```

## è¯¾æ—¶61ï¼šè¯¾æ—¶61ï¼šæ·±å…¥æ‰©å±•-å•ä¾‹æ¨¡å¼çš„å°æŠ€å·§

```javascript
//å•åˆ©æ¨¡å¼å°æŠ€å·§
// è¿™é‡Œå¤„ç†å¯ä»¥å…ˆåœ¨ä¸æ¸…é™¤å†…å­˜çš„ç§æœ‰ä½œç”¨åŸŸåšä¸€äº›é¢„å¤„ç†
var utils = (function () { 
    // ã€æƒ°æ€§åŠ è½½ã€‘
    // åŸç†ï¼šå¦‚æœä¸‹é¢çš„ä»£ç éœ€è¦ä½¿ç”¨ä¸€äº›ä»£ç å®ç°åˆ¤æ–­ï¼Œåˆ™æˆ‘ä»¬æŠŠä»£ç çš„å®ç°æ”¾åœ¨å¤–å±‚ï¼Œåœ¨é‡Œå±‚ä½¿ç”¨æ—¶ï¼Œåªéœ€è¦å¼•ç”¨å³å¯ï¼Œä¸éœ€è¦å¤šæ¬¡ä»£ç å»å®ç°ã€‚
    var flag = /^\d+$/
    ... 
    return { ... }    
})()
```

----------


## è¯¾æ—¶62ï¼š è·å–å…ƒç´ 

- prevï¼šè·å–å…ƒç´ çš„å“¥å“¥å…ƒç´ èŠ‚ç‚¹

```javascript
function prev (curEle) {
  var bro = curEle.previousSibling  // è·å–å…ƒç´ çš„å“¥å“¥èŠ‚ç‚¹
  while (bro) {
    if (bro.nodeType === 1) { //åˆ¤æ–­æ˜¯ä¸æ˜¯å…ƒç´ 
      return bro 
    }
    bro = bro.previousSibling
  }
  return null
}
```

- nextï¼šè·å–å…ƒç´ çš„å¼Ÿå¼Ÿå…ƒç´ å…ƒç´ 

```javascript
function next (curEle) {
  var bro = curEle.nextSibling  // è·å–å…ƒç´ çš„å“¥å“¥èŠ‚ç‚¹
  while (bro) {
    if (bro.nodeType === 1) { //åˆ¤æ–­æ˜¯ä¸æ˜¯å…ƒç´ 
      return bro 
    }
    bro = bro.nextSibling
  }
  return null
}
```

- prevAllï¼šè·å–å…ƒç´ çš„æ‰€æœ‰å“¥å“¥å…ƒç´ 

```javascript
function prevAll () {
  var arr = []
  var bro = this.prev(curEle)
  while(bro !== null) {
    arr.unshift = bro  // å­˜æ”¾å“¥å“¥å…ƒç´ æ—¶æœ€å¤§çš„å“¥å“¥æ’åœ¨æ•°ç»„æœ€å‰é¢
    bro = this.prev(bro)
  }
  return arr
}
```

- nextAllï¼šè·å–å…ƒç´ çš„æ‰€æœ‰å¼Ÿå¼Ÿå…ƒç´ 

```javascript
function nextAll (curEle) {
  var arr = []
  var bro = this.next(curEle)
  while(bro !== null) {
    arr.push(bro)  // å­˜æ”¾å“¥å“¥å…ƒç´ æ—¶æœ€å¤§çš„å“¥å“¥æ’åœ¨æ•°ç»„æœ€å‰é¢
    bro = this.next(bro)
  }
  return arr
}
```

- siblingï¼šè·å–å…ƒç´ çš„ä¸€ä¸ªå“¥å“¥å’Œä¸€ä¸ªå¼Ÿå¼Ÿå…ƒç´ 

```javascript
function sibling (curEle) {
  var arr = []
  arr.push(this.prev(curEle)) //å¦‚æœæœ‰å“¥å“¥ï¼Œæ²¡æœ‰å°±null
  arr.push(this.next(curEle)) //å¦‚æœæœ‰å¼Ÿå¼Ÿï¼Œæ²¡æœ‰å°±null
  return arr
}
```

- siblingsï¼šè·å–å…ƒç´ çš„æ‰€æœ‰å…„å¼Ÿå…ƒç´ 

```javascript
function siblings (curEle) {
  return this.prevAll(curEle).concat(this.nextAll(curEle))
}
```

- indexï¼šè·å–å…ƒç´ åœ¨åŒè¾ˆä¸­çš„ç´¢å¼•

```javascript
function index (curEle) {
  return this.prevAll(curEle).length
}

```

- firstChildï¼šè·å–å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ 

```javascript
function firstChild (curEle) {
  var ec = this.children(curEle)
  return ec[0] ? ec[0] : null
}
```

- lastChildï¼šè·å–å…ƒç´ çš„æœ€åä¸€ä¸ªå­å…ƒç´ 

```javascript
function lastChild (curEle) {
  var ec = this.children(curEle)
  return ec[ec.length - 1] ? ec[ec.length - 1] : null
}
```

----------

## è¯¾æ—¶63ï¼šå‘å®¹å™¨ä¸­è¿½åŠ æ–°å…ƒç´ çš„æ–¹æ³•

- appendï¼šå†…ç½®æ–¹æ³•ï¼Œå‘æŒ‡å®šå®¹å™¨çš„æœ«å°¾è¿½åŠ å…ƒç´ 

- prependï¼šå‘æŒ‡å®šå®¹å™¨çš„å¼€å¤´è¿½åŠ å…ƒç´ 
  - åŸç† -> 0. æŠŠæ–°å…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ èŠ‚ç‚¹å‰é¢ 
  - -> 1. å…ˆæŸ¥æ‰¾å®¹å™¨ä¸­çš„ç¬¬ä¸€ä¸ªå­å…ƒç´ èŠ‚ç‚¹
  - -> 2. å¦‚æœå­˜åœ¨ï¼Œå°±å°†è¦è¿½åŠ çš„å…ƒç´ æ’å…¥å®¹å™¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„å‰é¢
  - -> 3. å¦‚æœä¸å­˜åœ¨ï¼Œå°±å°†è¦è¿½åŠ çš„å…ƒç´ ç›´æ¥æ’å…¥æœ«å°¾å³å¯
  

```javascript
function prepend (newEle, container) {
    var fir = this.firstChild(container);
    if (fir) { // å¦‚æœå®¹å™¨ä¸­æœ‰èŠ‚ç‚¹
      container.insertBefore(newEle, fir)
      return
    }
    container.appendChild(fir)
}
```

- insertBeforeï¼šç±»ä¼¼å†…ç½®æ–¹æ³•ï¼ŒæŠŠæ–°å…ƒç´ è¿½åŠ åˆ°æŒ‡å®šå…ƒç´ çš„å‰é¢ 

```javascript
function insertBefore (newEle, oldEle) {
    oldEle.parentNode.insertBefore(newEle, oldEle)
}
```

- insertAfterï¼šæŠŠæ–°å…ƒç´ è¿½åŠ åˆ°æŒ‡å®šå…ƒç´ çš„åé¢
  - åŸç† -> 0. æŠŠæ–°å…ƒç´ è¿½åŠ åˆ°æŒ‡å®šå…ƒç´ å¼Ÿå¼Ÿå…ƒç´ çš„å‰é¢ 
  - -> 1. å¦‚æœå¼Ÿå¼Ÿå…ƒç´ å­˜åœ¨ï¼Œå°±è·å–çˆ¶èŠ‚ç‚¹åç”¨insertBefore()æ–¹æ³•å°†æ–°å…ƒç´ æ’å…¥åˆ°å¼Ÿå¼Ÿå…ƒç´ çš„å‰é¢å³å¯
  - -> 2. å¦‚æœå¼Ÿå¼Ÿå…ƒç´ ä¸å­˜åœ¨ï¼Œå°±ç›´æ¥è·å–çˆ¶èŠ‚ç‚¹åç”¨appendChildæ–¹æ³•å°†æ–°å…ƒç´ æ’å…¥æœ«å°¾å³å¯

```javascript
function insertAfter (newEle, oldEle) {
    var bro = this.next(oldEle)
    if (bro) {  // å¦‚æœå¼Ÿå¼Ÿå…ƒç´ å­˜åœ¨ï¼Œå°±æŠŠæ–°å…ƒç´ è¿½åŠ åˆ°å¼Ÿå¼Ÿå…ƒç´ çš„å‰é¢
      oldEle.parentNode.insertBefore(newEle, bro)
    }
    // å¦‚æœæŒ‡å®šå…ƒç´ å·²ç»æ˜¯æœ€æœ«å°¾å…ƒç´ ï¼Œå°±ç›´æ¥è·å–çˆ¶èŠ‚ç‚¹åappendChildå³å¯
    oldEle.parentNode.appendChild(newEle)
}
```

----------

## è¯¾æ—¶64ï¼šæ“ä½œå…ƒç´ çš„æ ·å¼ç±»

- hasClass

```javascript
function hasClass(curEle, className) {
    // åˆ†æéœ€æ±‚ï¼š
    // æƒ…å†µ1 -> "size" === /^size +/ , å½“åˆ¤æ–­çš„ç±»ååœ¨å­—ç¬¦ä¸²é¦–ä½æ—¶ï¼Œå°±æ˜¯ä»¥æŸæŸå¼€å¤´åé¢å¯ä»¥è·Ÿä¸€åˆ°å¤šä¸ªç©ºæ ¼
    // æƒ…å†µ2 -> "center" === / +center +/ ï¼Œå½“åˆ¤æ–­çš„ç±»ååœ¨å­—ç¬¦ä¸²ä¸­é—´æ—¶ï¼Œå°±æ˜¯ä»¥ä¸€åˆ°å¤šç©ºæ ¼å¼€å¤´å’Œç»“å°¾ä¸­é—´å°±æ˜¯ç±»å
    // æƒ…å†µ3 -> "className" === / +border^/
    // ä»ä»¥ä¸Šä¸‰ç§æƒ…å†µåˆ†æå¯å¾—ï¼š/(^| +)className( +|&)/
    // åˆ«å¿˜äº†å†ç»™classNameä¼ å…¥å‚æ•°å·¦å³ä¸¤è¾¹å–ç©ºæ ¼
    var reg = new RegExp('(^| +)?' + className + '( +|&)?')
    return reg.test(curEle.className)
}
```

- addClass

```javascript
function addClass(curEle, className) {
    // é¦–å…ˆå»é™¤å‚æ•°å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„å¤šä½™ç©ºæ ¼ï¼Œç„¶åä¸€å®šè¦ç”¨æ­£åˆ™çš„splitåˆ†å‰²
    var classAry = className.trim().split(/ +/g);
    classAry.forEach(function (item) {
        if(!hasClass(curEle,item)) {
            curEle.className += ' ' + item;
        }
    })
}
```

- removeClass

```javascript
function removeClass(curEle, className) {
    // é¦–å…ˆå»é™¤å‚æ•°å­—ç¬¦ä¸²å·¦å³ä¸¤è¾¹çš„å¤šä½™ç©ºæ ¼ï¼Œç„¶åä¸€å®šè¦ç”¨æ­£åˆ™çš„splitåˆ†å‰²
    var classAry = className.trim().split(/ +/g);
    classAry.forEach(function (item) {
        if(hasClass(curEle,item)) { //å¦‚æœå­˜åœ¨åˆ™ç§»é™¤
            // è®¾ç½®æ­£åˆ™åŒ¹é…ä»¥classNameå¼€å¤´æˆ–è€…ä¸€åˆ°å¤šä¸ªç©ºæ ¼å¼€å¤´æˆ–ç»“å°¾
            var reg = new RegExp("(^| +)"+ item +"( +|&)", 'g')
            curEle.className = curEle.className.replace(reg, " ")
        }
    })
}
```

----------

## è¯¾æ—¶65ï¼šgetElementsByClassNameçš„å®ç°ä¸å…¼å®¹å¤„ç†

- å®ç°æ­¥éª¤ï¼š
  - å…ˆéªŒè¯ä¼ å…¥classNameæ˜¯å¦å­˜åœ¨å’Œæ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œå¦çš„è¯å°±è¿”å›ç©ºæ•°ç»„
  - éªŒè¯ä¼ å…¥å®¹å™¨å‚æ•°æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨é»˜è®¤è®¾ä¸ºdocument
  - å°†ä¼ å…¥çš„ç±»åå­—ç¬¦ä¸²å…ˆå»ä¸¤è¾¹çš„ç©ºæ ¼ï¼Œå†æ‹¿split+æ­£åˆ™åˆ†å‰²æˆæ•°ç»„
  - ä½¿ç”¨`.getElementsByTagName('*')`è·å–è¯¥å®¹å™¨å†…çš„æ‰€æœ‰æ ‡ç­¾å…ƒç´ 
  - å¤–å¾ªç¯å¾ªç¯å®¹å™¨å…ƒç´ ç±»æ•°æ®ï¼Œå†…å¾ªç¯å¾ªç¯classAryç±»åæ•°ç»„
  - ä½¿ç”¨å‡è®¾éªŒè¯ï¼Œåœ¨å†…å¾ªç¯åˆ†åˆ«éªŒè¯è¯¥å…ƒç´ æ˜¯ä¸æ˜¯ä¸å­˜åœ¨è¯¥ç±»åï¼Œä¸å­˜åœ¨ç›´æ¥èµ‹å€¼isValidä¸ºfalseåä¸­æ–­å¾ªç¯
  - å¦‚æœä¼ å…¥éªŒè¯ç»“æœé€šè¿‡ï¼Œå°†è¯¥å…ƒç´ åŠ å…¥ç»“æœæ•°ç»„
  - è¿”å›ç»“æœæ•°ç»„

```javascript
// å®ç°getElementsByClassName
function getElementsByClassName (className, container) {
  // å¦‚æœæ²¡ä¼ classNameæˆ–è€…ä¸æ˜¯å­—ç¬¦ä¸²åˆ™è¿”å›ç©ºæ•°ç»„
  if(!className && (typeof className !== "string")) {
    return [];
  }
  // å¦‚æœæ²¡ä¼ containerå®¹å™¨åˆ™é»˜è®¤è®¾ä¸ºdocument
  if (!container) {
    container = document;
  }
  var res = [];
  // ä½¿ç”¨æ‰€æœ‰æµè§ˆå™¨éƒ½å…¼å®¹çš„getElementsByTagNameæ–¹æ³•åŠ é€šé…ç¬¦è·å–æ‰€æœ‰èŠ‚ç‚¹
  var elemtnts = container.getElementsByTagName('*');
  // ä½¿ç”¨æ­£åˆ™åˆ†å‰²ä¼ é€’è¿›æ¥çš„ç±»åå­—ç¬¦ä¸²æˆæ•°ç»„
  var classAry = className.trim().split(/ +/g);
  for (var i =0; i<elemtnts.length; i++) // å¾ªç¯å®¹å™¨å†…çš„å…ƒç´ èŠ‚ç‚¹
  { // å‡è®¾ç»“æœéªŒè¯ä¸ºtrue
    var isValid = true;
    var curEle = elemtnts[i];
    for (var j=0, len=classAry.length; j<len; j++) {
      // åˆ¤æ–­å½“å‰å…ƒç´ èŠ‚ç‚¹æ˜¯å¦æœ‰è¯¥ç±»åï¼Œæ²¡æœ‰å°±ç›´æ¥ä¸­æ–­å†…å¾ªç¯è®¾ç½®isValidä¸ºfalse
      if(!hasClass(curEle, classAry[j])) {
        isValid = false;
        break;
      }
    }
    if (isValid) { // åªæœ‰å½“éªŒè¯é€šè¿‡æ‰å°†å…ƒç´ åŠ å…¥ç»“æœæ•°ç»„
      res.push(elemtnts[i]);
    }
  }
  return res; // è¿”å›ç»“æœæ•°ç»„
}
```

----------


  [1]: http://static.zybuluo.com/szy0syz/yrvs2poihx4r4qdmgqjjigy4/image.png
  [2]: http://static.zybuluo.com/szy0syz/v850efctc8h7txof2v5ak8cz/image.png
  [3]: http://static.zybuluo.com/szy0syz/09p3oh487y8k60tj330xdi03/HTMLElement_offsetLeft_plus.png
  [4]: http://static.zybuluo.com/szy0syz/954d247dzc5iwwheeel2g57m/task-queue.png
  [5]: http://static.zybuluo.com/szy0syz/mh6q7kn309897ykvxqh2cd45/img-lazy-loading-base.png
