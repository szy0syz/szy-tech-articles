# ç å³°JSå…¨æ ˆåŸ¹è®­ï¼šä¸€ã€ä½œç”¨åŸŸæ·±å…¥å’Œé¢å‘å¯¹è±¡

### è¯¾æ—¶1ï¼šé¢„è§£é‡Š

> åŸºæœ¬æ•°æ®ç±»å‹ï¼šnumberã€stringã€Booleanã€nullã€undefined
> å¼•ç”¨æ•°æ®ç±»å‹ï¼šobjectï¼ˆ{}ã€[]ã€/^$/ã€Dateï¼‰ã€function

- å½“æµè§ˆå™¨åŠ è½½HTMLé¡µé¢çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæä¾›ä¸€ä¸ªä¾›å…¨å±€JSä»£ç æ‰§è¡Œçš„ç¯å¢ƒ->å…¨å±€ä½œç”¨åŸŸï¼ˆglobal/windowï¼‰ï¼Œwindowä¸ä»…ä»£è¡¨å½“å‰æµè§ˆå™¨çª—å£å¯¹è±¡è¿˜ä»£è¡¨å…¨å±€ä½œç”¨åŸŸ

- JSä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œé¦–å…ˆå¼•æ“ä¼šå…ˆåœ¨å†…å­˜å¼€è¾Ÿä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œç„¶åæŠŠå‡½æ•°ä½“å†…çš„ä»£ç å½“åš**å­—ç¬¦ä¸²**å­˜å…¥å†…å­˜ç©ºé—´ï¼Œæœ€åæŠŠå—å†…å­˜çš„åœ°å€èµ‹å€¼ç»™å‡½æ•°åã€‚

- é¢„è§£é‡Šï¼šåœ¨å½“å‰ä½œç”¨åŸŸä¸­ï¼ŒJSä»£ç æ‰§è¡Œä¹‹å‰ï¼Œæµè§ˆå™¨ä¼šé¦–å…ˆé»˜è®¤æŠŠæ‰€æœ‰å¸¦varå’Œfunctionçš„è¿›è¡Œæå‰å£°æ˜æˆ–å®šä¹‰ã€‚

  - ç†è§£å®šä¹‰å’Œå£°æ˜ï¼š
    å£°æ˜ï¼ˆdeclareï¼‰ï¼švar num; -> å‘Šè¯‰æµè§ˆå™¨åœ¨å…¨å±€ä½œç”¨åŸŸä¸­æœ‰ä¸€ä¸ªnumçš„å˜é‡äº†ï¼Œé»˜è®¤å€¼undefined
    å®šä¹‰ï¼ˆdefinedï¼‰ï¼šnum = 12; -> ç»™æˆ‘ä»¬å£°æ˜çš„å˜é‡èµ‹å€¼
  - å¯¹äºå¸¦varå’Œfunctionå…³é”®å­—çš„åœ¨é¢„è§£é‡Šæ—¶è¿˜æ˜¯ä¸ä¸€æ ·çš„
    var -> åœ¨é¢„è§£é‡Šæ—¶åªæå‰å£°æ˜
    function -> åœ¨é¢„è§£é‡Šæ—¶æå‰çš„å£°æ˜å’Œå®šä¹‰éƒ½å®Œæˆäº†
  - é¢„è§£é‡Šåªå‘ç”Ÿåœ¨å½“å‰çš„ä½œç”¨åŸŸä¸‹ï¼Œä¾‹å¦‚ï¼šå¼€å§‹åªå¯¹windowä¸‹çš„è¿›è¡Œé¢„è§£é‡Šï¼Œåªæœ‰å‡½æ•°è¿è¡Œæ—¶æ‰ä¼šå¯¹å‡½æ•°ä¸­çš„è¿›è¡Œé¢„è§£é‡Š

- JSä¸­å†…å­˜çš„åˆ†ç±»
  æ ˆå†…å­˜ï¼šç”¨æ¥æä¾›ä¸€ä¸ªä¾›JSä»£ç æä¾›çš„ç¯å¢ƒ -> ä½œç”¨åŸŸï¼ˆå…¨å±€ä½œç”¨åŸŸã€ç§æœ‰ä½œç”¨åŸŸï¼‰ï¼Œé¢„è§£é‡Šå‘ç”Ÿåœ¨æ ˆå†…å­˜å½“ä¸­
  å †å†…å­˜ï¼šç”¨æ¥å­˜å‚¨å¼•ç”¨æ•°æ®çš„å€¼ -> å¯¹è±¡å­˜å‚¨çš„å±æ€§åå’Œå±æ€§å€¼ï¼Œå‡½æ•°å­˜å‚¨çš„æ˜¯ä»£ç å­—ç¬¦ä¸²

- å¦‚ä½•åŒºåˆ†ç§æœ‰å˜é‡å’Œå…¨å±€å˜é‡ï¼Ÿ
  - åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å£°æ˜ï¼ˆé¢„è§£é‡Šçš„æ—¶å€™ï¼‰çš„å˜é‡æ˜¯å…¨å±€å˜é‡
  - åœ¨â€œç§æœ‰ä½œç”¨åŸŸä¸­å£°æ˜çš„å˜é‡â€å’Œâ€œå‡½æ•°çš„å½¢å‚â€éƒ½æ˜¯ç§æœ‰å˜é‡
  - åœ¨ç§æœ‰ä½œç”¨åŸŸä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç æ‰§è¡Œæ—¶é‡åˆ°äº†ä¸€ä¸ªå˜é‡ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®å®šå®ƒæ˜¯å¦ä¸ºç§æœ‰å˜é‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å’Œå¤–é¢ä½œç”¨åŸŸçš„å˜é‡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼›å¦‚æœä¸æ˜¯ç§æœ‰çš„ï¼Œåˆ™å¾€å½“å‰ä½œç”¨åŸŸçš„ä¸Šçº§ä½œç”¨åŸŸè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœä¸Šçº§ä½œç”¨åŸŸä¹Ÿæ²¡æœ‰åˆ™ç»§ç»­å¾€ä¸ŠæŸ¥çœ‹ï¼Œä¸€ç›´æ‰¾åˆ°windowså…¨å±€ä½ç½®ï¼ˆä½œç”¨åŸŸé“¾ï¼‰ã€‚
  
----------

### è¯¾æ—¶2ï¼šä½œç”¨åŸŸé“¾

- å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼ˆç›´æ¥ç›®çš„ï¼šè®©å‡½æ•°ä½“ä¸­çš„ä»£ç æ‰§è¡Œï¼‰ï¼Œé¦–å…ˆä¼šå½¢æˆä¸€ä¸ªæ–°çš„ç§æœ‰çš„ä½œç”¨åŸŸï¼Œç„¶åæŒ‰å¦‚ä¸‹æ­¥éª¤æ‰§è¡Œï¼š
  - å¦‚æœæœ‰å½¢å‚ï¼Œå…ˆç»™å½¢å‚èµ‹å€¼
  - è¿›è¡Œç§æœ‰ä½œç”¨åŸŸçš„é¢„è§£é‡Š
  - ç§æœ‰ä½œç”¨åŸŸä¸­çš„ä»£ç ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œ
  - å‡½æ•°å½¢å‚çš„ä¸€ä¸ªæ–°çš„ç§æœ‰å˜é‡ä¿æŠ¤äº†é‡Œé¢çš„ç§æœ‰å˜é‡ä¸å—å¤–ç•Œçš„å¹²æ‰°ï¼ˆå¤–é¢ä¿®æ”¹ä¸äº†ç§æœ‰çš„ï¼Œç§æœ‰çš„ä¹Ÿä¿®æ”¹ä¸äº†å¤–é¢çš„ï¼‰--> â€œé—­åŒ…â€

----------

### è¯¾æ—¶3ï¼šå…¨å±€å˜é‡çš„ç»†èŠ‚é—®é¢˜
  
- ç§æœ‰ä½œç”¨åŸŸä¸­å‡ºç°çš„ä¸€ä¸ªå˜é‡ä¸æ˜¯ç§æœ‰çš„ï¼Œåˆ™å¾€ä¸Šçº§ä½œç”¨åŸŸè¿›è¡ŒæŸ¥æ‰¾ï¼Œä¸Šçº§ä½œç”¨åŸŸæ²¡æœ‰åˆ™ç»§ç»­å¾€ä¸Šçº§æŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°windowä¸ºæ­¢ï¼Œå¦‚æœwindowä¸‹ä¹Ÿæ²¡æœ‰åˆ™ï¼š
  - è‹¥æ˜¯è·å–å€¼ï¼šconsole.log(total) -> æŠ¥é”™ï¼
  - è‹¥æ˜¯è®¾ç½®å€¼ï¼štotal = 100  -> ç›¸å½“äºç»™windowå¢åŠ äº†ä¸€ä¸ªå±æ€§å¹¶èµ‹å€¼

- åœ¨JSä¸­ï¼Œåœ¨ä¸è¿›è¡Œä»»ä½•ç‰¹æ®Šå¤„ç†çš„æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„ä»£ç æŠ¥é”™ï¼Œä¸‹é¢çš„ä»£ç éƒ½ä¸å†æ‰§è¡Œ

----------

### è¯¾æ—¶4ï¼šé¢„è§£é‡Šæ˜¯ä¸€ç§æ¯«æ— èŠ‚æ“çš„æœºåˆ¶

> è‡ªä»å­¦äº†é¢„è§£é‡Šï¼Œä»æ­¤èŠ‚æ“æ˜¯è·¯äºº

- é¢„è§£é‡Šæ—¶ï¼Œåªè¦ç”¨`var`å£°æ˜çš„å˜é‡ï¼Œä¸ç®¡æ‰€åœ¨çš„æ¡ä»¶è¯­å—æ˜¯å¦æˆç«‹ï¼Œç»Ÿç»Ÿæå‰å£°æ˜

```javascript
if (!("num" in window)) { // ->(!true) -> false
  var num = 12  // ä¸æ‰§è¡Œèµ‹å€¼æ“ä½œï¼Œä½†å¾—é¢„è§£é‡Šç»™windowå£°æ˜å±æ€§window.num
}
console.log(num) // -> undefined â˜…
```

- é¢„è§£é‡Šçš„æ—¶å€™åªå¯¹â€˜=â€™å·¦è¾¹çš„è¡¨è¾¾å¼é¢„è§£é‡Šï¼Œä¸å¯¹â€˜=â€™çš„å€¼è¿›è¡Œé¢„è§£é‡Šï¼åŒ¿åå‡½æ•°ä¹‹å‡½æ•°è¡¨è¾¾å¼ï¼šæŠŠå‡½æ•°å®šä¹‰çš„éƒ¨åˆ†å½“åšä¸€ä¸ªå€¼èµ‹å€¼ç»™æˆ‘ä»¬çš„å˜é‡ã€å…ƒç´ çš„æŸä¸€ä¸ªäº‹ä»¶ã€‚

```javascript
fn1()  // -> undefined() -> Uncaught TypeError: fn1 is not a function
var fn1 = function () {
  console.log('ok')
}

fn2()  // -> ok
function fn2 () {
  console.log('ok')
}
fn2()  // ok
```

> ä¸ªäººå»ºè®®ä½¿ç”¨fn1å‡½æ•°ä¹‹å‡½æ•°è¡¨è¾¾å¼å®šä¹‰å‡½æ•°ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯ï¼Œå‡½æ•°åªåœ¨ä»£ç ä¸‹æ–¹æ‰§è¡Œï¼Œå¦‚æœå‡½æ•°æŠ¥é”™ï¼Œåªéœ€è¦ç½‘ä¸ŠæŸ¥å³å¯ã€‚

- æ‰§è¡Œå‡½æ•°å®šä¹‰çš„é‚£ä¸ªfunctionåœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ä¸è¿›è¡Œä»£ç é¢„è§£é‡Šï¼Œå½“ä»£ç æ‰§è¡Œåˆ°è¿™ä¸ªä½ç½®æ—¶å®šä¹‰å’Œæ‰§è¡Œä¸€èµ·å®Œæˆäº†ã€‚è‡ªæ‰§è¡Œå‡½æ•°ï¼šå®šä¹‰å’Œæ‰§è¡Œä¸€èµ·å®Œæˆäº†

```javascript
(function(num) {})(100);
~function(num) {}(100);
!function(num) {}(100);
```

- å‡½æ•°ä½“ä¸­`return`ä¸‹é¢çš„ä»£ç è™½ç„¶ä¸æ‰§è¡Œäº†ï¼Œä½†æ˜¯éœ€è¦è¿›è¡Œé¢„è§£é‡Šï¼›`return`åé¢è·Ÿç€çš„éƒ½æ˜¯æˆ‘ä»¬çš„è¿”å›å€¼ï¼Œæ‰€ä»¥ä¸è¿›è¡Œé¢„è§£é‡Šï¼›

```javascript
function fn() {
  console.log(num)
  return function() {
  
  }
  var num = 100
}
fn()
```

- åœ¨é¢„è§£é‡Šæ—¶ï¼Œå¦‚æœåå­—å·²ç»å£°æ˜è¿‡äº†ï¼Œåˆ™ä¸ä¼šé‡æ–°å†å£°æ˜ï¼Œä½†ä¼šé‡æ–°èµ‹å€¼ï¼›åœ¨JSä¸­ï¼Œå¦‚æœå˜é‡åå’Œå‡½æ•°åé‡å¤äº†ï¼Œä¹Ÿä¼šè¦†ç›–ï¼

```javascript
// windowé¢„è§£é‡Šæ‰§è¡Œæ­¥éª¤
// å£°æ˜+å®šä¹‰ fn = x000ff11
// å£°æ˜var fn ï¼ˆä¸ä¼šé‡å¤å£°æ˜ï¼Œè¦†ç›–è€çš„fnï¼‰
// å£°æ˜ï¼ˆä¸ä¼šé‡å¤å£°æ˜ï¼‰+å®šä¹‰ fn = 0x000ff22
// -> fn = 0x000ff22
fn()  // -> 2
function fn() {console.log(1)}
fn()  // -> 2
var fn = 10
fn()  // -> 10() -> Error: fn is not a function
function fn() {console.log(1)}
fn() // ä¸æ‰§è¡Œäº†ï¼
```

----------

### è¯¾æ—¶5ï¼šå¦‚ä½•æŸ¥æ‰¾ä¸Šçº§ä½œç”¨åŸŸ

- å¦‚ä½•æŸ¥æ‰¾ä¸Šçº§ä½œç”¨åŸŸï¼Ÿ

> çœ‹å½“å‰å‡½æ•°æ˜¯åœ¨å“ªä¸ªä½œç”¨åŸŸä¸‹å®šä¹‰çš„ï¼Œé‚£ä¹ˆå®ƒçš„ä¸Šçº§ä½œç”¨åŸŸå°±æ˜¯è°ã€‚-->å’Œå‡½æ•°åœ¨å“ªæ‰§è¡Œæ²¡æœ‰ä»»ä½•å…³ç³»

```javascript
var num = 12
function fn() {
  var num = 120
  return function () {
    console.log(num)
  }
}
var f = fn()
f()

~function () {
  var num = 1200
  fn()
}
```

![Scop_Chain](http://ofx24fene.bkt.clouddn.com//img/book/Scop-Chain.svg)

----------

### è¯¾æ—¶6ï¼šå…³äºå†…å­˜é‡Šæ”¾å’Œä½œç”¨åŸŸé”€æ¯çš„ç ”ç©¶

- å †å†…å­˜ï¼šå¯¹è±¡æ•°æ®ç±»å‹æˆ–è€…å‡½æ•°æ•°æ®ç±»å‹åœ¨å®šä¹‰æ—¶é¦–å…ˆéƒ½ä¼šå¼€è¾Ÿä¸€ä¸ªå †å†…å­˜ï¼Œå †å†…å­˜æœ‰ä¸€ä¸ªå¼•ç”¨åœ°å€ï¼Œå¦‚æœå¤–é¢æœ‰å˜é‡ç­‰çŸ¥é“äº†è¿™ä¸ªåœ°å€ï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªå†…å­˜è¢«å ç”¨äº†ï¼Œå°±ä¸èƒ½é”€æ¯äº†ï¼›å¦‚æœæˆ‘ä»¬æƒ³è¦è®©å †å†…å­˜é‡Šæ”¾/é”€æ¯ï¼Œåªéœ€æŠŠæ‰€æœ‰å¼•ç”¨å®ƒçš„å˜é‡å€¼èµ‹å€¼ä¸ºnullå³å¯ï¼Œå¦‚æœå½“å‰çš„å †å†…å­˜æ²¡æœ‰è¢«ä»»ä½•ä¸œè¥¿å ç”¨äº†ï¼Œé‚£ä¹ˆå¼•æ“å°±ä¼šåœ¨ç©ºé—²çš„æ—¶å€™æŠŠå®ƒé”€æ¯

```javascript
var obj1 = { name: 'é˜¿é£' }
var obj2 = obj1

obj1 = null
obk2 = null
```

- æ ˆå†…å­˜ï¼šè¯´ç™½äº†å°±æ˜¯ä½œç”¨åŸŸ
  - å…¨å±€ä½œç”¨åŸŸï¼šåªæœ‰å½“é¡µé¢å…³é—­æ—¶å…¨å±€ä½œç”¨äºæ‰ä¼šé”€æ¯
  - ç§æœ‰ä½œç”¨åŸŸï¼šåªæœ‰å‡½æ•°æ‰§è¡Œä¼šäº§ç”Ÿç§æœ‰ä½œç”¨åŸŸã€‚ä¸€åŠæƒ…å†µä¸‹ï¼Œå‡½æ•°æ‰§è¡Œä¼šå½¢æˆç§æœ‰ä½œç”¨åŸŸï¼Œå½“ç§æœ‰ä½œç”¨åŸŸä¸­çš„ä»£ç æ‰§è¡Œå®Œæˆåï¼Œæˆ‘ä»¬å½“å‰ä½œç”¨åŸŸéƒ½ä¼šä¸»åŠ¨çš„è¿›è¡Œé‡Šæ”¾å’Œé”€æ¯ã€‚ä½†è¿˜ä¼šæœ‰ç‰¹ä¿—æƒ…å†µï¼šå½“å‰ç§æœ‰ä½œç”¨åŸŸä¸­çš„éƒ¨åˆ†å†…å­˜è¢«ä½œç”¨åŸŸä»¥å¤–çš„ä¸œè¥¿è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªä½œç”¨åŸŸå°±ä¸èƒ½é”€æ¯äº†ã€‚
  - ç§æœ‰ä½œç”¨åŸŸä¸é”€æ¯æƒ…å†µï¼šaã€å‡½æ•°æ‰§è¡Œè¿”å›äº†ä¸€ä¸ªå¼•ç”¨ç±»å‹çš„å€¼ï¼Œå¹¶ä¸”åœ¨å‡½æ•°å¤–è¢«ä¸€ä¸ªå…¶ä»–ä¸œè¥¿ç»™æ¥æ”¶äº†ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸€èˆ¬å½¢æˆçš„ç§æœ‰ä½œç”¨åŸŸéƒ½ä¸ä¼šè¢«é”€æ¯ï¼›
  - ç§æœ‰ä½œç”¨åŸŸä¸é”€æ¯æƒ…å†µï¼šbã€åœ¨ä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸä¸­ç»™DOMå…ƒç´ çš„äº‹ä»¶ç»‘å®šæ–¹æ³•ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬çš„ç§æœ‰ä½œç”¨åŸŸéƒ½ä¸é”€æ¯
  - ç§æœ‰ä½œç”¨åŸŸä¸é”€æ¯æƒ…å†µï¼šcã€fnè¿”å›çš„å‡½æ•°æ²¡æœ‰è¢«å…¶ä»–ä¸œè¥¿å ç”¨ï¼Œä½†æ˜¯è¿˜éœ€è¦æ‰§è¡Œä¸€æ¬¡å‘¢ï¼Œæ‰€ä»¥æš‚æ—¶ä¸é”€æ¯ï¼Œå½“è¿”å›çš„æ‰§è¡Œå®Œæˆåï¼Œæµè§ˆå™¨ä¼šåœ¨ç©ºé—²æ—¶æŠŠå®ƒé”€æ¯ã€‚ --> ä¸ç«‹å³é”€æ¯

```javascript
// æƒ…å†µa
function fn () {
  var num = 100
  return function () { }
}
var f = fn() // fnæ‰§è¡Œåå½¢æˆçš„è¿™ä¸ªç§æœ‰ä½œç”¨åŸŸå°±ä¸èƒ½è¢«é”€æ¯äº†

// æƒ…å†µb
var oDiv = document.getElementbyId("div1")
~function () {
  oDiv.onclick = function () {  }
} ()   // å½“å‰è‡ªå®šä¹‰å‡½æ•°å½¢æˆçš„ç§æœ‰ä½œç”¨åŸŸä¹Ÿä¸é”€æ¯

// æƒ…å†µc
function fn () {
  var num  = 100
  return function () { }
}
fn()() // é¦–å…ˆæ‰§è¡Œfnï¼Œè¿”å›ä¸€ä¸ªå°å‡½æ•°å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œç„¶åç´§æ¥ç€è®©è¿”å›çš„å°å‡½æ•°å†æ‰§è¡Œ
```

----------

### è¯¾æ—¶7ï¼šä½œç”¨åŸŸç»ƒä¹ é¢˜

```javascript
function fn () {
  var i = 10
  return function (n) {
    console.log(n + (++i))
  }
}
var f = fn()
f(10)  // -> 21
f(20)  // -> 32
fn()(10)  // -> 21
fn()(20)  // -> 31
```

![chain01](http://ofx24fene.bkt.clouddn.com//img/blog/chain-pro.svg)

```javascript
function fn (i) {
  return function (n) {
    console.log(n + (i++))
  }
}
var f = fn(13)
f(12)  // -> 24
f(14)  // -> 29
fn(15)(12)  // -> 27
fn(16)(13)  // -> 29
```

----------

### è¯¾æ—¶8ï¼šthiså…³é”®å­—

- JSä¸­çš„thisä»£è¡¨çš„æ˜¯å½“å‰è¡Œä¸ºæ‰§è¡Œçš„ä¸»ä½“ã€‚æˆ‘ä»¬ä¸€èˆ¬åœ¨JSä¸­ä¸»è¦ç ”ç©¶çš„éƒ½æ˜¯å‡½æ•°ä¸­çš„thisã€‚
- JSä¸­çš„contextä»£è¡¨çš„æ˜¯å½“å‰æ‰§è¡Œçš„ç¯å¢ƒï¼ˆåŒºåŸŸï¼‰
- thisæ˜¯è°å’Œå‡½æ•°åœ¨å“ªé‡Œå®šä¹‰çš„å’Œåœ¨å“ªæ‰§è¡Œçš„éƒ½æ²¡ä»»ä½•å…³ç³»ï¼›å¦‚ä½•åŒºåˆ†thiså‘¢ï¼Ÿ
  - å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æœå‡½æ•°åå‰æœ‰`.`çš„è¯ï¼Œ`.`å‰é¢æ˜¯è°thiså°±æ˜¯è°ï¼›æ²¡æœ‰çš„è¯ï¼Œthiså°±æ˜¯windowï¼ˆå…¨å±€å¯¹è±¡ï¼‰
  - è‡ªæ‰§è¡Œå‡½æ•°ä¸­çš„thisæ°¸è¿œæ˜¯window
  - ç»™DOMå…ƒç´ çš„æŸä¸€äº‹ä»¶ç»‘å®šæ–¹æ³•ï¼Œå½“äº‹ä»¶è§¦å‘æ—¶ï¼Œæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œæ–¹æ³•ä¸­çš„thiså°±æ˜¯å½“å‰å…ƒç´ 
  

```javascript
function fb () {
  console.log(this)
}

var obj = {fn: fn}
fn() // -> this is window
obj.fn() // -> this is obj

documnet.getElementById("div1").onclick = fn;
documnet.getElementById("div1").onclick = function () { 
  //ä½†å‡½æ•°ä½œç”¨äºå†…çš„thisä¸º'#div'
  fn() // -> this is window
}
```

> **ä½ ä»¥ä¸º ä½ ä»¥ä¸ºçš„ å°±æ˜¯ä½ ä»¥ä¸ºçš„ï¼**

----------

### è¯¾æ—¶9ï¼šç»¼åˆç»ƒä¹ é¢˜

```javascript
var num = 20
var obj = {
  num: 30,
  fn: (function (num) {
    this.num *=3
    num += 15
    var num = 45
    return function () {
      this.num *= 4
      num += 20
      console.log(num)
    }
  })(num)
}
var fn = obj.fn
fn()
obj.fn()
console.log(window.num, obj.num)
```

![09](http://ofx24fene.bkt.clouddn.com//img/blog/zhufeng09.svg)

----------

### è¯¾æ—¶10ï¼šç»¼åˆå®æˆ˜é¢˜

```javascript
var oBtn = document.getElementById('button')
var oCount = document.getElementById('count')

// æ–¹æ³•ä¸€ï¼šå…¨å±€ä½œç”¨åŸŸæ³•
var count = 0
oBtn.onclick = function () {
    oCount.innerHTML = ++count
} // å¼Šç«¯ï¼šå…¨å±€å˜é‡æ±¡æŸ“

// æ–¹æ³•äºŒï¼šç§æœ‰ä½œç”¨åŸŸæ³•ä¹‹è‡ªæ‰§è¡Œå‡½æ•°
~function () {
    var count = 0
    oBtn.onclick = function () {
        oCount.innerHTML = ++count
    }
}() // å¼Šç«¯ï¼šç§æœ‰ä½œç”¨åŸŸä¸é”€æ¯ï¼Œæµªè´¹ä¸€ä¸ç‚¹å†…å­˜

// æ–¹æ³•ä¸‰ï¼šç§æœ‰ä½œç”¨åŸŸæ³•ä¹‹ç›´æ¥ç»‘å®šè‡ªæ‰§è¡Œå‡½æ•°
oBtn.onclick = (function () {
    var count = 0
    return function () {
        oCount.innerHTML = ++count
    }
})()  // å¼Šç«¯ï¼šç§æœ‰ä½œç”¨åŸŸä¸é”€æ¯ï¼Œæµªè´¹ä¸€ä¸ç‚¹å†…å­˜

// æ–¹æ³•å››ï¼šinnerHtmlæ³•
oBtn.onclick = function () {
    oCount.innerHTML++
}  // å¼Šç«¯ï¼šåˆ©ç”¨innerHtmlæ–¹æ³•è¯»å†™ï¼Œå†åŠ å­—ç¬¦ä¸²è½¬æ•°å­—ï¼Œæœ€åæ¸²æŸ“é¡µé¢

// æ–¹æ³•äº”ï¼šè‡ªå®šä¹‰å±æ€§æ³•
oBtn.count = 0 //åœ¨btnä¸Šè®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰å±æ€§
oBtn.onclick = function () {
    oCount.innerHTML = ++this.count
}  // æ¨è

```

----------

### è¯¾æ—¶11ï¼šå•ä¾‹æ¨¡å¼

- å¯¹è±¡æ•°æ®ç±»å‹çš„ä½œç”¨
  - æŠŠæè¿°åŒä¸€ä¸ªäº‹ç‰©ï¼ˆåŒä¸€ä¸ªå¯¹è±¡ï¼‰çš„å±æ€§å’Œæ–¹æ³•æ”¾åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ä¸‹ï¼Œèµ·åˆ°äº†åˆ†ç»„çš„ä½œç”¨ï¼Œè¿™æ ·ä¸åŒäº‹ç‰©ä¹‹é—´çš„å±æ€§åç›¸åŒï¼Œç›¸äº’ä¹Ÿä¸ä¼šå‘ç”Ÿå†²çª
  - æˆ‘ä»¬æŠŠè¿™ç§åˆ†ç»„ç¼–å†™ä»£ç çš„æ¨¡å¼å«ä½œâ€œå•ä¾‹æ¨¡å¼â€
  - åœ¨å•åˆ©æ¨¡å¼ä¸­æˆ‘ä»¬æŠŠperson1æˆ–è€…person2ä¹Ÿå«åšâ€œå‘½åç©ºé—´â€
  
```javascript
var person1 = { name: 'xxx' }
var person2 = { name: 'yyy' }
```

> å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§é¡¹ç›®å¼€å‘ä¸­ç»å¸¸ä½¿ç”¨çš„æ¨¡å¼ï¼Œå› ä¸ºé¡¹ç›®ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥è¿›è¡Œâ€œæ¨¡å—åŒ–å¼€å‘â€

- â€œæ¨¡å—åŒ–å¼€å‘â€å¯¹äºä¸€ä¸ªç›¸å¯¹æ¥è¯´è¾ƒå¤§çš„é¡¹ç›®ï¼Œéœ€è¦å¤šäººååŒå¼€å‘çš„ï¼Œæˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹ä¼šæ ¹æ®å½“å‰é¡¹ç›®çš„éœ€æ±‚åˆ’åˆ†æˆå‡ ä¸ªåŠŸèƒ½æ¿å—ï¼Œæ¯ä¸ªäººè´Ÿè´£å¼€å‘ä¸€éƒ¨åˆ†ï¼ŒåŒæ—¶å¼€å‘ï¼Œæœ€åæŠŠæ¯ä¸ªäººå¼€å‘çš„ä»£ç è¿›è¡Œåˆå¹¶ã€‚

----------

### è¯¾æ—¶12ï¼šå·¥å‚æ¨¡å¼

- å•ä¾‹æ¨¡å¼è™½ç„¶è§£å†³äº†åˆ†ç»„ä½œç”¨ï¼Œä½†æ˜¯ä¸èƒ½å®ç°æ‰¹é‡ç”Ÿäº§ï¼Œå±äºæ‰‹å·¥ä½œä¸šæ¨¡å¼ -> éœ€è¦æ”¹è¿›æˆâ€å·¥å‚æ¨¡å¼â€œ
- æŠŠå®ç°åŒä¸€ä»¶äº‹æƒ…çš„ç›¸åŒä»£ç æ”¾åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œä»¥åå¦‚æœå†æƒ³å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™è¿™äº›ä»£ç ï¼Œåªéœ€è¦æ‰§è¡Œè¿™ä¸ªå·¥å‚å‡½æ•°å³å¯ -> â€å‡½æ•°å°è£…â€œ --> â€ä½è€¦åˆé«˜å†…èšâ€œï¼šå‡å°‘å†—ä½™ä»£ç ï¼Œæé«˜ä»£ç çš„å¤ç”¨ç‡
- JSæ˜¯ä¸€é—¨è½»é‡çº§çš„è„šæœ¬â€ç¼–ç¨‹è¯­è¨€â€œï¼ˆHTML+CSSä¸å±äºç¼–ç¨‹è¯­è¨€ï¼Œå±äºæ ‡è®°è¯­è¨€ï¼‰
- å¤§å¤šçš„ç¼–ç¨‹è¯­è¨€éƒ½æ˜¯é¢å‘å¯¹è±¡å¼€å‘çš„ -> ç±»çš„ç»§æ‰¿ã€å°è£…ã€å¤šæ€
  - ç»§æ‰¿ï¼šå­ç±»ç»§æ‰¿çˆ¶ç±»ä¸­çš„å±æ€§å’Œæ–¹æ³•
  - å¤šæ€ï¼šå½“å‰æ–¹æ³•çš„å¤šç§å½¢æ€ã€‚åå°è¯­è¨€ä¸­ï¼šå¤šæ€åŒ…å«é‡è½½å’Œé‡å†™
  
- JSä¸­ä¸å­˜åœ¨é‡è½½ï¼Œæ–¹æ³•åä¸€æ ·çš„è¯ï¼Œåé¢çš„ä¼šæŠŠå‰é¢çš„è¦†ç›–ï¼Œæœ€ååªä¿ç•™æœ€åä¸€ä¸ªã€‚
  - JSä¸­æœ‰ä¸€ä¸ªæ“ä½œç±»ä¼¼é‡è½½ä½†ä¸æ˜¯é‡è½½ï¼šæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä½“é‡Œæ ¹æ®ä¼ é€’å‚æ•°çš„ä¸ä¸€æ ·ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½ã€‚
  - é‡å†™ï¼šå­ç±»é‡å†™çˆ¶ç±»çš„æ–¹æ³•
  
> è¯´ç™½äº†å·¥å‚æ¨¡å¼å°±æ˜¯ä¸€ä¸ªâ€œç ´å‡½æ•°â€

----------

### è¯¾æ—¶13ï¼šæ„é€ å‡½æ•°æ¨¡å¼åŸºç¡€

#### æ„é€ å‡½æ•°æ¨¡å¼å’Œå·¥å‚æ¨¡å¼çš„åŒºåˆ«
 
- æ‰§è¡Œçš„æ—¶å€™ï¼š
   - æ™®é€šå‡½æ•°æ‰§è¡Œ -> `creatorPerson()`
   - æ„é€ å‡½æ•°æ‰§è¡Œ -> `New creatorPerson()`ï¼Œæ­¤æ—¶creatorPersonå°±æ˜¯ç±»åï¼Œè¿”å›å®ä¾‹ã€‚

- åœ¨å‡½æ•°ä»£ç æ‰§è¡Œçš„æ—¶å€™
  - ç›¸åŒç‚¹ï¼šéƒ½æ˜¯å½¢æˆä¸€ä¸ªç§æœ‰çš„ä½œç”¨åŸŸï¼Œç„¶åæ‰§è¡Œæ­¥éª¤ å½¢å‚èµ‹å€¼->é¢„è§£é‡Š->ä»£ç ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼ˆç±»å’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œå®ƒä¹Ÿæœ‰æ™®é€šå‡½æ•°çš„ä¸€é¢ï¼‰
  - ä¸åŒç‚¹ï¼šåœ¨ä»£ç æ‰§è¡Œä¹‹å‰ï¼Œä¸ç”¨è‡ªå·±åœ¨æ‰‹åŠ¨åˆ›å»ºobjå¯¹è±¡ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»å‹çš„å€¼ï¼ˆè¿™ä¸ªå¯¹è±¡å…¶å®å°±æ˜¯æˆ‘ä»¬å½“å‰ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼‰ï¼›æ¥ä¸‹æ¥ä»£ç ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œï¼Œä»¥å½“å‰çš„å®ä¾‹ä¸ºæ‰§è¡Œçš„ä¸»ä½“ï¼ˆthisä»£è¡¨çš„å°±æ˜¯å½“å‰ï¼‰ï¼Œç„¶ååˆ†åˆ«çš„æŠŠå±æ€§åå’Œå±æ€§å€¼èµ‹å€¼ç»™å½“å‰å®ä¾‹ï¼›æœ€åæµè§ˆå™¨ä¼šé»˜è®¤è‡ªåŠ¨æŠŠåˆ›å»ºçš„å®ä¾‹è¿”å›ã€‚
  
```javascript
// å·¥å‚æ¨¡å¼
function createPerson (name, age) {
  var obj = {}  // è¿™é‡Œåˆ›å»ºå¯¹è±¡
  obj.name = name
  obj.age = age
  return obj  // è¿™é‡Œè¿”å›è¿™ä¸ªå¯¹è±¡
}

function CreatePerson (name, age) {
  // è¿™é‡Œä¸éœ€è¦åˆ›å»º
  this.name = name
  this.age = age
  // è¿™é‡Œä¸éœ€è¦è¿”å›
}
```

> 1.JSä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯å‡½æ•°æ•°æ®ç±»å‹ï¼Œä»–é€šè¿‡newæ‰§è¡Œæˆä¸€ä¸ªç±»ï¼Œä½†å®ƒæœ¬äº‹ä¹Ÿæ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼›JSä¸­æ‰€æœ‰çš„å®ä¾‹éƒ½æ˜¯å¯¹è±¡æ•°æ®ç±»å‹
2.åœ¨æ„é€ å‡½æ•°æ¨¡å¼ä¸­ï¼Œç±»ä¸­ï¼ˆå‡½æ•°ä½“ä¸­ï¼‰å‡ºç°çš„thiså‡æŒ‡å½“å‰ç±»çš„ä¸€ä¸ªå®ä¾‹
3.ä¸¤ä¸ªå®ä¾‹éƒ½æ˜¯ç±»çš„å®ä¾‹ï¼Œæ‰€æœ‰éƒ½æœ‰ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸åŒå®ä¾‹ä¹‹é—´çš„æ–¹æ³•éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨ç±»ä¸­ç»™å®ä¾‹æ·»åŠ çš„å±æ€§éƒ½å±äºè¿™ä¸ªå®ä¾‹çš„ç§æœ‰å±æ€§ï¼Œå®ä¾‹å’Œå®ä¾‹ä¹‹é—´æ˜¯å•ç‹¬çš„ä¸ªä½“ï¼Œæ‰€ä»¥ç§æœ‰çš„å±æ€§ä¹‹é—´ä¸ç›¸ç­‰ã€‚

```javascript
var res = CreatePerson('szy', 18) // å‡½æ•°æ–¹å¼æ‰§è¡Œæ„é€ å‡½æ•°ï¼šé¦–å…ˆresæ¥æ”¶åˆ°çš„æ˜¯undefinedï¼Œå› ä¸ºæ²¡returnã€‚å…¶æ¬¡æ˜¯æ„é€ å‡½æ•°ä¸­çš„`this`æ˜¯å…¨å±€çš„windowå¯¹è±¡ã€‚
```

----------

### è¯¾æ—¶14ï¼šæ„é€ å‡½æ•°æ¨¡å¼æ‰©å±•

```javascript
function Fn () {
  var num = 4
  this.x = 100 // æ­¤æ—¶ï¼Œthisä¸ºå½“å‰å®ä¾‹f1
  this.get = function () {
    console.log(this.x) // è€Œè¿™ä¸ªthiså°±éœ€è¦è°ƒç”¨æ—¶æ‰çŸ¥é“æ˜¯è°
  }
}

var f1 = new Fn
f1.getX() // -> æ–¹æ³•ä¸­çš„thisæ˜¯f1 -> 100
f1.num // -> undefined
var ss = f1.getX
ss() // -> æ–¹æ³•ä¸­çš„thisæ˜¯window -> undefined
```


- åœ¨æ„é€ å‡½æ•°æ¨¡å¼ä¸­ï¼Œ`new Fn()`æ‰§è¡Œï¼Œå¦‚æœFnæ²¡æœ‰å‚æ•°ï¼Œåˆ™åé¢çš„å°æ‹¬å·å¯ä»¥çœç•¥`new Fn`
- thisçš„é—®é¢˜ï¼šåœ¨ç±»ä¸­å‡ºç°çš„this.xxxçš„thiséƒ½æ˜¯å½“å‰ç±»çš„å®ä¾‹ï¼Œè€ŒæŸä¸€å±æ€§å€¼ï¼ˆæ–¹æ³•ï¼‰ä¸­è‹¥å‡ºç°thisåˆ™éœ€è¦çœ‹æ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå‰é¢æ˜¯å¦æœ‰'.'æ‰èƒ½çŸ¥é“thisæ˜¯è°ï¼ˆè°è°ƒç”¨ï¼‰
- ç±»ä¹Ÿæœ‰æ™®é€šå‡½æ•°çš„ä¸€é¢ï¼Œå½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œ`var num`å…¶å®åªæ˜¯å½“å‰å½¢æˆç§æœ‰ä½œç”¨åŸŸä¸­çš„ç§æœ‰å˜é‡è€Œå·²ï¼Œå®ƒå’Œæˆ‘ä»¬çš„f1è¿™ä¸ªå®ä¾‹æ²¡æœ‰ä»»ä½•å…³ç³»ï¼›åªæœ‰`this.xxx=yyy`æ‰ç›¸å½“äºç»™f1è¿™ä¸ªå®ä¾‹æ·»åŠ ç§æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œæ‰å’Œæˆ‘ä»¬f1æœ‰å…³ç³»

```javascript
function Fn () {
  this.x = 100
  return { name: "szy" }
}

var f1 = new Fn
console.log(f1)  // -> {name: "szy"}
```

- åœ¨æ„é€ å‡½æ•°æ¨¡å¼ä¸­ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤çš„æŠŠæˆ‘ä»¬å®ä¾‹è¿”å›ï¼ˆè¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»å‹çš„å€¼ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æ‰‹åŠ¨å†™äº†returnè¿”å›çš„è¯ï¼š
  - è‹¥è¿”å›çš„æ˜¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™å½“å‰å®ä¾‹æ˜¯ä¸å˜çš„ï¼Œè¿˜æ˜¯ç…§æ ·è¿”å›è¿™ä¸ªå®ä¾‹ï¼Œå¦‚`return 100`
  - è‹¥è¿”å›çš„æ˜¯ä¸€ä¸ªå¼•ç”¨æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™å½“å‰è¦è¿”å›çš„è¿™ä¸ªå®ä¾‹ä¼šè¢«æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®çš„å¯¹è±¡ç»™æ›¿æ¢ï¼Œå¦‚`return { name: "szy" }`
  
```javascript
function Fn () {
  this.x = 100
}

var f1 = new Fn
console.log(f1 instanceof Fn)  // -> true
console.log(f1 instanceof Array)  // -> false
console.log(f1 instanceof Object)  // -> true å› ä¸ºæ‰€æœ‰çš„å®ä¾‹éƒ½æ˜¯å¯¹è±¡æ•°æ®ç±»å‹çš„ï¼Œè€Œæ¯ä¸ªå¯¹è±¡æ•°æ®ç±»å‹éƒ½æ˜¯Objectè¿™ä¸ªå†…ç½®ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥f1ä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªå®ä¾‹ã€‚å¯¹äºæ£€æµ‹æ•°æ®ç±»å‹æ¥è¯´ï¼Œtypeofæœ‰è‡ªå·±çš„å±€é™æ€§ï¼Œä¸èƒ½ç»†åˆ†objectä¸‹çš„å¯¹è±¡ã€æ•°ç»„ã€æ­£åˆ™ç­‰...
```

- æ£€æŸ¥æŸä¸ªå®ä¾‹æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å®ä¾‹ï¼š**instanceof**

```javascript
var f1 = new Fn
var f1 = new Fn
```

- f1å’Œf2éƒ½æ˜¯Fnè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œéƒ½æ‹¥æœ‰xå’ŒgetXä¸¤ä¸ªå±æ€§ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå±æ€§æ˜¯å„è‡ªçš„ç§æœ‰å±æ€§ï¼Œç”¨`===`åˆ¤æ–­çš„ç»“æœæ˜¯`false`
  - `in`ï¼šæ£€æµ‹æŸä¸€ä¸ªå±æ€§åæ˜¯å¦å­˜åœ¨äºæŸä¸ªå¯¹è±¡(attrName in object)ï¼Œä¸ç®¡æ˜¯ç§æœ‰å±æ€§è¿˜æ˜¯å…±æœ‰å±æ€§ï¼Œåªè¦å­˜åœ¨ï¼Œç”¨`in`æ¥æ£€æµ‹éƒ½æ˜¯true
  - `hasOwnProperty`ï¼šç”¨æ¥æ£€æµ‹æŸä¸€ä¸ªå±æ€§æ˜¯å¦ä¸ºè¿™ä¸ªå¯¹è±¡çš„â€œè‡ªæœ‰(ç§æœ‰)å±æ€§â€ï¼Œè¿™ä¸ªæ–¹æ³•åªèƒ½æ£€æµ‹è‡ªæœ‰å±æ€§
  
> æ€è€ƒï¼šæ£€æµ‹æŸä¸€ä¸ªå±æ€§æ˜¯å¦ä¸ºè¿™ä¸ªå¯¹è±¡çš„â€œå…±æœ‰å±æ€§â€ï¼šhasPubProperty
åŸç†ï¼šæ£€æµ‹æ˜¯å¦ä¸ºå¯¹è±¡çš„å±æ€§ï¼Œå¹¶æ£€æµ‹ä¸æ˜¯å¯¹è±¡çš„ç§æœ‰å±æ€§å³å¯ã€‚

```javascript
function hasPubProperty(obj, attr) {
  return (attr in obj) && (!obj.hasOwnProperty(attr))
}
```

- `isPrototypeOf`

----------

### è¯¾æ—¶15ï¼šåŸå‹é“¾æ¨¡å¼åŸºç¡€

> åŸºäºæ„é€ å‡½æ•°æ¨¡å¼çš„åŸå‹é“¾æ¨¡å¼è§£å†³äº† æ–¹æ³•æˆ–è€…å±æ€§å…¬æœ‰çš„é—®é¢˜ -> æŠŠå®ä¾‹ä¹‹é—´ç›¸åŒçš„å±æ€§å’Œæ–¹æ³•æå–å‡ºæ¥æˆå…¬æœ‰çš„å±æ€§å’Œæ–¹æ³• -> æƒ³è®©è°å…¬æœ‰å°±æŠŠå®ƒæ”¾åœ¨`.prototype`å±æ€§ä¸Šå³å¯

- æ¯ä¸€ä¸ªå‡½æ•°æ•°æ®ç±»å‹ï¼ˆæ™®é€šå‡½æ•°ã€ç±»ï¼‰éƒ½æœ‰ä¸€ä¸ªå¤©ç”Ÿçš„è‡ªå¸¦å±æ€§ï¼š`prototype`ï¼ˆåŸå‹ï¼‰ï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»å‹çš„å€¼
- å¹¶ä¸”åœ¨`prototype`ä¸Šæµè§ˆå™¨å¤©ç”Ÿç»™å®ƒåŠ äº†ä¸€ä¸ªå±æ€§`constructor`ï¼ˆæ„é€ å™¨ï¼‰ï¼Œå±æ€§å€¼å°±æ˜¯å½“å‰çš„å‡½æ•°(ç±»)æœ¬èº«
- æ¯ä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»å‹(æ™®é€šå¯¹è±¡ã€å®ä¾‹ã€prototypeã€æ•°ç»„ã€æ­£åˆ™ã€Data...)ä¹Ÿå¤©ç”Ÿè‡ªå¸¦ä¸€ä¸ªå±æ€§ï¼š`__proto__`ï¼Œå…¶å±æ€§å€¼å°±æ˜¯å½“å‰å®ä¾‹æ‰€å±ç±»çš„åŸå‹(prototype)

```javascript
function Fn() {
  this.x = 100
  this.sum = function () { }
}
Fn.prototype.getX = function () { console.log(this.x) }
Fn.prototype.sum = function () { }
var f1 = new Fn
var f2 = new Fn

console.log(Fn.prototype.constructor === Fn)  // -> true
```

![prototype chain base](http://ofx24fene.bkt.clouddn.com//img/blog/prototype%20chain%20base.svg)

#### åŸå‹é“¾æ¨¡å¼

- `f1.hasOwnPerproty("x")`ä¸­hasOwnPerprotyæ˜¯f1çš„ä¸€ä¸ªå±æ€§ã€‚
- ä½†æ˜¯æˆ‘ä»¬å‘ç°åœ¨f1çš„ç§æœ‰å±æ€§ä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œé‚£å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ
  - 1.é€šè¿‡ å¯¹è±¡å.å±æ€§å çš„æ–¹å¼è·å–å±æ€§å€¼æ—¶ï¼Œé¦–å…ˆä¼šåœ¨å¯¹è±¡çš„ç§æœ‰å±æ€§ä¸Šè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœç§æœ‰ä¸­å­˜åœ¨è¿™ä¸ªå±æ€§ï¼Œåˆ™è·å–è¿™ä¸ªç§æœ‰çš„å±æ€§å€¼ï¼›
  - å¦‚æœç§æœ‰çš„æ²¡æœ‰ï¼Œåˆ™é€šè¿‡`__proto__`å¯¹è±¡æ‰¾åˆ°æ‰€å±çš„åŸå‹ï¼ˆç±»çš„åŸå‹ä¸Šå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ä»…æ˜¯å½“å‰å®ä¾‹å…¬æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼‰ï¼ŒåŸå‹ä¸Šå­˜åœ¨çš„è¯ï¼Œè·å–åˆ°çš„æ˜¯å…¬æœ‰çš„å±æ€§å€¼ï¼›
  - å¦‚æœåŸå‹ä¸Šä¹Ÿæ²¡æœ‰ï¼Œåˆ™ç»§ç»­é€šè¿‡åŸå‹ä¸Šçš„`__proto__`ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œä¸€ç›´æ‰¾åˆ°Object.prototypeä¸ºæ­¢

> è¿™ç§æŸ¥æ‰¾æœºåˆ¶å°±æ˜¯æˆ‘ä»¬çš„â€œåŸå‹é“¾æ¨¡å¼â€

```javascript
f1.getX === f2.getX // -> ture
f1.__proto__.getX === f2.getX // -> ture
f1.getX === Fn.prototype.getX // -> ture

f1.sum === f2.__proto__.sum // -> false å‰ä¸€ä¸ªæ˜¯ç§æœ‰çš„ï¼Œåä¸€ä¸ªæ˜¯å…¬æœ‰çš„
f1.sum === Fn.prototype.sum // -> false

f1.hasOwnProperty // -> 
f1.__proto__.__proto__.hasOwnProperty // æ‰¾åˆ°äº†Objectä¸Š
```

- åœ¨IEæµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬åŸå‹é“¾æ¨¡å¼ä¹Ÿæ˜¯åŒæ ·åŸç†ï¼Œä½†æ˜¯IEæµè§ˆå™¨æ€•ä½ é€šè¿‡`__proto__`æŠŠå…¬æœ‰çš„ä¿®æ”¹ï¼Œç¦æ­¢æˆ‘ä»¬åªç”¨`__proto__`ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨çˆ¶ç±»çš„`prototype`å±æ€§æ¥ä¿®æ”¹å­ç±»çš„å…¬æœ‰å±æ€§

----------

### è¯¾æ—¶16ï¼šåŸå‹é“¾æ¨¡å¼æ‰©å±•ï¼šthis

- åœ¨åŸå‹é“¾ä¸­ï¼Œ`this`å¸¸ç”¨çš„ä¸¤ç§æƒ…å†µ
  - åœ¨ç±»ä¸­`this.xxx`æ­¤æ—¶`this`æ˜¯å½“å‰ç±»çš„å®ä¾‹
  - åœ¨æŸä¸€ä¸ªæ–¹æ³•ä¸­çš„`this`ï¼Œçœ‹æ‰§è¡Œçš„æ—¶å€™'.'å‰é¢æ˜¯è°`this`å°±æ˜¯è°

```javascript
function Fn() {
  this.x = 100
  this.y = 200
  getY: function () { console.log(this.y) }
}
Fn.prototype = {
  constructor: Fn,
  y: 300,
  getX: function () { console.log(this.x) },
  getY: function () { console.log(this.y) }
}
Fn.prototype.setX = function (val) { this.x = val }
var f1 = new Fn
var f2 = new Fn
f1.getX()  // -> ç›¸å½“äºconsole.log(f.x) -> 100
f1.__proto__.getX()  // -> ç›¸å½“äºconsole.log(f.__proto__.x) -> undefined å…¬æœ‰çš„xè¿˜æ²¡å®šä¹‰ï¼Œè·³è¿‡äº†ç§æœ‰ä»å…¬æœ‰æ‰¾èµ·ï¼Œæ‰¾åˆ°objectçš„åŸå‹ä¸Šä¹Ÿæ²¡æœ‰å°±undefinedâ˜…â˜…
f1.getY()  // -> 200
f1.__proto__.getY()  // -> 300
Fn.Prototype.setX(400) // this=Fn.prototype -> Fn.prototype.x = 400, å…¬æœ‰çš„æ·»åŠ æ–°å±æ€§x=400, f2ä¹Ÿå¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå…¬æœ‰xå±æ€§
f1.getX() // -> 100, this.x -> f1.x è¿™é‡Œè·å–çš„xè¿˜æ˜¯f1ç§æœ‰çš„x:100
f1.__proto__.getX() // -> 400, åˆšåˆšç”¨setæ–¹æ³•è®¾ç½®äº†å…¬æœ‰xä¸º400
f1.setX(500) // -> this=f1, f1.x = 500, æŠŠf1è‡ªå·±ç§æœ‰çš„xæ”¹ä¸º500
f1.y = 222  // -> è®¾ç½®f1.yè‡ªå·±ç§æœ‰çš„yä¸º222, å’Œf2å®ä¾‹æ²¡æœ‰ä»»ä½•å…³ç³»

```

 1. éœ€è¦å…ˆç¡®å®š`this`çš„æŒ‡å‘
 2. æŠŠ`this`æ›¿æ¢æˆå¯¹åº”çš„ä»£ç 
 3. æŒ‰ç…§åŸå‹é“¾æŸ¥æ‰¾çš„æœºåˆ¶ï¼Œä¸€æ­¥æ­¥çš„å‘ä¸ŠæŸ¥æ‰¾ç»“æœ
 
#### é“¾å¼å†™æ³•ï¼šæ‰§è¡Œå®Œæˆæ•°ç»„çš„ä¸€ä¸ªæ–¹æ³•åå¯ä»¥ç´§æ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ªæ–¹æ³•

```javascript
var ary = [4,22,44,22,4,1,9]
ary.sort(function () {return a-b}).reverse().pop.push(40) // æŠ¥é”™
```

- åŸç†ï¼šå› ä¸ºsortæ˜¯Array.protoytpeå¯¹è±¡ä¸Šçš„å…¬æœ‰æ–¹æ³•ï¼Œè€Œæ•°ç»„aryæ˜¯Arryaçš„å®ä¾‹ï¼Œæ‰€ä»¥aryå¯ä»¥è°ƒç”¨sortæ–¹æ³•ï¼Œæ•°ç»„æ‰èƒ½ä½¿ç”¨æˆ‘ä»¬ArrayåŸå‹ä¸Šå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•
  - sortæ‰§è¡Œå®Œæˆçš„è¿”å›å€¼æ˜¯ä¸€ä¸ªæ’åºåçš„æ–°æ•°ç»„ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œreverseæ–¹æ³•
  - reverseæ‰§è¡Œå®Œæˆåè¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œpopæ–¹æ³•
  - popæ‰§è¡Œå®Œæˆåè¿”å›å€¼æ˜¯é‚£ä¸ªè¢«åˆ é™¤çš„å…ƒç´ ï¼Œä¸å†æ˜¯ä¸€ä¸ªæ•°ç»„äº†ï¼Œå†æ‰§è¡Œæ—¶æŠ¥é”™ã€‚
  
#### æ€è€ƒé¢˜

1.æ‰‹å·¥å®ç°Array.sliceå‡½æ•°ï¼Œè¦æ±‚ä¸èƒ½ä½¿ç”¨ArrayåŸç”Ÿæ–¹æ³•ï¼Œè€ƒè™‘å¤šç§æƒ…å†µï¼
```javascript
var arr = [1, 2, 3, 4, 5, 6, 7, 8, 9]

Array.prototype.szySlice = function (start, end) {
  // è¿™é‡Œå½¢å‚endæ˜¯ç´¢å¼•å·ï¼Œä¾‹å¦‚ç¬¬å‡ ä¸ªå…ƒç´ ï¼Œæ²¡æœ‰ç¬¬0ä¸ªï¼Œç¬¬1ä¸ªå¼€å§‹
  // æƒ…å†µ01ï¼šå½“end <= startæ—¶ï¼Œç›´æ¥è¿”å›ç©ºæ•°ç»„
  if (end <= start) return [] // -> []
  var newArr = new Array
  // æƒ…å†µ02ï¼š ä¸¤ä¸ªå‚æ•°å‡ä¸å­˜åœ¨
  if (!start && !end) {
    for (var i = 0; i < this.length; i++) {
      newArr[newArr.length] = this[i]
    }
    return newArr // -> å¤åˆ¶ä¸€éåŸæ•°ç»„ç»™è¿”å›æ•°ç»„ -> [1, 2, 3, 4, 5, 6, 7, 8, 9]
  }
  /////////////ä»¥ä¸‹ä¸ºendä¸å­˜åœ¨
  if (!end) {
    // æƒ…å†µ03ï¼šå½“endä¸å­˜åœ¨ï¼Œä¸”startä¹Ÿå¤§äº0æ—¶
    // å¤„ç†ï¼šä»startä½å¼€å§‹å–ï¼Œå–åˆ°æœ«å°¾
    if (start > 0) {
      for (var i = start; i < this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // -> arr.szySlice(5) -> [ 6, 7, 8, 9 ]
    // æƒ…å†µ04ï¼šå½“endä¸å­˜åœ¨ï¼Œä¸”start + this.lengthçš„ç»“æœä¸ºæ­£æ•°æ—¶
    } else if ((this.length + start) > 0) {
      for (var i = this.length + start; i < this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // -> arr.szySlice(-3) -> [ 7, 8, 9 ]
    // æƒ…å†µ05ï¼šå½“endä¸å­˜åœ¨ï¼Œä¸”start + this.lengthç»“æœä¸ºè´Ÿæ•°æ—¶
    // åˆ¤æ–­ï¼šå½“startä¿®æ­£ä½å°äº0æ—¶ï¼Œé»˜è®¤ä»0å¼€å§‹å–ï¼Œå–åˆ°endï¼Œæ­¤æ—¶endä¸å­˜åœ¨ï¼Œå–åˆ°æœ«å°¾
    } else {
      for (var i = 0; i < this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // -> å¤åˆ¶ä¸€éæ•°ç»„ -> [ 1, 2, 3, 4, 5, 6, 7, 8, 9 ]
    }
  }
  /////////////ä»¥ä¸Šä¸ºendä¸å­˜åœ¨
  // ç°åœ¨å¯ä»¥ä¸è€ƒè™‘endå’Œstartéƒ½ä¸å­˜åœ¨çš„æƒ…å†µï¼Œé»˜è®¤start,endå­˜åœ¨
  // æ³¨ï¼šè¿™é‡Œå·²ç»æ’é™¤äº†start >= endæƒ…å†µ

  // æƒ…å†µ06ï¼šå½“startå­˜åœ¨ï¼Œè€Œend=0æ—¶ï¼Œä¹Ÿæ˜¯ç›´æ¥ç©ºæ•°ç»„
  if (end == 0) {
    return newArr // -> ç©ºæ•°ç»„
  } else if (end > 0) {
    // æƒ…å†µ07ï¼šå½“start+length >= end åˆ™ç›´æ¥ç©ºæ•°æ®
    // åˆ¤æ–­ï¼šå½“startä¿®æ­£æ•°å¤§äºç­‰äºendï¼Œåˆ™ç©ºæ•°æ®
    if ((start+this.length) >= end) {
      return newArr // -> ç©ºæ•°ç»„
    }
    // æƒ…å†µ08ï¼šå½“start+length < end
    // åˆ¤æ–­ï¼šå½“startä¿®æ­£æ•°å°äºend
    // å¤„ç†ï¼šä»startä¿®æ­£æ•°å¼€å§‹å–ï¼Œå–åˆ°endç»“æŸ
    if ((start+this.length) < end) {
      for (var i = start+this.length; i < end; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // arr.szySlice(-4,7) -> [ 6, 7 ]
    }

    // æƒ…å†µ09ï¼šå½“end>0ï¼Œä¸”startå°äº0ï¼Œä¸”this.length + startç»“æœå¤§äºç­‰äº0
    // å¤„ç†ï¼šä»startä¿®æ­£æ•°å¼€å§‹ï¼Œå–åˆ°æœ¬æ•°ç»„æœ«å°¾
    if (start < 0 && (this.length + start) >= 0) {
      for (var i = this.length + start; i < this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // arr.szySlice(-4,-1)  -> [ 6, 7, 8 ]
    }
    //  æ²¡é‡åˆ°è¿™æ ·çš„æƒ…å†µ
    // // æƒ…å†µ10ï¼šå½“end>0ï¼Œä¸”startå°äº0ï¼Œä¸”this.length + startç»“æœå°äº0
    // if (start < 0 && (this.length + start) < 0) {
    //   for (var i = 0; i < end; i++) {
    //     newArr[newArr.length] = this[i]
    //   }
    // }
    // æƒ…å†µ11ï¼šå½“end>0ï¼Œä¸”start>0
    if (start > 0) {
      for (var i = start; i < end; i++) {
        newArr[newArr.length] = this[i]
      }
    }

  // !!!!å½“startå’Œend å‡ä¸ºè´Ÿæ•°
  } else {
    // æƒ…å†µ12ï¼šå…¶å®å¯ä»¥ä¸éœ€è¦å¤„ç†
    if ((end + this.length) < 0) {
      return newArr
    }

    // æƒ…å†µ13ï¼šå½“ä¿®æ­£endå¤§äº0 ä¸” ä¿®æ­£startå°äº0
    // å¤„ç†ï¼šè®¾ç½®startä¸º0å¼€å§‹ï¼Œå–åˆ°endä¿®æ­£åçš„æ•°å­—
    if ((end+this.length>=0) && (start+this.length) < 0) {
      for (var i = 0; i < end+this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr // -> [ 1, 2, 3, 4 ]
    }

    // æƒ…å†µ14ï¼šå½“ä¿®æ­£startå¤§äºç­‰äº0
    if ((start+this.length) >=0) {
      for (var i = start+this.length; i < end+this.length; i++) {
        newArr[newArr.length] = this[i]
      }
      return newArr
    }
  }

  return newArr
}
```

2.å®ç°ä¸€ä¸ªéœ€æ±‚ï¼š`(5).plus(10).minus(2)`

```javascript
Number.prototype.plus = function (opt) {
  console.log(this)
  return this + Number(opt) // new, this = [Number: 5]
}

Number.prototype.minus = function (opt) {
  return this - Number(opt) // new, this = [Number: 15]
}

console.log((5).plus(10).minus(2))
```

----------

### è¯¾æ—¶17ï¼šåŸå‹é“¾æ¨¡å¼æ‰©å±•-æ‰¹é‡è®¾ç½®å…¬æœ‰å±æ€§

#### æ–¹æ³•ä¸€ï¼šèµ·åˆ«å

```javascript
function Fn() { this.x = 100 }
var pro = Fn.protptype
pro.getX = function () {}
```

#### æ–¹æ³•äºŒï¼šé‡æ„åŸå‹å¯¹è±¡

> è‡ªå·±æ–°å¼€è¾Ÿä¸€ä¸ªå †å†…å­˜ï¼Œå­˜å‚¨æˆ‘ä»¬å…¬æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼ŒæŠŠæµè§ˆå™¨åŸæ¥ç»™Fn.prototypeå¼€è¾Ÿçš„é‚£ä¸ªæ›¿æ¢æ‰

```javascript
function Fn() { this.x = 100 }
Fn.prototype = function () {
  consttuctor: Fn
  a: function () {}
  b: function () {}
}
var f = new Fn
```

- 1.åªæœ‰æµè§ˆå™¨å¤©ç”Ÿç»™Fn.prototypeå¼€è¾Ÿçš„å †å†…å­˜æ‰æœ‰constructorï¼Œè€Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å †å†…å­˜æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œè¿™æ ·constructoræŒ‡å‘å°±ä¸å†æ˜¯Fnè€Œæ˜¯Objectã€‚ä¸ºäº†å’ŒåŸæ¥çš„ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„å¢åŠ constructorçš„æŒ‡å‘ã€‚
- 2.ç”¨è¿™ç§æ–¹å¼ç»™å†…ç½®ç±»å¢åŠ å…¬æœ‰çš„å±æ€§

```javascript
Array.prototype = {
  constructor: Array,
  unique: function () {}
} // è¿™ç§æ–¹æ³•ä¼šæŠŠåŸæ¥å­˜åœ¨äºåŸå‹çš„å†…ç½®å±æ€§å’Œæ–¹æ³•æ›¿æ¢æ‰ï¼Œæ‰€ä»¥æµè§ˆå™¨ä¼šç»™å±è”½æ‰

Array.prototype.sort = function () {
  console.log('ok')
} // ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä¸€ä¸ªä¸€ä¸ªçš„ä¿®æ”¹å†…ç½®æ–¹æ³•ï¼Œå½“æˆ‘ä»¬é€šè¿‡ä¸‹è¿°æ–¹æ³•åœ¨æ•°ç»„çš„åŸå‹ä¸Šæ·»åŠ æ–¹æ³•æ—¶ï¼Œå¦‚æœæ–¹æ³•åå’ŒåŸæ¥å†…ç½®çš„æ–¹æ³•åé‡åäº†ï¼Œä¼šæŠŠåŸå…ˆå†…ç½®çš„æ›¿æ¢æ‰ã€‚æ•…å»ºè®®ä»¥åä¸ºå†…ç½®ç±»æ·»åŠ æ–¹æ³•æ—¶ï¼Œå‘½åéƒ½åŠ ä¸Šç‰¹ä¿—çš„å‰ç¼€ã€‚
```

----------

### è¯¾æ—¶18ï¼šæ·±å…¥æ‰©å±•åŸå‹é“¾æ¨¡å¼-å¸¸ç”¨çš„å…­ç§ç»§æ‰¿æ–¹æ³•

#### `for in`å¾ªç¯æšä¸¾å±æ€§

`for in`å¾ªç¯åœ¨éå†æ—¶ï¼Œé»˜è®¤ä¼šæŠŠè‡ªå·±ç§æœ‰çš„å’Œåœ¨å®ƒæ‰€å±ç±»åŸå‹ä¸Šæ‰©å±•çš„å±æ€§å’Œæ–¹æ³•éƒ½å¯ä»¥éå†åˆ°ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éå†ä¸€ä¸ªå¯¹è±¡åªéœ€è¦éå†ç§æœ‰å³å¯ï¼Œæ•…ä½¿ç”¨æ—¶éœ€è¦åšä¸€ä¸‹åˆ¤æ–­ã€‚

```javascript
Object.prototype.szy = function () {}
var obj =  {name: 'szy'}
for (var key in obj) {
  if (obj.propertyIsEnumerable(key)) { ... }
  // æˆ–è€…ä¹Ÿå¯ä»¥è¿™æ ·
  if (obj.hasOwnProperty(key)) { ... }
}
```

#### Object.create

```javascript
var obj = {
  constructor: Fn,
  getX: function () {}
}
function Fn () {}

var obj2 = {}
for (var key in obj) {
  if(obj.hasOwnProperty(key)) { // è‡ªå·±ç§æœ‰çš„
    obj2[key] = obj[key]
  }
}

var obj3 = Object.create(obj) // è¿™ä¸ªçš„ç»“æœä¹Ÿç­‰äºå…‹éš†ï¼Œä½†ä¼šæŠŠobjé‡Œçš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•æ”¾åœ¨obj3çš„__proto__åŸå‹ä¸Š
```
> Object.create(protoObj) åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä½†è¿˜è¦æŠŠ`protoObj`ä½œä¸ºè¿™ä¸ªæ–°å¯¹è±¡çš„åŸå‹(ECMASrcipt5æ–°å¢ï¼ŒIE6~8ä¸å…¼å®¹)

```javascript
var obj = { getX: function () { console.log("x") } }
var obj2 = Object.create(obj)
//  .__protp__:
//    getX: function () {}
//    __protp__: Object.prototype
obj2.getX() // -> x
obj.getY = function () { console.log("y") }

obj2.getY() // -> y
```

```javascript
// æ¨¡æ‹ŸObject.create
function object(o) {
  function Fn () { }
  Fn.prototype = o
  return new Fn
}
var obj = { getX: function () { console.log("x") } }
var newObj = object(obj)
```

#### åŸå‹é“¾ç»§æ‰¿

- ç¬¬ä¸€ç§ç»§æ‰¿æ–¹æ³•ï¼šåŸå‹é“¾ç»§æ‰¿ã€‚å…¶åŸç†æ˜¯æŠŠçˆ¶ç±»å…¬æœ‰å’Œç§æœ‰çš„éƒ½ç»™å­ç±»å…¬æœ‰çš„ã€‚

```bash
#div1.__proto__ 
    -> HTMLDivElement.prototype 
        -> HTMLElement.prototype 
            -> Element.prototype 
                -> Node.prototype 
                    -> EventTarget.prototype 
                        -> Object.prototype
```

```javascript
function myObject () { }
myObject.prototype = {
  constructor: Object,
  hasOwnProperty: function () {},
  toString: function () {}
}

function EventTarget () { }
EventTarget.prototype = new myObject
EventTarget.prototype.addEventListener = function () {}

function myNode () { }
myNode.prototype = new EventTarget
myNode.prototype.createElement = function () {}

var szyNode = new myNode
szyNode.getNode = function () {}
```

![00](http://ofx24fene.bkt.clouddn.com//img/blog/WX20170530-134424.png)

- åŸå‹ç»§æ‰¿æ˜¯JSä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ç»§æ‰¿æ–¹æ³•ã€‚å­ç±»Bæƒ³è¦ç»§æ‰¿çˆ¶ç±»Açš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼ˆå…¬æœ‰+ç§æœ‰ï¼‰ï¼Œåªéœ€è¦è®©B.prototype = new A(Açš„ä¸€ä¸ªå®ä¾‹)å³å¯ã€‚å…¶è¿˜æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šå®ƒæ˜¯æŠŠçˆ¶ç±»ä¸­ç§æœ‰å’Œå…¬æœ‰çš„éƒ½ç»§æ‰¿åˆ°äº†å­ç±»åŸå‹ä¸Š(å­ç±»å…¬æœ‰)ã€‚

```javascript
function A () {
  this.x = 100
}
A.prototype.getX = function () {}

function B () {
  this.x = 200
}
B.prototype = new A
B.consturctor = B
Â 
```

![prototype-chain](http://ofx24fene.bkt.clouddn.com//img/blog/prototype_china%C2%8B.svg)


##### åŸå‹é“¾æ ¸å¿ƒï¼šåŸå‹ç»§æ‰¿å¹¶ä¸æ˜¯æŠŠçˆ¶ç±»Aä¸­çš„å±æ€§å’Œæ–¹æ³•å…‹éš†ä¸€ä»½ä¸€æ¨¡ä¸€æ ·çš„ç»™å­ç±»Bï¼Œè€Œæ˜¯è®©å­ç±»Bå’Œçˆ¶ç±»Aä¹‹é—´æ·»åŠ äº†ä¸€åŸå‹é“¾çš„é“¾æ¥ï¼Œä»¥åå­ç±»çš„å®ä¾‹cæƒ³è¦çˆ·çˆ·ç±»Aä¸­getXæ–¹æ³•æ—¶ï¼Œåªéœ€è¦ä¸€çº§ä¸€çº§å¾€ä¸ŠæŸ¥æ‰¾æ¥ç”¨ã€‚

#### ç¬¬äºŒç§ç»§æ‰¿æ–¹æ³•ï¼šcallç»§æ‰¿

- callç»§æ‰¿ä½œç”¨ï¼šæŠŠçˆ¶ç±»ç§æœ‰çš„å±æ€§å’Œæ–¹æ³•å…‹éš†ä¸€ä»½ä¸€æ¨¡ä¸€æ ·çš„ä½œä¸ºå­ç±»ç§æœ‰çš„å±æ€§

```javascript
function A() { this.x = 100 }
A.prototype.getX = function () { console.log(this.x) }
function B () {
  A.call(this) // -> ç›¸å½“äºA.call(n) æŠŠAå‡½æ•°æ‰§è¡Œï¼Œè®©Aä¸­çš„thisç­‰äºn
}
var n = new B
console.log(n.x) // -> 100
```

#### ç¬¬ä¸‰ç§ç»§æ‰¿æ–¹æ³•ï¼šå†’å……å¯¹è±¡ç»§æ‰¿

- å†’å……å¯¹è±¡ç»§æ‰¿ï¼šæŠŠçˆ¶ç±»ç§æœ‰å’Œå…¬æœ‰çš„éƒ½å…‹éš†ä¸€ä»½ä¸€æ¨¡ä¸€æ ·çš„ç»™å­ç±»ç§æœ‰çš„

```javascript
function A() { this.x = 100 }
A.prototype.getX = function () { console.log(this.x) }

function B () {
  var tmp = new A
  for (var key in tmp) {
    //  if (tem.hasOwnproperty(key)) ä¸è¿‡æ»¤äº†
    this[key] = tmp[key]
  }
  tmp = null
}

var n = new B
console.log(n.x) // -> 100
```

#### ç¬¬å››ç§ç»§æ‰¿æ–¹æ³•ï¼šæ··åˆæ¨¡å¼ç»§æ‰¿

- æ··åˆæ¨¡å¼ç»§æ‰¿ï¼šåŸå‹ç»§æ‰¿+callç»§æ‰¿ã€‚åŸç†å°±æ˜¯æŠŠçˆ¶ç±»çš„ç§æœ‰çš„å…‹éš†ä¸€ä»½ç»™å­ç±»çš„ç§æœ‰ï¼Œå†æŠŠçˆ¶ç±»çš„ç§æœ‰å’Œå…¬æœ‰çš„æŒ‡å‘å­ç±»çš„å…¬æœ‰

```javascript
function A() { this.x = 100 }
A.prototype.getX = function () { console.log(this.x) }

function B () {
  A.call(this) // -> n.x: 100 , æ•´äº†ä¸¤éã€‚
}
B.prototype = new A // -> B.prototype: x:100, getX:function
B.prototype.constructor = B

var n = new B
console.log(n.x) // -> 100
```

#### ç¬¬äº”ç§ç»§æ‰¿æ–¹æ³•ï¼šå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

- å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼šç±»æ··åˆç»§æ‰¿ï¼Œä½†ä¸æŠŠçˆ¶ç±»ç§æœ‰å¼•å…¥å­ç±»å…¬æœ‰ã€‚åŸç†å°±æ˜¯æŠŠçˆ¶ç±»çš„ç§æœ‰å…‹éš†ä¸€ä»½ç»™å­ç±»çš„ç§æœ‰ï¼Œå†æŠŠçˆ¶ç±»çš„å…¬æœ‰æŒ‡å‘å­ç±»çš„å…¬æœ‰ï¼ˆä¸­é—´å¤šäº†ä¸€å±‚__popto__ï¼‰

```javascript
function A() { this.x = 100 }
A.prototype.getX = function () { console.log(this.x) }

function B () {
  A.call(this)
}
B.prototype = Object.create(A.prototype) // åªæŠŠçˆ¶ç±»çš„åŸå‹ç»™å­ç±»åŸå‹ï¼ä¸æŠŠçˆ¶ç±»ç§æœ‰çš„æ”¾å­ç±»åŸå‹ä¸Šï¼
B.prototype.constructor = B

var n = new B
console.log(n.x) // -> 100
```

#### ç¬¬å…­ç§ç»§æ‰¿æ–¹æ³•ï¼šä¸­é—´ç±»ç»§æ‰¿

- ä¸­é—´ç±»ç»§æ‰¿ï¼šç›´æ¥æŠŠç›®æ ‡__proto__æŒ‡å‘æŒ‡å®šåŸå‹ã€‚ä¾‹å¦‚ï¼šç±»æ•°æ®å¯¹è±¡çš„__proto__æŒ‡å‘æ•°æ®çš„prototyprã€‚

```javascript
function avgFn () {
  arguments.__proto__ = Array.prototype
  arguments.pop()
}
```

### è¯¾æ—¶19ï¼šåŸå‹é“¾ç»¼åˆå¤ä¹ å‚è€ƒ

- instanceof

```javacript
odiv instanceof HTMLElement // -> true
odiv instanceof Element     // -> true
odiv instanceof Node        // -> true
odiv instanceof EventTarget // -> true
odiv instanceof object      // -> true
```

> instanceofåœ¨æ£€æŸ¥æ—¶ï¼Œå·¦ä¾§å®ä¾‹çš„åŸå‹é“¾ä¸Šè‹¥æŒ‡å‘å³ä¾§ç±»ï¼Œåˆ™æ€»ä¼šè¿”å›true

- åœ¨å†…ç½®ç±»çš„åŸå‹ä¸Šæ‰©å±•æ–¹æ³•

```javascript
var ary = [1,2,3,2,1,4,3]
Array.prototype.unique = function unique () { // æ•°ç»„å»é‡
  var obj = {}
  for(var i=0; i < this.length; i++) {
    var cur = this[i]
    if(obj[cur] == cur) {
      this[i] = this[this.length - 1] // å‘ç°é‡å¤é¡¹ï¼ŒæŠŠæœ«å°¾é¡¹å¤åˆ¶å»é‡å¤é¡¹ä¸Š
      this.length-- // åˆ é™¤æœ«å°¾é¡¹
      i-- // å¾ªç¯æŒ‡é’ˆå‡1ï¼Œå†é‡æ–°æ£€æŸ¥ä¸Šä¸€æ¬¡index
      continue
    }
    obj[cur] = cur
  }
  obj = null
}

console.log(ary.unique())
```

- å°è€ƒé¢˜ä¸€ä¸ªâ˜ï¸

```javascript
function Fn (num) {
  this.x = this.y = num
}
Fn.prototype = {
  x: 20,
  sum: function () {
    console.log(this.x + this.y)
  }
}
var f = new Fn(10)
console.log(f.sum === Fn.prototype.sum) // -> true, fä¸Šæ²¡æœ‰sumï¼Œåœ¨fçš„åŸå‹ä¸Šæ‰¾åˆ°ï¼Œè€Œfçš„åŸå‹æ­£å¥½æ˜¯Fnï¼Œæ•…æ˜¯true
f.sum() // -> f.x + f.y = 10+10 = 20
Fn.prototype.sum() // -> Fnçš„åŸå‹ä¸Šæ²¡æ‰¾åˆ°Fn.prototype.yï¼Œæ•…20+undefinedä¸ºNaNï¼
console.log(f.constructor) // -> æ ¹æœ¬æ²¡å®šä¹‰
```

### è¯¾æ—¶21ï¼šå‡½æ•°çš„ä¸‰ç§è§’è‰²

![prototype-chain-final](http://ofx24fene.bkt.clouddn.com//img/book/prototype-chain-final.svg)

- å‡½æ•°æœ¬èº«ä¹Ÿä¼šæœ‰ä¸€äº›è‡ªå·±çš„å±æ€§ï¼š
  - length:0   å½¢å‚ä¸ªæ•°
  - name:"Fn"  å‡½æ•°åç§°
  - prototype: ç±»çš„åŸå‹ï¼Œåœ¨åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•éƒ½æ˜¯å½“å‰Fnè¿™ä¸ªç±»å®ä¾‹çš„å…±æœ‰æ–¹æ³•
  - \__proto__: æŠŠå‡½æ•°å½“åšä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒæŒ‡å‘Functionè¿™ä¸ªç±»çš„åŸå‹
  
#### å‡½æ•°æ˜¯æ•´ä¸ªJSä¸­æœ€å¤æ‚ä¹Ÿæ˜¯æœ€é‡è¦çš„çŸ¥è¯†ç‚¹

- å‡½æ•°å­˜åœ¨å¤šé¢æ€§
  - â€œæ™®é€šå‡½æ•°â€ï¼šå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œæ‰§è¡Œæ—¶ä¼šå½¢æˆç§æœ‰ä½œç”¨åŸŸ(é—­åŒ…)->å½¢å‚èµ‹å€¼->é¢„è§£é‡Š->ä»£ç æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåæ ˆå†…å­˜é”€æ¯æˆ–ä¸é”€æ¯
  - â€ç±»â€œï¼šå®ƒæœ‰è‡ªå·±çš„å®ä¾‹ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå«åš`prototype`å±æ€§æ˜¯è‡ªå·±çš„åŸå‹ï¼Œå®ƒçš„å®ä¾‹éƒ½å¯ä»¥æ‰§è¡Œè‡ªå·±çš„åŸå‹
  - â€æ™®é€šå¯¹è±¡â€œï¼šå’Œ`var obj = {}`ä¸­çš„objä¸€æ ·ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œä»–ä½œä¸ºå¯¹è±¡å¯ä»¥æœ‰ä¸€äº›è‡ªå·±çš„ç§æœ‰å±æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`__proto__`æ‰¾åˆ°`Function.prototype`
  
#### å°ä¾‹å­ä¸€æšå……åˆ†è¯´æ˜å‡½æ•°çš„ä¸‰é¢æ€§

```javascript
var Fn = function () {
  var num = 10
  this.x = 100
}
Fn.prototype.getX = function () { console.log(this.x) }
Fn.aaa = 1000
var f = new Fn
f.num // -> undefined, å› ä¸ºåœ¨æ„é€ å‡½æ•°ä¸­å£°æ˜çš„numä»…æ˜¯ç§æœ‰ä½œç”¨åŸŸä¸­çš„ä¸€ä¸ªå˜é‡
f.aaa // -> undefined, aaaæ˜¯Fnè¿™ä¸ªå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œå®ä¾‹å–ä¸åˆ°
var res = Fn()   // ä½¿ç”¨Fnçš„å †å†…å­˜å¼€è¾Ÿä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸï¼Œé‡Œé¢æœ‰numå“¦ğŸ™ƒ
console.log(res) // å‡½æ•°æ²¡è¿”å›å€¼ï¼Œå½“ç„¶ä¹Ÿæ˜¯undefinedğŸ˜
Fn.aaa // -> 1000, è¿™æ¬¡æ‹¿åˆ°äº†Fnè¿™ä¸ªå¯¹è±¡çš„ç§æœ‰å±æ€§
```
