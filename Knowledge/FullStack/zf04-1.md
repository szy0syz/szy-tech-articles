[TOC]

## è¯¾æ—¶71ï¼šåœ¨æŒ‡å®šæ—¶é—´å†…å®ç°å•æ–¹å‘åŒ€é€Ÿè¿åŠ¨

- æ–¹æ³•ä¸€ï¼šå›ºå®šåŠ¨ç”»æ—¶é—´ä½¿ç”¨setIntervalå®ç°ã€‚å®ç°æ­¥éª¤ç®€è¿°ï¼š
  - åˆ†åˆ«è®¡ç®—å‡ºæ‰€æœ‰å˜é‡ï¼Œå¦‚æœ€å¤§ç§»åŠ¨è·ç¦»maxDistanceã€åŠ¨ç”»æŒç»­æ—¶é—´durationã€åŠ¨ç”»é—´éš”intervalã€ç›’å­ç§»åŠ¨æ­¥é•¿stepç­‰...
  - å¼€å¯å®šæ—¶å™¨
  - åˆ¤æ–­ç›’å­æ˜¯å¦è¶Šè¿‡è¾¹ç•Œï¼Œè¶Šè¿‡å°±ç›´æ¥è®©ç›’å­è¹¦åˆ°è¾¹ç•Œå®Œäº‹ï¼Œæ¸…é™¤å®šæ—¶å™¨~
  - å¦‚æœæ²¡è¶Šè¿‡è¾¹ç•Œï¼Œå°±è®©ç›’å­ç»§ç»­åŠ æ­¥é•¿å¾ªç¯


```javascript
    var box = document.getElementById('box');
    // è·å–ç›’å­æœ€å¤§ç§»åŠ¨è·ç¦»ï¼Œå…¬å¼=å½“å‰æµè§ˆå™¨ä¸€ä¸ªå±å¹•çš„å®½åº¦-æ•´ä¸ªç›’å­çš„å®½åº¦(å«è¾¹æ¡†)
    var maxDistance = (document.documentElement.clientWidth || document.body.clientWidth) - box.offsetWidth;
    var duration = 2000; // åŠ¨ç”»æŒç»­æ—¶é—´2000ms
    var interval = 10;   // åŠ¨ç”»æ¯10msæ‰§è¡Œä¸€æ¬¡
    // æ­¥é•¿çš„æ„æ€æ˜¯ æ¯ä¸€æ¬¡intervalæ—¶é—´ç›’å­è¦ç§»åŠ¨å¤šå°‘è·ç¦»
    var step = (maxDistance / duration) * 10;
    var timer = window.setInterval(function () {
        var curPos = utils.css(box, "left");
        // åˆ¤æ–­å½“å‰ä½ç½® + ç§»åŠ¨æ­¥é•¿æ˜¯å¦å¤§äºç­‰äºæœ€å¤§ç§»åŠ¨ä½ç½®
        if ((curPos + step) >= maxDistance) {
            utils.css(box, "left", maxDistance); // ç›´æ¥è¹¦åˆ°æœ€å¤§è·ç¦»å®Œäº‹äº†~
            window.clearInterval(timer); // æ¸…é™¤å®šæ—¶å™¨
            return;
        }
        utils.css(box, "left", curPos + step);
    }, interval);
```

- æ–¹æ³•äºŒï¼šå›ºå®šåŠ¨ç”»æ—¶é—´ä½¿ç”¨setIntervalå®ç°ã€‚å®ç°æ­¥éª¤ç®€è¿°ï¼š
  - è®¡ç®—ç›®æ ‡è·ç¦»targetï¼Œè·å–ç›’å­åˆå§‹ä½ç½®è·ç¦»beginï¼Œè®¡ç®—ç›®æ ‡è·ç¦»å’Œåˆå§‹è·ç¦»çš„å·®è·changeï¼Œè®¾ç½®æŒç»­æ—¶é—´durationï¼Œè®¾ç½®èµ·å§‹æ—¶é—´timeä¸º0
  - è®¾ç½®poså…¬å¼ï¼štime*duration/change+beginï¼Œå…¬å¼è®¡ç®—ç»“æœä¸ºå½“å‰ç›’å­ç§»åŠ¨åçš„ä½ç½®
  - å¼€å¯å®šæ—¶å™¨
  - å¦‚æœç›’å­ç§»åŠ¨åçš„ä½ç½®>=targetå°±ç›´æ¥è®©ç›’å­è¹¦åˆ°è¾¹ç•Œ
  - å¦‚æœä¸æ˜¯åˆ™è®¾ç½®ç›’å­leftä¸ºè®¡ç®—åå¾—åˆ°çš„poså€¼

```javascript
    var box = document.getElementById('box');
    var target = utils.win("clientWidth") - box.offsetWidth;
    var interval = 10;
    var begin = utils.css(box, "left");
    var change = target-begin;
    var duration = 2000;
    var time = 0;
    function getPos (t, b, c, d) {
        // time*duration/change+begin
        return t*d/c+b;
    };
    var timer = window.setInterval(function () {
        time += interval;
        var pos = getPos(time,begin,change,duration);
        if(pos >= target) {
            utils.css(box, "left", target);
            return;
        }
        utils.css(box, "left", pos);
    }, interval)
```

> æ„Ÿè§‰æ–¹æ³•äºŒä¸åŒ€é€Ÿ!

----------


## è¯¾æ—¶72ï¼šæŒ‡å®šæ­¥é•¿å®ç°å•æ–¹å‘åŒ€é€Ÿè¿åŠ¨

- ä¿®å¤åŠ ä¸Šæ­¥é•¿åè¶Šè¿‡è¾¹ç•Œï¼Œæ”¹å˜srrollLeftçš„é—®é¢˜ï¼š
  1. åˆ¤æ–­æ˜¯å¦è¶Šè¿‡äº†è¾¹ç•Œï¼Œè¶Šè¿‡å‡ ç›´æ¥è¹¦åˆ°è¾¹ç•Œ
  2. æ²¡æœ‰è¶Šè¿‡å°±ç»§ç»­åŠ æ­¥é•¿

----------

## è¯¾æ—¶73ï¼šä½¿ç”¨setTimeOutå®ç°è½®æ’­åŠ¨ç”»

- ä¸è§„å®šæ—¶é—´ä½¿ç”¨é€’å½’+setTimeoutçš„æ–¹å¼å®ç°åŠ¨ç”»ã€‚å®ç°æ­¥éª¤ç®€è¿°ï¼š
  1. è·å–æœ€ç»ˆç§»åŠ¨è·ç¦»targetï¼Œè®¾ç½®æ­¥é•¿step
  2. å£°æ˜moveå‡½æ•°
  3. è¿›å‡½æ•°ç¬¬ä¸€æ­¥æ¸…å®šæ—¶å™¨
  4. è·å–ç›’å­å½“å‰å®æ—¶ä½ç½®è·ç¦»
  5. åˆ¤æ–­å½“å‰ä½ç½®+æ­¥é•¿æ˜¯å¦è¶Šè¿‡è¾¹ç•Œï¼Œè¶Šè¿‡äº†å°±ç›´æ¥è¹¦åˆ°è¾¹ç•Œ
  6. å¦‚æœæ²¡æœ‰è¶Šè¿‡è¾¹ç•Œå°±åŠ ä¸Šæ­¥é•¿

```javascript
    var box = document.getElementById('box');
    var target = utils.win("clientWidth") - box.offsetWidth;
    var timer = null;
    var step = 4;
    function move () {
        window.clearTimeout(timer);
        var curPos = utils.css(box, 'left');
        if (curPos+step >= target) {
            utils.css(box,'left', target);
            return;
        }
        utils.css(box,'left', curPos+step);
        timer = window.setTimeout(move, 5)
    }
    timer = window.setTimeout(move, 5);
```

----------

## è¯¾æ—¶74ï¼šå®ç°åå¼¹åŠ¨ç”»

- åŠŸèƒ½ï¼šä¸€ä¸ªç›’å­ï¼Œåœ¨å±å¹•ä¸­é—´ï¼Œæœ‰ä¸¤ä¸ªæŒ‰é’®ï¼Œç‚¹å‘å·¦æˆ–å‘å³ï¼Œåˆ™ç›’å­å‘å·¦æˆ–è€…å‘å³èµ°ã€‚åˆ¤æ–­æ—¶è¦æ³¨æ„è¾¹ç•Œé—®é¢˜

- ä¼˜åŒ–ï¼šé¿å…å¤šçº§ä½œç”¨åŸŸåµŒå¥—ã€‚ä¸¤ä¸ªmoveåµŒå¥—ä½¿ç”¨ã€‚

```javascript
        // ç¬¬ä¸€ä¸ªç‰ˆæœ¬
        var box = document.getElementById('box');
        var timer = null;
        var target = utils.win("clientWidth") - box.offsetWidth
        function clickHandler(e) {
            e = e || window.event;
            e.target = e.target || e.srcElement;
            if (e.target.id === 'goLeft') {
                move(0, 5, box);
            } else if (e.target.id === 'goRight') {
                move(target, 5, box);
            } else {
                return null;
            }
        }
        var op = document.getElementById('op');
        op.addEventListener("click", clickHandler)
        function move(target, step, el) {
            window.clearTimeout(timer);
            var curPos = utils.css(el, 'left');
            target = target || 0;
            console.log(curPos, target);
            if (target === 0) {
                if (curPos - step <= target) {
                    utils.css(el, 'left', target);
                    return;
                }
                utils.css(box, 'left', curPos - step);
                timer = window.setTimeout(function () {
                    move(target, step, box);
                }, 5)
            } else {
                if (curPos + step >= target) {
                    utils.css(el, 'left', target);
                    return;
                }
                utils.css(box, 'left', curPos + step);
                timer = window.setTimeout(function () {
                    move(target, step, box);
                }, 5)
            }
        }
```

![zf-lesson74.png-49.9kB][1]

- ç¬¬ä¸€ä¸ªç‰ˆæœ¬ç¼ºç‚¹ï¼Œè¡¥ä¸åº•éƒ¨moveå‡½æ•°ï¼Œä¸”ä¸åœåº”ç”¨å¤–å±‚å˜é‡ï¼Œä½œç”¨åŸŸä¸åœçš„åµŒå¥—ã€‚


- ç¬¬äºŒä¸ªç‰ˆæœ¬ï¼Œä»…ä¼šäº§ç”Ÿä¸€ä¸ªmove()å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå…¶æ‰€æœ‰ç›‘å¬äº‹ä»¶å’Œå®šæ—¶å™¨çš„å›è°ƒå…¨éƒ¨ä»åŒ¿åå‡½æ•°æ›¿æ¢æˆå…·åå‡½æ•°ï¼Œè¿™æ ·å°±ä¸ä¼šäº§ç”Ÿä½œç”¨åŸŸåµŒå¥—ï¼Œè€Œæ˜¯æ‰§è¡Œä¸€æ¬¡_move()å®Œåå°±é”€æ¯ï¼

```javascript
var box = document.getElementById('box');
var timer = null;
var target = utils.win("clientWidth") - box.offsetWidth
var step = 5;
function clickHandler(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    if (e.target.id === 'goLeft') {
        // å¦‚æœæˆ‘ä»¬ç‚¹çš„æ˜¯å‘å·¦ç§»åŠ¨ï¼Œåˆ™æŠŠtargetè®¾ç½®ä¸º0
        target = 0;
        move();
    } else if (e.target.id === 'goRight') {
        // å¦‚æœæˆ‘ä»¬ç‚¹çš„æ˜¯å‘å³ç§»åŠ¨ï¼Œåˆ™æŠŠtargetè®¾ç½®ä¸ºå½“å‰æµè§ˆå™¨å±å¹•ä¸€å±å¤§å°å‡å»ç›’å­è‡ªèº«å®½åº¦
        target = utils.win("clientWidth") - box.offsetWidth
        move();
    } else {
        return null;
    }
}
var op = document.getElementById('op');
op.addEventListener("click", clickHandler);
function move() {
// å…¶å®è¿™é‡Œå¯ä»¥ä¸æ¶ˆä¼ å‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬äººå·¥è®¾ç½®äº†ï¼Œå¼•æ“å°±ä¸éœ€è¦åœ¨ä½œç”¨åŸŸé“¾ä¸Šç¿»
    _move(target, step, box);
}
// ä¸ºäº†ä¸äº§ç”Ÿä½œç”¨åŸŸåµŒå¥—ï¼Œä½¿æ ˆç©ºé—´å¼€å£å¤§ï¼åªå¼€è¾Ÿä¸€ä¸ªmove()çš„æ ˆç©ºé—´ï¼
function _move(target, step, el) {
    window.clearTimeout(timer);
    var curPos = utils.css(el, 'left');
    target = target || 0;
    if (target === 0) {
        if (curPos - step <= target) {
            utils.css(el, 'left', target);
            return;
        }
            utils.css(box, 'left', curPos - step);
            timer = window.setTimeout(function () {
                move();
            }, 5)
        } else {
        if (curPos + step >= target) {
            utils.css(el, 'left', target);
            return;
        }
        utils.css(box, 'left', curPos + step);
        timer = window.setTimeout(function () {
            move();
        }, 5)
    }
}
```

----------

## è¯¾æ—¶75ï¼šä¿è¯å½“å‰å…ƒç´ åŒä¸€æ—¶é—´æ‰§è¡Œ

- ä¸ºäº†è®©å½“å‰å…ƒç´ åœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šåªèƒ½è¿è¡Œä¸€ä¸ªåŠ¨ç”»(ä¸‹ä¸€ä¸ªåŠ¨ç”»å¼€å§‹æ—¶ï¼Œé¦–å…ˆæŠŠä¸Šä¸€ä¸ªåŠ¨ç”»çš„å®šæ—¶å™¨æ¸…é™¤æ‰)ï¼šä¿è¯å½“å‰å…ƒç´ æ‰€æœ‰åŠ¨ç”»æ¥æ”¶å®šæ—¶å™¨è¿”å›å€¼çš„é‚£ä¸ªå˜é‡éœ€è¦å…±äº« ---> è§£å†³åŠæ³•ï¼šåœ¨åŠ¨ç”»çš„å…ƒç´ ä¸Šæ·»åŠ è‡ªå®šä¹‰å±æ€§è®¾ç½®å®šæ—¶å™¨!

- æ€»ç»“åˆ°ç›®å‰ä¸ºæ­¢åŠ¨ç”»å°æŠ€å·§ï¼š
  1. å¯¹äºç§»åŠ¨ç›’å­çš„åŠ¨ç”»ï¼Œåœ¨è¾¹ç•Œåˆ¤æ–­æ˜¯éœ€åŠ æ­¥é•¿æ¥åˆ¤æ–­ï¼›
  2. å¯¹äºç”¨`setTimeout`å®ç°çš„è½®æ’­åŠ¨ç”»ï¼Œéœ€è¦åœ¨æ¯æ¬¡è¿›å…¥å®šæ—¶å™¨æ—¶æŠŠæ²¡ç”¨çš„å®šæ—¶å™¨é¦–å…ˆæ¸…é™¤ï¼›
  3. å¯¹äºåŠ¨ç”»å‡½æ•°æ¥è¯´ï¼Œåœ¨å®šæ—¶å™¨æˆ–è€…å…ƒç´ ç»‘å®šäº‹ä»¶æ—¶ä¸èƒ½ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œè€Œåº”æ‰‹å·¥åµŒå¥—ä¸€ä¸ªä½œç”¨åŸŸæŠŠåŠ¨ç”»å‡½æ•°æ”¾åœ¨ä½œç”¨åŸŸä¸­è¿è¡Œï¼Œè€Œå®šæ—¶å™¨å’Œç»‘å®šäº‹ä»¶ç”¨è¿™ä¸ªå¤–å±‚å‡½æ•°ï¼›
  4. å¦‚æœé™å®šäº†æŸä¸ªå…ƒç´ åœ¨åŒä¸€æ—¶é—´ç‚¹ä¸Šä»…æœ‰ä¸€ä¸ªåŠ¨ç”»è¿è¡Œï¼Œåˆ™å¯ä»¥å°†å®šæ—¶å™¨è®¾ç½®åœ¨æ­¤å…ƒç´ çš„è‡ªå®šä¹‰å±æ€§ä¸Šã€‚

- æ€»ç»“åˆ°ç›®å‰ä¸ºæ­¢åŠ¨ç”»å°æŠ€å·§æ ¸å¿ƒç‰ˆï¼š
  1. è¾¹ç•Œåˆ¤æ–­åŠ æ­¥é•¿ï¼›
  2. setTimeoutå…ˆæ¸…å®šæ—¶å™¨ï¼›
  3. é¿å…é€’å½’æ—¶ä½œç”¨åŸŸåµŒå¥—ï¼›
  4. å…ƒç´ åŠ¨ç”»å®šæ—¶å™¨è®¾åœ¨è¯¥å…ƒç´ ä¸Šã€‚
  
----------

## è¯¾æ—¶76ï¼šå®ç°å¤šæ–¹å‘åŒ€é€Ÿè¿åŠ¨åŠ¨ç”»

```javascript
<script type="text/javascript">
    //è®©ç›’å­åœ¨è§„å®šçš„æ—¶é—´å†…ä¸¤ä¸ªæ–¹å‘è¿åŠ¨
    var box = document.getElementById('box');
    var duration = 2000, interval = 10, time = 0, timer = null;
    // æœ€ç»ˆå·¦è¾¹ä½ç½®è·ç¦»ä¸ºå½“å‰å±å¹•æœ€å¤§å®½åº¦ å‡å» æ•´ä¸ªç›’å­çš„å®½åº¦
    var targetLeft = utils.win('clientWidth') - box.offsetWidth;
    // æœ€ç»ˆå·¦è¾¹ä½ç½®è·ç¦»ä¸ºå½“å‰å±å¹•æœ€å¤§å®½åº¦ å‡å» æ•´ä¸ªç›’å­çš„é«˜åº¦
    var targetTop = utils.win("clientHeight") - box.offsetHeight;
    var beginLeft = utils.css(box, 'left');
    var beginTop = utils.css(box, 'top');
    var changeLeft = targetLeft - beginLeft;
    var changeTop = targetTop - beginTop;
    function linear(t, b, c, d) {
        // time*duration/change+begin
        return t * d / c + b;
    }
    box.timer = window.setInterval(function () {
        time += interval;
        var curLeft = linear(time, beginLeft, changeLeft, duration);
        var curTop = linear(time, beginTop, changeLeft, duration);
        if (curLeft >= targetLeft || curTop >= targetTop) {
            utils.css(box, 'left', targetLeft);
            utils.css(box, 'top', targetTop);
            window.clearInterval(box.timer);
            return;
        }
        utils.css(box, 'left', curLeft);
        utils.css(box, 'top', curTop);
    }, interval)
</script>
```

- å®ç°æ­¥éª¤ç®€è¿°ï¼š
  1. åˆ›å»ºlinearå‡½æ•°
  2. åˆ›å»ºbeginXXX, targetXXX, time, duration, changeXXXå˜é‡ï¼ŒXXXä»£è¡¨æ–¹å‘ã€‚
  3. å¼€å¯intervalå®šæ—¶å™¨ï¼Œå¯åŠ¨åŠ¨ç”»
  4. çœ‹æ˜¯å¦åˆ°è¾¹ç•Œï¼Œåˆ°è¾¹ç•Œå°±ç›´æ¥è¹¦è¾¹ç•Œä¸Šï¼Œå¦è€…å°±ç§»åŠ¨ç§»åŠ¨

----------

## è¯¾æ—¶77ï¼šå®ç°ç®€å•ç‰ˆçš„åŒ€é€Ÿè¿åŠ¨åŠ¨ç”»åº“

- é—­åŒ…çš„ä¸¤å¤§ä½œç”¨ï¼š
  - ä¿æŠ¤ç§æœ‰å˜é‡ä¸æ”¶å¤–æ¥å¹²æ‰°ï¼Œä¾‹å¦‚å†™ä¸€äº›å…¬å…±æ–¹æ³•ç”¨é—­åŒ…åŒ…èµ·æ¥é˜²æ­¢å†²çªï¼›
  - åˆ©ç”¨é—­åŒ…ä¸é”€æ¯çš„åŸç†å­˜å‚¨ä¸€äº›éœ€è¦ä¿ç•™ä½¿ç”¨çš„å€¼ï¼Œä¾‹å¦‚åœ¨ç±»åº“ä¸­ç”¨é—­åŒ…å®ç°æƒ°æ€§æ€æƒ³ï¼Œå°†åº•ä¸‹å‡½æ•°éœ€è¦ç”¨å¾—åˆ°çš„å…¬å…±ä¸œè¥¿å­˜èµ·æ¥ï¼Œä¸éœ€è¦é‡å¤åˆ¤æ–­è¯»å–ã€‚


```javascript
// tween.js
~function () {
    //~~åœ¨å°é—­åŒ…é‡Œï¼Œåˆ«æ€•ï¼Œå¤–é¢çš„å®¶ä¼™ä¼¤å®³ä¸äº†ä½ ï¼Œæˆ‘ä¼šä¿æŠ¤ä½ ï¼Œä½ æ˜¯æˆ‘çš„å”¯ä¸€~~

    // å…¬å¼åŒ…
    var effect = {
        linear: function linearFn(t, d, c, b) {
            // change*time/duration+begin
            return c * t / d + b;
        }
    };

    // å¤šæ–¹å‘çŠ¶æ€ç§»åŠ¨å‡½æ•°
    // target: { left: 1000, top: 500, opacity: 0}
    function move(el, target, duration, interval) {
        var time = 0;
        el.timer = window.setInterval(function () {
            time += interval;
            var curPos = {}, begin = {}, change = {};
            // è®¡ç®—å‡ºbegin[xxx]å’Œchange[xxx]
            for (var key in target) {
                // è¿‡æ»¤å‡ºç§æœ‰å±æ€§
                if (target.hasOwnProperty(key)) {
                    begin[key] = utils.css(el, key);
                    change[key] = target[key] - begin[key];
                    curPos[key] = effect.linear(time, duration, change[key], begin[key]);
                }
            }
            // å¦‚æœåŠ¨ç”»æ—¶é—´å·²ç»“æŸ
            if (time >= duration) {
                // æ¸…é™¤å®šæ—¶å™¨
                window.clearInterval(el.timer);
                // targetå¯¹è±¡æ ¼å¼æ­£å¥½ç¬¦åˆcssçš„æ‰¹é‡ä¿®æ”¹styleæ ¼å¼
                utils.css(el, target);
                return;
            }
            // å¦‚æœåŠ¨ç”»æ—¶é—´è¿˜æœ‰ï¼Œå°±è®¾ç½®å¾ªç¯å½“å‰è·ç¦»ç»™å…ƒç´ ï¼Œé€ä¸€èµ‹å€¼åˆ°å…ƒç´ styleä¸Š
            for (var k in curPos) {
                if (target.hasOwnProperty(key)) {
                    utils.css(el, k, curPos[k]);
                }
            }
        }, interval)
    }

    window.moveAnimate = move;
}();
//////////////////////////////////////////////////////
<script type="text/javascript">
    var box = document.getElementById('box');
    // è®¾ç½®åŠ¨ç”»ç»“æŸæ—¶çš„ç›®æ ‡çŠ¶æ€
    var target = {
        left: utils.win('clientWidth') - box.offsetWidth,
        top: utils.win("clientHeight") - box.offsetHeight,
        opacity: 0
    }
    // è°ƒç”¨åŠ¨ç”»åº“ä¸­çš„ç§»åŠ¨åŠ¨ç”»~
    moveAnimate(box, target, 3000, 20);
</script>
```

- å®ç°æ­¥éª¤ç®€è¿°ï¼š
  1. åˆ›å»ºå•ç‹¬é—­åŒ…IIFE
  2. åˆ›å»ºå…¬å¼åŒ…å’ŒåŠ¨ç”»å‡½æ•°
  3. å‡½æ•°é‡Œï¼Œtime(å³åŠ¨ç”»æ‰§è¡Œäº†å¤šé•¿æ—¶é—´)å˜é‡èµ‹å€¼0ï¼Œåˆå§‹åŒ–curPosã€beginã€changeå¯¹è±¡
  4. å¾ªç¯targetå¯¹è±¡é‡Œçš„ç§æœ‰å±æ€§ï¼Œä¾æ¬¡è®¡ç®—å‡ºå…ƒç´ æŸæ–¹å‘/çŠ¶æ€ä¸Šçš„èµ·å§‹å€¼beginã€å·®è·å€¼changeå’Œåˆ©ç”¨å…¬å¼linearè®¡ç®—å‡ºæ­¤æ¬¡åŠ¨ç”»åçŠ¶æ€å€¼cur
  5. åˆ¤æ–­åŠ¨ç”»æ—¶é—´åˆ°äº†æ²¡ï¼Œåˆ°äº†å°±æ¸…é™¤å®šæ—¶å™¨ï¼Œå°†å…ƒç´ çš„styleè®¾ç½®ä¸ºæœ€ç»ˆæ ·å¼targetå¯¹è±¡
  6. å¦‚æœåŠ¨ç”»æ—¶é—´è¿˜æ²¡åˆ°ï¼Œå°±å¾ªç¯curå¯¹è±¡ï¼Œä¾æ¬¡èµ‹å€¼åˆ°å…ƒç´ sytleæ ·å¼

----------

## è¯¾æ—¶78ï¼šåŠ¨ç”»åº“æ”¯æŒåŠ¨ç”»å®Œæˆåå›è°ƒ

- å›è°ƒå‡½æ•°ï¼šæŠŠä¸€ä¸ªå‡½æ•°Aå½“ä½œä¸€ä¸ªå€¼ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°Bï¼Œè¿™æ ·åœ¨Bæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨ä»»ä½•ä½ç½®æ‰§è¡Œä¸€åˆ°å¤šæ¬¡Aæ–¹æ³•

```javascript
callback && callback.call(el);
```

----------

## è¯¾æ—¶79ï¼šåŠ¨ç”»åº“å®Œæ•´ç‰ˆ

```javascript
   /**
   * å…ƒç´ ç§»åŠ¨åŠ¨ç”»å‡½æ•°
   * @param el éœ€è¦è¿åŠ¨çš„å…ƒç´ 
   * @param target éœ€è¦è¿åŠ¨çš„ç»ˆç‚¹[Objecct]
   * @param duration éœ€è¦è¿åŠ¨çš„æ—¶é—´é—´éš”
   * @param interval åŠ¨ç”»æ’­æ”¾é—´éš”
   * @param effect æ•ˆæœå…¬å¼
   * @param callback å›è°ƒå‡½æ•°
   **/
  function move(el, target, duration, interval, effect, callback) {
    // ã€1.åˆ¤æ–­è¾¹ç•Œ  2.è®¾ç½®æ¯ä¸€ä¸ªç»´åº¦çš„å€¼ã€‘
    var time = 0,    // åŠ¨ç”»æ’­æ”¾è¿›åº¦æ¡çš„æ—¶é—´
      begin = {},  // å…ƒç´ èµ·å§‹å€¼å¯¹è±¡,æ ¹æ®ä¼ å…¥elå’Œtargetç¡®å®šå…¶æœ‰å¤šå°‘ä¸ªç»´åº¦
      change = {}; // å·®è·é‡å€¼å¯¹è±¡ï¼Œä¹Ÿæœ‰å¤šä¸ªç»´åº¦
    // åˆå§‹åŒ–ä¸´æ—¶æ•ˆæœå¯¹è±¡ï¼Œé»˜è®¤ä¸ºåŒ€é€Ÿç›´çº¿è¿åŠ¨
    var tmpEffect = myEffect.Linear;
    if (typeof  effect === 'number') {
      switch (effect) {
        case 1:
          tmpEffect = myEffect.Bounce.easeIn;
          break;
        case 2:
          tmpEffect = myEffect.Elastic.easeInOut;
          break;
        case 3:
          tmpEffect = myEffect.Circ.easeIn;
          break;
        case 4:
          tmpEffect = myEffect.Sine.easeInOut;
          break;
      }
    } else if (effect instanceof Array) {
      //effect æ˜¯ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸æ˜¯é•¿åº¦2ï¼Œå°±é»˜è®¤è¯¥åŠ¨ç”»å¤§ç±»çš„é»˜è®¤ç¬¬ä¸€ä¸ªï¼Œå¦‚æœæ˜¯2å°±é€ä¸€å¯¹åº”
      tmpEffect = effect.length === 2 ? myEffect[effect[0]][effect[1]] : myEffect[effect[0]];
    } else if (typeof effect === 'function') {
      // å¦‚æœå‚æ•°å°‘ä¼ ä¸€ä¸ªä¸”ç±»å‹è¿˜æ˜¯functionå°±æŠŠæœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºå›è°ƒå‡½æ•°
      callback = effect;
    } else { // å®åœ¨æ²¡æœ‰å°±ä¸¢ä¸ªnull
      callback = null;
    }
    // è®¡ç®—å‡ºbegin[xxx]å’Œchange[xxx]çš„å„ä¸ªç»´åº¦å€¼
    for (var key in target) {
      // è¿‡æ»¤å‡ºç§æœ‰å±æ€§
      if (target.hasOwnProperty(key)) {
        begin[key] = utils.css(el, key);
        change[key] = target[key] - begin[key];
      }
    }
    el.timer = window.setInterval(function () {
      time += interval;
      // å¦‚æœåŠ¨ç”»æ—¶é—´å·²ç»“æŸ
      if (time >= duration) {
        // æ¸…é™¤å®šæ—¶å™¨
        window.clearInterval(el.timer);
        // targetå¯¹è±¡æ ¼å¼æ­£å¥½ç¬¦åˆcssçš„æ‰¹é‡ä¿®æ”¹styleæ ¼å¼
        utils.css(el, target);
        // åŠ¨ç”»å®Œæˆæ—¶æ‰§è¡Œå›è°ƒå‡½æ•°
        // åˆ¤æ–­callbackæ˜¯å¦ä¸ºçœŸå°±é€»è¾‘ä¸”æ‰§è¡Œå¹¶ä¿®æ”¹thisä¸ºå½“å‰å…ƒç´ 
        callback && typeof callback === 'function' && callback.call(el);
        return;
      }
      // å¦‚æœåŠ¨ç”»æ—¶é—´è¿˜æœ‰ï¼Œå°±è®¾ç½®å¾ªç¯å½“å‰è·ç¦»ç»™å…ƒç´ ï¼Œé€ä¸€èµ‹å€¼åˆ°å…ƒç´ styleä¸Š
      for (var key in target) {
        if (target.hasOwnProperty(key)) {
          // å—¯ï¼Œå¯¹çš„ï¼Œå°±è¿™æ ·ã€‚ä¸éœ€è¦å£°æ˜curå¯¹è±¡ï¼Œåªéœ€è¦å®šä¹‰curå€¼å³å¯ï¼ä¸”åœ¨éœ€è¦æ—¶å†å»å£°æ˜å°±è¡Œã€‚
          var cur = tmpEffect(time, begin[key], change[key], duration);
          utils.css(el, key, cur);
        }
      }
    }, interval)
  }
```

----------

## è¯¾æ—¶80ï¼šè½®æ’­å›¾å®ç°åŸºæœ¬çš„å¸ƒå±€ç»“æ„

```css
        <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-size: 14px;
            -webkit-user-select: none;
            user-select: none;
        }

        ul, li {
            list-style: none;
        }

        img {
            display: block;
            border: none;
        }

        a {
            display: block;
            color: #000;
            text-decoration: none; /*å»é™¤aæ ‡ç­¾é»˜è®¤ç‚¹å‡»ä¸‹åˆ’çº¿*/
        }

        a:hover, a:active, a:visited, a:target {
            display: block;
            color: #000000;
            text-decoration: none;
        }

        .banner {
            position: relative;
            margin: 0 auto;
            width: 990px;
            height: 400px;
            overflow: hidden;
        }

        .banner .inner {
            position: absolute;
            top: 0;
            left: 0;
            /*width: 3960px; jsè‡ªåŠ¨è®¡ç®—å®½åº¦*/
        }

        .banner .inner div {
            /*è¿™é‡Œå¦‚æœåŠ äº†absoluteçš„å®šä½çš„è¯ï¼ŒoffsetParnetéƒ½è¿˜æ˜¯innerå•Šï¼Œå¥‡æ€ª*/
            /*å¦‚æœåŠ äº†ç»å¯¹å®šä½ï¼Œåˆ™4å¼ å›¾ç‰‡å…¨éƒ¨éƒ½å›°åœ¨divè‡ªèº«å®½é«˜çš„ç›’å­é‡Œï¼Œå›¾ç‰‡é€ä¸€è¢«è¦†ç›–ï¼Œæ˜¾ç¤ºçš„æ˜¯æœ€åä¸€å¼ å›¾ç‰‡ï¼Œè¯´æ˜positionå¯ä»¥å½±å“æµ®åŠ¨*/
            /*å¦‚æœä¸åŠ ï¼Œå®šä½è¿˜æ˜¯é»˜è®¤ï¼Œæµ®åŠ¨åœ¨ä¸Šçº§ç›’å­é‡Œ*/
            /*åˆ°æ—¶å€™é€ä¸€ç»™divåŠ ä½ç½®ï¼Œæµ‹è¯•åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹,è¿˜æœ‰æ‹¿4ä¸ªç›’å­å¥—ç€æµ‹è¯•ä¸€ä¸‹*/
            /*position: absolute;*/
            float: left;
            width: 990px;
            height: 400px;
            background: url("./img/tb_default.gif") no-repeat center #e0e0e0;
        }

        .banner .inner img {
            display: none;
            width: 100%;
            height: 100%;
        }

        .bannerTip {
            position: absolute;
            bottom: 20px;
            right: 20px;
        }

        .bannerTip li {
            float: left;
            margin-left: 10px;
            margin-right: 10px;
            width: 18px;
            height: 18px;
            background: lightblue;
            border-radius: 50%;
            cursor: pointer;
            opacity: 0.7;
            filter: alpha(opacity=70);
        }

        .banner .bannerTip li.bg {
            background: lightcoral;
        }

        .bannerTip li:hover {
            background: lightcoral;
            opacity: 1;
            filter: alpha(opacity=1);
        }

        .banner a {
            position: absolute;
            display: none;
            top: 42%;
            width: 30px;
            height: 45px;
            opacity: 0.4;
            filter: alpha(opacity=40);
        }

        .banner a:hover {
            opacity: 1;
            filter: alpha(opacity=100);
        }

        .banner a.bannerLeft {
            left: 10px;
            background: url("./img/pre.png") no-repeat;
        }

        .banner a.bannerRight {
            background: url("./img/pre.png") no-repeat;
            right: 10px;
            background-position: -45px 0;
        }
    </style>
```

![lesson80-layout.png-69.7kB][2]

- å¸ƒå±€æ–‡å­—å™è¿°æ­¥éª¤ï¼š
  1. é¦–å…ˆç»™å¤–å±‚ç›’å­div.bannerè®¾ç½®`position:relative; overflow:hidden;`ç›¸å¯¹bodyå®šä½å’Œæº¢å‡ºéšè—ï¼Œè¿™æ ·èµ·å­å­™èŠ‚ç‚¹åªè¦è®¾ç½®absoluteå®šä½åå°±ä¼šè‡ªåŠ¨æ ¹æ®banneræ¥ç»å¯¹å®šä½ï¼
  2. åœ¨å›¾ç‰‡è½®æ’­çš„ä¸‰ä¸ªå…ƒç´ div.bannerã€divã€imgä¸­åªç»™div.bannerè®¾ç½®å®½é«˜ä¸ºå›¾ç‰‡å®½é«˜ï¼Œå…¶å®ƒä¸¤ä¸ªéƒ½è®¾100%å³å¯ï¼›
  3. è®¾ç½®.banner.innerçš„ä½ç½®ä¸ºç»å¯¹å®šä½ï¼Œå…¶è‡ªåŠ¨æ‰¾åˆ°ä¸Šçº§çˆ¶çº§å…ƒç´ çš„å®šä½ä¸ºrelativeåå¾—çŸ¥ï¼Œæˆ‘ä¸æ¶ˆå†å»å¤–é¢æ‰¾å‚ç…§ç‰©äº†ï¼Œæˆ‘çˆ¸å°±æ˜¯æˆ‘å‚ç…§ç‰©ã€‚innerçš„å®½åº¦å¿…é¡»æ ¹æ®å›¾ç‰‡å®é™…æ•°é‡çš„æ€»å®½åº¦è®¾ç½®ï¼Œå› ä¸ºåŠ¨ç”»æ—¶è¦ç”¨å®šæ—¶å™¨æ§åˆ¶innerçš„leftå€¼æ¥æ˜¾ç¤ºå›¾ç‰‡ï¼
  4. è®¾ç½®ç„¦ç‚¹å…ƒç´ .banner .bannerTipï¼Œä¹Ÿæ˜¯ç»å¯¹å®šä½ï¼Œè¿™æ ·å°±å¯ä»¥è®¾ç½®å®ƒè·ç¦»å³è¾¹xxåƒç´ å’Œè·ç¦»åº•è¾¹xxåƒç´ æ¥å›ºå®šä½ç½®
  5. è®¾ç½®å·¦å³æ»‘åŠ¨å—.banner aï¼Œä¹Ÿæ˜¯ç»å¯¹å®šä½ï¼›å¯ä»¥è®¾ç½®açš„ä¼ªç±»è¾¾åˆ°é¼ æ ‡åœ¨å…¶ä¸Šé¢å’Œç¦»å¼€æ—¶çš„æ ·å¼ï¼Œä¸”å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼›åœ¨è®¾ç½®ä¸¤ä¸ªaæ ‡ç­¾çš„èƒŒæ™¯å›¾
  6. åœ¨å·¦å³æ»‘å—çš„bannerLeftå’ŒbannerRightä¸Šï¼Œå› ä¸ºæ˜¯é›ªç¢§å›¾ï¼Œè¦ç”¨`background-position: -45px 0;`æ¥å®šä½

----------

## è¯¾æ—¶81~82ï¼šè½®æ’­å›¾çš„æ•°æ®ç»‘å®šã€å»¶è¿ŸåŠ è½½å’Œæ— ç¼è‡ªåŠ¨è½®æ’­

```javascript
~function () {
  // ç¬¬é›¶æ­¥ï¼šåˆå§‹åŒ–
  var banner = document.getElementById("banner");
  // var inner = banner.firstChild; // åˆæ‰å‘é‡Œï¼Œè¦ç”¨elementä¸è¦nodeï¼Œä¸ºäº†å…¼å®¹ç”¨utils
  var inner = utils.firstChild(banner);
  var ul = utils.children(banner, 'ul')[0];
  // test!!!
  // banner.firstElementChild.children[1].offsetParent,
  // test!!!
  // ç¬¬ä¸€æ­¥ï¼šè¿œç¨‹è·å–æ•°æ®
  var data = null,
    count = 0; // è½®æ’­å›¾ç‰‡çš„æ•°é‡ï¼šajaxè¯·æ±‚å›æ¥çš„æ•°é‡+1(å®ç°æ— ç¼å›¾ç‰‡è¡”æ¥)
  // é‡å¤è®°å¿†ä¸€éxhré…ç½®å§ï¼šå…ˆå®ä¾‹ä¸€ä¸ªxhrå¯¹è±¡
  var xhr = new XMLHttpRequest;
  // é…ç½®xhrçš„openå±æ€§
  xhr.open("get", "./json/data.json", true);
  // å…¼å¬onreadystatechangeäº‹ä»¶
  xhr.onreadystatechange = function handlerXHR() {
    if (xhr.readyState === 4 && /^2\d\d$/.test(xhr.status)) {
      data = utils.jsonParse(xhr.responseText);
      bind(data);
      count = data.length + 1;
      setImgBoxWidth(inner, 990, count); // ä¸ºäº†å®ç°å›¾ç‰‡æ— ç¼è¡”æ¥ï¼ŒæŠŠç¬¬0å¼ é‡å¤çš„æ’åˆ—çš„æœ«å°¾ï¼Œæ‰€ä»¥æ˜¯length+1
      // æ„Ÿè§‰è¿™ä¸ªå»¶è¿ŸåŠ è½½å¥½å›¾ï¼Œè€Œä¸”è¿˜åªå»¶è¿Ÿæ˜¾ç¤ºä¸€å¼ ï¼
      window.setTimeout(function () {
        imgDelyLoad(inner);
      }, 300);

    }
  };
  // å‘é€è¯·æ±‚
  xhr.send(null);

  // ç¬¬äºŒæ­¥ï¼šæ•°æ®ç»‘å®š, æ•´æˆä¸ªå‡½æ•°æŠŠï¼Œå¼‚æ­¥å°±è¿™æ ·ï¼Œä½ çš„æ»¡è¶³å®ƒ~
  function bind(data) {
    var sbImgs = '', // æˆ‘è¿˜æ˜¯æ€€å¿µC#ä¸­StringBuildç±»
      sbLis = '';
    for (var i = 0, len = data.length; i < len; i++) {
      sbImgs += '<div><img src="" rsrc="' + data[i]["img"] + '" alt="' + data[i]["desc"] + '" imgIndex="' + i + '"></div>';
      i === 0 ? sbLis += '<li class="bg"></li>' : sbLis += '<li></li>'; // ä¸ºç¬¬ä¸€ä¸ªliåŠ ä¸Šé€‰ä¸­æ ·å¼
    }
    // ä¸ºäº†å®ç°æ— ç¼è½®æ’­å›¾ï¼Œå¾—å†æŠŠç¬¬ä¸€å¼ å›¾å¤åˆ¶ä¸€ä»½æ’åˆ—åœ¨æœ«å°¾
    sbImgs += '<div><img src="" rsrc="' + data[0]["img"] + '" alt="' + data[0]["desc"] + '" imgIndex="' + 0 + '"></div>';
    inner.innerHTML = sbImgs;
    ul.innerHTML = sbLis;
  }

  // ç¬¬ä¸‰æ­¥ï¼šè®¾ç½®å›¾ç‰‡è½®æ’­ç›’å­çš„å®½åº¦ï¼šlength+1
  function setImgBoxWidth(container, imgw, count) {
    utils.css(container, 'width', imgw * count);
  }

  // ç¬¬å››æ­¥ï¼šå®ç°å»¶è¿ŸåŠ è½½
  // ä¸ºäº†å»¶è¿ŸåŠ è½½ï¼Œå…ˆæŠŠåŸimgçš„srcæ”¹åˆ°rsrcè‡ªå®šä¹‰å±æ€§ä¸­å†éšè—imgï¼Œç„¶åå†è®¾ç½®imgç›’å­divä¸€ä¸ªé»˜è®¤èƒŒæ™¯å ä½å›¾
  // è¿™é‡Œå»¶è¿ŸåŠ è½½çš„åªæ˜¯é»˜è®¤å ä½å›¾æ›¿æ¢åˆ°çœŸå®å›¾ç‰‡æ—¶çš„å»¶è¿ŸåŠ è½½
  function imgDelyLoad(container) {
    container = container || inner || null;
    var timg = null;
    for (var i = 0, len = count; i < len; i++) {
      var curImg = container.getElementsByTagName('img')[i];
      if (i === 0) { // ä¹Ÿå°±ç»™ç¬¬ä¸€å¼ æ•´ä¸ªå»¶è¿ŸåŠ è½½é€æ¸æ˜¾ç¤ºçš„æ•ˆæœ~
        // æˆ‘å‘ç°ç°åœ¨ä¸éœ€è¦é—­åŒ…ç»™å¼‚æ­¥å‡½æ•°å­˜å€¼äº†ï¼ï¼ï¼
        timg = new Image;
        timg.src = container.getElementsByTagName('img')[0].getAttribute('rsrc');
        timg.onload = function validImg() {
          // DOMå…„ï¼Œä½ çš„getElementsByTagNameæ–¹æ³•æ¯æ¬¡æ‰§è¡Œåè¿”å›çš„ç±»æ•°æ®é¡ºåºå˜äº†åŠ³èµ„å°±å®Œè›‹äº†å“ˆï¼Œä½ çœ‹ç€åŠï¼Œä¸èƒ½å˜~
          container.getElementsByTagName('img')[0].src = container.getElementsByTagName('img')[0].getAttribute('rsrc');
          utils.css(container.getElementsByTagName('img')[0], 'opacity', 0); //å¼‚æ­¥åˆå§‹åŒ–é€æ˜åº¦0
          container.getElementsByTagName('img')[0].style.display = 'block'; //å¯¹ï¼Œä½ æ˜¾ç¤ºäº†ï¼Œä½†åŠ³èµ„ç»™ä½ è®¾ç½®é€æ˜åº¦0ï¼Œä½ å°å­è¿˜æ˜¯ä¸æ˜¾ç¤ºï¼Œå“ˆå“ˆã€‚
          //å®Œå…¨åœ¨ç‚«æŠ€ï¼Œæ²¡æœ‰å®é™…ä»·å€¼ï¼Œè¿™è€å¸ˆæ‚æ•™çš„å•Šï¼é ~
          moveAnimate(container.getElementsByTagName('img')[0], {opacity: 1}, 1000, 10, autoPlayImg); //æ‰§è¡Œè½®æ’­å›è°ƒ
        }
        //// è¿™é—­åŒ…ç”¨çš„å¾ˆæ·«è¡ï¼Œä½†æœ‰ç‚¹æµªè´¹å†…å­˜ï¼Œåæ­£ä¹Ÿå°±å‡ å¼ å›¾ç‰‡è€Œå·²ã€‚
        //// è¿™é‡Œé—­åŒ…å¯ä»¥æŠŠå¤–é¢çš„å˜é‡içš„åœ°å€å…ˆå­˜åœ¨é—­åŒ…é‡Œï¼Œä¸é”€æ¯ï¼Œç­‰å¾…onloadå‡½æ•°æ‰§è¡Œæ—¶å»å¤–å±‚é—­åŒ…æ‰¾iå˜é‡åœ°å€çš„å€¼ï¼
        //~function (i) {
        //  timg = new Image;
        //  timg.src = curImg.getAttribute('rsrc');
        //  timg.onload = function validImg() {
        //    // DOMå…„ï¼Œä½ çš„getElementsByTagNameæ–¹æ³•æ¯æ¬¡æ‰§è¡Œåè¿”å›çš„ç±»æ•°æ®é¡ºåºå˜äº†åŠ³èµ„å°±å®Œè›‹äº†å“ˆï¼Œä½ çœ‹ç€åŠï¼Œä¸èƒ½å˜~
        //    curImg.src = curImg.getAttribute('rsrc');
        //    utils.css(curImg,'opacity',0); //å¼‚æ­¥åˆå§‹åŒ–é€æ˜åº¦0
        //    curImg.style.display = 'block'; //å¯¹ï¼Œä½ æ˜¾ç¤ºäº†ï¼Œä½†åŠ³èµ„ç»™ä½ è®¾ç½®é€æ˜åº¦0ï¼Œä½ å°å­è¿˜æ˜¯ä¸æ˜¾ç¤ºï¼Œå“ˆå“ˆã€‚
        //    moveAnimate(curImg, {opacity: 1}, 1600, 10); //å®Œå…¨åœ¨ç‚«æŠ€ï¼Œæ²¡æœ‰å®é™…ä»·å€¼ï¼Œè¿™è€å¸ˆæ‚äº¤çš„å•Šï¼é ~
        //  }
        //}(i);
      } else { // é™¤äº†ç¬¬ä¸€å¼ ä»¥å¤–ï¼Œç›´æ¥ç»™urlï¼Œç›´æ¥æ˜¾ç¤ºï¼ŒåŠ¨ç”»ä¸åŠ äº†ï¼Œæœ‰æ²¡å¥æŸ„åœ¨ç›‘æµ‹å•Šï¼
        curImg.src = curImg.getAttribute('rsrc');
        curImg.style.display = 'block';
      }
    }
  }

  // ç¬¬äº”æ­¥ï¼šå®ç°è½®æ’­åŠ¨ç”»ï¼Œå“¥çªç„¶å‘ç°ä¸ªä¸šåŠ¡ï¼Œè®ºå›çš„åŸºç¡€å¾—å›¾ç‰‡å¼‚æ­¥åŠ è½½æ‡’åŠ è½½å®Œå§~~~
  //        ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå®šæ—¶å™¨çš„å¼€å§‹æ—¶é—´æœ€å¥½æ˜¯æ‡’åŠ è½½å®Œï¼Œä¹Ÿå°±æ˜¯è¯´æŠŠè¿™ä¸ªæ”¾åœ¨ç¬¬ä¸€å¼ å›¾ç‰‡æ•´çš„åŠ è½½å®Œçš„åŠ¨ç”»å›è°ƒå‡½æ•°é‡Œå§
  //        ç®—äº†ï¼Œè¿˜æ˜¯ç”¨ä¸€ä¸‹ç§æœ‰ä½œç”¨åŸŸä¸‹çš„å…¬å…±å˜é‡å§ï¼ï¼Œåæ­£æ˜¯ç§æœ‰ä½œç”¨åŸŸä¸‹çš„ï¼Œæ€•å•¥ï¼
  var imgIndex = 0;

  function autoPlayImg() {
    // é¦–å…ˆè®°å¾—æŠŠå®šæ—¶å™¨æ”¾åœ¨è½®æ’­å®¹å™¨çš„è‡ªå®šä¹‰å±æ€§ä¸Šï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨innerç›’å­çš„è‡ªå®šä¹‰å±æ€§ä¸Šå§ï¼
    // è¿™ä¸ªæ— ç¼å›¾ç‰‡è½®æ’­åº”ç”¨åˆ°äº†æ¬ºéª—çœ¼ç›çš„æŠ€æœ¯
    inner.autoPlayTimer = window.setInterval(function () {
      // imgIndex++;  // å¦‚æœå›¾ç‰‡ç´¢å¼•æ”¾å¼€å¤´ä¼šæœ‰é—®é¢˜ï¼æˆ‘å¾—æ‰¾æ‰¾çœ‹ï¼
      if (imgIndex >= count - 1) {
        imgIndex = 0;
        utils.css(inner, 'left', 0);
      }
      imgIndex++;
      moveAnimate(inner, {left: (-imgIndex * 990)}, 1000, 5);
    }, 2000);
  }
}();
```

> æ²¡åšå®Œçš„äº‹æƒ…

- [ ] å®šä½ä¸‰ä¾ å®¢ï¼šabsoluteã€relativeã€fixedï¼Œè¿˜æ²¡é¢†æ‚Ÿï¼Œè¦è‡ªæˆ‘é¢†æ‚Ÿæ‰è¡Œï¼
- [ ] ææ¸…æ¥šåŒ€é€Ÿç›´çº¿è¿åŠ¨çš„åŸç†linearï¼
- [x] åœ¨è½®æ’­autoPlayImg()åŠ¨ç”»ä¸­ï¼Œä¸ºä»€ä¹ˆimgIndexåŠ å‡é¡ºåºé‚£ä¹ˆé‡è¦ï¼Œè¦ææ‡‚ï¼

```javascript
/// imgIndex++
// å¦‚æœæŠŠè½®æ’­å›¾ç´¢å¼•æ”¾åœ¨åˆ¤æ–­å½“å‰ç´¢å¼•æ˜¯å¦è¶…è¿‡æ‰€æœ‰å›¾ç‰‡æ•°ğŸ’°ï¼Œåˆ™ä¼šæŠŠæœ¬è¯¥æ˜¾ç¤ºæœ€åä¸€å¼ å›¾æ—¶çš„ç´¢å¼•ç»™è·³è¿‡æ˜¾ç¤ºåˆ°ç¬¬ä¸€å¼ ä¸Šå»ã€‚
// ç®€å•æ¥è¯´å°±æ˜¯ä¼šå°‘æ˜¾ç¤ºä¸€å¼ å›¾ç‰‡ï¼
if (imgIndex >= count - 1) {
    imgIndex = 0;
    utils.css(inner, 'left', 0);
}
imgIndex++;
moveAnimate(inner, {left: (-imgIndex * 990)}, 800, 10, changeTip);
```

----------

## è¯¾æ—¶83ï¼šå®ç°ç„¦ç‚¹è½®æ’­

- å®ç°ç„¦ç‚¹å¯¹é½

```javascript
  // ç¬¬å…­æ­¥ï¼šå®ç°ç„¦ç‚¹å¯¹é½
  // åŸç†ï¼šä¹Ÿå°±æ˜¯ç®€å•æ”¹å˜ä¸€ä¸‹liçš„é€‰ä¸­æ ·å¼çš„åºå·ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ0ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ0ï¼Œ1......
  // åŸç†ï¼šè½®æ’­å›¾ç´¢å¼•å®šä½liçš„é€‰ä¸­æ ·å¼ï¼Œå¦‚æœè½®æ’­ç´¢å¼•å·²ç»å¤§äºliæ•°ç»„å¯é€‰ä¸­åºæ•°çš„æ ·å¼åˆ™ç½®0ï¼Œå¦åˆ™å°±æŒ‰è½®æ’­å›¾ç´¢å¼•è®¾ç½®lié€‰ä¸­æ ·å¼
  function changeTip() {
    var tempIndex = imgIndex > lis.length - 1 ? 0 : imgIndex;
    for (var i = 0, len = lis.length; i < len; i++) {
      var cur = lis[i];
      i === tempIndex ? cur.className = "bg" : cur.className = "";
    }
  }
```

- åœæ­¢å’Œå¼€å¯è‡ªåŠ¨è½®æ’­

```javascript
  // ç¬¬ä¸ƒæ­¥ï¼šåœæ­¢å’Œå¼€å¯è‡ªåŠ¨è½®æ’­
  banner.onmouseover = function stopAutoPlay() {
    window.clearInterval(autoTimer);
    bleft.style.display = "block";
    bright.style.display = "block";
  };
  banner.onmouseout = function startAutoPlay() {
    autoTimer = window.setInterval(autoPlayImg, 3000);
    bleft.style.display = "none";
    bright.style.display = "none";
  };
```

- å•å‡»ç„¦ç‚¹å®ç°è½®æ’­å›¾çš„åˆ‡æ¢

```javascript
  // ç¬¬å…«æ­¥ï¼šå•å‡»ç„¦ç‚¹å®ç°è½®æ’­å›¾çš„åˆ‡æ¢
  ul.onclick = function handlerLiClick(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    if (e.target.nodeName === "LI") {
      // è®¾ç½®å›¾ç‰‡è½®æ’­ç´¢å¼•ä¸ºæ‰€ç‚¹å‡»liå¯¹åº”çš„é‚£å¼ 
      imgIndex = utils.index(e.target);
      changeTip(); // æ”¹å˜lié€‰ä¸­æ ·å¼åˆ°å¯¹åº”çš„åºå·ä¸Š
      moveAnimate(inner, {left: -imgIndex * 990}, 400, 10);
    }
  };
```

----------

## è¯¾æ—¶84ï¼šå®ç°å·¦å³åˆ‡æ¢

- å®ç°å·¦å³åˆ‡æ¢è½®æ’­å›¾

```javascript
  // ç¬¬ä¹æ­¥ï¼šå®ç°å·¦å³è½®æ’­å›¾
  // å‘å³æ»‘åŠ¨å…¶å®å°±æ˜¯å¯åŠ¨ä¸€æ¬¡åŠ¨ç”»
  bright.onclick = autoPlayImg;
  bleft.onclick = function () {
    if (imgIndex <= 0) { // å¦‚æœæ˜¯ç¬¬ä¸€å¼ 
      imgIndex = count - 1; // ç­‰äºèµ‹å€¼åŒ…å«å¤šäº†ä¸€å¼ è½®æ’­å›¾çš„æ•°é‡-1ï¼Œä¹Ÿå°±æ˜¯å®é™…æœ€åä¸€å¼ å›¾
      utils.css(inner, 'left', -imgIndex * 990);
    }
    imgIndex--; // æ§åˆ¶è½®æ’­ç´¢å¼•å‡ä¸€
    moveAnimate(inner, {left: -imgIndex * 990}, 800, 10);
    changeTip();
  }
```

> æ²¡åšå®Œçš„äº‹æƒ…

- [x] ç›‘å¬é¡µé¢æ˜¯å¦æ­£è¢«æ‰“å¼€ï¼Œå¦å°±åœåŠ¨ç”»ï¼

```javascript
  // è®¾ç½®documentçš„ç›‘å¬äº‹ä»¶visibilityChangeEvent
  var hiddenProperty = 'hidden' in document ? 'hidden' : 'webkitHidden' in document ? 'webkitHidden' : 'mozHidden' in document ? 'mozHidden' : null;
  // è®¾ç½®ç›‘å¬å¥æŸ„åç§°
  var visibilityChangeEvent = hiddenProperty.replace(/hidden/i, 'visibilitychange');
  var onVisibilityChange = function () {
    if (!document[hiddenProperty]) {
      autoTimer = window.setInterval(autoPlayImg, 3000);
    } else {
      window.clearInterval(autoTimer);
    }
  };
  document.addEventListener(visibilityChangeEvent, onVisibilityChange);
```

----------

## è¯¾æ—¶85ï¼šcssæ–¹æ³•çš„bugä¿®å¤

```javascript
// åœ¨åˆ¤æ–­æŸä¸ªå‚æ•°å–å€¼åæ˜¯å¦ä¸ºçœŸæˆ–å‡ï¼Œä¸èƒ½ç›´æ¥`!val`ï¼Œè¿™æ ·å¦‚æœä¼ 0ï¼Œå°±æˆçœŸå€¼äº†
if (!val) { ... } // x
if (typeof val === 'undefined') { ... } // ok
```

----------

## æ€»ç»“ï¼šå·¦å³ç‰ˆè½®æ’­å›¾æ€»ç»“

**ã€åŠ¨ç”»åº“æƒŠå¤©bugä¸€æšè°ƒè¯•è®°ã€‘---- 2017å¹´6æœˆ22æ—¥15æ—¶ï¼Œå‘ç°æƒŠå¤©åŠ¨ç”»bugä¸€æšã€‚**

    - æè¿°ï¼š
    1.è‹¥å½“å‰æµè§ˆå™¨æ ‡ç­¾é¡µdocumentå¤±å»ç„¦ç‚¹ï¼Œå›¾ç‰‡è½®æ’­é€Ÿåº¦è¶…çº§å¿«ï¼Œè¡¨ç¤ºçœ‹è§é—ªç”µä¾ âš¡ï¸äº†ï¼›
    2.å›¾ç‰‡å·¦å³ä¸¤ä¾§çš„åˆ‡æ¢é”®ï¼Œåªè¦æŒ‰å¿«äº†2+æ¬¡ï¼Œå›¾ç‰‡å¡ä½ï¼Œç»æŸ¥div.innerçš„lefté”æ­»ï¼›
    3.åº•ä¸‹é”šç‚¹å°åœ†ç‚¹ç‚¹å¿«äº†(ä¸€å¼ å›¾ç‰‡æ²¡è¿åŠ¨è¯ç‚¹å¦ä¸€ä¸ªåŠ¨ç”»)ä¹Ÿä¼šå¡æ­»ï¼
    - è°ƒè¯•ï¼š
    1.å…ˆè°ƒè¯•banner.jsï¼Œå‘ç°autoPlayå‡½æ•°å€¼è¦å°ä¸€ç‚¹ä¼šå¥½ç‚¹ã€‚ç„¶åè°ƒç»‘å®šäº‹ä»¶ï¼Œå‘ç°åœ¨ç»™<li>å…ƒç´ ç»‘å®šclickå‡½æ•°æ—¶ï¼Œç«Ÿç„¶æ˜¯ç©ºçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡ç»‘å®šä¸Šå»ï¼Œlisæ•°ç»„ç«Ÿç„¶æ˜¯ç©ºçš„ï¼è°ƒè¯•åå‘ç°åŸæ¥ajaxæ˜¯å¼‚æ­¥çš„æ•°æ®ç»‘å®šå‘ç”Ÿåœ¨getElementsByTagNameä¹‹åï¼Œé‚£å½“ç„¶æ˜¯ç©ºæ•°ç»„ä¸€ä¸ªï¼ç»“æœé”šç‚¹clickäº‹ä»¶ç»‘å®šåœ¨çˆ¶çº§å…ƒç´ ulä¸Šï¼Œè¿™ä¸ªå…ƒç´ å¤©ç”Ÿå°±åœ¨ï¼
    2.åˆè°ƒè¯•utils.jsåŸºæœ¬ç±»åº“ï¼Œè¡¨ç¤ºæ‰¾ä¸åˆ°é”™è¯¯ï¼›
    3.æœ€åè°ƒè¯•tween.jsåŠ¨ç”»ç±»åº“ã€‚å›å¿†bugç—‡çŠ¶ï¼šåŠ¨ç”»æ²¡æ‰§è¡Œå®Œæ¯•å†æ‰§è¡ŒåŒå‡½æ•°çš„å¦ä¸€ä¸ªåŠ¨ç”»å°±å¡æ­»ï¼Œå¯ä»¥çœ‹å‡ºåº”è¯¥æ˜¯ï¼ŒåŒä¸€ä¸ªå…ƒç´ åªèƒ½åŒæ—¶æ‰§è¡Œä¸€ä¸ªç›¸åŒçš„åŠ¨ç”»å‡½æ•°ã€‚å†è€…å°±æ˜¯å¦‚æœåœ¨åŠ¨ç”»åº“ä¸­å¼€å¯ä¸€ä¸ªsetInervalæ—¶å¿…é¡»ä¿è¯å‰ä¸€ä¸ªå®šæ—¶å™¨å·²ç»æ¸…é™¤ï¼Œç‰¹åˆ«æ˜¯setInervalçš„ï¼æœ€ååœ¨moveå‡½æ•°ä¸­è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨å‰å…ˆæŠŠä¸Šä¸€ä¸ªæ¸…é™¤ï¼

> å…³äºåŠ¨ç”»åº“æ—¶ä¸€å®šæ³¨æ„ï¼ŒåŒåŠ¨ç”»å‡½æ•°åœ¨åŒå…ƒç´ ä¸Šå¿…é¡»ä¿è¯åªè¿è¡Œä¸€ä¸ªï¼Œä¸”è¿˜éœ€æ³¨æ„æ¸…ç†åŠ¨ç”»ã€‚ä¾‹å¦‚ä¸Šä¸€ä¸ªåŠ¨ç”»æ‰§è¡Œåˆ°ä¸€åŠï¼ŒåŒåŠ¨ç”»å‡½æ•°çš„åŠ¨ç”»åˆè¦æ‰§è¡Œæ—¶ï¼Œå¿…é¡»æ¸…ä¸Šä¸€ä¸ªåŠ¨ç”»ï¼
    
![zf_lesson82.png-93.5kB][3]

    æ— ç¼è½®æ’­å›¾åŸç†ï¼šæœ«å°¾æ¥ç¬¬ä¸€å¼ å›¾ï¼Œå…ˆæŒ‰åºå·è½®æ’­å›¾ç‰‡å¸¦åä¸€å¼ å›¾(å®é™…ç¬¬ä¸€å¼ å›¾)ï¼Œè®©äººçš„è‚‰çœ¼ä¸€ç›´ä»¥ä¸ºæ˜¯å‘å·¦æ»‘åŠ¨ï¼Œå½“æ»‘åˆ°åŸç†å›¾ç¬¬5æ­¥æ—¶ï¼Œç«‹å³è®¾ç½®å®šä½åˆ°ç¬¬ä¸€å¼ å›¾å¾—ä½ç½®(ä¸åŠ åŠ¨ç”»ç«‹å³è·³è·ƒ)ï¼Œè¿™æ ·å½“è®¾ç½®

----------

## è¯¾æ—¶86ï¼šå®ç°åŸºæœ¬å¸ƒå±€å’Œåˆ†æ

-  ç¬¬ä¸€å¤§æ­¥ï¼šå†™DOMéª¨æ¶

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson86</title>
    <style type="text/css">

    </style>
</head>
<body>
<div class="banner" id="banner">
    <div class="inner" id="inner">
        <div><img src="./img/banner1.jpg" alt="1"></div>
        <div><img src="./img/banner2.jpg" alt="2"></div>
        <div><img src="./img/banner3.jpg" alt="3"></div>
        <div><img src="./img/banner4.jpg" alt="4"></div>
    </div>
    <ul class="bannerTip" id="bannerTip">
        <li class="bg"></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>
    <a class="bannerLeft" href="javascript:;"></a>
    <a class="bannerRight" href="javascript:;"></a>
</div>
</body>
</html>
```

- ç¬¬äºŒå¤§æ­¥ï¼šå†™CSSæ ·å¼è¡¨

 1. æ¸…é™¤é»˜è®¤æ ·å¼
 2. è®¾ç½®æœ€å¤–å±‚div.bannerç›’å­çš„æ ·å¼ï¼Œç›¸å¯¹äºbodyå®šä½ä¸”è®©å­å­™ä»¬é”å®šå‚ç…§ç‰©ï¼Œè®¾ç½®å›¾ç‰‡å®é™…å®½é«˜ï¼Œè®¾ç½®æº¢å‡ºéšè—
 3. è®¾ç½®div.innerç»å¯¹å®šä½ï¼Œå®½é«˜100%ï¼ŒèƒŒæ™¯å ä½é»˜è®¤å›¾
 4. è®¾ç½®innerç›’å­é‡ŒåŒ…è£¹imgçš„divä¸ºç»å¯¹å®šä½ï¼Œè®¾ç½®topã€leftã€zIndex
 5. è®¾ç½®æ‰€æœ‰inneré‡Œçš„imgçš„displayä¸ºnone
 6. è®¾ç½®é”šç‚¹nav
 7. è®¾ç½®å·¦å³ä¸¤ä¾§silder

> è®¾ç½®è°æ¥æœ€ç»ˆæ˜¾ç¤ºå°±è®¾ç½®è°çš„positionï¼ä¸è¦è®¾ç½®å®ƒçš„çˆ¶çº§å…ƒç´ ä½ç½®åå»æ˜¾ç¤ºå­å…ƒç´ ã€‚

```css
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            /*font-family: "å¾®è½¯é›…é»‘";*/
            font-size: 14px;
            -webkit-user-select: none;
            user-select: none;
        }

        ul li {
            list-style: none;
        }

        .banner {
            position: relative;
            margin: 0 auto;
            border: none;
            height: 400px;
            width: 990px;
            /*å…³é”®çš„æ¥äº†*/
            overflow: hidden; /*å“‡å“ˆå“ˆï¼Œimgså †å åœ¨innerç›’å­é‡Œäº†*/
        }

        .banner .inner {
            border: none;
            height: 100%;
            width: 100%;
            background: url("./img/tb_default.gif") no-repeat center center #e1e1e1;
        }

        .banner .inner div {
            position: absolute;
            top: 0;
            left: 0;
            display: block;
            height: 100%;
            width: 100%;
            z-index: 0;
            opacity: 0;
            filter: alpha(opacity=0);

        }

        .banner .inner div img {
            display: none;
        }

        .banner .bannerTip {
            position: absolute;
            height: 18px;
            bottom: 20px;
            right: 20px;
            z-index: 9;
        }

        .banner .bannerTip li {
            float: left;
            height: 18px;
            margin-left: 20px;
            width: 18px;
            background: lightblue;
            cursor: pointer;
            border-radius: 50%;
        }

        .banner .bannerTip li:hover {
            background: lightcoral;
        }

        .banner .bannerTip li.bg {
            background: lightcoral;
        }

        .banner a {
            position: absolute;
            top: 50%;
            height: 45px;
            width: 30px;
            margin-top: -22.5px; /*å½“å‰å…ƒç´ é«˜çš„ä¸€åŠåŠ è´Ÿå·*/
            text-decoration: none;
            display: none;
            color: #000000;
            background: url("./img/pre.png") no-repeat center center;
            opacity: 0.2;
            filter: alpha(opacity=20);
        }

        .banner a:hover, a:active, a:visited, a:target {
            text-decoration: none;
            display: block;
            color: #000000;
        }

        .banner a:hover {
            opacity: 0.7;
            filter: alpha(opacity=70);
        }

        .banner .bannerLeft {
            z-index: 9;
            left: 0;
            background-position: 0 0;
        }

        .banner .bannerRight {
            z-index: 9;
            right: 0;
            background-position: -45px 0;
        }
    </style>
```

----------

## è¯¾æ—¶87ï¼šå®ç°æ•°æ®ç»‘å®šå’Œå›¾ç‰‡å»¶è¿ŸåŠ è½½

```javascript
~function () {
  // 0.åˆå§‹åŒ–å˜é‡
  var banner = document.getElementById('banner');
  var inner = utils.firstChild(banner);
  var ul = banner.getElementsByTagName('ul')[0];
  var lis = null; // å¼‚æ­¥æ‹¼æ¥çš„ï¼Œåˆ«æ€¥ï¼Œåé¢å†æ‹¿ï¼
  var leftNav = banner.getElementsByTagName('a')[0];
  var rightNav = banner.getElementsByTagName('a')[1];

  // 1. é…ç½®ajaxï¼Œå¼‚æ­¥è¿œç¨‹æ‹¿æ•°æ®
  var xhr = new XMLHttpRequest;
  xhr.open("get", "./json/data.json", true);
  xhr.onreadystatechange = function ajaxHandler() {
    if (xhr.readyState === 4 && /^2\d{2}$/.test(xhr.status)) {
      var data = xhr.responseText;
      if (typeof data === 'undefined') {
        console.error('ajaxè¿œç¨‹è·å–å›¾ç‰‡åŠ è½½å¯¹è±¡å¤±è´¥');
      }
      data = utils.jsonParse(data);
      // è¯¥ç»‘å®šæ•°æ®
      bind(data);
      lis = ul.getElementsByTagName('li');
      // å»¶è¿ŸåŠ è½½å›¾ç‰‡
      imgDelyLoad();
    }
  };
  xhr.send(null);

  // 2. æ•°æ®ç»‘å®š
  function bind(data) {
    var sbImgs = '', // æˆ‘è¿˜æ˜¯æ€€å¿µC#ä¸­StringBuildç±»
      sbLis = '';
    for (var i = 0, len = data.length; i < len; i++) {
      sbImgs += '<div><img src="" rsrc="' + data[i]["img"] + '" alt="' + data[i]["desc"] + '"></div>';
      i === 0 ? sbLis += '<li class="bg"></li>' : sbLis += '<li></li>'; // ä¸ºç¬¬ä¸€ä¸ªliåŠ ä¸Šé€‰ä¸­æ ·å¼
    }
    inner.innerHTML = sbImgs;
    ul.innerHTML = sbLis;
  }

  // 3. å›¾ç‰‡å»¶è¿ŸåŠ è½½(å°å¿ƒå¼‚æ­¥ï¼Œä¹Ÿæ”¾åœ¨å–å›æ•°æ®æ—¶å»¶è¿ŸåŠ è½½)
  function imgDelyLoad() {
    var tmpimg = null;
    var divs = inner.getElementsByTagName('div');
    for (var i = 0, len = utils.children(inner).length; i < len; i++) {
      if (i === 0) {
        tmpimg = new Image;
        tmpimg.src = utils.firstChild(divs[0]).getAttribute("rsrc");
        tmpimg.onload = function validImg() {
          // è¿™é‡Œå¯æ˜¯å¼‚æ­¥ç©ºé—´å“¦~~ å‘ä¸åˆ°æˆ‘çš„ï¼
          var cur = inner.getElementsByTagName('img')[0];
          cur.src = cur.getAttribute("rsrc");
          cur.style.display = 'block';
          utils.css(cur.parentNode, 'z-index', 1);
          // è¿™é‡Œè¦å¼€å§‹è®¾ç½®åŠ¨ç”»äº†ï¼Œè¦ç»Ÿä¸€æ‰è¡Œ
          moveAnimate(cur.parentNode, {opacity: 1}, 1000, 10);
        }
      } else { // è¿™é‡Œè¦ä¸è¦å»¶è¿Ÿ500mså†å»åŠ è½½å‘¢,åº”è¯¥ä»¿å°ç±³å®˜ç½‘çš„åšï¼
        utils.firstChild(divs[i]).src = utils.firstChild(divs[i]).getAttribute("rsrc");
      }
    }
  }
```

----------

## è¯¾æ—¶88ï¼šå®ç°è‡ªåŠ¨è½®æ’­å’ŒåŠ ç‚¹å¯¹é½

```javascript
// 4.å®ç°è½®æ’­
  var imgIndex = 0,
    autoTimer = null,
    interval = 4000;

  // window.setTimeout(function () {
  //   autoTimer = window.setInterval(autoPlay, interval);
  // }, 800);
  autoTimer = window.setInterval(autoPlay, interval);

  function autoPlay() {
    if (imgIndex >= (lis.length - 1)) {
      imgIndex = -1; // å› ä¸ºåé¢è¿˜è¦åŠ 1, -1+1=0, æ­£å¥½æ˜¯ç¬¬ä¸€å¼ ï¼
    }
    imgIndex++;
    // ç¡®ä¿åŠ¨ç”»æ‰§è¡Œå‰è½®æ’­æŒ‡é’ˆæŒ‡å‘å¿…é¡»åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼
    imgIndex = imgIndex < 0 ? 0 : imgIndex;
    setBanner();
  }

  //å®é™…çš„å›¾ç‰‡æ¸æ˜¾åŠ¨ç”»å‡½æ•°
  function setBanner() {
    // è®©imgIndexæ‰€æŒ‡å‘çš„divçš„zIndexä¸º1ä¸”ç¬¬ä¸€ä¸ªå­å…ƒç´ displayä¸ºblockä¸”é€æ˜åº¦åŠ¨ç”»æ•ˆæœå˜ä¸º1ï¼Œå…¶å®ƒçš„divé€æ˜åº¦å˜ä¸º0ä¸”zIndexä¸º0ä¸”ç¬¬ä¸€ä¸ªå­å…ƒç´ displayä¸ºnone
    var divs = inner.getElementsByTagName('div');
    for (var i = 0, len = divs.length; i < len; i++) {
      if (imgIndex === i) {
        utils.css(divs[i], {zIndex: 1});
        utils.children(divs[i])[0].style.display = 'block';
        //é‡ç‚¹æ¥äº†
        moveAnimate(divs[i], {opacity: 1}, 400, 10, function () {
          //æ­¤æ—¶æ‰æ˜¯é‡ç‚¹ï¼šç­‰è½®æ’­åˆ°çš„å›¾ç‰‡é€æ˜åº¦å®Œæ¯•å˜ä¸º1åæ‰æŠŠåŸæ¥é€æ˜åº¦1çš„å›¾ç‰‡è®¾ç½®ä¸º0é€æ˜åº¦
          // æˆ‘é ï¼Œimgæ²¡å¾—å…„å¼Ÿå…ƒç´ ï¼æˆ‘æ˜¯è¸©å‘ç‹ã€‚è¿™é‡Œthisæ˜¯åŒ…imgçš„é‚£ä¸ªdiv
          utils.siblings(this).forEach(function (item) {
            utils.children(item)[0].style.display = 'none';
            utils.css(item, {opacity: 0});
          })
        });
        continue;
      } //å¥½tmç¥å¥‡ï¼Œè¿™ä¸ªzindexæ”¾åŠ¨ç”»é‡Œæœ€åä¸€å¼ å¾ªç¯åˆ°ç¬¬ä¸€å¼ æ—¶æ¸æ˜¾æ•ˆæœç«Ÿç„¶æ²¡æœ‰ï¼Œå…¶ä»–æ—¶å€™æœ‰ï¼ï¼ç‰›é€¼ï¼ï¼ï¼æ— è¯­ï¼ï¼ï¼
      utils.css(divs[i], 'z-index', 0);
    }
    ///////////////////////////////////
    // 5.å®ç°ç„¦ç‚¹å¯¹é½ focusAlign
    for (var k = 0, len0 = lis.length; k < len0; k++) {
      if (k === imgIndex) {
        utils.addClass(lis[k], 'bg');
        utils.siblings(lis[k]).forEach(function (curLi) {
          utils.removeClass(curLi, 'bg');
        });
        break; // ä¸éœ€è¦å†å»å¾ªç¯äº†
      }
    }
  }

  // 6. é¼ æ ‡è¿›å…¥æ˜¾ç¤ºå·¦å³silderæŒ‰é’®
  banner.onmouseover = function (ev) {
    window.clearInterval(autoTimer);
    leftNav.style.display = "block";
    rightNav.style.display = "block";
  };
  banner.onmouseout = function (ev) {
    autoTimer = window.setInterval(autoPlay, interval);
    leftNav.style.display = "none";
    rightNav.style.display = "none";
  };
```

----------

## è¯¾æ—¶89ï¼šå®ç°ç„¦ç‚¹åˆ‡æ¢å’Œå·¦å³åˆ‡æ¢

```javascript
  // 7. å®ç°ç‚¹å‡»ç„¦ç‚¹åˆ‡æ¢
  // æ³¨æ„ï¼šè¿™é‡Œliæ˜¯å¼‚æ­¥åŠ è½½ï¼Œå“¥å“¥ä½ æ ¹æœ¬ç»‘å®šä¸ä¸Šonclickäº‹ä»¶çš„ï¼è¦ç»‘å®šå°±ç»‘ulï¼Œdoméª¨æ¶æœ¬èº«å°±æœ‰çš„å…ƒç´ ï¼
  function focusTurnHandler (ev) {
    ev = ev || window.event;  // ä¸ºäº†å…¼å®¹mozillaå’Œieæ ¸å¿ƒçš„æµè§ˆå™¨ï¼
    ev.target = ev.target || ev.srcElement;
    if(ev.target.nodeName === 'LI') {
      // è·å–æ‰€ç‚¹å‡»liåœ¨åŒè¾ˆå…ƒç´ ä¸­æ’è¡Œè€å‡ ~
      imgIndex = utils.index(ev.target) - 1; // è®¾ç½®è½®æ’­ç´¢å¼•æ—¶ä¸ºå•¥è¦å‡ä¸€å‘¢ï¼Ÿå‘çˆ¹ï¼Ÿå› ä¸ºäº†å˜›
      autoPlay();
    }
  }
  ul.addEventListener('click', focusTurnHandler);

  // 8. å®ç°silderå·¦å³åˆ‡æ¢
  rightNav.addEventListener('click',autoPlay);
  function navTurnLeft () {
    if(imgIndex === 0) {
      imgIndex = lis.length;
    }
    imgIndex--;
    setBanner();
  }
  leftNav.addEventListener('click', navTurnLeft);
```

----------

## è¯¾æ—¶90ï¼šè½®æ’­å›¾çš„æ’ä»¶åŒ–å°è£…

- è¯´å®è¯ï¼Œè‡ªå·±å°è£…ä¸€æ¬¡ç±»åº“ã€‚è¸©äº†å¥½å‡ ä¸ªå¼‚æ­¥çš„å‘ï¼

```javascript
~function () {

  // ç±»çš„æ„é€ å‡½æ•°Slider
  function Slider(e, i, u) {
    // e = element id
    // i = interval
    // u = ajax url
    this.banner = document.getElementById(e); // æˆ‘é ï¼Œå…ƒç´ è¿˜æ˜¯è‡ªå·±åœ¨ç±»åº“é‡Œapiè·å–ï¼Œè¦ä¸ç„¶å¥½è¯¡å¼‚çš„äº‹æƒ…éƒ½å‘ç”Ÿï¼
    this.inner = utils.firstChild(banner);
    this.ul = banner.getElementsByTagName('ul')[0];
    this.lis = null; // å¼‚æ­¥æ‹¼æ¥çš„ï¼Œåˆ«æ€¥ï¼Œåé¢å†æ‹¿ï¼
    this.leftNav = banner.getElementsByTagName('a')[0];
    this.rightNav = banner.getElementsByTagName('a')[1];
    this.imgIndex = 0;
    this.autoTimer = null;
    this.interval = i;
    this.dataUrl = u;
  }

  Slider.prototype = {
    constructor: Slider,
    init: init,
    bind: bind,
    imgDelyLoad:imgDelyLoad,
    getDataBind: getDataBind,
    autoPlay: autoPlay,
    setBanner:setBanner,
    showNav: showNav,
    focusAlign:focusAlign,
    turnOn:turnOn
  };

  // ç»‘å®šæ•°æ®
  function bind(data) {
    //console.dir(this);
    var sbImgs = '', // æˆ‘è¿˜æ˜¯æ€€å¿µC#ä¸­StringBuildç±»
      sbLis = '';
    for (var i = 0, len = data.length; i < len; i++) {
      sbImgs += '<div><img src="" data-src="' + data[i]["img"] + '" alt="' + data[i]["desc"] + '"></div>';
      i === 0 ? sbLis += '<li class="bg"></li>' : sbLis += '<li></li>'; // ä¸ºç¬¬ä¸€ä¸ªliåŠ ä¸Šé€‰ä¸­æ ·å¼
    }
    this.inner.innerHTML = sbImgs;
    this.ul.innerHTML = sbLis;
  }

  // å›¾ç‰‡å»¶è¿ŸåŠ è½½(å°å¿ƒå¼‚æ­¥ï¼Œä¹Ÿæ”¾åœ¨å–å›æ•°æ®æ—¶å»¶è¿ŸåŠ è½½)
  function imgDelyLoad() {
    var self = this;
    var tmpimg = null;
    var divs = this.inner.getElementsByTagName('div');
    for (var i = 0, len = utils.children(this.inner).length; i < len; i++) {
      if (i === 0) {
        tmpimg = new Image;
        tmpimg.src = utils.firstChild(divs[0]).getAttribute("data-src");
        tmpimg.onload = function validImg() {
          // è¿™é‡Œå¯æ˜¯å¼‚æ­¥ç©ºé—´å“¦~~ å‘ä¸åˆ°æˆ‘çš„ï¼
          var cur = self.inner.getElementsByTagName('img')[0];
          cur.src = cur.getAttribute("data-src");
          cur.style.display = 'block';
          utils.css(cur.parentNode, 'z-index', 1);
          // è¿™é‡Œè¦å¼€å§‹è®¾ç½®åŠ¨ç”»äº†ï¼Œè¦ç»Ÿä¸€æ‰è¡Œ
          moveAnimate(cur.parentNode, {opacity: 1}, 1000, 10);
        }
      } else { // è¿™é‡Œè¦ä¸è¦å»¶è¿Ÿ500mså†å»åŠ è½½å‘¢,åº”è¯¥ä»¿å°ç±³å®˜ç½‘çš„åšï¼
        utils.firstChild(divs[i]).src = utils.firstChild(divs[i]).getAttribute("data-src");
      }
    }
  }

  // è·å–æ•°æ®å¹¶ç»‘å®šæ•°æ®
  function getDataBind () {
    var self = this;
    var xhr = new XMLHttpRequest;
    xhr.open("get", this.dataUrl, true);
    xhr.onreadystatechange = function ajaxHandler() {
      if (xhr.readyState === 4 && /^2\d{2}$/.test(xhr.status)) {
        var data = xhr.responseText;
        if (typeof data === 'undefined') {
          console.error('ajaxè¿œç¨‹è·å–å›¾ç‰‡åŠ è½½å¯¹è±¡å¤±è´¥');
        }
        data = utils.jsonParse(data);
        self.bind(data);// è¯¥ç»‘å®šæ•°æ®
        self.lis = self.ul.getElementsByTagName('li');
        // å»¶è¿ŸåŠ è½½å›¾ç‰‡
        self.imgDelyLoad();
      }
    };
    xhr.send(null);
  }

  // 4.å®ç°è½®æ’­
  function autoPlay() {
    console.dir(this);
    if (this.imgIndex >= (this.lis.length - 1)) {
      this.imgIndex = -1; // å› ä¸ºåé¢è¿˜è¦åŠ 1, -1+1=0, æ­£å¥½æ˜¯ç¬¬ä¸€å¼ ï¼
    }
    this.imgIndex++;
    // ç¡®ä¿åŠ¨ç”»æ‰§è¡Œå‰è½®æ’­æŒ‡é’ˆæŒ‡å‘å¿…é¡»åœ¨æœ‰æ•ˆèŒƒå›´å†…ï¼
    this.imgIndex = this.imgIndex < 0 ? 0 : this.imgIndex;
    this.setBanner();
  }

  //å®é™…çš„å›¾ç‰‡æ¸æ˜¾åŠ¨ç”»å‡½æ•°
  function setBanner() {
    // è®©imgIndexæ‰€æŒ‡å‘çš„divçš„zIndexä¸º1ä¸”ç¬¬ä¸€ä¸ªå­å…ƒç´ displayä¸ºblockä¸”é€æ˜åº¦åŠ¨ç”»æ•ˆæœå˜ä¸º1ï¼Œå…¶å®ƒçš„divé€æ˜åº¦å˜ä¸º0ä¸”zIndexä¸º0ä¸”ç¬¬ä¸€ä¸ªå­å…ƒç´ displayä¸ºnone
    var divs = this.inner.getElementsByTagName('div');
    for (var i = 0, len = divs.length; i < len; i++) {
      if (this.imgIndex === i) {
        utils.css(divs[i], {zIndex: 1});
        utils.children(divs[i])[0].style.display = 'block';
        //é‡ç‚¹æ¥äº†
        moveAnimate(divs[i], {opacity: 1}, 400, 10, function () {
          //æ­¤æ—¶æ‰æ˜¯é‡ç‚¹ï¼šç­‰è½®æ’­åˆ°çš„å›¾ç‰‡é€æ˜åº¦å®Œæ¯•å˜ä¸º1åæ‰æŠŠåŸæ¥é€æ˜åº¦1çš„å›¾ç‰‡è®¾ç½®ä¸º0é€æ˜åº¦
          // æˆ‘é ï¼Œimgæ²¡å¾—å…„å¼Ÿå…ƒç´ ï¼æˆ‘æ˜¯è¸©å‘ç‹ã€‚è¿™é‡Œthisæ˜¯åŒ…imgçš„é‚£ä¸ªdiv
          utils.siblings(this).forEach(function (item) {
            utils.children(item)[0].style.display = 'none';
            utils.css(item, {opacity: 0});
          })
        });
        continue;
      } //å¥½tmç¥å¥‡ï¼Œè¿™ä¸ªzindexæ”¾åŠ¨ç”»é‡Œæœ€åä¸€å¼ å¾ªç¯åˆ°ç¬¬ä¸€å¼ æ—¶æ¸æ˜¾æ•ˆæœç«Ÿç„¶æ²¡æœ‰ï¼Œå…¶ä»–æ—¶å€™æœ‰ï¼ï¼ç‰›é€¼ï¼ï¼ï¼æ— è¯­ï¼ï¼ï¼
      utils.css(divs[i], 'z-index', 0);
    }
    ///////////////////////////////////
    // 5.å®ç°ç„¦ç‚¹å¯¹é½ focusAlign
    for (var k = 0, len0 = this.lis.length; k < len0; k++) {
      if (k === this.imgIndex) {
        utils.addClass(this.lis[k], 'bg');
        utils.siblings(this.lis[k]).forEach(function (curLi) {
          utils.removeClass(curLi, 'bg');
        });
        break; // ä¸éœ€è¦å†å»å¾ªç¯äº†
      }
    }
  }

  // 6. é¼ æ ‡è¿›å…¥æ˜¾ç¤ºå·¦å³navæŒ‰é’®
  function showNav() {
    var self = this;
    self.banner.onmouseover = function (ev) {
      window.clearInterval(self.autoTimer);
      self.leftNav.style.display = "block";
      self.rightNav.style.display = "block";
    };
    this.banner.onmouseout = function (ev) {
      self.autoTimer = window.setInterval(function () {self.autoPlay()}, self.interval);
      self.leftNav.style.display = "none";
      self.rightNav.style.display = "none";
    };
  }

  // 7. å®ç°ç‚¹å‡»ç„¦ç‚¹åˆ‡æ¢
  function focusAlign () {
    var self = this;
    this.ul.onclick = function (ev) {
      ev = ev || window.event;  // ä¸ºäº†å…¼å®¹mozillaå’Œieæ ¸å¿ƒçš„æµè§ˆå™¨ï¼
      ev.target = ev.target || ev.srcElement;
      if (ev.target.nodeName === 'LI') {
        // è·å–æ‰€ç‚¹å‡»liåœ¨åŒè¾ˆå…ƒç´ ä¸­æ’è¡Œè€å‡ ~
        self.imgIndex = utils.index(ev.target) - 1; // è®¾ç½®è½®æ’­ç´¢å¼•æ—¶ä¸ºå•¥è¦å‡ä¸€å‘¢ï¼Ÿå‘çˆ¹ï¼Ÿå› ä¸ºäº†å˜›
        self.autoPlay();
      }
    }
  }

  // 8. å®ç°silderå·¦å³åˆ‡æ¢
  function turnOn () {
    var self = this;
    //this.rightNav.addEventListener('click', this.autoPlay);
    // åŸæ¥æ˜¯ä¸Šé¢é‚£æ ·æ‰§è¡Œï¼Œä½†è¿™æ ·thiså°±ä¼šå˜æˆé”šç‚¹aæ ‡ç­¾ï¼Œå¿…é¡»æƒ³åŠæ³•å°†thisç±»å®ä¾‹å¯¹è±¡å¸¦å…¥ï¼Œ
    //    åˆ™å¼€è¾Ÿä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸä¸”åµŒå¥—åœ¨turnOnä½œç”¨åŸŸä¸­ï¼Œåˆ™è¢«åµŒå¥—çš„ç§æœ‰ä½œç”¨åŸŸå°±å¯ä»¥é€šè¿‡ä½œç”¨åŸŸé“¾æ‰¾åˆ°selfæŒ‡é’ˆ
    this.rightNav.addEventListener('click', function () {
      self.autoPlay();
    });
    this.leftNav.addEventListener('click', function () {
      if (self.imgIndex === 0) {
        self.imgIndex = self.lis.length;
      }
      self.imgIndex--;
      self.setBanner();
    });
  }

  // åˆå§‹åŒ–
  function init () {
    var self = this;
    this.getDataBind();
    window.setTimeout(function () {
      self.autoTimer = window.setInterval(function () {
        self.autoPlay();
        //æå‡ä½“éªŒï¼šä¿®æ”¹div.innerçš„èƒŒæ™¯å›¾ï¼Œä¸è¦è®©ç”¨æˆ·çœ‹åˆ°é»˜è®¤å ä½å›¾ä¸¤æ¬¡ï¼
        var fisrtSliderImg = self.inner.getElementsByTagName('img')[0].src;
        // ä»¥åå¯ä»¥å‡çº§çš„æˆ‘ç±»åº“äº†ï¼ï¼ï¼è¿™é‡Œè¦å‡çº§ï¼
        utils.css(self.inner, 'backgroundImage', 'url(' + fisrtSliderImg + ')');
      }, self.interval);
    },550);
    this.showNav();
    this.focusAlign();
    this.turnOn();
  }

  window.SliderEaseIn = Slider

}();

//  var slider = new SliderEaseIn('banner', 3000, "./json/data.json");
//  slider.init();
```

- æ€»ç»“å°è£…çš„æ­¥éª¤ï¼š
  1. åˆ›å»ºIIFEåŒ…ç€ä»£ç ï¼Œç¡®ä¿ä¸å†²çªï¼
  2. åˆ›å»ºæ„é€ å‡½æ•°function Slider(e, i, u) { ... }, æ„é€ å‡½æ•°ä»…ä»…åªå®šä¹‰å®ä¾‹å¯¹è±¡çš„ç§æœ‰å±æ€§ã€‚ä¾‹å¦‚bannerã€innerã€autoTimerã€imgIndexç­‰ç­‰å±æ€§ã€‚
  3. ä¿®æ”¹Sliderçš„æ„é€ å‡½æ•°ä¸ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå…¶æœ€é‡è¦çš„ç¬¬ä¸€æ­¥å°±æ˜¯å…ˆå°†`constructor`é‡æ–°åå‘æŒ‡å‘`function Slider(...)`ã€‚ç„¶åå°†ç±»ä¸­çš„å…¬å…±æ–¹æ³•å…¨éƒ¨æ”¾åœ¨åŸå‹ä¸Šï¼Œä¾‹å¦‚initã€bindã€imgDelyLoadã€autoPlayã€setBannerã€focusAlignç­‰ç­‰æ–¹æ³•ã€‚
  4. ä¿®æ”¹bindæ–¹æ³•ï¼šbindæ–¹æ³•é‡Œé¢thiså°±æ˜¯å®ä¾‹å¯¹è±¡ï¼Œä¸éœ€è¦æ€ä¹ˆæ”¹ï¼›
  5. ä¿®æ”¹imgDelyLoadæ–¹æ³•ï¼šå› ä¸ºå›¾ç‰‡å»¶è¿Ÿæ–¹æ³•ç»™ç¬¬ä¸€å¼ åŠ å»¶è¿Ÿæ•ˆæœæ—¶ä¼šä½¿ç”¨åˆ°å¼‚æ­¥ç¼–ç¨‹çš„äº‹ä»¶ç»‘å®š(`tmpimg.onload = function validImg() { è¿™é‡Œæ˜¯å¼‚æ­¥ç©ºé—´å“¦~ }`)ï¼Œæ‰€ä»¥ä»…æ–¹æ³•åç¬¬ä¸€æ­¥å°†thisä¿å­˜åœ¨selfæŒ‡é’ˆä¸­ï¼Œè¿™æ ·å¼‚æ­¥ç©ºé—´å°±å¯ä»¥ä½¿ç”¨selfæŒ‡é’ˆæ­£ç¡®çš„æ‰¾åˆ°thisï¼
  6. åˆ›å»ºgetDataBindæ–¹æ³•ï¼šè·å–å¼‚æ­¥æ•°æ®å¹¶ç»‘å®šæ•°æ®ã€‚ä¹Ÿä¸€æ ·çš„ï¼Œajaxçš„å›è°ƒæ˜¯å¼‚æ­¥ç©ºé—´ï¼Œå¾—æŠŠthisä¿å­˜åœ¨selfæŒ‡é’ˆä¸Šï¼Œä»¥ä¾¿åœ¨xhrçš„å›è°ƒä¸­æ­£ç¡®æ‰¾åˆ°ç±»çš„å®ä¾‹å¯¹è±¡ï¼
  7. ä¿®æ”¹è½®æ’­å‡½æ•°autoPlayå’ŒsetBannerï¼šæ–¹æ³•è°ƒç”¨å¾ˆå¤šï¼Œä¸”æ¯æ¬¡è°ƒç”¨éƒ½ç¡®ä¿äº†thisï¼Œåªéœ€åŠ åŠ thiså³å¯ã€‚
  8. ä¿®æ”¹showNavã€focusAlignã€turnOnæ–¹æ³•ï¼šå› ä¸ºéƒ½æœ‰å¼‚æ­¥ç©ºé—´ï¼Œéƒ½éœ€è¦å­˜thisåœ°å€
  9. åˆ›å»ºinitæ–¹æ³•ï¼šä¿å­˜thisåœ°å€åˆ°æŒ‡é’ˆselfï¼Œå¯åŠ¨åŠ¨ç”»ç”¨setTimeoutåŠ setIntervalä¸‰å±‚åµŒå¥—ï¼Œè½®æ’­å»¶è¿Ÿå¼€å¯ã€‚

- ä½“éªŒå‡çº§ï¼šåœ¨initçš„ç¬¬ä¸€ä¸ªå»¶æ—¶å®šæ—¶å™¨ä¸­ï¼Œæ‰‹åŠ¨å°†div.innerçš„èƒŒæ™¯å›¾åœ¨å»¶è¿Ÿåè®¾ç½®ä¸ºç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œè¿™æ ·ç”¨æˆ·åœ¨è¿‡å¿«ä¹±ç‚¹æ—¶ï¼Œä¸ä¼šç¬¬äºŒæ¬¡çœ‹åˆ°é»˜è®¤å ä½å›¾ã€‚
  
> é‡å¤çš„é¢†æ‚Ÿï¼šJavaScriptæ“ä½œdomæ–¹æ³•å–å¾—çš„æ ·å¼ä»…ä»…æ˜¯doméª¨æ¶ä¸Šçš„æ ·å¼å€¼ï¼Œä¸ä¼šå¾—åˆ°æµè§ˆå™¨æ¸²æŸ“åçš„å€¼ã€‚è¦è·å–æ¸²æŸ“åçš„å€¼å¯ä»¥ä½¿ç”¨***BOM***ä¸Šçš„æ–¹æ³•ï¼

----------



  [1]: http://static.zybuluo.com/szy0syz/bmt0gfbhgzny9pwvtf5szy29/zf-lesson74.png
  [2]: http://static.zybuluo.com/szy0syz/gphbn9q4fs1msckxqnm81ano/lesson80-layout.png
  [3]: http://static.zybuluo.com/szy0syz/rz5cte2pwlx2whnmil6r143x/zf_lesson82.png
