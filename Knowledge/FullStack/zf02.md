# ç å³°å‰ç«¯å…¨æ ˆåŸ¹è®­ç¬¬äºŒå‘¨ï¼šcall/apply/è¡¨æ ¼æ’åº/æ­£åˆ™

### è¯¾æ—¶21ï¼šå‡½æ•°çš„ä¸‰ç§è§’è‰²

![prototype-chain-final](http://ofx24fene.bkt.clouddn.com//img/book/prototype_chain_final.svg)

- Function.prototypeæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæ“ä½œä¹Ÿå’ŒObject.prototypeä¸€æ ·ã€‚

- å‡½æ•°æœ¬èº«ä¹Ÿä¼šæœ‰ä¸€äº›è‡ªå·±çš„å±æ€§ï¼š
  - length: 0   å½¢å‚ä¸ªæ•°
  - name: "Fn"  å‡½æ•°åç§°
  - prototype: ç±»çš„åŸå‹ï¼Œåœ¨åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•éƒ½æ˜¯å½“å‰Fnè¿™ä¸ªç±»å®ä¾‹çš„å…±æœ‰æ–¹æ³•
  - \__proto__: æŠŠå‡½æ•°å½“åšä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼ŒæŒ‡å‘Functionè¿™ä¸ªç±»çš„åŸå‹
  
#### å‡½æ•°æ˜¯æ•´ä¸ªJSä¸­æœ€å¤æ‚ä¹Ÿæ˜¯æœ€é‡è¦çš„çŸ¥è¯†ç‚¹

- å‡½æ•°å­˜åœ¨å¤šé¢æ€§
  - â€œæ™®é€šå‡½æ•°â€ï¼šå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œæ‰§è¡Œæ—¶ä¼šå½¢æˆç§æœ‰ä½œç”¨åŸŸ(é—­åŒ…)->å½¢å‚èµ‹å€¼->é¢„è§£é‡Š->ä»£ç æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåæ ˆå†…å­˜é”€æ¯æˆ–ä¸é”€æ¯
  - â€ç±»â€œï¼šå®ƒæœ‰è‡ªå·±çš„å®ä¾‹ï¼Œä¹Ÿæœ‰ä¸€ä¸ªå«åš`prototype`å±æ€§æ˜¯è‡ªå·±çš„åŸå‹ï¼Œå®ƒçš„å®ä¾‹éƒ½å¯ä»¥æ‰§è¡Œè‡ªå·±çš„åŸå‹
  - â€æ™®é€šå¯¹è±¡â€œï¼šå’Œ`var obj = {}`ä¸­çš„objä¸€æ ·ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œä»–ä½œä¸ºå¯¹è±¡å¯ä»¥æœ‰ä¸€äº›è‡ªå·±çš„ç§æœ‰å±æ€§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`__proto__`æ‰¾åˆ°`Function.prototype`
  
#### å°ä¾‹å­ä¸€æšå……åˆ†è¯´æ˜å‡½æ•°çš„ä¸‰é¢æ€§

```javascript
var Fn = function () {
  var num = 10
  this.x = 100
}
Fn.prototype.getX = function () { console.log(this.x) }
Fn.aaa = 1000
var f = new Fn
f.num // -> undefined, å› ä¸ºåœ¨æ„é€ å‡½æ•°ä¸­å£°æ˜çš„numä»…æ˜¯ç§æœ‰ä½œç”¨åŸŸä¸­çš„ä¸€ä¸ªå˜é‡
f.aaa // -> undefined, aaaæ˜¯Fnè¿™ä¸ªå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œå®ä¾‹å–ä¸åˆ°
var res = Fn()   // ä½¿ç”¨Fnçš„å †å†…å­˜å¼€è¾Ÿä¸€ä¸ªç§æœ‰ä½œç”¨åŸŸï¼Œé‡Œé¢æœ‰numå“¦ğŸ™ƒ
console.log(res) // å‡½æ•°æ²¡è¿”å›å€¼ï¼Œå½“ç„¶ä¹Ÿæ˜¯undefinedğŸ˜
Fn.aaa
```

----------

### è¯¾æ—¶22ï¼šcallæ–¹æ³•æ·±å…¥

```javascript
myAry.slice // -> è®©ä»åŸå‹é“¾ä¸Šæ‰¾åˆ°çš„sliceæ–¹æ³•å…ˆæ‰§è¡Œï¼Œåœ¨æ‰§è¡Œæ—¶ï¼Œæ‰æŠŠmyAryæ•°ç»„è¿›è¡Œæˆªå–ç­‰æ“ä½œ
```

#### callæ–¹æ³•

```javscript
var obj = { name:"jerryshi.com" }
function fn () { console.log(this) }
fn() // -> æ­¤æ—¶thisè¢«windowå¯¹è±¡ä»£æ›¿
obj.fn() // -> æŠ¥é”™ï¼
fn.call(obj)
```

- callæ–¹æ³•çš„ä½œç”¨ï¼šé¦–å…ˆæˆ‘ä»¬è®©åŸå‹ä¸Šçš„callæ–¹æ³•æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œcallæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬è®©fnæ–¹æ³•ä¸­çš„thiså˜ä¸ºç¬¬ä¸€ä¸ªå‚æ•°å€¼objï¼Œç„¶åå†æŠŠfnè¿™ä¸ªå‡½æ•°æ‰§è¡Œã€‚ç®€å•æ¥è¯´ï¼Œcallæ–¹æ³•å°±æ˜¯æ”¹å˜æ–¹æ³•é‡Œçš„thiså…³é”®å­—ã€‚

#### ç®€å•æ¨¡æ‹ŸFunctionå†…ç½®çš„callæ–¹æ³•

```javascript
function fn () { console.log(this) }
var obj = { name: "szy" }
Function.prototype.szyCall = function (context) {
  // szyCallæ–¹æ³•ä¸­çš„thiså…¶å®å°±æ˜¯å½“å‰è¦æ“ä½œçš„å’Œæ”¹å˜å…¶å†…éƒ¨thisçš„é‚£ä¸ªå‡½æ•°
  // 1.è®©fnä¸­çš„thiså…³é”®å­—å˜ä¸ºcontextçš„å€¼ -> æŸä¸ªå¯¹è±¡obj
  //   è®©thisè¿™ä¸ªå‡½æ•°ä¸­çš„â€œthisâ€å…³é”®å­—å˜ä¸ºâ€œcontextâ€
  //   ç„¶åeval(this.toString().replace('this','context'))
  // 2.è®©fnæ–¹æ³•æ‰§è¡Œ this()
}
fn.call(obj)
```

#### é¢è¯•é¢˜

```javascript
function fn1 () { console.log(1) }
function fn2 () { console.log(2) }
fn1.call(fn2) // -> 1 :é¦–å…ˆfn1ä¼šé€šè¿‡åŸå‹é“¾æœºåˆ¶æ‰¾åˆ°Function.prototypeä¸Šçš„callæ–¹æ³•ï¼Œå¹¶ä¸”å°†fn2ä½œä¸ºå‚æ•°ä¼ å…¥callæ–¹æ³•å»æ‰§è¡Œï¼Œæ­¤æ—¶callæ–¹æ³•å†…çš„thiså…³é”®å­—è¿˜æ˜¯æˆ‘ä»¬è¦æ“ä½œçš„fn1å‡½æ•°ã€‚åœ¨callæ–¹æ³•ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­é¦–å…ˆè®©fn1ä¸­çš„thiså…³é”®å­—å˜ä¸ºfn2ï¼Œç„¶åfn1çš„æ–¹æ³•æ‰§è¡Œã€‚
//--------------------éš¾åº¦å‡çº§--------------------
fn1.call.call(fn2) // -> é¦–å…ˆfn1ä¼šé€šè¿‡åŸå‹é“¾æœºåˆ¶æ‰¾åˆ°Function.prototypeä¸Šçš„callæ–¹æ³•ï¼Œç„¶åå†è®©è¿™ä¸ªcallæ–¹æ³•å†é€šè¿‡åŸå‹é“¾æ‰¾åˆ°Function.prototypeä¸Šçš„callæ–¹æ³•(å› ä¸ºcallæœ¬èº«çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥åŒæ ·å¯ä»¥æ‰¾åˆ°Function.prototype)ï¼Œåœ¨ç¬¬äºŒæ¬¡æ‰¾åˆ°callæ–¹æ³•æ—¶è®©æ–¹æ³•æ‰§è¡Œï¼Œæ­¤æ—¶æ–¹æ³•ä¸­çš„thisæ˜¯fn1.callï¼Œé¦–å…ˆè®©è¿™ä¸ªæ–¹æ³•(fn1.call)ä¸­çš„thisæ›¿æ¢ä¸ºfn2ï¼Œç„¶åå†è®©fn1.callæ‰§è¡Œï¼Œæœ€ç»ˆè¾“å‡º2
//------------------ä¸¾ä¾‹è¯´æ˜----------------------
function szy (context) {
  // -> 1.è®©thisè¿™ä¸ªå‡½æ•°ä¸­çš„thiså…³é”®å­—æ›¿æ¢context
  // -> 2.è®©thisæ–¹æ³•æ‰§è¡Œ
  this()
}
Function.prototype.mycall = szy
fn1.mycall.mycall(fn2) 
// -> fn1.mycall -> szy
// szy.mycall(fn2) -> å…ˆè®©mycallæ–¹æ³•æ‰§è¡Œï¼Œmycallä¸­çš„thisæ˜¯szyï¼Œè®©szyä¸­çš„thisæ›¿æ¢ä¸ºfn2ï¼Œå†è®©szyæ‰§è¡Œï¼Œä¼šå¸¦åŠ¨szyä¸­çš„thisæ‰§è¡Œ -> 2

fn1.call.call.call.call(fn2) // -> 2
Function.prototype.call(fn1) // -> undefined, é¦–å…ˆæ˜ç¡®æœ€ç»ˆæ‰§è¡Œçš„æ˜¯Function.prototypeï¼Œå®ƒæ˜¯ä¸€ä¸ªç©ºå‡½æ•°ï¼Œæ‰§è¡Œç»“æœundefined
Function.prototype.call.call.call(fn1) // -> 1
```

> fn1.call(fn2) è¿™é‡Œä¸ç®¡æœ‰æ²¡fn2è¿™ä¸ªå‚æ•°ï¼Œæ‰§è¡Œæœ¬ä½“è¿˜æ˜¯fn1.
fn1.call.call(fn2) è€Œè¿™é‡Œæ‰§è¡Œæœ¬ä½“å·²ç»è¢«æ›¿æ¢æˆäº†fn2ï¼Œåˆ™æœ€ç»ˆæ‰§è¡Œçš„æ˜¯fn2ã€‚

åŸç†å¤§æ¦‚è¿™æ ·ï¼Œé¦–å…ˆjså¼•æ“åœ¨fn1çš„åŸå‹é“¾ä¸Šæ‰¾åˆ°callæ–¹æ³•ï¼Œä½†æ²¡æ‰§è¡Œï¼Œå®ƒå‘ç°è¿˜æœ‰ä¸€ä¸ªcallæ–¹æ³•ï¼Œå°±å†é€šè¿‡fn1.callçš„åŸºç¡€ä¸Šå†å»æ‰¾åˆ°callæ–¹æ³•ï¼Œæ‰¾åˆ°ç¬¬äºŒä¸ªcallä¹‹åï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªcallæ–¹æ³•ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªcallæ–¹æ³•é‡Œçš„thisåŸå…ˆæŒ‡å‘fn1.callçš„åœ°å€(æ˜¯ä¸ªå‡½æ•°)ï¼Œä½†ç°åœ¨æ˜¯åœ¨ç¬¬äºŒä¸ªcallé‡Œï¼Œå¼•æ“æ ¹æ®è§„åˆ™ä¼šæŠŠç¬¬äºŒä¸ªcallé‡Œçš„thisæŒ‡å‘æ›¿æ¢æˆç”±å½¢å‚ä¼ å…¥fn2çš„åœ°å€ï¼Œæœ€åæ‰§è¡Œfn1.call=fn2è¢«æ‰§è¡Œã€‚fn2æ‰§è¡Œæ—¶ï¼Œthisæ˜¯windowã€‚

#### å¦‚æœcallè¢«è°ƒç”¨ä¸€æ¬¡æ—¶ï¼Œä¼šå°†è°ƒç”¨æ–¹æ³•ä¸»ä½“ä¸­çš„thisæ›¿æ¢æˆå½¢å‚å¯¹è±¡æ¥æ‰§è¡Œï¼›è€Œè¢«è°ƒç”¨è¶…è¿‡ä¸€æ¬¡æ—¶ï¼Œåˆ™è°ƒç”¨ä¸»ä½“å’Œæ‰§è¡Œä¸»ä½“ä¼šå‘ç”Ÿè½¬å˜ï¼Œæœ€ç»ˆç­‰äºwindowè°ƒç”¨äº†æœ€åä¸€ä¸ªcallä¸­çš„å½¢å‚æ–¹æ³•ã€‚ç®€å•æ¥è¯´callæœ¬æ¥å°±æ˜¯ä¸ºäº†æ”¹å˜æŸæ–¹æ³•ä¸­çš„thisæ¥ç”¨çš„ã€‚

----------

### è¯¾æ—¶23ï¼šcallã€applyå’Œbindçš„åŒºåˆ«

```javascript
var obj = { name: "Jerry Shi" }
function fn (num1, num2) {
  console.log(num1,num2)
  console.log(this)
}
fn(100,200)             // -> this=window, num1=100, num2=200
fn.call(100, 200)       // -> this=100, num1=200, num2=undefined
fn.call(obj, 100, 200)  // -> this=obj, num1=100, num2=200
fn.call()               // -> this=window
fn.call(null)           // -> this=window
fn.call(undefined)      // -> this=window

"use strict" //ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
fn.call()               // -> this=undefined
fn.call(null)           // -> this=null
fn.call(undefined)      // -> this=undefined
// åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œcallå‡½æ•°ä¼ nullæ—¶thisæ˜¯thisï¼Œä¸ä¼ æˆ–è€…ä¼ undefinedæ—¶thisæ˜¯undefined
```

> applyå’Œcallæ–¹æ³•çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ç”¨æ”¹å˜æ–¹æ³•çš„thiså…³é”®å­—å¹¶ä¸”æ‰§è¡Œæ–¹æ³•ï¼›è€Œä¸”åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹å¯¹äºç¬¬ä¸€ä¸ªå‚æ•°æ˜¯null/undefinedè¿™ç§æƒ…å†µçš„è§„å¾‹ä¹Ÿæ˜¯ä¸€æ ·

```javascript
fn.call(obj, 100, 200)  // callåœ¨ç»™fnä¼ é€’å‚æ•°æ—¶ï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ä¼ é€’è¿›å»(arguments)
fn.apply(obj, [100, 200]) // applyåˆ™æ˜¯æŠŠè¦ä¼ ç»™fnçš„å‚æ•°ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ä¼ è¿›å»
// ä½†æœ€ç»ˆä¸¤ä¸ªæ–¹æ³•ä¹Ÿç®—æŠŠå‚æ•°é€ä¸€ä¼ é€’

// bindï¼šè¿™ä¸ªæ”¾åœ¨åœ¨IE6~8ä¸‹ä¸å…¼å®¹ï¼Œå’Œcall/applyç±»ä¼¼ä¹Ÿæ˜¯ç”¨æ¥æ”¹å˜thiså…³é”®å­—çš„

fn.call(obj, 1, 2) // -> æ”¹å˜thiså’Œæ‰§è¡Œfnå‡½æ•°éƒ½ä¸€èµ·å®Œæˆäº†

// é¢„å¤„ç†ï¼šäº‹å…ˆæŠŠfnçš„thisæ”¹å˜ä¸ºæˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå¹¶æŠŠå¯¹åº”çš„å‚æ•°ä¹Ÿå‡†å¤‡å¥½ï¼Œä»¥åç”¨åˆ°å°±æ‰§è¡Œï¼Œå…¶å®å°±æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªå †å†…å­˜ï¼Œæ²¡å˜é‡æ¥æ”¶è¿˜ä¸æ˜¯ä¼šè¢«æ¸…ç†
var newFn = fn.bind(obk, 1, 2) // -> åªæ˜¯æŠŠfnä¸­thisæ”¹ä¸ºobjï¼Œå¹¶ä¸”ç»™ä¸¤ä¸ªå½¢å‚èµ‹å€¼1å’Œ2ï¼Œä½†æ­¤æ—¶å¹¶æ²¡æœ‰æŠŠfnè¿™ä¸ªå‡½æ•°æ‰§è¡Œï¼Œè€Œæ˜¯æ›¿æ¢å’Œèµ‹å€¼å¥½çš„å †å†…å­˜åœ°å€è¿”å›ï¼Œè¿™ä¸ªè¿”å›å€¼ç»™äº†newFnè¿™ä¸ªå˜é‡
newFn() // -> ç°åœ¨æ‰çœŸæ­£æ‰§è¡Œæ›¿æ¢åçš„å †å†…å­˜ï¼Œç„¶åä¹Ÿä¼šç”Ÿæˆä½œç”¨åŸŸé¢„è§£é‡Š...
```

----------

### å…³äºthisçš„çŸ¥è¯†è¡¥å……

```javascript
//å‡½æ•°ä¸­çš„thisæŒ‡å‘å’Œå½“å‰å‡½æ•°åœ¨å“ªå®šä¹‰çš„æˆ–è€…åœ¨å“ªæ‰§è¡Œçš„éƒ½æ²¡æœ‰ä»»ä½•çš„å…³ç³»
//åˆ†æthisæŒ‡å‘çš„è§„å¾‹å¦‚ä¸‹:

//[éä¸¥æ ¼æ¨¡å¼]
//1ã€è‡ªæ‰§è¡Œå‡½æ•°ä¸­çš„thisæ°¸è¿œæ˜¯window
//[æ¡ˆä¾‹1]
 var obj={
    fn:(function(i){
       //this->window
       return function(){
          //this->obj
       }
    })(0)
 };
 obj.fn();

//2ã€ç»™å…ƒç´ çš„æŸä¸ªè¡Œä¸ºç»‘å®šä¸€ä¸ªæ–¹æ³•,å½“è¡Œä¸ºè§¦å‘çš„æ—¶å€™,æ‰§è¡Œç»‘å®šçš„æ–¹æ³•,æ­¤æ—¶æ–¹æ³•ä¸­çš„thisæ˜¯å½“å‰çš„å…ƒç´ 
// [æ¡ˆä¾‹1]
 oDiv.onclick=function(){
    //this->oDiv
 };

 // [æ¡ˆä¾‹2]
 function fn(){
    //this->window
 }
 oDiv.onclick=function(){
     //this->oDiv
     fn();
 };

//3ã€æ–¹æ³•æ‰§è¡Œ,çœ‹æ–¹æ³•åå‰é¢æ˜¯å¦æœ‰".",æœ‰çš„è¯,"."å‰é¢æ˜¯è°thiså°±æ˜¯è°,æ²¡æœ‰çš„è¯thiså°±æ˜¯window
// [æ¡ˆä¾‹1]
 var obj={fn:fn};
 function fn(){}
 fn.prototype.aa=function(){};
 var f=new fn;

 fn();//this->window
 obj.fn();//this->obj
 fn.prototype.aa();//this->fn.prototype
 f.aa();//this->f
 f.__proto__.aa();//this->f.__proto__->fn.prototype


//4ã€åœ¨æ„é€ å‡½æ•°æ¨¡å¼ä¸­,å‡½æ•°ä½“ä¸­çš„this.xxx=xxxä¸­çš„thisæ˜¯å½“å‰ç±»çš„ä¸€ä¸ªå®ä¾‹
// [æ¡ˆä¾‹1]
 function Fn(){
    this.x=100; //this->f
    this.getX=function(){
        console.log(this);//this->f å› ä¸ºgetXæ–¹æ³•æ‰§è¡Œçš„æ—¶å€™,"."å‰é¢æ˜¯f,æ‰€ä»¥thisæ˜¯f
    }
 }
 var f=new Fn;
 f.getX();

//5ã€ä½¿ç”¨call/applyæ¥æ”¹å˜thisçš„æŒ‡å‘(ä¸€ä½†é‡åˆ°call/applyä¸Šè¿°çš„å››æ¡éƒ½æ²¡ç”¨äº†)


// [ä¸¥æ ¼æ¨¡å¼]
"use strict";//->å‘Šè¯‰æµè§ˆå™¨æˆ‘ä»¬æ¥ä¸‹æ¥ç¼–å†™çš„JSä»£ç é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼

//1ã€è‡ªæ‰§è¡Œå‡½æ•°ä¸­çš„thisæ°¸è¿œæ˜¯undefined
// [æ¡ˆä¾‹1]
 var obj={
    fn:(function(i){
       //this->undefined
       return function(){
          //this->obj
       }
    })(0)
 };
 obj.fn();

//3ã€æ–¹æ³•æ‰§è¡Œ,çœ‹æ–¹æ³•åå‰é¢æ˜¯å¦æœ‰".",æœ‰çš„è¯,"."å‰é¢æ˜¯è°thiså°±æ˜¯è°,æ²¡æœ‰çš„è¯thiså°±æ˜¯undefined
// [æ¡ˆä¾‹1]
 var obj={fn:fn};
 function fn(){}

 fn();//this->undefined
 obj.fn();//this->obj
```

> æˆ‘ä»¬å‘ç°ä¸¥æ ¼æ¨¡å¼ä¸‹çš„thisç›¸å¯¹äºéä¸¥æ ¼æ¨¡å¼ä¸‹çš„thisä¸»è¦åŒºåˆ«åœ¨äºï¼šå¯¹äºJSä»£ç ä¸­æ²¡æœ‰å†™æ‰§è¡Œä¸»ä½“çš„æƒ…å†µä¸‹,éä¸¥æ ¼æ¨¡å¼ä¸‹é»˜è®¤éƒ½æ˜¯windowæ‰§è¡Œçš„,æ‰€ä»¥thisæŒ‡å‘çš„æ˜¯window;ä½†æ˜¯åœ¨ä¸¥æ ¼çš„æ¨¡å¼ä¸‹,æ²¡æœ‰å†™å°±æ˜¯æ²¡æœ‰æ‰§è¡Œä¸»ä½“,thisæŒ‡å‘çš„æ˜¯undefined;
***ä½ ä»¥ä¸º ä½ ä»¥ä¸ºçš„ å°±æ˜¯ä½ ä»¥ä¸ºçš„***

----------

### è¯¾æ—¶24 è·å–æ•°ç»„æœ€å¤§å€¼

```javascript
var ary = [44,2,4,9]

// æ–¹æ³•ä¸€: æ’åºæ³•
ary.sort(function (a,b) { return a-b }) // max = ary[ary.length - 1]

// æ–¹æ³•äºŒ: å‡è®¾æ³•
// å‡è®¾å½“å‰æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå°±æ˜¯æœ€å¤§å€¼ï¼Œç„¶åæ‹¿è¿™ä¸ªå€¼å’Œæ•°ç»„é‡Œåé¢çš„å€¼é€ä¸€æ¯”è¾ƒï¼Œå¦‚æœæŸä¸€ä¸ªå€¼æ¯”å‡è®¾å€¼è¿˜è¦å¤§ï¼Œè¯´æ˜å‡è®¾é”™äº†ï¼Œæˆ‘ä»¬æŠŠå‡è®¾å€¼è¿›è¡Œæ›¿æ¢...
// å’Œè‡ªå®šä¹‰å±æ€§ä¸€æ ·ï¼Œéƒ½æ˜¯JSä¸­æœ€å¸¸è§çš„ç¼–ç¨‹æ€æƒ³
var max = ary[0]
for(var i = 1; i<ary.length; i++) {
  var cur = ary[i]
  cur > max ? max = cur : null
}

// æ–¹æ³•ä¸‰: Math + apply
Math.max.apply(null, ary)
```

// æ–¹æ³•å››: evalå­—ç¬¦ä¸²æ‹¼æ¥æ³•
max = eval('Math.max(' + ary.toString() +')')

#### æ‹¬å·è¡¨è¾¾å¼

```javascript
function fn1 () { console.log('fn1:' + this) }
function fn2 () { console.log('fn2:' + this) }
var obj = { name: "szy~", fn: fn2 }
//;(fn1,fn2)() // -> fn2:'this'ï¼Œæœ€ååªæœ‰fn2æ‰§è¡Œ -> åœ¨(x1,x2,x3...)æ‹¬å·è¡¨è¾¾å¼ä¸­ï¼Œä¸€ä¸ªæ‹¬å·å†…å‡ºç°äº†å¤šé¡¹å†…å®¹ï¼Œä¸­é—´ç”¨','éš”å¼€ï¼Œä½†æœ€ååªè·å¾—äº†æœ€åä¸€é¡¹
(fn2, obj.fn)() // -> æ‰§è¡Œçš„æ˜¯obj.fnï¼Œä½†åœ¨æ‰§è¡Œæ—¶ï¼Œä½œç”¨åŸŸé‡Œçš„thiså˜ä¸ºäº†windowï¼Œè€Œä¸æ˜¯è°ƒç”¨ä¸»ä½“objã€‚è¿™é‡Œç›¸å½“äºæŠŠè¿™ä¸ªå‡½æ•°æ‹·è´ä¸€ä»½æ”¾åœ¨é‚£é‡Œæ‰§è¡Œï¼Œæ‰€ä»¥thiså‘ç”Ÿäº†å˜åŒ–ã€‚
(obj.fn)() // -> this=objè°ƒç”¨ä¸»ä½“ï¼Œåªæœ‰ä¸€é¡¹æ—¶thisä¸å‘ç”Ÿå˜åŒ–
```

----------

### è¯¾æ—¶25ï¼šè·å–å¹³å‡æ•°

#### æ–¹æ³•ä¸€

```javascript
var target = [9.1, 3, 8.8, 10.0, 9.3]
function avgFn () {
  // åˆ›å»ºä¸´æ—¶æ•°ç»„
  var ary = []
  // æŠŠå‡½æ•°çš„å‚æ•°å¤åˆ¶ä¸€ä»½åˆ°ä¸´æ—¶æ•°ç»„ä¸­
  for (var i = 0; i < arguments.length; i++) {
    ary.push(arguments[i])
  }
  // ä»å°åˆ°å¤§æ’åº
  ary.sort(function (a, b) { return a -b })
  // å»é™¤æœ€å°å€¼
  ary.shift()
  // å»é™¤æœ€å¤§å€¼
  ary.pop()
  // å°†æ•°ç»„è½¬æˆx+y+zå½¢å¼ç»™evalè®¡ç®—
  return (eval(ary.join("+")) / ary.length).toFixed()
}
```

> æ„æ€æ–¹æ³•ä¸€ç§ç”¨é«˜æ•ˆå¤„ç†æ•°æ®å¤åˆ¶ï¼Œæƒ³åˆ°äº†slice~

#### æ–¹æ³•äºŒ

```javascript
var target = [9.1, 3, 8.8, 10.0, 9.3]
// æ¨¡æ‹Ÿå†…ç½®çš„sliceå‘ç°æ•°ç»„çš„å…‹éš†åŠŸèƒ½
Array.prototype.mySlice = function () {
  // æ­¤æ—¶çš„ thiså°±æ˜¯è¦æ“ä½œçš„æ•°ç»„å¯¹è±¡ï¼
  //////////////å†…ç½®æ–¹æ³•//////////////
  var tmp = []
  for (var i=0;i<this.length;i++) {
    tmp[tmp.length] = this[i]
  }
  ////////////////////////////////////
  //å®ç°æŠŠargumentsè½¬æ¢ä¸ºæ•°ç»„ï¼Œè§æ–¹æ³•ä¸€ï¼
  // var tmp = []
  // for (var i=0;i < arguments.length;i++) {
  //   tmp[tmp.length] = arguments[i]
  // }
  // ä¸¤è€…åŒºåˆ«ä»…åœ¨äºä¸Šé¢çš„thisåˆ°ä¸‹é¢å˜æˆäº†argumentsè€Œå·²ï¼Œæ°æ°åªæ”¹å˜äº†thisï¼Œæ•…æˆ‘ä»¬åº”è¯¥è”æƒ³åˆ°äº†èƒ½å¤Ÿä¿®æ”¹æ–¹æ³•thisçš„æ–¹æ³•ã€‚
  return tmp
}

function avgFn () {
  // å…¶å®è¿™é‡Œå·²ç»ä¸éœ€è¦è½¬æ¢æˆæ•°ç»„æ¥å¤„ç†
  // å°†ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„ï¼šæŠŠargumentså…‹éš†ä¸€ä»½æˆæ•°ç»„
  // å€Ÿç”¨æ•°ç»„åŸå‹ä¸Šçš„sliceæ–¹æ³•ï¼Œå½“sliceæ‰§è¡Œçš„æ—¶å€™ï¼Œè®©æ–¹æ³•ä¸­çš„thiså˜ä¸ºæˆ‘ä»¬è¦å¤„ç†çš„argumentsï¼Œå®ç°å°†ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°æ®
  // var ary = Array.prototype.slice.call(arguments)
  // var ary = [].__proto__.slice.call(arguments)
  
  // åŒç†, å€Ÿç”¨æ•°ç»„åŸå‹ä¸Šçš„æ’åºæ–¹æ³•ï¼Œå¯¹argumentsç±»æ•°ç»„è¿›è¡Œæ’åº
  Array.prototype.sort.call(arguments, function (a,b) { return a-b })
  // å»é™¤æœ€å°å€¼
  [].shift.call(arguments)
  // å»é™¤æœ€å¤§å€¼
  [].shift.pop(arguments)
  // å°†æ•°ç»„è½¬æˆx+y+zå½¢å¼ç»™evalè®¡ç®—, å…¨å€Ÿç”¨åŸå‹ä¸Šçš„æ–¹æ³•
  return (eval([].join.call(arguments,"+")) / arguments.length).toFixed()
}
```

> ä»æ­¤è¯¾æ—¶å¯å¾—ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç±»é‡Œå†™äº†å…³äºthisçš„ç®—æ³•å‡½æ•°ï¼Œå¦‚æœå¯é€šç”¨çš„è¯ï¼Œå¯ä»¥ç”¨callå–å‡ºæ¥åœ¨åˆ«çš„ç±»ä¸­ç»§ç»­ä½¿ç”¨ï¼æ–¹æ³•å¤ç”¨æ€§å°†å¤§å¤§å¢å¼ºï¼

### è¯¾æ—¶26ï¼šç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„

```javascript
var divs = document.getElementsByTagName("div")
console.dir(divs) // -> HTMLCollections å…ƒç´ é›†åˆç±»çš„ä¸€ä¸ªå®ä¾‹(ç±»æ•°ç»„)
divs = document.getElementByName("szy")  
console.dir(divs) // -> NodeList èŠ‚ç‚¹é›†åˆç±»çš„ä¸€ä¸ªå®ä¾‹(ç±»æ•°ç»„)

var olist = document.getElementsByTagName('div')
var ary = Array.prototype.slice.call(olist)
// -> åœ¨IE6~8ä¸­ï¼Œä¸æ”¯æŒå€Ÿç”¨æ•°ç»„çš„sliceå®ç°å°†å…ƒç´ é›†åˆ(èŠ‚ç‚¹é›†åˆ)çš„ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„ -> Array.prototype.slice: 'this' ä¸æ˜¯ JavaScript å¯¹è±¡ï¼
// -> ä½†å¯¹äºargumentså€Ÿç”¨æ•°ç»„çš„æ–¹æ³•æ—¶æ²¡æœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå¦‚æœè¦å…¼å®¹å†™å¾ªç¯æ•°ç»„pushå…ƒç´ 
```

> ä½œä¸šï¼šæŸ¥æ‰¾JSä¸­æ‰€æœ‰è·å–å…ƒç´ çš„æ–¹æ³•ï¼ŒæŸ¥çœ‹ä»–ä»¬è¿”å›çš„ç±»å‹ã€‚

#### æµè§ˆå™¨çš„å¼‚å¸¸ä¿¡æ¯æ•è·

> try catch finlly

```javascript
// å®ç°å°†ç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„
function listToArray (likeArr) {
  var arr = []
  try {
    arr = [].__proto__.slice.call(likeArr)
  } catch (e) {
    for (var i=0; i < likeArr.length; i++) {
      arr[arr.length] = likeArr[i]  
    }
  }
  return arr
}
```

### è¯¾æ—¶27ï¼šsortæ–¹æ³•æ·±å…¥ç ”ç©¶

#### å›è°ƒå‡½æ•°ï¼šæŠŠä¸€ä¸ªæ–¹æ³•Aå½“åšå‚æ•°å€¼ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå‡½æ•°Bï¼Œç„¶ååœ¨Bæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éšæ—¶æ ¹æ®éœ€æ±‚è®©Aæ–¹æ³•æ‰§è¡Œ

```javascript
//sortæ–¹æ³•ä¼šè°ƒç”¨length-1æ¬¡å›è°ƒå‡½æ•°

//æ‰©å¼ 
var ary = [{name:"å°é£"}, {name:"å°æ"}, {name:"å°ç‹"}]
ary.sort(function (a,b) {return a.name.localCompare(b.name)})
//ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼ŒlocalCompareä¼šå°†æ±‰å­—å…ˆè½¬æ¢æˆæ‹¼éŸ³æ¯”è¾ƒï¼Œå¦‚æœè¿˜æ¯”ä¸å‡ºæ¥å†è½¬Unicodeä»£ç æ¯”è¾ƒ
```

### è¯¾æ—¶28ï¼šjsonåŠæ“ä½œ

- JSONä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ•°æ®ç±»å‹ï¼Œå®ƒåªæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®æ ¼å¼ -> å®ƒæ˜¯å¯¹è±¡æ•°æ®ç±»å‹ã€‚JSONæ ¼å¼çš„å¯¹è±¡ï¼ˆç›¸è¾ƒäºæ™®é€šæ ¼å¼æ¥è¯´ï¼Œä»…æ˜¯æŠŠå±æ€§åç”¨åŒå¼•å·æŠ±èµ·æ¥è€Œå·²ï¼‰

- åœ¨windowæµè§ˆå™¨å¯¹è±¡ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå«JSONçš„å±æ€§ï¼Œå®ƒé‡Œé¢æä¾›äº†ä¸¤ä¸ªæ–¹æ³•:
  - JSON.parse:ï¼šæŠŠJSONæ ¼å¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºJSONæ ¼å¼çš„å¯¹è±¡
  - JSON.stringifyï¼šæŠŠJSONæ ¼å¼çš„å¯¹è±¡è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²

> ä½œä¸šï¼šå†™å…¼å®¹å…¨æµè§ˆå™¨çš„JSON.parseå’ŒJSON.stringify

### è¯¾æ—¶29ï¼šæ•°æ®ç»‘å®šåŠdomå›æµ

```jajvascript
// æ–¹æ³•ä¸€ï¼šåŠ¨æ€çŠ¶æ€å…ƒç´ æ³•
// ä¼˜åŠ¿ï¼š
// åŠ£åŠ¿ï¼šæ¯æ¬¡åŠ¨æ€åˆ›å»ºä¸€ä¸ªliï¼Œæˆ‘ä»¬å°±æ·»åŠ åˆ°é¡µé¢å½“ä¸­ï¼Œå¼•å‘ä¸€èµ·DOMå›æµï¼Œæœ€åå¼•å‘å›æµæ¬¡æ•°è¿‡å¤šï¼Œå½±å“æ€§èƒ½ï¼

// æ–¹æ³•äºŒï¼šå­—ç¬¦ä¸²æ‹¼æ¥æ³•

// ä¼˜åŠ¿ï¼šäº‹å…ˆæŠŠå†…å®¹æ‹¼æ¥å¥½ï¼Œæœ€åç»Ÿä¸€æ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œåªå¼•å‘ä¸€æ¬¡å›æµ
// åŠ£åŠ¿ï¼šæˆ‘ä»¬æŠŠæ–°æ‹¼æ¥çš„å­—ç¬¦ä¸²æ·»åŠ åˆ°#ul1ä¸­ï¼ŒåŸæœ‰é‚£ä¸‰ä¸ªliçš„é¼ æ ‡åˆ’è¿‡æ•ˆæœæ¶ˆå¤±äº†(åŸæ¥ç»‘å®šçš„DOMäº‹ä»¶å…¨éƒ¨æ¶ˆå¤±)

// æ–¹æ³•ä¸‰ï¼šæ–‡æ¡£ç¢ç‰‡
var frg = document.createDocumentFragment()  // -> åˆ›å»ºä¸€ä¸ªæ–‡æ¡£ç¢ç‰‡ï¼Œç›¸å½“äºä¸´æ—¶åˆ›å»ºäº†ä¸€ä¸ªå®¹å™¨
for (var i = 0; i < ary.length; i++) {
  var cur = ary[i]
  var oli = document.createElement("li")
  oli.innerHTML = "<span>" + (i + 4) + "</span>" + cur.titel
  frg.appendChild(oli)
}
oul.appendChild(frg)
frg = null // -> æ‰‹åŠ¨é‡Šæ”¾frgçš„å †å†…å­˜
```

#### JSä¸­DOMæ·±å…¥çŸ¥è¯†ï¼š
- å›æµ(é‡æ’ reflow)ï¼šå½“é¡µé¢ä¸­çš„HTMLç»“æ„å‘ç”Ÿæ”¹å˜ï¼ˆå¢åŠ ã€åˆ é™¤å…ƒç´ ã€ä½ç½®å‘ç”Ÿæ”¹å˜ ...ï¼‰ï¼Œæµè§ˆå™¨éƒ½éœ€è¦ä»æ–°è®¡ç®—ä¸€éæœ€æ–°çš„DOMç»“æ„ï¼Œä»æ–°çš„å¯¹å½“å‰é¡µé¢è¿›è¡Œæ¸²æŸ“

- é‡ç»˜ï¼šæŸä¸€ä¸ªå…ƒç´ çš„éƒ¨åˆ†æ ·å¼å‘ç”Ÿæ”¹å˜äº†ï¼Œæµè§ˆå™¨åªéœ€è¦é‡æ–°æ¸²æŸ“å½“å‰å…ƒç´ å³å¯

> JSä¼˜åŒ–å°ç»†èŠ‚ï¼šä¸¥ç¦DOMå›æµ

### è¯¾æ—¶30ï¼šè¡¨æ ¼æ’åºåŠdomæ˜ å°„

```html
<ul id="ul1">
    <li>98</li>
    <li>99</li>
    <li>96</li>
    <li>90</li>
    <li>95</li>
</ul>
```

```javascript
// ç±»æ•°ç»„è½¬æ¢æˆæ•°ç»„
function listToArray (likeArr) {
  var arr = []
  try {
    arr = [].__proto__.slice.call(likeArr)
  } catch (e) {
    for (var i=0; i < likeArr.length; i++) {
      arr[arr.length] = likeArr[i]  
    }
  }
  return arr
}

// è¡¨æ ¼æ’åº
// 1.å–å¾—è¦æ’åºçš„ç±»æ•°ç»„li
var oUl = document.getElementById("ul1")
var oLis = oUl.getElementByTagName("li")
// 2.å…ˆæŠŠå…ƒç´ é›†åˆç±»æ•°ç»„è½¬æ¢ä¸ºæ•°ç»„
var ary = listToArray(oLis)
// 3.ç»™è½¬æ¢åçš„æ•°ç»„è¿›è¡Œæ’åº
ary.sort(function (a,b) {
  return parseFloat(a.innerHTML) - parseFloat(b.innerHTML) // å…¶å®è¿™é‡Œæ‰¾å­èŠ‚ç‚¹æ‹¿nodeValueæ›´ä¸“ä¸šäº›ï¼
})
// 4. æŒ‰ç…§aryä¸­å­˜å‚¨çš„æœ€æ–°é¡ºåºä½¿ç”¨æ–‡æ¡£ç¢ç‰‡ä¾æ¬¡çš„æŠŠå¯¹åº”çš„liæ·»åŠ åˆ°é¡µé¢ä¸­
var frg = document.createDocumentFragment()
for (var i=0; i<ary.length; i++) {
  frg.appendChild(ary[i])
}
oUl.appendChild(frg) // ä½“ç°DOMæ˜ å°„æœºåˆ¶
frg = null
```

#### DOMæ˜ å°„æœºåˆ¶ï¼šé¡µé¢ä¸­çš„æ ‡ç­¾å’ŒJSä¸­è·å–åˆ°çš„å…ƒç´ å¯¹è±¡(å…ƒç´ é›†åˆ)æ˜¯ç´§ç´§ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œé¡µé¢ä¸­çš„HTMLç»“æ„å˜äº†ï¼ŒJSä¸­ä¸éœ€è¦é‡æ–°è·å–ï¼Œé›†åˆä¸­çš„å†…å®¹ä¹Ÿä¼šè·Ÿç€è‡ªåŠ¨æ”¹å˜

```javascript
// ä¸¾ä¾‹è¯´æ˜
var oUl = document.getElementById("ul1")
var oLis = oUl.getElementByTagName("li")
console.log(oLis.length) // -> 5
var tli = document.createElement("li")
oUl.appendChild(tli)
console.log(oLis.length) // -> 6
```

![dom-mapping](http://ofx24fene.bkt.clouddn.com//img/blog/DOM-mapping.svg)

### è¯¾æ—¶31ï¼š
```css
/*ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡å­—*/
-webkit-user-select: none;

/*å®ç°ç›’å­é˜´å½±*/
.box {
    margin: 20px auto;
    padding: 20px;
    width: 400px;
    border: 1px green solid;

    border-radius: 10px;
    box-shadow: 3px 3px 15px 0 #DBEEBD;
}
```

### è¯¾æ—¶32ï¼šå®ç°Ajaxæ•°æ®è¯»å–å’Œç»‘å®š

```javascript
// 0.è·å–éœ€è¦æ“ä½œçš„å…ƒç´ 
var oTab = document.getElementById("tab")
var tHead = oTab.tHead  // tHeadå±æ€§ï¼Œè¡¨æ ¼ç‹¬æœ‰, oTabä¹Ÿæœ‰rowså±æ€§ï¼Œä½†å…¶åŒ…å«æ‰€æœ‰è¡Œï¼ŒåŒ…è£¹thè¡Œ
var oThList = tHead.rows[0].cells // rowså’Œcellsè¡¨æ ¼ç‹¬æœ‰å±æ€§ï¼Œæ„æ€æ˜¯æ‹¿åˆ°thä¸­ç¬¬ä¸€è¡Œçš„æ‰€æœ‰å…ƒç´ 
var tBody = oTab.tBodies[0]
var oRows = tBody.rows
var data = null
// -> 1.è·å–åå°JSONæ•°æ® -> AJAX(async javascript and xml)
// -->> (1). åˆ›å»ºä¸€ä¸ªAjaxå¯¹è±¡
var xhr = new XMLHttpRequest
// -->> (2). åˆ›å»ºä¸€ä¸ªAjaxå¯¹è±¡
xhr.open("get", "./json/data.txt", true) // ç¬¬ä¸‰ä¸ªå‚æ•°å¸ƒå°”å€¼è¡¨æ˜æ˜¯å¼‚æ­¥è¯·æ±‚
// -->> (3). åˆ›å»ºä¸€ä¸ªAjaxå¯¹è±¡
xhr.onreadystatechange = function () { //æ£€æŸ¥æ˜¯ä¸æ˜¯2xxçš„çŠ¶æ€ç 
  if (xhr.readyState === 4 && /^2\d{2}/.test(xhr.status)) {
    var val = xhr.responseText;
    data = utils.jsonParse(val)
    bind()
    changeBg()
  }
}
// -->> (4). åˆ›å»ºä¸€ä¸ªAjaxå¯¹è±¡
xhr.send()

// -> 2.å®ç°æ•°æ®ç»‘å®š
function bind() {
  var frg = document.createDocumentFragment()
  for (var i = 0; i < data.length; i++) {
    var cur = data[i]
    //åˆ›å»ºæ–‡æ¡£ç¢ç‰‡
    var oTr = document.createElement('tr')
    for (var key in cur) {
      if(key == 'sex') {
        cur[key] = cur[key] == 1 ? 'ç”·' : 'å¥³'
      }
      var oTd = document.createElement('td')
      oTd.appendChild(document.createTextNode(cur[key]))
      oTr.appendChild(oTd)
    }
    frg.appendChild(oTr)
  }
  tBody.appendChild(frg)
}

function changeBg () {
  //classListæœ‰ç‚¹æ–°~çœ‹è¦ä¸è¦åŠ å«ç‰‡å•Š~
  for (var i=0; i<oRows.length; i++) {
    if( i%2 === 1) {
      oRows[i].classList.add("bg")
    } else { // è¿™é‡Œéœ€è¦æ¸…åŸæ¥ç•™ä¸‹çš„æ ·å¼ï¼
      oRows[i].classList.remove("bg")
    }
  }
}
//changeBg() //è¿™é‡Œè¿™ä¹ˆæ‰§è¡Œæ²¡é¢œè‰²å•Š, éƒ½è¿˜æ²¡æœ‰è·å–æ•°æ®å‘¢ï¼è¡Œéƒ½æ²¡æœ‰æ€ä¹ˆéš”è¡Œå˜è‰²ã€‚
```

- å¦‚æœåœ¨webstormä¸­å‡ºç°ä¹±ç ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ç¼–ç æ ¼å¼é—®é¢˜ï¼Œ`Command + ,`è¿›å»è®¾ç½®ï¼Œåœ¨`Editor -> File Encodings`é‡Œä¿®æ”¹ä¸‰ä¸ªç¬¬ä¸‰ç¼–ç å…¨éƒ¨ä¸ºUTF-8ï¼Œç„¶åæŠŠå‡ºç°ä¹±ç çš„æ–‡ä»¶å†…å®¹æ‹·è´ä¸€éï¼Œå†æ–°å»ºä¸€ä¸ªæ–‡ä»¶åç²˜è´´ä¿å­˜å³å¯ã€‚

### è¯¾æ—¶33ï¼šå®ç°å‡é™åºæ’åˆ—

```javascript
//ç®—æ³•åˆ†æï¼š
//1.é‚£ä¸ªtableçš„é‚£ä¸ªtbody
//2.çœ‹æ•°æ®è¡Œæ˜¯å¦å°äº2ï¼Œå°äºå°±æ²¡å¿…è¦æ’åº
//3.ç¡®å®šæ‰€ç‚¹çš„åˆ—åºå·
//4.tbodyé‡Œçš„trè¡Œå¯¹è±¡è½¬æ¢æˆæ•°ç»„
//5.åœ¨æ•°ç»„ä¸­ç”¨åˆ—åºå·ç¡®è®¤ç”¨å“ªä¸ªå€¼æ’åºï¼Œå–å¾—æ—¶å€™ç›´æ¥æ‹¿åˆ°nodeValue
//6.åˆ›å»ºæ–‡æ¡£ç¢ç‰‡
//7.å¾ªç¯æ’åºåçš„æ•°ç»„ï¼Œé€ä¸€å°†tr_domå¯¹è±¡å­˜å…¥æ–‡æ¡£ç¢ç‰‡çš„childListé‡Œ
//8.å°†æ–‡æ¡£ç¢ç‰‡å¯¹è±¡appendChildåˆ°tbodyä¸Š
function sort(mouseEvent) {
  var th = mouseEvent.target
  var tb = document.getElementsByTagName("tbody")[0]
  if (tb.children.length < 2) return // å¦‚æœå°±ä¸€è¡Œæ•°æ®é‚£å°±ä¸æ’åºäº†
  var columnIndex = -1 // ç‚¹çš„åˆ°åº•æ˜¯å“ªä¸€åˆ—
  var siblingThAry = [].__proto__.slice.call(th.parentNode.children)
  for (var i = 0; i < siblingThAry.length; i++) {
    if (siblingThAry[i].isEqualNode((th))) {
      columnIndex = i //ç¬¬å‡ åˆ—
    }
  }
  var rowsAry = [].__proto__.slice.call(tb.children)
  rowsAry.sort(function (a, b) {
    var curValue = a.children[columnIndex].firstChild.nodeValue
    var nextValue = b.children[columnIndex].firstChild.nodeValue
    if (isNaN(parseFloat(curValue)) || isNaN(parseFloat(nextValue))) {
      return (curValue.toString().localeCompare(nextValue.toString())) * th.flag
    }
    return (parseFloat(curValue) - parseFloat(nextValue)) * th.flag
  })
  th.flag *= -1
  var frg = document.createDocumentFragment()
  rowsAry.forEach(function (item) {
    frg.appendChild(item)
  })
  tb.appendChild(frg)
  changeBg()
}

//åˆå§‹åŒ–
function init() {
  for (var j = 0; j < oThs.length; j++) { //oThsè¿˜æ˜¯ä¸ªç±»æ•°ç»„ï¼
    oThs[j].flag = 1
    console.log(oThs[j].flag)
    oThs[j].addEventListener('click', sort, false)
  }
}
init()
```

> ç–‘é—®ï¼šä¸ºä»€ä¹ˆä½¿ç”¨addEventListeneræ·»åŠ åˆ°å…ƒç´ ä¸Šçš„æ–¹æ³•å’Œç›´æ¥æŠŠæ–¹æ³•å†™åœ¨å…ƒç´ ä¸Šæ—¶ï¼Œä¼ å…¥å‡½æ•°çš„å‚æ•°ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯MouseEventè€Œåè€…ç›´æ¥æ˜¯è§¦å‘çš„å…ƒç´ ï¼Ÿ

----------

### è¯¾æ—¶34ï¼šthisä¼˜åŒ–

> åœ¨å¤šè°ƒç”¨ä¸»ä½“çš„å‡½æ•°ä¸­ï¼Œå¯ä»¥ç”¨`_this = this`æŠŠthiså¾€åµŒå¥—çš„å‡½æ•°ä¸­ä¸Ÿï¼

> ä¸€è¨€ä¸åˆå°±åœ¨è¯¾æ—¶33ä¸­è‡ªå·±çº¯ç›²å†™å®ç°äº†è¯¾æ—¶31~è¯¾æ—¶36çš„ä»£ç ğŸ¤˜ğŸ¤£ğŸ¤˜

----------

### è¯¾æ—¶37ï¼šæ­£åˆ™çš„ä½œç”¨

- æ­£åˆ™ï¼šä»–å°±æ˜¯ä¸€ä¸ªè§„åˆ™ï¼Œç”¨æ¥å¤„ç†å­—ç¬¦ä¸²çš„ä¸€ä¸ªè§„åˆ™(æ­£åˆ™ä»…ç”¨æ¥å¤„ç†å­—ç¬¦ä¸²)

#### ä½¿ç”¨ï¼š

1.åŒ¹é…æ¨¡å¼ï¼šåˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç¬¦åˆæˆ‘ä»¬åˆ¶å®šçš„è§„åˆ™ -> test

2.æ•è·æ¨¡å¼ï¼šæŠŠå­—ç¬¦ä¸²ä¸­ç¬¦åˆæˆ‘ä»¬æ­£åˆ™è§„åˆ™çš„å†…å®¹æ•è·åˆ° -> exec 

#### åˆ›å»º

- å­—é¢é‡æ–¹å¼ï¼š`var reg=\/d\`
- å®ä¾‹åŒ–æ–¹å¼ï¼š`var reg=new RegExp(â€œ\dâ€)`

æ­£åˆ™çš„è¿™ä¸¤ç§åˆ›å»ºæ–¹å¼æ˜¯æœ‰åŒºåˆ«çš„ï¼

#### ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•å»å­¦ä¹ JavaScript

----------

### è¯¾æ—¶38ï¼šæ­£åˆ™çš„å…ƒå­—ç¬¦å’Œä¸€äº›ç®€å•çš„åº”ç”¨

å…ƒå­—ç¬¦ï¼šæ¯ä¸ªæ­£åˆ™è¡¨è¾¾å¼éƒ½æ˜¯ç”±å…ƒå­—ç¬¦å’Œä¿®é¥°ç¬¦ç»„æˆçš„
[å…ƒå­—ç¬¦] -> åœ¨/ /ä¹‹é—´å…·æœ‰æ„ä¹‰çš„ä¸€äº›å­—ç¬¦
  ç¬¬ä¸€ç§å…ƒå­—ç¬¦ï¼šå…·æœ‰ç‰¹æ®Šæ„ä¹‰çš„å…ƒå­—ç¬¦ (ä»…å¸¸ç”¨)
  \ï¼šè½¬ä¹‰å­—ç¬¦ï¼Œè½¬ä¹‰åé¢çš„å­—ç¬¦æ‰€ä»£è¡¨çš„å«ä¹‰
  ^ï¼šä»¥æŸä¸€ä¸ªå…ƒå­—ç¬¦å¼€å§‹
  $ï¼šä»¥æŸä¸€ä¸ªå…ƒå­—ç¬¦ç»“å°¾
  \nï¼šåŒ¹é…ä¸€ä¸ªæ¢è¡Œç¬¦
   .ï¼šé™¤äº†\nä»¥å¤–çš„ä»»æ„å­—ç¬¦
  ( )ï¼šåˆ†ç»„ï¼ŒæŠŠä¸€ä¸ªå¤§æ­£åˆ™æœ¬äººåˆ’åˆ†ä¸ºå‡ ä¸ªå°çš„æ­£åˆ™

  x|yï¼šxæˆ–è€…yä¸­çš„ä¸€ä¸ª
  [xyz]ï¼šxæˆ–è€…yæˆ–è€…zä¸­çš„ä¸€ä¸ª
  [^xyz]ï¼šé™¤äº†xyzä¸‰ä¸ªä»¥å¤–çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦
  [a-z]ï¼ša-zä¹‹é—´çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦
  [^a-z]ï¼šé™¤äº†a-zä¹‹é—´çš„ä»»ä½•ä¸€ä¸ªå­—ç¬¦
  \dï¼šä¸€ä¸ª0-9ä¹‹é—´çš„æ•°å­—
  \Dï¼šé™¤äº†0-9ä¹‹é—´æ•°å­—ä»¥å¤–çš„ä»»ä½•å­—ç¬¦
  \bï¼šåŒ¹é…ä¸€ä¸ªè¾¹ç•Œç¬¦eg: /\bj/ -> "i m jerry" åŒ¹é…åˆ°j ä¼šè‡ªåŠ¨å°†ç©ºæ ¼ã€@ã€httpã€+ã€.åçš„å•è¯è®¤ä¸ºæ˜¯è¾¹ç•Œçš„å¼€å§‹
  \Bï¼šåŒ¹é…ä¸€ä¸ªéè¾¹ç•Œç¬¦
  \wï¼šæ•°å­—ã€å­—æ¯ä¸‹åˆ’çº¿ä¸­çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ [(0-9)(a-z)(A-z)(_)]
  \sï¼šåŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦ æˆ– ç©ºæ ¼ç¬¦ æˆ– åˆ¶è¡¨ç¬¦ æˆ– æ¢é¡µç¬¦...ç­‰


  ç¬¬äºŒç§å…ƒå­—ç¬¦ï¼šä»£è¡¨æ•°æ˜¾æ¬¡æ•°çš„é‡è¯å…ƒå­—ç¬¦
  *ï¼šå‡ºç°é›¶åˆ°å¤šæ¬¡
  +ï¼šå‡ºç°ä¸€åˆ°å¤šæ¬¡
  ?ï¼šå‡ºç°é›¶æ¬¡æˆ–ä¸€æ¬¡
  {n}ï¼šå‡ºç°næ­¤
  {n, }ï¼šå‡ºç°nåˆ°å¤šæ¬¡
  {n,m}ï¼šå‡ºç°nåˆ°mæ¬¡

```javascript
var reg = /^\d+$/
console.log(reg.test(â€˜2015â€™))

// æ­£åˆ™éªŒè¯æ‰‹æœºå·ç ï¼š11ä½æ•°å­—ï¼Œç¬¬ä¸€ä½æ˜¯1ï¼Œæœ€åä»¥æ•°å­—ç»“å°¾
var reg2 = /^1\d{10}$/

// ä»¥0å¼€å¤´ï¼Œä»¥2ç»“å°¾ï¼Œä¸­é—´å¯ä»¥æ˜¯é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å­—ç¬¦
console.log(/^0.2$/.test(â€œ0.2â€)). // -> true
console.log(/^0.2$/.test(â€œ0-2â€)). // -> true
console.log(/^0\.2$/.test(â€œ0.2â€)). // -> true
console.log(/^0\.2$/.test(â€œ0-2â€)). // -> false

// åˆ†ç»„
var reg = /^(\d+)www(\d+)$/
 
// åŒ¹é…ä¸€ä¸ªæœ‰æ•ˆçš„æ•°å­—ï¼Œå«æœ‰æ­£æ•°ã€è´Ÿæ•°ã€é›¶ã€å°æ•°
// è§„åˆ™ä¸€ï¼šå°æ•°ç‚¹å¯ä»¥å‡ºç°ä¹Ÿå¯ä»¥ä¸å‡ºç°ï¼Œä½†ä¸€æ—¦å‡ºç°åˆ™åé¢å¿…é¡»è·Ÿç€ä¸€ä½æˆ–å¤šä¸ºæ•°å­—ï¼Œåªèƒ½å‡ºç°ä¸€ä¸ªå°æ•°ç‚¹
//è§„åˆ™äºŒï¼šæœ€å¼€å§‹å¯ä»¥æœ‰+/-ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰
//è§„åˆ™ä¸‰ï¼šæ•´æ•°éƒ¨åˆ†ï¼Œä¸€ä¸ªæ•°å¯ä»¥æ˜¯0-9ä¹‹é—´çš„ä¸€ä¸ªï¼Œå¤šä½æ•°åˆ™ä¸èƒ½ä»¥0å¼€å¤´
var reg0 = /^[+-]?$/ 	   // -> å«ä¹‰ï¼šä»¥æ•°å­—å¼€å¤´å’Œç»“å°¾ï¼Œ+æˆ–-ä¸­çš„ä¸€ä¸ªèƒ½å‡ºç°ä¸€æ¬¡
var reg1 = /(\d|([1-9]\d+))/  // -> å«ä¹‰ï¼šå…ˆå°æ‹¬å·èµ·æ¥æ”¹å˜ä¼˜å…ˆçº§ï¼Œå…ˆä¸€ä½æ•°æ˜¯å¯ä»¥æ˜¯0-9ï¼Œæˆ–è€…å¤šä½æ•°æ˜¯åªèƒ½1-9å¼€å¤´
var reg2 = /(\.\d+)?/    // -> å«ä¹‰ï¼šå°æ•°ç‚¹å¯æœ‰å¯æ— ï¼Œå¦‚æœæœ‰åé¢å¿…é¡»æ˜¯ä¸€åˆ°å¤šä½æ•°å­— 
// æœ€ç»ˆç‰ˆæœ¬çš„æœ‰æ•ˆæ•°å­—æ­£åˆ™åŒ¹é…
var reg = /^[+-]?(\d|([1-9]\d+))(\.\d+)?$/
```

#### æ­£åˆ™è§„å¾‹æ€»ç»“
 
[ ]çš„æ€»ç»“ï¼š
1. åœ¨ä¸­æ‹¬å·ä¸­å‡ºç°çš„æ‰€æœ‰å­—ç¬¦éƒ½æ˜¯ä»£è¡¨æœ¬èº«æ„ä¹‰çš„å­—ç¬¦(æ²¡æœ‰ä»»ä½•ç‰¹æ®Šå«ä¹‰)(ä¸­æ‹¬å·æœ‰å±è”½æ‰€æœ‰ç‰¹æ®Šå«ä¹‰çš„åŠŸèƒ½)
2. ä¸­æ‹¬å·ä¸­ä¸è¯†åˆ«ä¸¤ä½+çš„æ•°

( )çš„æ€»ç»“ï¼š
1. åˆ†ç»„å¯ä»¥æ”¹å˜x|yçš„é»˜è®¤çš„ä¼˜å…ˆçº§

```javascript
var reg = /^18|19$/     // èƒ½ç¬¦åˆçš„ï¼š18, 19, 181, 189, 119, 819, 1819â€¦
var reg1 = /^(18|19)$/  //åŒ¹é…åˆ°çš„åªæœ‰18å’Œ19
```

----------

### è¯¾æ—¶39ï¼šæ­£åˆ™åˆ›å»ºæ–¹å¼çš„åŒºåˆ«

- å­—é¢é‡æ–¹å¼ä¸­å‡ºç°çš„ä¸€åˆ‡éƒ½æ˜¯å…ƒå­—ç¬¦ï¼Œæ‰€ä»¥ä¸èƒ½è¿›è¡Œå˜é‡å€¼çš„æ‹¼æ¥ï¼Œè€Œå®ä¾‹åˆ›å»ºçš„æ–¹å¼åˆ™å¯ä»¥ï¼›
- å­—é¢é‡æ–¹å¼ä¸­ç›´æ¥å†™`\d`å°±å¯ä»¥ï¼Œè€Œåœ¨å®ä¾‹ä¸­éœ€è¦æŠŠå®ƒè½¬ä¹‰`\\d`

----------

### è¯¾æ—¶40ï¼šç¼–å†™ç®€å•çš„æ­£åˆ™è¡¨è¾¾å¼

```javascript
var reg0 = /^[12-68]$/. // -> åŒ¹é…ç»“æœ1ã€2-6ä¸­ä¸€ä¸ªã€8 è¿™ä¸‰ä¸ªä¸­çš„ä¸€ä¸ª
var reg1 = /^[\w-]$/.   // -> åŒ¹é…ç»“æœæ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€ä¸­æ† ä¸­çš„ä¸€ä¸ª

// éªŒè¯å¹´é¾„ä»‹äº18~65ä¹‹é—´ ï¼š 18-19   20-59  60-65
var reg = /^(1[8-9]|[2-5]\d|6[0-5])$/

// éªŒè¯é‚®ç®±çš„æ­£åˆ™(ç®€ç‰ˆ)
// 185505508@qq.com
// jerryshi@163.com.cn
// jerryshi444@ttcompany.xyz
// jerry_shi@gamil.com
// åˆ†æè¿‡ç¨‹ï¼šå…ˆæ‰¾è§„å¾‹ï¼Œå†åˆ†ç»„ä¸€éƒ¨åˆ†ä¸€éƒ¨åˆ†çš„å®Œæˆ
var reg = /^[\w.-]+@[0-9a-zA-Z]+(\.[a-zA-Z]{2,4}){1,2}$/

// ä¸­å›½æ ‡å‡†çœŸå®å§“å 2-4ä½æ±‰å­—çš„æ­£åˆ™
var reg = /^[\u4e00-\u9fa5]{2,4}$/   //ä¸­é—´çš„æ˜¯Unicodeå€¼ 

// ä¸­å›½èº«ä»½è¯éªŒè¯çš„æ­£åˆ™(ç®€å•ç‰ˆ)
var reg = /^([1-9]\d)(\d{4})([1-2]\d{3})(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[0-1]])(\d{2})(\d)([0-9|X])$/
```

----------

### è¯¾æ—¶41ï¼šæ­£åˆ™çš„æ‡’æƒ°æ€§å’Œè´ªå©ªæ€§

#### `exec` -> æ­£åˆ™çš„æ•è·

#### æ­£åˆ™æ•è·çš„å†…å®¹

- æ•è·åˆ°çš„å†…å®¹æ˜¯ä¸€ä¸ªæ•°ç»„
  - æ•°ç»„ä¸­çš„ç¬¬ä¸€é¡¹æ˜¯å½“å‰å¤§æ­£åˆ™æ•è·çš„å†…å®¹
  - ç¬¬äºŒé¡¹indexæ•è·å†…å®¹åœ¨å­—ç¬¦ä¸²ä¸­å¼€å§‹çš„ç´¢å¼•ä½ç½®
  - ç¬¬ä¸‰é¡¹inputæ•è·çš„åŸå§‹å­—ç¬¦ä¸²
  
- æ­£åˆ™æ•è·çš„ç‰¹ç‚¹
  - æ‡’æƒ°æ€§ -> æ¯ä¸€æ¬¡æ‰§è¡Œexecåªæ•è·ç¬¬ä¸€ä¸ªåŒ¹é…çš„å†…å®¹ï¼Œåœ¨ä¸è¿›è¡Œä»»ä½•å¤„ç†çš„æƒ…å†µä¸‹ï¼Œå†æ¬¡æ‰§è¡Œå¤šæ¬¡æ•è·ï¼Œæ•è·çš„è¿˜æ˜¯ç¬¬ä¸€ä¸ªåŒ¹é…çš„å†…å®¹
  - `lastIndex`å±æ€§æ˜¯æ­£åˆ™æ¯ä¸€æ¬¡æ•è·åœ¨å­—ç¬¦ä¸²å¼€å§‹æŸ¥æ‰¾çš„ä½ç½®ï¼Œé»˜è®¤å€¼æ˜¯0ã€‚æ„æ€å°±æ˜¯è¯´å¦‚æœä¸è¿›è¡Œé¢„å…ˆé…ç½®ï¼Œç¬¬äºŒæ¬¡æ•è·æ—¶`lastIndex`ä¹Ÿæ˜¯ä¸º0ï¼Œæ‰€ä»¥ä½“ç°äº†æ‡’æƒ°æ€§ã€‚
  
- å¦‚ä½•è§£å†³æ‡’æƒ°æ€§ï¼Ÿåœ¨æ­£åˆ™æœ«å°¾åŠ ä¸€ä¸ªä¿®é¥°ç¬¦"g"
  - æ­£åˆ™çš„ä¿®é¥°ç¬¦ï¼šimg -> i/m/g
  - global(g)ï¼šå…¨å±€åŒ¹é…
  - ignoreCase(i)ï¼šå¿½ç•¥å¤§å°å†™
  - multiLine(m)ï¼šå¤šè¡ŒåŒ¹é…
  
#### åŸç†ï¼šåŠ äº†å…¨å±€ä¿®é¥°ç¬¦`g`ï¼Œæ­£åˆ™æ¯ä¸€æ¬¡æ•è·ç»“æŸåï¼Œæˆ‘ä»¬çš„lastIndexçš„å€¼éƒ½ä¼šå˜ä¸ºæ‰€åŒ¹é…åˆ°å­—ç¬¦ä¸²ç¢ç‰‡çš„åä¸€ä½ç´¢å¼•å€¼ï¼Œä¸‹ä¸€æ¬¡æ•è·ä»è¿™ä¸ªæœ€æ–°çš„ä½ç½®å¼€å§‹æŸ¥æ‰¾ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ‰€æœ‰éœ€è¦æ•è·çš„çš„å†…å®¹æ•è·åˆ°äº†

```javascript
var reg = /\d+/g
console.log(reg.lastIndex)  // -> 0
console.log(reg.exec("jerry44shi99"))  // ["44", index: 5,..]
console.log(reg.lastIndex) //  -> 7
console.log(reg.exec("jerry44shi99"))  // ["99", index: 10,..]
console.log(reg.lastIndex) //  -> 12
console.log(reg.exec("jerry44shi99"))  // null
/////////////////////////////////////////
var reg = /\d+/g
var str = "jerry222shi444com888"
var ary = []
var res = reg.exec(str)
while (res) {
  ary.push(res[0])
  res = reg.exec(str)
}
```

- æ­£åˆ™æ•è·çš„ç‰¹ç‚¹
  - è´ªå©ªæ€§ -> æ­£åˆ™çš„æ¯ä¸€æ¬¡æ•è·éƒ½æ˜¯æŒ‰ç…§åŒ¹é…çš„zuiæœ€é•¿ç»“æœæ•è·çš„ï¼Œä¾‹å¦‚ä¸‹ä¾‹ä¸­2ä¹ŸåŒ¹é…ï¼Œ2017é¡µåŒ¹é…ï¼Œä½†æ­£åˆ™é»˜è®¤æ•è·çš„æ˜¯2017
  - å¦‚ä½•è§£å†³æ­£åˆ™çš„è´ªå©ªæ€§é—®é¢˜ï¼Ÿ -> å¯¹äº†ï¼Œå°±æ˜¯åŠ `?`é—®å·ï¼

- é—®å·`?`åœ¨æ­£åˆ™ä¸­æœ‰å¾ˆå¤šä½œç”¨ï¼š
  - æ”¾åœ¨ä¸€ä¸ªæ™®é€šçš„å…ƒå­—ç¬¦åä»£è¡¨å‡ºç°0-1æ¬¡ `/\d?/`ï¼Œè¡¨ç¤ºæ•°å­—å¯èƒ½å‡ºç°ä¹Ÿå¯èƒ½ä¸å‡ºç°0åˆ°å¤šæ¬¡
  - æ”¾åœ¨ä¸€ä¸ªé‡è¯å…ƒå­—ç¬¦åé¢åˆ™æ˜¯å–æ¶ˆæ•è·æ—¶çš„è´ªå©ªæ€§
  - æ”¾åœ¨ä¸€ä¸ªåˆ†ç»„å°æ­£åˆ™ä¸­`(?:RegEx)`ï¼Œè¡¨ç¤ºæ­¤åˆ†ç»„å°æ­£åˆ™åªåŒ¹é…ä¸æ•è·
  

```javascript
// ä½“ç°é™¤äº†æ­£åˆ™çš„è´ªå©ªæ€§
var reg = /\d+/  // åŒ¹é…1åˆ°å¤šä¸ª0~9ä¹‹é—´çš„æ•°å­—
var str = "s2017z06z08"
console.log(reg.exec(str)) // -> ["2017", ...]
var reg1 = /\d+?/g
var ary = [], res = reg.exec(str)
while (res) {
  ary.push(res[0])
  res = reg.exec(str)
}  // å¤ªå‘äº†ï¼Œæ•´å‡ ä¸‡æ¬¡å¾ªç¯ã€‚ã€‚ã€‚
```

####  å­—ç¬¦ä¸²ä¸­çš„matchæ–¹æ³•ï¼šæŠŠæ‰€æœ‰å’Œæ­£åˆ™åŒ¹é…çš„å­—ç¬¦ä¸²éƒ½ä¸€æ¬¡æ•è·åˆ°

```javascript
var reg = /\d+?/g
var str = "s2017z06z08"
console.log(str.match(reg))
```

- `match`çš„å‘ç‚¹ï¼šåœ¨åˆ†ç»„æ•è·çš„æƒ…å†µä¸‹ï¼Œ`match`åªèƒ½æ•è·åˆ°å¤§æ­£åˆ™åŒ¹é…çš„å†…å®¹ï¼Œè€Œå¯¹å°æ­£åˆ™æ•è·çš„å†…å®¹æ˜¯æ— æ³•æ•è·çš„

----------

### è¯¾æ—¶42ï¼šåˆ†ç»„æ•è·

- æ­£åˆ™åˆ†ç»„çš„ä½œç”¨ï¼š
  - æ”¹å˜ä¼˜å…ˆçº§
  - åˆ†ç»„å¼•ç”¨

```javascript
// ä¸‹ä¾‹ä¸­çš„ \2 ä»£è¡¨å’Œç¬¬äºŒä¸ªåˆ†ç»„å‡ºç°ä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼Œè¿™é‡Œçš„ä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼šå…ˆè¦åŒ¹é…åˆ†ç»„çš„æ­£åˆ™å†è¦å’Œå…¶æ–‡æœ¬å†…å®¹ä¹Ÿä¸€æ ·
var reg = /^(\w)\1(\w)\2$/
console.log(reg.test("sszz")) // -> true
console.log(reg.test("ssz_")) // -> flase
```

- åˆ†ç»„æ•è·ï¼šæ­£åˆ™åœ¨æ•è·çš„æ—¶å€™ï¼Œä¸ä»…ä»…æŠŠå¤§æ­£åˆ™åŒ¹é…çš„å†…å®¹æ•è·ï¼Œè€Œä¸”è¿˜å¯ä»¥æŠŠå°åˆ†ç»„åŒ¹é…çš„å†…å®¹ä¹Ÿæ•è·åˆ°

```javascript
// ä¸­å›½èº«ä»½è¯éªŒè¯çš„æ­£åˆ™(ç®€å•ç‰ˆ)
// 53 3321 1988 08 08 00 5 0
var reg = /^([1-9]\d)(\d{4})([1-2]\d{3})(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[0-1]])(\d{2})(\d)([0-9|X])$/
var str = "533321198808080050"
console.log(reg.exec(str)) //  ["533321198808080050", "53", "3321", "1988", "08", "08", "00", "5", "0", index: 0, input: "533321198808080050"]

var reg0 = /^([1-9]\d)(\d{4})([1-2]\d{3})(0[1-9]|1[0-2])(0[1-9]|[1-2]\d|3[0-1]])(?:\d{2})(\d)(?:[0-9|X])$/
console.log(reg0.exec(str)) // ["533321198808080050", "53", "3321", "1988", "08", "08", "5", index: 0, input: "533321198808080050"]
// é€šè¿‡`?:`æˆ‘ä»¬åªæ•è· çœ å…·ä½“å¿åŒºä¹¡é•‡ å‡ºç”Ÿå¹´ æœˆ æ—¥ æ€§åˆ«ï¼Œè¿‡æ»¤äº†åºå·å’Œæ ¡éªŒä½
/////////////////////////////////////////////////////////////
var reg = /shi(\d+)/g
var str = "shi123shi444"
// æ‰§è¡Œexecæ•è·ä¸‰æ¬¡ï¼Œæ¯æ¬¡ä¸ä»…ä»…æŠŠå¤§æ­£åˆ™åŒ¹é…çš„å†…å®¹æ•è·åˆ°ï¼Œè¿˜æŠŠå¸¦ä¸ªåˆ†ç»„çš„å°æ­£åˆ™ä¹ŸåŒ¹é…æ•è·åˆ°
console.log(reg.exec(str)) // ["shi123", "123", index: 0, ...]
console.log(reg.exec(str)) // ["shi444", "444", index: 6, ...]
// è€Œä½¿ç”¨String.prototype.matchæ•è·çš„ä»…ä»…æœ‰å¤§æ­£åˆ™æ‰€åŒ¹é…çš„å†…å®¹ï¼Œæ²¡æœ‰åˆ†ç»„å°æ­£åˆ™ã€‚
console.log(str.match(reg)) // ["shi123", "shi444"]
```

----------

### è¯¾æ—¶43ï¼šreplace

- String.prototype.replaceæ–¹æ³•å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå­—ç¬¦ä¸²æ—¶
  - é¦–å…ˆå’Œexecæ•è·ä¸€æ ·ï¼ŒæŠŠæ‰€æœ‰å’Œæˆ‘ä»¬æ­£åˆ™åŒ¹é…çš„å†…å®¹éƒ½æ•è·çš„ï¼Œç„¶åæŠŠæ•è·çš„å†…å®¹æ›¿æ¢æˆç¬¬äºŒä¸ªå‚æ•°çš„å­—ç¬¦ä¸²
  - `/jerry/g`æŒ‰ç…§è¿™ä¸ªæ­£åˆ™æŠŠå­—ç¬¦ä¸²ä¸­æ‰€æœ‰å¯ä»¥åŒ¹é…çš„å†…å®¹å…¨éƒ¨åŒ¹é…ï¼Œç„¶åç»Ÿä¸€éƒ½æ›¿æ¢æˆæˆ‘ä»¬çš„æ–°å†…å®¹

- String.prototype.replaceæ–¹æ³•å½“ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ­£åˆ™ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºå‡½æ•°æ—¶
  - ç¬¬äºŒä¸ªå‚æ•°çš„åŒ¿åå‡½æ•°æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œå–å†³äºæ­£åˆ™èƒ½åœ¨å­—ç¬¦ä¸²ä¸­æ•è·å¤šå°‘æ¬¡
  - æ¯ä¸€æ¬¡æ‰§è¡ŒåŒ¿åå‡½æ•°ï¼Œé‡Œé¢æ‰€ä¼ å…¥çš„å‚æ•°argumentsä¸ºæ•°ç»„ï¼Œå’Œæ­£åˆ™çš„execæ–¹æ³•æ•è·çš„è¿”å›å€¼éå¸¸ç±»ä¼¼ï¼ˆå³ä½¿æ­£åˆ™æœ‰åˆ†ç»„ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡argumentsè·å–åˆ†ç»„æ•è·çš„å†…å®¹ï¼‰
  - return è¿”å›æ‰€æ›¿æ¢æˆçš„æ–°æ–‡æœ¬ï¼Œå°±ç›¸å½“äºä½ æŠŠå½“å‰è¿™æ¬¡å¤§æ­£åˆ™æ‰€æ•è·çš„å†…å®¹æ›¿æ¢çš„æ–°å†…å®¹

```javascript
var str = '20170608'
var ary = ['é›¶','å£¹','è´°','å','è‚†','ä¼','é™†','æŸ’','æŒ','ç–']
str = str.replace(/\d/g, function (arr) {
  return ary[arr[0]]
})
console.log(str)
```

----------

### è¯¾æ—¶45ï¼šæ›´å¤šrepalceçš„æ¡ˆä¾‹

æ­£åˆ™çš„æ•è·ï¼šæ­£åˆ™çš„execæ–¹æ³•ã€å­—ç¬¦ä¸²çš„matchæ–¹æ³•ã€å­—ç¬¦ä¸²çš„repalceæ–¹æ³•

```javascript
// ç»ƒä¹ ï¼šç»Ÿè®¡å­—ç¬¦ä¸²ä¸­å‡ºç°æœ€å¤šæ¬¡æ•°çš„å­—ç¬¦
var str = "jerryshijavascriptnodejssequelize"
// 1ã€è·å–æ¯ä¸€ä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°
var res = {}
str.replace(/[a-z]/gi, function (arr) {
  var val = arr[0]
  res[val] ? res[val] += 1 : res[val] = 1
  return val
}) // res -> Object {j: 3, e: 5, r: 3, y: 1, s: 4â€¦}

// 2ã€è·å–æœ€å¤šå‡ºç°æ¬¡æ•°çš„å­—ç¬¦ï¼Œä¸€ä¸ªï¼
var maxNum = 0
for (var k in res) {
  res[k] > maxNum ? maxNum = res[k] : null
}

// 3ã€è€ƒè™‘æœ€å¤§å‡ºç°æ¬¡æ•°ç›¸åŒæƒ…å†µ
var ary = []
for (var k in res) {
  res[k] === maxNum ?ary.push(k) : null
}

// 4ã€è¾“å‡ºç»“æœ
console.log("å­—ç¬¦ä¸²("+ str +")ä¸­å‡ºç°æ¬¡æ•°æœ€å¤šçš„å­—ç¬¦æ˜¯ï¼š" + ary.toString() + "ï¼Œå…±è®¡å‡ºç°äº†' + maxNum + 'æ¬¡ã€‚")

//////////////////////////////////////////
// æ¨¡æ¿å¼•æ“å®ç°çš„åˆæ­¥åŸç†~
var str = "My name is {0}, my age is {1}, i come from {2}, i love {3}"
var ary = ["Jerry", 20, "Yunnan", "Javscript"]
str.replace(/{(\d+)}/g, function (args) {
  return ary[args[1]] //è¿™é‡Œéå¸¸å·§å¦™ï¼Œargs[0]æ˜¯æ•´ä¸ªå¤§æ­£åˆ™åŒ¹é…çš„ç»“æœ{x}ï¼Œè€Œæˆ‘ä»¬ç”¨åˆ†ç»„å°æ­£åˆ™æŠŠä¸­æ‹¬å·é‡Œçš„æ•°å­—ç»™åŒ¹é…åˆ°ï¼Œåˆ™è®¿é—®æ—¶ç”¨args[1]è®¿é—®ç¬¬ä¸€ä¸ªåˆ†ç»„å°æ­£åˆ™çš„æ•è·å†…å®¹
})
```

- æ€è€ƒé¢˜
  - â€œ2017-06-18 23:06:33â€ -> "2017å¹´6æœˆ18æ—¥ 23æ—¶6åˆ†33ç§’"
  - æŠŠè¾“å…¥å­—ç¬¦ä¸²çš„é¦–å­—æ¯å¤§å†™ "jerry shi" -> "Jerry Shi"

```javascript
// æŠŠè¾“å…¥å­—ç¬¦ä¸²çš„é¦–å­—æ¯å¤§å†™ "jerry shi" -> "Jerry Shi"
var str = "i am jerry shi"
var reg = /\b([a-z])[a-z]{0,}/g
str = str.replace(reg, function () {
  return arguments[0].replace(/[a-z]/, arguments[1].toUpperCase())
})
// è§£é¢˜æ€è·¯ï¼š
// 1.è®©ç³»ç»Ÿè‡ªå®šå¸®æˆ‘ä»¬è®¤å‡ºå•è¯è¾¹ç•Œï¼Œå³ä½¿ç”¨è¾¹ç•Œç¬¦\b
// 2.ç”¨å°æ‹¬å·åˆ†ç»„å°æ­£åˆ™åŒ¹é…å‡ºè¦æ›¿æ¢çš„é¦–å­—ç¬¦
// 3.å¤§æ­£åˆ™åé¢éƒ¨åˆ†åŒ¹é…é¦–å­—æ¯åå¯ä»¥æœ‰å­—æ¯ä¹Ÿå¯ä»¥æ²¡æœ‰ï¼Œå³[a-z]{0,}
// 4.åœ¨ç¬¬ä¸€æ¬¡replaceçš„callbackä¸­ï¼Œæ˜¯åŒ¹é…åˆ°äº†é¦–å­—æ¯ï¼Œä½†å¤§æ­£åˆ™æ˜¯åŒ¹é…æ•´ä¸ªå•è¯ï¼Œæ‰€ä»¥è¿˜éœ€è¦å¯¹æ•´ä¸ªå•è¯çš„é¦–å­—æ¯åŒ¹é…æ›¿æ¢
```

```javascript
var str = "2017-06-18 23:06:33"
var reg = /\b[-: ]/g
var ary1 = ['å¹´','æœˆ','æ—¥ ','æ—¶','åˆ†']
var i = 0
str = str.replace(reg, function () {
  return ary1[i++]
}).replace(/\d$/, function () { return arguments[0] + 'ç§’' })
// è§£é¢˜æ€è·¯ï¼š
//1.é¦–å…ˆæˆ‘ä»¬å¾—æ˜ç¡®å…·ä½“è¦æ›¿æ¢çš„æ˜¯-ã€ç©ºæ ¼ã€ï¼šå’Œæœ€åä¸€ä¸ªå­—ç¬¦
//2.æˆ–è€…ç¬¬ä¸€æ¬¡æ­£åˆ™åŒ¹é…-ã€ç©ºæ ¼å’Œï¼šï¼Œåœ¨ç©ºæ ¼æ˜¯éœ€ç‰¹æ®Šå¤„ç†
//3.æœ€åç§’é‚£é‡Œåœ¨æ¥ä¸€æ¬¡æ­£åˆ™ï¼Œä½¿ç”¨$åŒ¹é…åˆ°æœ€åä¸€ä¸ªå­—ç¬¦
```

```javascript
// ç»ƒä¹ é¢˜ï¼šè·å–URLä¸­çš„parameters
var str = 'https://kbs.sports.qq.com/kbsweb/game.htm?mid=10000&cid=1467086&app=1.0'
var reg = /(\w+)=(\w+)/g //  è¿™ä¸ªæ­£åˆ™æˆ‘å†™çš„ï¼Œå°±è§„åˆ™åªè¦0-9a-Z_
var paraObj = {}
str.replace(reg, function () {
  paraObj[arguments[1]] = arguments[2]
  return arguments[0]
})
var reg1 = /([^=?&]+)=([^=?&]+)/g // è€å¸ˆå†™çš„ï¼Œå¥½è¯¡å¼‚ï¼Œä¸æ¥å—ï¼
var res1 = reg1.exec(str)
while (res1) {
  paraObj[res1[1]] = res1[2] // åˆ†è´åˆ†ç»„æ•è·çš„æ–‡æœ¬ 
  res1 = reg1.exec(str)
} // Object {mid: "10000", cid: "1467086", app: "1.0"}
```
