# ç å³°å‰ç«¯å…¨æ ˆåŸ¹è®­ç¬¬äº”å‘¨ï¼šdomé›¶çº§ã€äºŒçº§äº‹ä»¶åŸºç¡€å’Œå®æˆ˜

[TOC]

----------

## è¯¾æ—¶104ï¼šä»€ä¹ˆæ˜¯äº‹ä»¶

- ä»€ä¹ˆæ˜¯äº‹ä»¶?
  1. è¡Œä¸ºæœ¬èº«ï¼šæµè§ˆå™¨å¤©ç”Ÿå°±èµ‹äºˆå…¶çš„è¡Œä¸ºï¼Œä¾‹å¦‚`onclick`, `onmouseover(onmouseenter)`, `onmouseout(onmouseleave)`, `onmousemove`, `onmousedown`, `onmouseup`, `onmousewheel`(é¼ æ ‡æ»šè½®æ»šåŠ¨è¡Œä¸º), `onscroll`
  2. äº‹ä»¶ç»‘å®šï¼šç»™å…ƒç´ çš„æŸä¸€ä¸ªè¡Œä¸ºç»‘å®šæ–¹æ³•
 

```javascript
var oDiv = document.getElementById("#box");

// onclickè¿™ä¸ªè¡Œä¸ºå®šä¹‰åœ¨å½“å‰å…ƒç´ çš„ç§æœ‰å±æ€§ä¸Š
// æˆ‘ä»¬ç§°ä¹‹ä¸ºDOM 0çº§äº‹ä»¶ç»‘å®š
oDiv.onclick = function handler () { ... };

// addEventListenerè¿™ä¸ªå±æ€§åˆ™å®šä¹‰åœ¨"EventTarget"è¿™ä¸ªæ¥å£ä¸Šï¼Œæ”¾åœ¨è¯¥å…ƒç´ çš„åŸå‹é“¾ä¸Š
// æˆ‘ä»¬ç§°ä¹‹ä¸ºDOM 2çº§äº‹ä»¶ç»‘å®š
oDiv.addEventListener("click", handler);
```

- å…³äºä¸ºä»€ä¹ˆæ²¡æœ‰DOM 1çº§äº‹ä»¶ï¼š å¾ˆä¹…ä»¥å‰ï¼ŒDOMåˆšå¼€å‘æ—¶ï¼Œç‰ˆæœ¬ä¸º0çº§ï¼Œåæ¥åˆè¿›è¡Œäº†ä¸€æ¬¡å‡çº§å‡çº§åˆ°1çº§ï¼Œä½†è¿™æ¬¡å‡çº§å¹¶æ²¡æœ‰æ›´æ–°DOMäº‹ä»¶ï¼Œåæ¥å†æ¬¡å‡çº§åˆ°DOM 2çº§æ—¶ï¼ŒDOMäº‹ä»¶å¾—åˆ°äº†æ›´æ–°å°±æœ‰äº†DOM2çº§äº‹ä»¶ç»‘å®šã€‚


----------

## è¯¾æ—¶105ï¼šäº‹ä»¶å¯¹è±¡åŠå…¼å®¹å¤„ç†

```javascript
// è¡¨ç¤ºæˆ‘ä»¬æŠŠåŒ¿åå‡½æ•°å®šä¹‰çš„éƒ¨åˆ†å½“åšä¸€ä¸ªå€¼èµ‹å€¼ç»™äº†oDivçš„ç‚¹å‡»è¡Œä¸º(å‡½æ•°è¡¨è¾¾å¼)
oDiv.onclick = function (mouseEvent) { ... }
// å½“æˆ‘ä»¬è§¦å‘#divçš„ç‚¹å‡»è¡Œä¸ºæ—¶ï¼Œä¼šæ‰§è¡Œå¯¹åº”ç»‘å®šä¸Šçš„æ–¹æ³•
// â˜…é‡è¦ï¼šä¸ä»…ä»…æŠŠç»‘å®šçš„æ–¹æ³•æ‰§è¡Œäº†ï¼Œè€Œä¸”æµè§ˆå™¨è¿˜é»˜è®¤çš„ç»™è¿™ä¸ªæ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªå‚æ•° --> MouseEventï¼šé¼ æ ‡äº‹ä»¶å¯¹è±¡
//   1. å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡æ•°æ®ç±»å‹å€¼ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šå±æ€§åå’Œå±æ€§å€¼ï¼Œè¿™äº›éƒ½æ˜¯ç”¨æ¥è®°å½•å½“å‰é¼ æ ‡çš„ç›¸å…³ä¿¡æ¯
//   2. MouseEventçš„åŸå‹é“¾ï¼šMouseEvent -> UIEvent -> Event -> Object
//   3. MouseEventè®°å½•çš„æ˜¯é¡µé¢ä¸­å”¯ä¸€ä¸€ä¸ªé¼ æ ‡æ¯æ¬¡è§¦å‘æ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå’Œåˆ°åº•æ˜¯åœ¨å“ªä¸ªå…ƒç´ ä¸Šè§¦å‘çš„æ²¡å…³ç³»
```

**å…³äºäº‹ä»¶å¯¹è±¡MouseEventçš„å…¼å®¹é—®é¢˜**
```javascript
oDiv.onclick = function (e) {
  // åœ¨éæ ‡å‡†æµè§ˆå™¨(IE6~8)ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å»window.eventä¸Šè·å–ã€‚
  e = e || window.event;
  e.target = e.target || e.srcElement
  e.pageX = e.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft)
  e.pageY = e.clientY + (document.documentElement.scrollTop || document.body.scrollTop)
  e.preventDefault ? e.preventDefault() : e.returnValue=false
  // é˜»æ­¢é»˜è®¤è¡Œä¸ºå¯ä»¥ç›´æ¥ç”¨return falseï¼
  // æ›´å¯ä»¥åœ¨htmläº‹ä»¶ä»£ç ä¸­ç›´æ¥åŠ "javascript:;"æˆ–è€…"javascript: void 0;"æˆ–è€…"javascript: viod 1;"
  
  // e.stopPropagation é˜»æ­¢äº‹ä»¶çš„å†’æ³¡ä¼ æ’­ï¼Œåœ¨IE6~8ä¸­ä¸å…¼å®¹ï¼Œä½¿ç”¨e.cancelBubble=trueå…¼å®¹å¤„ç†
  e.stopPropagation ? e.stopPropagation() : e.cancelBubble=true
}
  // e.typeï¼šå½“å‰é¼ æ ‡è§¦å‘çš„è¡Œä¸ºç±»å‹ â€œclickâ€ ...
  // e.clientX/e.clientYï¼šå½“å‰é¼ æ ‡è§¦å‘ç‚¹æ‰€è·ç¦»å½“å‰æµè§ˆå™¨å±å¹•(viewport,è§†å£)å·¦ä¸Šè§’çš„xè½´å’Œyè½´çš„åæ ‡å€¼
  // e.targetï¼šäº‹ä»¶æºï¼Œå½“å‰é¼ æ ‡è§¦å‘çš„æ˜¯å“ªä¸ªå…ƒç´ 
  // e.pageX/e.pageYï¼šå½“å‰é¼ æ ‡è§¦å‘ç‚¹æ‰€è·ç¦»bodyå·¦ä¸Šè§’çš„x/yè½´çš„åæ ‡ï¼Œä½†é—®é¢˜æ˜¯åœ¨IE6~8ä¸‹ä¸å…¼å®¹ï¼Œå¤„ç†åŠæ³•ä¸ºä½¿ç”¨clientX/Y+æ»šåŠ¨æ¡å·æ›²çš„é«˜åº¦æˆ–å®½åº¦å³å¯
  // e.preventDefault: é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸ºï¼Œä½†é—®é¢˜æ˜¯IE6~8ä¸­ä¸å…¼å®¹ï¼Œä½¿ç”¨e.returnValue=falseè§£å†³å…¼å®¹é—®é¢˜
  
  // KeyboardEvent é”®ç›˜äº‹ä»¶å¯¹è±¡
  // e.keyCodeï¼šå½“å‰é”®ç›˜ä¸Šæ¯ä¸€ä¸ªé”®å¯¹åº”çš„å€¼
  // ç©ºæ ¼é”®(space)->32 , é€€å›é”®(Backspace)->8 , å›è½¦é”®(Enter)->13 , åˆ é™¤é”®(Del)->46
```

----------

## è¯¾æ—¶106ï¼šäº‹ä»¶çš„ä¼ æ’­æœºåˆ¶

- äº‹ä»¶çš„é»˜è®¤ä¼ æ’­æœºåˆ¶ï¼š
  - æ•è·é˜¶æ®µï¼šä»å¤–å‘å†…ä¾æ¬¡æŸ¥æ‰¾å…ƒç´ 
  - ç›®æ ‡é˜¶æ®µï¼šå½“å‰äº‹ä»¶æºæœ¬èº«çš„æ“ä½œ
  - å†’æ³¡é˜¶æ®µï¼šä»å†…åˆ°å¤–ä¾æ¬¡è§¦å‘ç›¸å…³çš„è¡Œä¸º
  
- ä½¿ç”¨DOM-0çº§äº‹ä»¶ç»™å…ƒç´ çš„æŸä¸€ä¸ªè¡Œä¸ºç»‘å®šçš„æ–¹æ³•ï¼Œéƒ½æ˜¯åœ¨è¡Œä¸ºè§¦å‘åçš„å†’æ³¡é˜¶æ®µæ‰å»æ‰§è¡Œæ–¹æ³•

- å› ä¸ºç”±æ•è·é˜¶æ®µæˆ–å†’æ³¡é˜¶æ®µæˆ–ç›®æ ‡é˜¶æ®µè§¦å‘æ˜¯çš„äº‹ä»¶å¯¹è±¡å…¨éƒ½æ˜¯ç›¸ç­‰çš„


----------

## è¯¾æ—¶107ï¼šæ¡ˆä¾‹ä¹‹é¼ æ ‡è·Ÿéš(jQueryç‰ˆ)

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson107</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        .box {
            position: relative;
            width: 598px; /*å›¾ç‰‡140*4=560 å·¦å³è¾¹æ¡†2*4 margin-right:10*3 = 598 + æœ€åä¸€ä¸ªæ— ç”¨çš„margin-right=608 */
            height: 98px; /*ä¸Šä¸‹è¾¹æ¡†2 å›¾ç‰‡75 margin-top:10 margin-bottom:10 = 98*/
            margin: 50px auto;
            border: 1px dashed darkgray;
        }

        .box .content {
            position: absolute;
            /*width: 100%;*/ /*åƒä¸‡åˆ«è®¾100%ï¼Œè‡ªé€‚åº”ï¼Œå¼Ÿå¼Ÿå¯ä»¥è¶…è¿‡å“¥å“¥*/
            /*height: 100%;*/
            margin-right: -20px; /*å“‡å“ˆå“ˆ~è´Ÿè¾¹è·åº”ç”¨äº†ï¼ŒæˆåŠŸæ”¾å¤§äº†contentå…ƒç´ ï¼*/
            overflow: hidden;
        }

        .box img { /* 140*75 */
            float: left;
            margin: 10px 10px 10px 0;
            border: 1px solid red;
        }

        .mask {
            display: none;
            position: absolute;
            left: 0;
            top: 0;
            width: 522px; /*åŸå§‹å›¾ç‰‡ä¸º520*280ï¼Œä½†æˆ‘ä¸Šä¸‹å’Œå·¦å³åˆ†åˆ«åŠ äº†è¾¹æ¡†ï¼Œæ‰€ä»¥å„åŠ 2*/
            height: 282px;
            border: 1px solid lightgray;
            background: no-repeat center center;
        }
    </style>
</head>
<body>
<div id="box" class="box">
    <div id="content" class="content">
        <img src="./imgs/i01s.jpg" bigsrc="./imgs/i01.jpg" alt="1">
        <img src="./imgs/i02s.jpg" bigsrc="./imgs/i02.jpg" alt="2">
        <img src="./imgs/i03s.jpg" bigsrc="./imgs/i03.jpg" alt="3">
        <img src="./imgs/i04s.jpg" bigsrc="./imgs/i04.jpg" alt="4">
    </div>
    <div class="mask" id="mask"></div>
</div>
<script src="../jquery-1.12.4.js" type="text/javascript"></script>
<script type="text/javascript">
  $(function () {
    var boxOffet = $('#box').offset(),
        $imgs = $('img'),
        $mask = $('#mask');

    $imgs.mouseenter(function (e) {
      $mask
        .css("background-image", 'url("' + this.getAttribute("bigsrc") + '")')
        .finish()
        .fadeIn(400)
        .css({ //è¿™é‡Œä¸èƒ½æ‹¿imgçš„offsetè®¾ç½®å•Šï¼Œå› ä¸ºmaskæ˜¯æ ¹æ®boxå®šä½ï¼Œæ‰€ä»¥æ‹¿boxçš„offsetç»å¯¹è·ç¦»å³å¯ï¼
          left: e.clientX - boxOffet.left + 10,
          top: e.clientY - boxOffet.top + 10
        });
    });

    $imgs.mouseleave(function (e) {
      $mask
        .finish()
        .fadeOut(200);
    });

    $imgs.mousemove(function (e) {
      $mask
        .css({
          left: e.clientX - boxOffet.left + 10,
          top: e.clientY - boxOffet.top + 10
        });
    });
  })
</script>
</body>
</html>
```

> è‡ªå·±å‘è‡ªå·±å•Šï¼Œå†™é¡¹ç›®æ—¶å¤´è„‘è¦æ¸…æ™°ï¼æ˜¨æ™šå„¿å­æäº‹æƒ…ï¼Œ05ç‚¹æ‰ç¡ç€ï¼Œä¹Ÿæ˜¯æ²¡æ³•ğŸ˜£
  å½“ç„¶ä¹Ÿç©äº†ä¸ªè´Ÿè¾¹è·â€œæ”¾å¤§â€å¸ƒå±€!!å¥½ç©!!

- é¡¹ç›®é‡Œmaskæ˜¯æ ¹æ®boxå®šä½çš„ï¼Œæ‰€ä»¥åœ¨è®¡ç®—å…¶topå’Œleftæ—¶ï¼Œå› ç”¨`e.clientX - box.offset().left + 10px`ï¼Œè€Œä¸èƒ½æ˜¯`e.clientX - $(this).offset().left + 10`ã€‚

![zf-lesson107.png-35.4kB][1]

----------

## è¯¾æ—¶108ï¼šæ¡ˆä¾‹ä¹‹é¼ æ ‡è·Ÿéš(åŸç”Ÿjsç‰ˆ)

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson108_VanillaJS</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        .container {
            position: relative;
            height: 402px;
            width: 402px;
            margin: 100px auto;
            border: 2px dashed red;
            background: lightgray;
        }

        .container .box {
            display: none;
            position: absolute;
            background: green;
            height: 100px;
            width: 100px;
            top: 410px;
            left: 410px;
        }
    </style>
</head>
<body>
<!--æŒ–å‘ç¬¬ä¸€æ­¥ï¼šæ•…æ„æŠŠboxæ”¾åœ¨å®¹å™¨é‡Œï¼Œå¢åŠ éš¾åº¦ï¼Œä¸ºäº†ç†è§£æ—¶é—´çš„ä¼ æ’­æœºåˆ¶ã€‚-->
<div id="container" class="container">
    <div class="box" id="box"></div>
</div>
<script type="text/javascript">
  var cta = document.getElementById("container"),
    box = document.getElementById("box");
  //æŒ–å‘ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨mouseoverå’Œmouseoutäº‹ä»¶è§¦å‘è¡Œä¸º
  //    cta.addEventListener('mouseover', function (e) {
  //      e = e || window.event;
  //      e.target = e.target || e.srcElement;
  //      box.style.display = 'block';
  //      box.style.left = e.clientX - cta.offsetLeft + 6 + 'px';
  //      box.style.top = e.clientY - cta.offsetTop + 10 + 'px';
  //    }, false);
  //
  //    cta.addEventListener('mousemove', function (e) {
  //      e = e || window.event;
  //      e.target = e.target || e.srcElement;
  //      box.style.left = e.clientX - cta.offsetLeft + 6 + 'px';
  //      box.style.top = e.clientY - cta.offsetTop + 10 + 'px';
  //    }, false);
  //
  //    cta.addEventListener('mouseout', function () {
  //      box.style.display = 'none';
  //    }, false);
  
  // ä¸ºä»€ä¹ˆæˆ‘æ²¡é‡åˆ°å‘¨è€å¸ˆè®²çš„å‘å‘¢ï¼Œå¥‡æ€ªå•Šï¼Œå„ç§åŠæ³•éƒ½è¯•äº†ã€‚
  // æˆ‘æ˜ç™½äº†ï¼ŒåŸæ¥ä»–ç”¨çš„æ˜¯äº‹ä»¶å‡½æ•°é‡Œç”¨çš„æ˜¯"this"ï¼Œå¦‚æœé‚£å°±å¤æ‚äº†ã€‚
  // å¦‚æœä½ thisæ˜¯containerè¿˜å¥½ï¼Œå¦‚æœæ˜¯boxé‚£å°±å†’æ³¡äº†ã€‚
  //  cta.onmouseover = function (e) {
  //    e = e || window.event;
  //    e.target = e.target || e.srcElement;
  //    box.style.display = 'block';
  //    box.style.left = e.clientX - cta.offsetLeft + 6 + 'px';
  //    box.style.top = e.clientY - cta.offsetTop + 10 + 'px';
  //  };
  //
  //  cta.onmousemove = function (e) {
  //    e = e || window.event;
  //    e.target = e.target || e.srcElement;
  //    box.style.left = e.clientX - cta.offsetLeft + 6 + 'px';
  //    box.style.top = e.clientY - cta.offsetTop + 10 + 'px';
  //  };
  //
  //  cta.onmouseout = function (e) {
  //    box.style.display = 'none';
  //  }
  
  // æˆ‘æ‰¿è®¤ï¼Œæˆ‘è¯•äº†ä¸‰éï¼Œç¡¬æ˜¯æ²¡æŠŠå‘è¯•å‡ºæ¥ï¼Œæ˜¯ä¸æ˜¯æˆ‘åŸºç¡€å¤ªå¥½äº†å•Š~~
  //  cta.onmouseover = function (e) {
  //    e = e || window.event;
  //    e.target = e.target || e.srcElement;
  //    box.style.display = 'block';
  //    box.style.left = e.clientX - this.offsetLeft + 6 + 'px';
  //    box.style.top = e.clientY - this.offsetTop + 10 + 'px';
  //  };// è¿™å°¼ç›æ°¸è¿œä¹Ÿæ˜¯containerå•Šï¼Œä¸ä¼šå‡ºæ¥å‘¨è€å¸ˆçš„å‘å˜›ï¼Œå“ï¼Œæ‰¾ä¸ªå‘è·³ä¹Ÿé‚£ä¹ˆéº»çƒ¦ï¼Œç½¢äº†ã€‚
  //
  //  cta.onmousemove = function (e) {
  //    console.dir(this);
  //    e = e || window.event;
  //    e.target = e.target || e.srcElement;
  //    box.style.left = e.clientX - this.offsetLeft + 6 + 'px';
  //    box.style.top = e.clientY - this.offsetTop + 10 + 'px';
  //  };
  //
  //  cta.onmouseout = function (e) {
  //    box.style.display = 'none';
  //  }
  
  // ç¬¬å››éï¼Œä½¿ç”¨mouseenterå’Œmouseleaveä»£æ›¿ï¼Œåº”ä¸ºè¿™ä¸¤è´§åœ¨MDNæ–‡æ¡£ä¸­ä¸¥é‡æ ‡æ˜ä¸æ”¯æŒå†’æ³¡æœºåˆ¶ï¼æ¬§è€¶~
  cta.onmouseover = function (e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    box.style.display = 'block';
    box.style.left = e.clientX - this.offsetLeft + 6 + 'px';
    box.style.top = e.clientY - this.offsetTop + 10 + 'px';
  };// è¿™å°¼ç›æ°¸è¿œä¹Ÿæ˜¯containerå•Šï¼Œä¸ä¼šå‡ºæ¥å‘¨è€å¸ˆçš„å‘å˜›ï¼Œå“ï¼Œæ‰¾ä¸ªå‘è·³ä¹Ÿé‚£ä¹ˆéº»çƒ¦ï¼Œç½¢äº†ã€‚
  
  cta.onmousemove = function (e) {
    console.dir(this);
    e = e || window.event;
    e.target = e.target || e.srcElement;
    box.style.left = e.clientX - this.offsetLeft + 6 + 'px';
    box.style.top = e.clientY - this.offsetTop + 10 + 'px';
  };
  
  cta.onmouseout = function (e) {
    box.style.display = 'none';
  }
</script>
</body>
</html>
```

> æˆ‘è¾“äº†ï¼Œè¯•äº†å››éï¼Œç¡¬æ˜¯æ²¡æ‰¾åˆ°å‘è·³è¿›å»å•ŠğŸ˜‚

- `mouseenter`å’Œ`mouseover` ã€`mouseleave`å’Œ`mouseout`çš„æœ¬è´¨åŒºåˆ«ï¼š`mouseenter`å’Œ`mouseleave`è¿™ä¸¤ä¸ªäº‹ä»¶éƒ½æ˜¯é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œè€Œ`mouseover`å’Œ`mouseout`åˆ™ä¸é˜»æ­¢äº‹ä»¶å†’æ³¡ã€‚é˜»æ­¢è¡Œä¸ºå†’æ³¡ä¼ æ’­çš„å¥½å¤„åœ¨äºå½“è§¦å‘å­å…ƒç´ çš„æŸä¸ªè¡Œä¸ºæ—¶ï¼Œå¯¼è‡´çˆ¶å…ƒç´ çš„è¯¥è¡Œä¸ºä¹Ÿè¢«è§¦å‘ã€‚

----------

## è¯¾æ—¶109ï¼šé¼ æ ‡è·Ÿéš æ·±å…¥ç†è§£äº‹ä»¶çš„ä¼ æ’­æœºåˆ¶

```javascript
<script type="text/javascript">
  var box = document.getElementById("box"),
    inner = document.getElementById("inner");

  //    box.onmouseover = function () {
  //      inner.style.display = "block";
  //    };
  //
  //    box.onmouseout = function () {
  //      inner.style.display = "none";
  //    };

  // å‡çº§ç»‘å®šè¡Œä¸ºï¼Œå–æ¶ˆäº‹ä»¶çš„å†’æ³¡ä¼ é€’ï¼
  box.onmouseenter = function () {
    inner.style.display = "block";
  }

  box.onmouseleave = function () {
    inner.style.display = "none";
  }
</script>
```

> ä½¿ç”¨åœ°çƒæœ€å¿«çš„Vanilla.jsæ¡†æ¶å®ç°lesson107æ•ˆæœ

```javascript
<script type="text/javascript">
  var cta = document.getElementById('container'),
    box = document.getElementById('box'),
    mask = document.getElementById('mask'),
    imgList = box.getElementsByTagName('img');
  // boxè·ç¦»bodyçš„è·ç¦»ï¼Œä¸­é—´åŒ…äº†ä¸ªcontainerï¼Œæ‰‹å·¥ç®—å§ã€‚
  // ç®—äº†éƒ½æ˜¯æ ¹æ®containerå®šä½ï¼Œä¸è®¸ç®—ä¸¤é“äº†ï¼Œæ²¡æ„æ€ã€‚
  var ctaOffsetLeft = cta.offsetLeft,
    ctaOffsetTop = cta.offsetTop;

  function handleMouseEnter(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    mask.style.backgroundImage = 'url("' + this.getAttribute("bigsrc") + '")';
    mask.style.display = 'block';
    mask.style.left = e.clientX - ctaOffsetLeft + 10 + 'px';
    mask.style.top = e.clientY - ctaOffsetTop + 10 + 'px';
  }

  function handleMousemove(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    mask.style.left = e.clientX - ctaOffsetLeft + 10 + 'px';
    mask.style.top = e.clientY - ctaOffsetTop + 10 + 'px';
  }

  function handleMouseLeave() {
    mask.style.display = 'none';
  }

  for (var i = 0, len = imgList.length; i < len; i++) {
    // å…¶å®è¿™é‡Œå¯ä»¥ç”¨æ•è·æ¥ä¼˜åŒ–ï¼Œç›´æ¥ç»‘å®šåœ¨boxä¸Šå³å¯ï¼Œç¬¬äºŒç‰ˆæœ¬å†ä¼˜åŒ–ã€‚
    imgList[i].addEventListener('mouseenter', handleMouseEnter, false);
    imgList[i].addEventListener('mousemove', handleMousemove, false);
    imgList[i].addEventListener('mouseleave', handleMouseLeave, false);
  }
</script>
```

----------

## è¯¾æ—¶110ï¼šäº‹ä»¶å§”æ‰˜ äº‹ä»¶ä»£ç†

- ä»€ä¹ˆå«äº‹ä»¶å§”æ‰˜/äº‹ä»¶ä»£ç†ï¼Ÿåˆ©ç”¨äº‹ä»¶çš„å†’æ³¡ä¼ æ’­æœºåˆ¶ï¼ˆè§¦å‘å½“å‰å…ƒç´ çš„æŸé¡¹è¡Œä¸ºï¼Œå®ƒçˆ¸çˆ¸çˆ·çˆ·ç¥–å®—åå…«ä»£å…ƒç´ çš„ç›¸å…³è¡Œä¸ºéƒ½ä¼šè¢«è§¦å‘ï¼‰ï¼›å¦‚æœä¸€ä¸ªå®¹å™¨é‡Œæœ‰å¾ˆå¤šå…ƒç´ éƒ½è¦ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œæˆ‘ä»¬æ²¡å¿…è¦æ¯ä¸€ä¸ªéƒ½é€ä¸€ç»‘å®šï¼Œåªéœ€ç»™æœ€å¤–å±‚çš„çš„å®¹å™¨ç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶å³å¯ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶ï¼Œé€šè¿‡äº‹ä»¶æºæ¥åŒºåˆ†è¿›è¡Œä¸åŒæ“ä½œã€‚

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson110</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        .container {
            position: relative;
            height: 33px;
            width: 100px;
            border: 1px solid #000000;
            margin: 50px auto;
        }

        .container .cart {
            /*position: absolute; ä¸å¿…å®šä½ï¼Œå®šä½äº†è¿˜ä¸å¥½å±…ä¸­*/
            height: 33px;
            line-height: 30px;
            text-align: center;
            background: lightblue;
        }

        .container .cartDetail {
            position: absolute;
            top: 33px;
            left: -1px;
            height: 200px;
            width: 200px;
            background: lightgray;
            border: 1px solid #000000;
            text-align: center;
            line-height: 66px;
        }
    </style>
</head>
<body>
<div id="container" class="container">
    <div class="cart" id="cart">
        <span>è´­ç‰©è½¦</span>
        <div class="cartDetail" id="cartDetail" style="display: none">
            1. iPhone7<br/>
            2. Mi6<br/>
            3. P10<br/>
        </div>
    </div>
</div>

<script type="text/javascript">
  var ctnr = document.getElementById("container"),
    cart = document.getElementById("cart"),
    cartDetail = document.getElementById("cartDetail");

  function handleCartClick(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    if (e.target.id === 'cart' || (e.target.tagName.toLocaleLowerCase() === 'span' && e.target.parentNode === cart)) {
      var dsp = cartDetail.style.display;
      dsp === 'none' ? cartDetail.style.display = 'block' : cartDetail.style.display = 'none';
      return false;
    }
    if (e.target.id === 'cartDetail') {
      return false;
    }
    cartDetail.style.display = 'none';
  }
  // å°†ç‚¹å‡»äº‹ä»¶ç»‘å®šåœ¨bodyä¸Šï¼Œå®ç°äº‹ä»¶å§”æ‰˜æˆ–äº‹ä»¶ä»£ç†ã€‚
  document.body.addEventListener('click', handleCartClick, false);
</script>
</body>
</html>
```

----------

## è¯¾æ—¶111ï¼šæ¡ˆä¾‹ä¹‹äº¬ä¸œå•†åŸæ”¾å¤§é•œ

> é¢„å…ˆä¼°è®¡ï¼Œå’Œä¸Šé¢è·Ÿéšå·®ä¸å¤šï¼Œä½†é¢å¤–ä½¿ç”¨äº†divç„¶å`backgroundImage: position `å®šä½å±€éƒ¨å›¾

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson111</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        .box {
            position: absolute;
            width: 450px;
            height: 450px;
            top: 25px;
            left: 50px;
            border: none;
            box-shadow: 3px 3px 10px 0 #111111;
        }

        .box .mark {
            position: absolute;
            top: 0;
            left: 0;
            height: 300px;
            width: 300px;;
            display: block;
            border: 1px solid #aaa;
            background: #fede4f;
            opacity: 0.5;
            filter: alpha(opacity=50);
            z-index: 9;
            cursor: move;
        }

        .box img {
            display: block;
            border: none;
        }

        .box .imgDetail {
            position: absolute;
            top: 0;
            left: 458px;
            height: 540px;
            width: 540px;
            background: url("imgs/iPhone7plus_red_lg.jpg") no-repeat center center;
            background-position: 0 0;
            border: 1px dashed #aaaaaa;
        }
    </style>
</head>
<body>
<div id="box" class="box">
    <img src="imgs/iPhone7plus_red_sm.jpg" alt="iPhone7Plus" id="simg">
    <div class="mark" id="mark"></div>
    <div class="imgDetail" id="imgDetail" style="display: none"></div>
</div>

<script type="text/javascript">
  var box = document.getElementById('box'),
    mark = document.getElementById('mark'),
    imgDetail = document.getElementById('imgDetail');


  function setPoistion(e) {
    // å±•ç¤ºç›’å­ 450px * 450px
    // æ”¾å¤§é•œ   300px * 300px
    // æ˜ç»†ç›’å­ 540px * 540px
    var left = e.clientX - box.offsetLeft - (mark.offsetWidth / 2),
      top = e.clientY - box.offsetTop - (mark.offsetHeight / 2);
    var minLeft = 0, minTop = 0, maxLeft = box.offsetWidth - mark.offsetWidth,
      maxTop = box.offsetHeight - mark.offsetHeight;
    // è¿›è¡Œè¾¹ç•Œåˆ¤æ–­
    if (left > maxLeft) {
      left = maxLeft;
      mark.style.left = maxLeft + 'px';
    } else if (left <= minLeft) {
      left = minLeft;
      mark.style.left = minLeft + 'px';
    } else {
      mark.style.left = left + 'px';
    }
    // è¿›è¡Œè¾¹ç•Œåˆ¤æ–­
    if (top > maxTop) {
      top = maxTop;
      mark.style.top = maxTop + 'px';
    } else if (top <= minTop) {
      top = minTop;
      mark.style.top = minTop + 'px';
    } else {
      mark.style.top = top + 'px';
    }
    // è®¾ç½®æ”¾å¤§å›¾çš„divé‡Œçš„backgroundPosition
    setDetailPosition(left, top);
  }

  function setDetailPosition(l, t) { // 2.6500
    l = -l * 1.77;
    t = -t * 1.77;
    // è¿™é‡Œåˆè¦æœ‰è¾¹ç•Œ
    //ä½ çœŸåˆ«é—®æˆ‘è¾¹ç•Œæ€ä¹ˆç®—å‡ºæ¥çš„ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæˆ‘æ˜¯æ‹¿æˆªå›¾å·¥å…·é‡å‡ºæ¥çš„ï¼
    var minL = -259,
      minT = -259;
    l < minL ? l = minL : null;
    t < minT ? t = minL : null;
    imgDetail.style.backgroundPosition = l + 'px ' + t + 'px';
  }

  function handleMouseEnter(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    console.dir(e.target);
    if (e.target.id === 'box') {
      imgDetail.style.display = 'block';
    }
    setPoistion(e);
  }

  function handleMouseLeave(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    if (e.target.id === 'box') {
      imgDetail.style.display = 'none';
    }
  }

  function handleMouseMove(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    e.clientX > box.offsetLeft + box.offsetWidth ? imgDetail.style.display = 'none' : null;
    e.clientY > box.offsetTop + box.offsetHeight ? imgDetail.style.display = 'none' : null;
    setPoistion(e);
  }

  box.addEventListener('mouseenter', handleMouseEnter);
  box.addEventListener('mouseleave', handleMouseLeave);
  box.addEventListener('mousemove', handleMouseMove);
</script>
</body>
</html>
```

----------

## è¯¾æ—¶112ï¼šæ¡ˆä¾‹ä¹‹ç™¾åº¦æœç´¢æ¡†

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson112</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-size: 14px;
        }

        /*è¿™é‡Œå¦‚æœä¸æŒ‡å®šbodyçš„å®½é«˜ï¼Œåˆ™å®ƒä¹Ÿæ˜¯ä¸ªç›’å­ï¼Œä¹Ÿæ˜¯æ’‘ä¸å¼€ï¼Œå¯¼è‡´ä½ å°±ç®—ä¸Šäº†onclickäº‹ä»¶ä¹Ÿä¸èƒ½è§¦å‘ï¼Œå› ä¸ºæ²¡å®½åº¦å•Šã€‚*/
        html, body {
            width: 100%;
            height: 100%;
        }

        input {
            display: block;
            outline: none;
        }

        ul, li {
            list-style: none;
        }

        li a {
            display: block;
            text-decoration: none;
            color: #000000;
        }

        li a:hover a:target a:visited a:active {
            text-decoration: none;
            color: #000000;
        }

        .box {
            position: absolute;
            width: 400px;
            top: 20px;
            left: 50%;
            margin-left: -200px;
        }

        .box input {
            padding: 0 10px;
            width: 300px;
            height: 35px;
            margin-bottom: -1px; /*æŠŠåº•ä¸‹çš„å…ƒç´ å¾€ä¸Šå¸ä¸€ä¸ªåƒç´ */
            border: 1px solid #008000;
        }

        .box ul {
            display: none;
            position: relative;
            border: 1px solid #008000;
        }

        .box ul li, .box ul li a {
            height: 30px;
            line-height: 30px; /*æ–‡å­—å‚ç›´å±…ä¸­*/
        }

        .box ul li a {
            padding: 0 5px;
        }

        .box ul li a:hover {
            background: #cccccc;
        }
    </style>
</head>
<body>

<div id="box" class="box">
    <input type="text" id="searchInp" placeholder="wrods...">
    <ul id="searchList">
        <li><a href="javascript:;">ã€ŠJavaScriptæƒå¨æŒ‡å—(ç¬¬å…­ç‰ˆ)ã€‹</a></li>
        <li><a href="javascript:;">ã€Šä½ ä¸çŸ¥é“çš„JavaScriptã€‹</a></li>
        <li><a href="javascript:;">ã€ŠNode.jså®æˆ˜ã€‹</a></li>
        <li><a href="javascript:;">ã€Šæ·±å…¥æµ…å‡ºNodejsã€‹</a></li>
        <li><a href="javascript:;">ã€ŠJavaScripté«˜çº§ç¼–ç¨‹(ç¬¬ä¸‰ç‰ˆ)ã€‹</a></li>
    </ul>
</div>

<script type="text/javascript">
  //æ˜¾ç¤º: 1.æ–‡æœ¬æ¡†è·å–ç„¦ç‚¹ï¼Œå¹¶ä¸”æ–‡æœ¬æ¡†ä¸­æœ‰å†…å®¹çš„æ—¶å€™ï¼›2.åœ¨æ–‡æœ¬æ¡†ä¸­æ“ä½œ(æ–°è¾“å…¥ã€åˆ é™¤)å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰æ¸…ç©ºå°±æ˜¾ç¤ºï¼Œå¦åˆ™éšè—ï¼›
  //éšè—ï¼š1.ç‚¹å‡»é¡µé¢å…¶ä½™çš„ä½ç½®éƒ½éšè—(é™¤äº†æ–‡æœ¬æ¡†å’ŒsearchListé‡Œé¢çš„æ¯ä¸€è¡Œ)éƒ½éšè—ï¼›2.ç‚¹å‡»searchListéšè—ï¼Œä½†è¿˜éœ€è¦æŠŠåˆ—è¡¨ä¸­çš„å†…å®¹æ”¾åˆ°æ–‡æœ¬æ¡†ä¸­ï¼›

  var searchInp = document.getElementById('searchInp'),
    searchList = document.getElementById('searchList');
  // ä¸ç®¡æ˜¯è·å–ç„¦ç‚¹onfoucesï¼Œè¿˜æ˜¯åœ¨é‡Œé¢ç¼–è¾‘å†…å®¹onkeyup
  searchInp.onfocus = searchInp.onkeyup = function (e) {
    // String.trim();
    var val = this.value.replace(/(^ +| +$)/g, '');
    searchList.style.display = val.length > 0 ? 'block' : 'none';
  };

  function handleSearchList(e) {
    e = e || window.event;
    e.target = e.target || e.srcElement;
    // å¦‚æœç‚¹å‡»çš„äº‹ä»¶æºæ˜¯searchListä¸‹çš„a
    if (e.target.tagName.toLocaleLowerCase() === 'a' && (e.target.parentNode.parentNode === searchList)) {
      searchInp.value = e.target.childNodes[0].nodeValue;
      searchList.style.display = 'none';
      return;
    }
    // å¦‚æœç‚¹å‡»çš„æ˜¯æœç´¢æ¡†ï¼Œå› ä¸ºå­˜åœ¨äº‹ä»¶å†’æ³¡ä¼ æ’­ï¼Œä¼šä»bodyçš„clickè¡Œä¸ºä¸Šæ•è·åˆ°æœç´¢æ¡†å†ä¼ å†’æ³¡åˆ°bodyã€‚åˆ™æˆ‘ä»¬ä¸éœ€è¦è§¦å‘bodyçš„clickè¡Œä¸ºï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡ã€‚
    //ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰‹å·¥å–æ¶ˆå†’æ³¡ä¼ æ’­
    //if (e.target === searchInp) {
    //  return;
    //}
    //å‡ºåœæ­¢æœç´¢æ¡†çš„å†’æ³¡ï¼Œè¿™é‡Œå°±æœ‰é—®é¢˜ã€‚
    searchList.style.display = 'none';
  }

  // ä¹Ÿå¯ä»¥æ‰‹å·¥åœ¨æœç´¢æ¡†çš„clickä¸Šå¤„ç†å–æ¶ˆå†’æ³¡ä¼ æ’­
  searchInp.onclick = function (e) {
    e = e || e.event;
    //ç»ˆæ­¢äº‹ä»¶åœ¨ä¼ æ’­è¿‡ç¨‹çš„æ•è·ã€ç›®æ ‡å¤„ç†æˆ–èµ·æ³¡é˜¶æ®µè¿›ä¸€æ­¥ä¼ æ’­ã€‚å…¼å®¹IE~~
    e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;
  };

  //document.body.onclick = handleSearchList;
  document.body.addEventListener('click', handleSearchList);
</script>
</body>
</html>
```

----------

## è¯¾æ—¶113ï¼šæ¡ˆä¾‹ä¹‹å¤šçº§èœå•jsç‰ˆ

- CSSæŠ€å·§ï¼šæ¸è¿›å¢å¼ºã€‚é¦–å…ˆè®¾ç½®ä¸€ä¸ªçº¯è‰²çš„èƒŒæ™¯ï¼Œå¯¹äºä¸å…¼å®¹CSS3çš„æµè§ˆå™¨çš„è¯å°±ç”¨çº¯è‰²ï¼›å¯¹äºå…¼å®¹çš„æµè§ˆå™¨çš„è¯ï¼Œæˆ‘ä»¬å†ä¸‹é¢å†é¢å¤–é‡å¤å¢åŠ ä¸€ä¸ªèƒŒæ™¯æ¸å˜è‰²ï¼Œè¿™æ ·å°±ä¼šæŠŠçº¯è‰²çš„èƒŒæ™¯è¦†ç›–ã€‚

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson113</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-size: 14px;
            -webkit-user-select: none;
            user-select: none;
        }

        ul, li {
            list-style: none;
        }

        .box {
            margin: 10px;
            padding: 10px;
            width: 300px;
            border: 1px dashed #000000;
            /*æ¸è¿›å¢å¼ºï¼šé¦–å…ˆè®¾ç½®ä¸€ä¸ªçº¯è‰²çš„èƒŒæ™¯ï¼Œå¯¹äºä¸å…¼å®¹CSS3çš„æµè§ˆå™¨çš„è¯å°±ç”¨çº¯è‰²ï¼›å¯¹äºå…¼å®¹çš„æµè§ˆå™¨çš„è¯ï¼Œæˆ‘ä»¬å†ä¸‹é¢å†é¢å¤–é‡å¤å¢åŠ ä¸€ä¸ªèƒŒæ™¯æ¸å˜è‰²ï¼Œè¿™æ ·å°±ä¼šæŠŠçº¯è‰²çš„èƒŒæ™¯è¦†ç›–ã€‚*/
            background: #fede4f; /*PCç«¯å…¼å®¹css3æ ·å¼ï¼Œåˆ†åˆ«å¯¹åº”webkitã€ç«ç‹ã€operaã€ie*/
            background: -webkit-linear-gradient(to bottom, red 0%, blue 100%);
            background: -moz-linear-gradient(to bottom, red 0%, blue 100%);
            background: -o-linear-gradient(to bottom, red 0%, blue 100%);
            background: -ms-linear-gradient(to bottom, red 0%, blue 100%);
            background: linear-gradient(to bottom, red 0%, blue 100%);
        }

        .box li {
            position: relative;
            line-height: 30px;
        }

        .box em {
            position: absolute;
            top: 7px;
            left: 0;
            width: 16px;
            height: 16px;
            cursor: pointer;
            background: url("imgs/icon.png") no-repeat -59px -28px;
        }

        .box em.open {
            background-position: -42px -28px;
        }

        .box span {
            display: block;
            padding-left: 20px;
        }

        .box .levelTwo {
            margin-left: 20px;
        }

        .box .levelThree {
            margin-left: 20px;
        }

        .box .levelFour {
            margin-left: 20px;
        }

        .box .levelTwo, .box .levelThree, .box .levelFour {
            display: none;
        }

    </style>
</head>
<body>
<div class="box" id="box">
    <ul>
        <li>
            <em></em><span>ç¬¬ä¸€çº§ç¬¬ä¸€ä¸ª</span>
            <ul class="levelTwo">
                <li><span>ç¬¬äºŒçº§ç¬¬ä¸€ä¸ª</span></li>
                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬äºŒä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                        <li>
                            <em></em><span>ç¬¬ä¸‰çº§ç¬¬ä¸‰ä¸ª</span>
                            <ul class="levelFour">
                                <li><span>ç¬¬å››çº§ç¬¬ä¸€ä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬äºŒä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬ä¸‰ä¸ª</span></li>
                            </ul>
                        </li>

                    </ul>
                </li>

                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬ä¸‰ä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                    </ul>
                </li>

            </ul>
        </li>
        <li>
            <em></em><span>ç¬¬ä¸€çº§ç¬¬ä¸€ä¸ª</span>
            <ul class="levelTwo">
                <li><span>ç¬¬äºŒçº§ç¬¬ä¸€ä¸ª</span></li>
                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬äºŒä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                        <li>
                            <em></em><span>ç¬¬ä¸‰çº§ç¬¬ä¸‰ä¸ª</span>
                            <ul class="levelFour">
                                <li><span>ç¬¬å››çº§ç¬¬ä¸€ä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬äºŒä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬ä¸‰ä¸ª</span></li>
                            </ul>
                        </li>

                    </ul>
                </li>

                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬ä¸‰ä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                    </ul>
                </li>

            </ul>
        </li>
    </ul>
</div>
<script type="text/javascript" src="../utils.js"></script>
<script type="text/javascript">
  var box = document.getElementById('box'),
    spanList = box.getElementsByTagName('span');

  // ç¬¬ä¸€æ­¥ï¼šå¾ªç¯å®¹å™¨ä¸­æ‰€æœ‰spanæ ‡ç­¾
  for (var i = 0, len = spanList.length; i < len; i++) {
    var curSpan = spanList[i],
      prevEle = utils.prev(curSpan); // è·å–è¯¥spanæ ‡ç­¾çš„å“¥å“¥å…ƒç´ 
    if (prevEle && prevEle.tagName.toLocaleLowerCase() === 'em') {
      // å¦‚æœå“¥å“¥å…ƒç´ æ˜¯emçš„è¯ï¼Œè¯´æ˜è¿™ä¸ªspanä¸‹è¿˜æœ‰ulå†…å®¹ï¼Œåˆ™è®¾ç½®è¯¥spanæ ·å¼cursor = "pointer"
      curSpan.style.cursor = "pointer";
    }
  }

  function handleSpanClick(e) {
    e = e || window.event;
    e.traget = e.target || e.srcElement;

    var tagName = e.target.tagName.toLowerCase(), //è·å–å½“å‰ç‚¹å‡»å…ƒç´ çš„tagName
      siblingsUlList = utils.children(e.traget.parentNode, 'ul'), // è·å–å½“å‰ç‚¹å‡»å…ƒç´ çš„å…„å¼Ÿå…ƒç´ ä¸­ulå…ƒç´ åˆ—è¡¨
      prevEle = utils.prev(e.target); // è·å–å½“å‰äº‹ä»¶æºçš„å“¥å“¥å…ƒç´ 

    // åˆ¤æ–­æ˜¯å¦çœŸçš„æœ‰å…„å¼Ÿulå…ƒç´ ä¸”ç‚¹å‡»å…ƒç´ æ—¶emæˆ–è€…span
    if (siblingsUlList.length > 0 && (tagName === 'em' || tagName === 'span')) {
      // ç¡®å®šå½“å‰ç‚¹å‡»æ“ä½œæ—¶æ˜¾ç¤ºå†…å®¹è¿˜æ˜¯éšè—å†…å®¹
      var isHide = tagName === 'span' ? utils.hasClass(prevEle, 'open') : utils.hasClass(e.target, 'open');
      // éå†å¾ªç¯æ¯ä¸€ä¸ªå…„å¼Ÿulå…ƒç´ å¹¶æ“ä½œ
      for (var i = 0, len = siblingsUlList.length; i < len; i++) {
        // è¿™é‡Œæ˜¾ç¤ºå’Œéšè—éƒ½åªæ“ä½œå…„å¼Ÿulå…ƒç´ ï¼
        //isHide ? siblingsUlList[i].style.display = "none" : siblingsUlList[i].style.display = "block";

        //å‡çº§ä¸šåŠ¡é€»è¾‘ã€‚æ˜¾ç¤ºæ—¶å€¼æ“ä½œå…„å¼Ÿulä»¬æ˜¾ç¤ºï¼Œä½†éšè—å¼ä¸ä»…æŠŠå…„å¼Ÿulä»¬éšè—ï¼Œè¿˜è¦æŠŠå­å­å­™å­™ulä»¬éƒ½éšè—
        if (isHide) {
          siblingsUlList[i].style.display = "none";
          var u = siblingsUlList[i].getElementsByTagName('ul'); // è·å–è¿™ä¸ªulåº•ä¸‹çš„æ‰€æœ‰ul
          var ems = siblingsUlList[i].getElementsByTagName('em'); // è·å–è¿™ä¸ªulåº•ä¸‹çš„æ‰€æœ‰em
          for (var iu=0;iu<u.length;iu++) {
            u[iu].style.display = 'none'; // ulçš„è¯å°±ç›´æ¥åº”é…¬
          }
          for (var ie=0;ie<ems.length;ie++) {
            utils.removeClass(ems[ie], 'open'); // emçš„è¯å°±ç›´æ¥åˆ é™¤openæ ·å¼ç±»å
          }
        } else { // å¦è€…æ˜¾ç¤º
          siblingsUlList[i].style.display = "block";
        }
      }

      // å…ˆåˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦ä¸ºspanï¼Œå¦‚æœæ˜¯å°±æŠŠå®ƒå“¥å“¥å…ƒç´ çš„openæ ·å¼å‘½åè¿›è¡Œtoggle
      if (tagName === 'span') {
        utils.toggleClass(prevEle, 'open');
      } else { // å¦‚æœä¸æ˜¯å°±è¯´æ˜ç‚¹çš„æ˜¯emå…ƒç´ ï¼Œå°±ç›´æ¥æŠŠæœ¬èº«æ ·å¼ç±»åopenè¿›è¡Œtoggleå¼€å…³
        utils.toggleClass(e.target, 'open');
      }
    }
  }
  // å› ä¸ºæœ‰äº‹ä»¶å†’æ³¡ä¼ æ’­ï¼Œæ‰€ä»¥ä¸ºboxç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œå¯ä»¥è®©å®ƒçš„å­å­å­™å­™å…ƒç´ ç‚¹å‡»äº‹ä»¶ä¼ é€’ç»™boxä¸Š~~
  box.addEventListener('click', handleSpanClick, false);
</script>
</body>
</html>
```

- å¤šçº§èœå•Vanilla.jsç‰ˆå®ç°é€»è¾‘æ€»ç»“ï¼š
  1. å¾ªç¯å®¹å™¨ä¸­æ‰€æœ‰spanæ ‡ç­¾ï¼Œæ‹¿åˆ°æ¯ä¸ªæ ‡ç­¾çš„å“¥å“¥å…ƒç´ ï¼Œå¦‚æœå“¥å“¥å…ƒç´ æ˜¯emï¼Œåˆ™è¯´æ˜è¿™ä¸ªspanä¸‹è¿˜æœ‰ulå†…å®¹ï¼Œåˆ™è®¾ç½®è¯¥spanæ ·å¼cursor = "pointer"ï¼›
  2. åˆ›å»ºhandleSpanClickå‡½æ•°
  3. å‡½æ•°é‡Œï¼Œåˆ¤æ–­äº‹ä»¶æºæ‰€æœ‰æœ‰å…„å¼Ÿulå…ƒç´ ä¸”äº‹ä»¶æºæ˜¯emæˆ–è€…spanå…ƒç´ ï¼›ã€æ˜¯ã€‘å…ˆæ‹¿åˆ°è¯¥å…ƒç´ æ‰€æœ‰å…„å¼Ÿulå…ƒç´ ä»¬ï¼Œç„¶åå¾ªç¯ï¼›
  4. å¾ªç¯é‡Œï¼Œå…ˆåˆ¤æ–­emå…ƒç´ æ˜¯å¦æœ‰openæ ·å¼ï¼Œå¦‚æœæœ‰åˆ™isHideä¸ºtrueï¼Œå¦è€…ä¸ºfalseï¼›
  5. æ¥ä¸Šï¼Œå¦‚æœisHideä¸ºtrueï¼Œåˆ™å…ˆè®©å…„å¼Ÿulä»¬éšè—ï¼Œç„¶åè·å–åœ¨æ¯ä¸€ä¸ªå…„å¼Ÿulå…ƒç´ çš„å­å­å­™å­™èŠ‚ç‚¹ä¸­è¿‡æ»¤å‡ºulå’Œemï¼Œåˆ†åˆ«å¾ªç¯è®¾ç½®éšè—å’Œåˆ é™¤openæ ·å¼ç±»åï¼›
  6. æ¥ä¸Šï¼Œå¦‚æœisHideä¸ºfalseï¼Œå°±ç›´æ¥è®©å…„å¼Ÿulä»¬æ˜¾ç¤ºï¼›
  7. æ¥ä¸Šï¼Œtoggleç‚¹å‡»çš„emå…ƒç´ æ ·å¼ç±»åopenï¼ŒhandleSpanClickå‡½æ•°å®Œï¼›
  8. handleSpanClickå‡½æ•°ç»‘å®šåˆ°boxçš„clickä¸Š

----------

## è¯¾æ—¶114ï¼šæ¡ˆä¾‹ä¹‹å¤šçº§èœå•jqueryç‰ˆ

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson114</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            font-size: 14px;
            -webkit-user-select: none;
            user-select: none;
        }

        ul, li {
            list-style: none;
        }

        .box {
            margin: 10px;
            padding: 10px;
            width: 300px;
            border: 1px dashed #000000;
            /*æ¸è¿›å¢å¼ºï¼šé¦–å…ˆè®¾ç½®ä¸€ä¸ªçº¯è‰²çš„èƒŒæ™¯ï¼Œå¯¹äºä¸å…¼å®¹CSS3çš„æµè§ˆå™¨çš„è¯å°±ç”¨çº¯è‰²ï¼›å¯¹äºå…¼å®¹çš„æµè§ˆå™¨çš„è¯ï¼Œæˆ‘ä»¬å†ä¸‹é¢å†é¢å¤–é‡å¤å¢åŠ ä¸€ä¸ªèƒŒæ™¯æ¸å˜è‰²ï¼Œè¿™æ ·å°±ä¼šæŠŠçº¯è‰²çš„èƒŒæ™¯è¦†ç›–ã€‚*/
            background: #fede4f; /*PCç«¯å…¼å®¹css3æ ·å¼ï¼Œåˆ†åˆ«å¯¹åº”webkitã€ç«ç‹ã€operaã€ie*/
            background: -webkit-linear-gradient(to bottom, red 0%, blue 100%);
            background: -moz-linear-gradient(to bottom, red 0%, blue 100%);
            background: -o-linear-gradient(to bottom, red 0%, blue 100%);
            background: -ms-linear-gradient(to bottom, red 0%, blue 100%);
            background: linear-gradient(to bottom, red 0%, blue 100%);
        }

        .box li {
            position: relative;
            line-height: 30px;
        }

        .box em {
            position: absolute;
            top: 7px;
            left: 0;
            width: 16px;
            height: 16px;
            cursor: pointer;
            background: url("imgs/icon.png") no-repeat -59px -28px;
        }

        .box em.open {
            background-position: -42px -28px;
        }

        .box span {
            display: block;
            padding-left: 20px;
        }

        .box .levelTwo {
            margin-left: 20px;
        }

        .box .levelThree {
            margin-left: 20px;
        }

        .box .levelFour {
            margin-left: 20px;
        }

        .box .levelTwo, .box .levelThree, .box .levelFour {
            display: none;
        }

    </style>
</head>
<body>
<div class="box" id="box">
    <ul>
        <li>
            <em></em><span>ç¬¬ä¸€çº§ç¬¬ä¸€ä¸ª</span>
            <ul class="levelTwo">
                <li><span>ç¬¬äºŒçº§ç¬¬ä¸€ä¸ª</span></li>
                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬äºŒä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                        <li>
                            <em></em><span>ç¬¬ä¸‰çº§ç¬¬ä¸‰ä¸ª</span>
                            <ul class="levelFour">
                                <li><span>ç¬¬å››çº§ç¬¬ä¸€ä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬äºŒä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬ä¸‰ä¸ª</span></li>
                            </ul>
                        </li>

                    </ul>
                </li>

                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬ä¸‰ä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                    </ul>
                </li>

            </ul>
        </li>
        <li>
            <em></em><span>ç¬¬ä¸€çº§ç¬¬ä¸€ä¸ª</span>
            <ul class="levelTwo">
                <li><span>ç¬¬äºŒçº§ç¬¬ä¸€ä¸ª</span></li>
                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬äºŒä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                        <li>
                            <em></em><span>ç¬¬ä¸‰çº§ç¬¬ä¸‰ä¸ª</span>
                            <ul class="levelFour">
                                <li><span>ç¬¬å››çº§ç¬¬ä¸€ä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬äºŒä¸ª</span></li>
                                <li><span>ç¬¬å››çº§ç¬¬ä¸‰ä¸ª</span></li>
                            </ul>
                        </li>

                    </ul>
                </li>

                <li>
                    <em></em><span>ç¬¬äºŒçº§ç¬¬ä¸‰ä¸ª</span>
                    <ul class="levelThree">
                        <li><span>ç¬¬ä¸‰çº§ç¬¬ä¸€ä¸ª</span></li>
                        <li><span>ç¬¬ä¸‰çº§ç¬¬äºŒä¸ª</span></li>
                    </ul>
                </li>

            </ul>
        </li>
    </ul>
</div>
<script type="text/javascript" src="../jquery-1.12.4.js"></script>
<script type="text/javascript">
  var $box = $('#box');
  // å¾ªç¯emå…„å¼ŸspanåŠ å¯ç‚¹å‡»çš„æ ·å¼
  $box.find('span').each(function (i, v) {
    var $item = $(v);
    $item.prev().is('em') ? $item.css('cursor', 'pointer') : null;
  });
  
  function handleBoxClick(je) {
    var $target = $(je.currentTarget),
      $siblingsUls = $target.parent().children('ul'),
      tagName = je.target.nodeName.toLowerCase();
    if ($siblingsUls.length > 0 && (tagName === 'span' || tagName === 'em')) {
      var isHide = tagName === 'span' ? $target.parent().hasClass('open') : $target.hasClass('open');
      $siblingsUls.each(function (item) {
        if (isHide) {
          // éšè—
          $siblingsUls.slideToggle(); //jQuery: -> defaultSpeed:400ms
          $siblingsUls.find('ul').hide(400); // è¿™é‡Œåªèƒ½éšè—ï¼Œä¸èƒ½ç”¨toggle
          $siblingsUls.find('em').removeClass('open'); // è¿™é‡Œåªèƒ½åˆ é™¤ï¼Œä¸èƒ½ç”¨toggleClass
        } else {
          // æ˜¾ç¤º
          $siblingsUls.slideToggle();
        }
        tagName === 'em' ? $target.toggleClass('open') : $target.prev().toggleClass('open');
      })
    }
  }
  // å°†ç‚¹å‡»æ—¶é—´çš„è¡Œä¸ºå‡½æ•°å§”æ‰˜ç»™boxå®¹å™¨ä¸‹çš„emå’Œspanå…ƒç´ 
  $box.delegate('em, span', 'click', handleBoxClick);

</script>
</body>
</html>
```

----------

## è¯¾æ—¶115ï¼šæ‹–æ‹½demoå®ç°åŸºæœ¬çš„æ•ˆæœ

> é¼ æ ‡æ‹–æ‹½çš„åŸç†ï¼š
å½“é¼ æ ‡åœ¨ç›’å­ä¸ŠæŒ‰ä¸‹mousedownçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¼€å§‹æ‹–æ‹½ï¼ˆç»™ç›’å­ç»‘å®šmousemoveå’Œmouseupï¼‰ï¼›
å¤§æ¦‚ç›’å­ç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬å¼€å§‹è®¡ç®—ç›’å­çš„æœ€æ–°ä½ç½®ï¼›
å½“é¼ æ ‡æŠ¬èµ·(æ”¾æ¾é¼ æ ‡å·¦é”®)æ—¶ï¼Œè¯´æ˜æ‹–æ‹½å·²ç»ç»“æŸï¼Œæˆ‘ä»¬overå’Œupå°±æ²¡ç”¨äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬æŠŠè¿™ä¸¤ä¸ªäº‹ä»¶æ–¹æ³•ç§»é™¤ã€‚

![lesson115-mouseDrag.png-56.2kB][2]

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson115</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        #box {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 100px;
            left: 100px;
            /*ä¸€ç§ç§»åŠ¨ç«¯çš„å±…ä¸­æ–¹æ³•ï¼Œä½†å®¹å™¨çš„marginä¼šè¢«è®¾ç½®å¾—viewportå®½åº¦çš„ä¸€åŠï¼*/
            /*left:0;*/
            /*right: 0;*/
            /*bottom:0;*/
            /*top:0;*/
            /*margin: auto;*/
            /*å¦ä¸€ç§å±…ä¸­æ–¹æ³•ï¼Œä½†ä¹Ÿä¼šå½±å“å®¹å™¨marginå€¼ï¼*/
            /*top:50%;*/
            /*left:50%;*/
            /*margin-left: -60px;*/
            /*margin-top: -60px;*/
            background: red;
            cursor: move;
        }
    </style>
</head>
<body>
<div id="box"></div>
<script type="text/javascript">
  var box = document.getElementById('box');

  function down(e) {
    e = e || window.event;
    //å‘1: å¦‚æœå½“å‰leftä¸º0æ—¶ï¼Œè¿”å›ç©ºå­—ç¬¦ï¼
    //å‘2ï¼šè¦ç”¨BOMæä¾›çš„å®æ—¶csså•Šï¼
    this["prevLeft"] = parseFloat(window.getComputedStyle(this)['left']) || 0;
    this["prevTop"] = parseFloat(window.getComputedStyle(this)['top']) || 0;
    this["prevX"] = parseFloat(e.clientX);
    this["prevY"] = parseFloat(e.clientY);
    // å½“é¼ æ ‡åœ¨boxæŒ‰ä¸‹æ—¶ï¼Œç»™boxç»‘å®šmousemoveå’Œmouseupäº‹ä»¶
    box.addEventListener('mousemove', move, false);
    box.addEventListener('mouseup', up, false);
  }

  function move(e) {
    e = e || window.event;
    var left = this["prevLeft"] + e.clientX - this["prevX"];
    var top = this["prevTop"] + e.clientY - this["prevY"];
    //è¾¹ç•Œåˆ¤æ–­
    var minL = 0, minT = 0,
      // æœ€å¤§ç›’å­çš„Leftå€¼ä¸ºï¼Œå½“å‰viewportå®½åº¦ - æ•´ä¸ªç›’å­çš„å®½åº¦
      maxL = (document.documentElement.clientWidth || document.body.clientWidth) - this.offsetWidth,
      // æœ€å¤§ç›’å­çš„Topå€¼ä¸ºï¼šå½“å‰viewporté«˜åº¦ - æ•´ä¸ªç›’å­çš„é«˜åº¦
      maxT = (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight;
    // å¤æ‚ä¸‰å…ƒè¿ç®—ç¬¦ï¼šå…ˆåˆ¤æ–­leftå°äºminLå—ï¼Œå°äºå°±ç”¨minLï¼Œå¤§äºçš„è¯(å†åˆ¤æ–­å¤§äºmaxLå—ï¼Œå¤§äºå°±ç”¨maxLï¼Œå°äºå°±lefeåŸå€¼)
    this.style.left = left < minL ? minL : (left > maxL ? maxL : left) + 'px';
    this.style.top = top < minT ? minT : (top > maxT ? maxT : top) + 'px';
  }

  function up(e) {
    e = e || window.event;
    box.removeEventListener('mousemove', move);
    box.removeEventListener('mouseup', up);
  }

  box.addEventListener('mousedown', down, false);
</script>
</body>
</html>
```

----------

## è¯¾æ—¶116ï¼šæ‹–æ‹½demoè§£å†³é¼ æ ‡ä¸¢å¤±

- å½“é¼ æ ‡ç§»åŠ¨è¿‡å¿«æ—¶ï¼Œæˆ‘ä»¬çš„é¼ æ ‡ä¼šè„±ç¦»ç›’å­ï¼Œå¯¼è‡´ç›’å­çš„mouseupå’Œmousemoveäº‹ä»¶éƒ½æ— æ³•ç§»é™¤ï¼Œè¿™ç§ç°è±¡ç§°ä¸ºâ€œé¼ æ ‡ç„¦ç‚¹ä¸¢å¤±â€ã€‚åœ¨IEå’Œç«ç‹å†…æ ¸çš„æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æŠŠé¼ æ ‡å’Œç›’å­ç»‘å®šåœ¨ä¸€èµ·å³å¯-->`setCapture()`å’Œ`releaseCapture()`ã€‚ 

```javascript
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson115</title>
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            width: 100%;
        }

        #box {
            position: absolute;
            width: 120px;
            height: 120px;
            top: 100px;
            left: 100px;
            /*ä¸€ç§ç§»åŠ¨ç«¯çš„å±…ä¸­æ–¹æ³•ï¼Œä½†å®¹å™¨çš„marginä¼šè¢«è®¾ç½®å¾—viewportå®½åº¦çš„ä¸€åŠï¼*/
            /*left:0;*/
            /*right: 0;*/
            /*bottom:0;*/
            /*top:0;*/
            /*margin: auto;*/
            /*å¦ä¸€ç§å±…ä¸­æ–¹æ³•ï¼Œä½†ä¹Ÿä¼šå½±å“å®¹å™¨marginå€¼ï¼*/
            /*top:50%;*/
            /*left:50%;*/
            /*margin-left: -60px;*/
            /*margin-top: -60px;*/
            background: red;
            cursor: move;
        }
    </style>
</head>
<body>
<div id="box"></div>
<script type="text/javascript">
  var box = document.getElementById('box');

  function down(e) {
    e = e || window.event;
    //å‘1: å¦‚æœå½“å‰leftä¸º0æ—¶ï¼Œè¿”å›ç©ºå­—ç¬¦ï¼
    //å‘2ï¼šè¦ç”¨BOMæä¾›çš„å®æ—¶csså•Šï¼
    this["prevLeft"] = parseFloat(window.getComputedStyle(this)['left']) || 0;
    this["prevTop"] = parseFloat(window.getComputedStyle(this)['top']) || 0;
    this["prevX"] = parseFloat(e.clientX);
    this["prevY"] = parseFloat(e.clientY);
    // ä¸ºäº†è§£å†³é¼ æ ‡ç„¦ç‚¹ä¸¢å¤±é—®é¢˜ï¼Œåœ¨IEå’ŒFFä¸­æˆ‘ä»¬ä½¿ç”¨setCaptureå’ŒreleaseCaptrueã€‚è€Œå…¶å®ƒæµè§ˆå™¨åˆ™æˆ‘ä»¬ç›´æ¥å°†é¼ æ ‡moveå’Œé¼ æ ‡upäº‹ä»¶ç»‘å®šåœ¨documentå¯¹è±¡ä¸Šï¼Œå¦¥å¦¥çš„ï¼Œä¸ä¸¢å¤±ï¼
    // å½“é¼ æ ‡åœ¨boxæŒ‰ä¸‹æ—¶ï¼Œç»™boxç»‘å®šmousemoveå’Œmouseupäº‹ä»¶
    // å¦‚æœå½“å‰ç¯å¢ƒå…¼å®¹setCaptureå°±å¯åŠ¨
    if (this.setCapture) {
      this.setCapture();
      this.addEventListener('mousemove', move, false);
      this.addEventListener('mouseup', up, false);
    } else {
      var self = this;
      // åŒ¿åå‡½æ•°å‚æ•°å¿…é¡»æœ‰eï¼Œäº‹ä»¶ä¼šä¼ é€’è¿›æ¥
      this["MOVE"] = function (e) {
        move.call(self, e);
      };
      this["UP"] = function (e) {
        up.call(self, e);
      };
      document.onmousemove = this["MOVE"];
      document.onmouseup = this["UP"];
    }

  }

  function move(e) {
    e = e || window.event;
    var left = this["prevLeft"] + e.clientX - this["prevX"];
    var top = this["prevTop"] + e.clientY - this["prevY"];
    //è¾¹ç•Œåˆ¤æ–­
    var minL = 0, minT = 0,
      // æœ€å¤§ç›’å­çš„Leftå€¼ä¸ºï¼Œå½“å‰viewportå®½åº¦ - æ•´ä¸ªç›’å­çš„å®½åº¦
      maxL = (document.documentElement.clientWidth || document.body.clientWidth) - this.offsetWidth,
      // æœ€å¤§ç›’å­çš„Topå€¼ä¸ºï¼šå½“å‰viewporté«˜åº¦ - æ•´ä¸ªç›’å­çš„é«˜åº¦
      maxT = (document.documentElement.clientHeight || document.body.clientHeight) - this.offsetHeight;
    // å¤æ‚ä¸‰å…ƒè¿ç®—ç¬¦ï¼šå…ˆåˆ¤æ–­leftå°äºminLå—ï¼Œå°äºå°±ç”¨minLï¼Œå¤§äºçš„è¯(å†åˆ¤æ–­å¤§äºmaxLå—ï¼Œå¤§äºå°±ç”¨maxLï¼Œå°äºå°±lefeåŸå€¼)
    this.style.left = left < minL ? minL : (left > maxL ? maxL : left) + 'px';
    this.style.top = top < minT ? minT : (top > maxT ? maxT : top) + 'px';
  }

  function up(e) {
    e = e || window.event;
    if (this.releaseCapture) {
      this.releaseCapture();
      this.removeEventListener('mousemove', move);
      this.removeEventListener('mouseup', up);
    } else {
      document.onmousemove = null;
      document.onmouseup = null;
    }
  }

  box.addEventListener('mousedown', down, false);
</script>
</body>
</html>
```

> å…³äºå¦‚ä½•è§£å†³å› æ‹–æ‹½é€Ÿåº¦è¿‡å¿«å¯¼è‡´é¼ æ ‡ç„¦ç‚¹ä¸¢å¤±åä¸€ç³»åˆ—bugä¿®å¤ã€‚

- é¦–å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºIE(Tridentå†…æ ¸)å’ŒFireFox(Geckoå†…æ ¸)ï¼Œå¦‚æœæ˜¯å¯ä»¥ä½¿ç”¨`setCapture()`ä¸`releaseCapture()`æ–¹æ³•æ†ç»‘å’Œè§£ç»‘é¼ æ ‡å’Œå½“å‰ç›’å­åœ¨ä¸€èµ·~~
- å¦‚æœä¸æ˜¯ä¸Šé¢çš„ä¸¤è€…ï¼Œåˆ™å¯ä»¥åœ¨downçš„å‡½æ•°é‡Œï¼Œå°†moveå’Œupç»‘å®šåˆ°documentå¯¹è±¡ä¸Šï¼Œå› ä¸ºé¼ æ ‡å†å¿«ä¹Ÿé€ƒä¸å‡ºdocumentå¯¹è±¡ï¼›ç»‘å®šä¸Šå»åï¼Œæ„æ€å°±æ˜¯é¼ æ ‡å°±ç®—ç§»åŠ¨å†å¿«ï¼Œmoveä¹Ÿè·Ÿç€é¼ æ ‡è·‘ï¼Œç›´åˆ°ä½ upæ”¾å¼€é¼ æ ‡å·¦é”®ï¼Œå°±åˆ é™¤moveå’Œupäº‹ä»¶ã€‚

----------

## è¯¾æ—¶117ï¼šdom2çº§äº‹ä»¶åŸºç¡€çŸ¥è¯†

- æˆ‘ä»¬ä½¿ç”¨DOM2çº§äº‹ä»¶ç»‘å®šï¼Œå…¶å®æ˜¯è®©å…ƒç´ é€šè¿‡åŸå‹é“¾ä¸€è‡´æ‰¾åˆ°`EventTarget`è¿™ä¸ªå†…ç½®ç±»åŸå‹ä¸Šçš„`addEventListener`æ–¹æ³•å®ç°çš„

- DOM0çº§äº‹ä»¶ç»‘å®šï¼šåªèƒ½ç»™å…ƒç´ çš„æŸä¸€ä¸ªè¡Œä¸ºç»‘å®šä¸€æ¬¡æ–¹æ³•ï¼Œç¬¬äºŒæ¬¡ç»‘å®šä¼šæŠŠä¹‹å‰çš„è¦†ç›–

- DOM2çº§äº‹ä»¶åŒºåˆ«ä¸€ï¼šå¯ä»¥ç»™åŒä¸€ä¸ªè¡Œä¸ºç»‘å®šå¤šä¸ªä¸åŒæ–¹æ³•

- DOM2çº§äº‹ä»¶åŒºåˆ«äºŒï¼šDOM0çº§ä¸­çš„è¡Œä¸ºç±»å‹ï¼Œåœ¨DOM2çº§ä¸­ä¸€æ ·å¯ä»¥ç»‘å®šï¼›è€Œä¸”DOM2çº§ä¸­è¿˜æä¾›äº†ä¸€äº›DOM0çº§æ²¡æœ‰çš„è¡Œä¸ºç±»å‹ï¼Œä¾‹å¦‚DOMContentLoaded(å½“é¡µé¢ä¸­çš„domæ ‘åŠ è½½å®Œæˆè§¦å‘çš„è¡Œä¸º)ã€

```javascript
window.onload = function () { console.log('ok') };
// å½“é¡µé¢ä¸­çš„æ‰€æœ‰èµ„æº(dom,images,music,vedio...)åŠ è½½å®Œæ¯•æ—¶æ‰ä¼šæ‰§è¡Œåè¾¹çš„å‡½æ•°ï¼›å¹¶ä¸”ä¸€ä¸ªé¡µé¢ä¸­åªèƒ½ç”¨ä¸€æ¬¡ï¼Œåé¢å†™çš„ä¼šæŠŠå‰é¢çš„è¦†ç›–æ‰

$(document).ready(function () {}); //==$(function (){})
// å½“é¡µé¢ä¸­domæ ‘åŠ è½½å®Œæ¯•å°±ä¼šæ‰§è¡Œå¯¹åº”å‡½æ•°ï¼›å¹¶ä¸”å¯ä»¥ç»‘å®šå¤šæ¬¡å‡½æ•°
// åŸç†ï¼šdom2çº§äº‹ä»¶ + DOMCotentLoadedå®ç°
```

- dom2çº§åœ¨ç§»é™¤æ˜¯ï¼Œå¿…é¡»å’Œå®šä¹‰æ—¶çš„ç»“æ„ä¸€æ‘¸ä¸€æ ·ï¼Œå¦åˆ™ä¸èƒ½ç§»é™¤ã€‚ä¾‹å¦‚ç»‘å®šæ˜¯åœ¨æ•è·é˜¶æ®µï¼Œç§»é™¤æ—¶ç§»é™¤å†’æ³¡é˜¶æ®µçš„ï¼Œä¹Ÿä¸èƒ½è¢«ç§»é™¤ã€‚

![zf-lesson117.png-31.3kB][3]

- dom2çº§äº‹ä»¶å°çŸ¥è¯†ï¼š **ï¼ˆäº‹ä»¶æ± ï¼‰**
  1. åªèƒ½ç»™æŸä¸ªå…ƒç´ çš„åŒä¸€è¡Œä¸ºç»‘å®šå¤šä¸ªâ€œä¸åŒâ€æ–¹æ³•(å¦‚æœæ–¹æ³•ç›¸åŒåªä¿ç•™ä¸€ä¸ª)
  2. å½“è¡Œä¸ºè§¦å‘ï¼Œä¼šæŒ‰ç…§ç»‘å®šçš„å…ˆåé¡ºåºä¾æ¬¡æŠŠç»‘å®šçš„æ–¹æ³•æ‰§è¡Œ
  3. æ‰§è¡Œæ–¹æ³•ä¸­çš„thiså°±æ˜¯å½“å‰è¢«ç»‘å®šäº‹ä»¶çš„é‚£ä¸ªå…ƒç´ æœ¬èº«

- ä»€ä¹ˆå«ä½œäº‹ä»¶æ± ï¼Ÿç”¨æ¥å­˜å‚¨å½“å‰å…ƒç´ è¡Œä¸ºç»‘å®šæ–¹æ³•çš„å®¹å™¨ï¼ˆæµè§ˆå™¨è‡ªå¸¦ï¼‰

ã€äº‹ä»¶æ± å›¾~ã€‘

- åœ¨IE6~8ä¸­ï¼Œä¸æ”¯æŒ`addEventListener`å’Œ`removeEventListener`ï¼Œå¦‚æœæƒ³è¦å®ç°dom2çº§äº‹ä»¶ï¼Œåªèƒ½ä½¿ç”¨`attachEvent`å’Œ`detachEvent`ä»£æ›¿ï¼›ä½†è¿™ä¸¤ä¸ªæ–¹æ³•åªæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸å¯ä»¥æ§åˆ¶åœ¨å“ªä¸ªé˜¶æ®µå‘ç”Ÿï¼Œé»˜è®¤éƒ½åªèƒ½åœ¨å†’æ³¡é˜¶æ®µå‘ç”Ÿï¼›è€Œä¸”è¡Œä¸ºç±»å‹å¿…é¡»åŠ `on`å‰ç¼€(ä¸dom0ç±»ä¼¼)
  - IEçš„`attachEvent`å’Œ`detachEvent`å’Œæ ‡å‡†æµè§ˆå™¨çš„äº‹ä»¶æ± æœºåˆ¶å¯¹æ¯”ï¼š
  - åŒºåˆ«ä¸€ï¼šIE6~8ã€å¾ªåºé—®é¢˜ã€‘æ‰§è¡Œæ—¶å…¶é¡ºåºæ˜¯æ··ä¹±çš„ï¼Œæ ‡å‡†æµè§ˆå™¨æ˜¯æŒ‰ç…§ç»‘å®šé¡ºåºä¾æ¬¡æ‰§è¡Œçš„ï¼
  - åŒºåˆ«äºŒï¼šIE6~8ã€é‡å¤é—®é¢˜ã€‘å¯ä»¥ç»™åŒä¸€ä¸ªå…ƒç´ çš„åŒä¸€è¡Œä¸ºç»‘å®šç›¸åŒçš„æ–¹æ³•ï¼
  - åŒºåˆ«ä¸‰ï¼šIE6~8ã€thisé—®é¢˜ã€‘å½“æ‰€ç»‘å®šçš„æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ–¹æ³•ä¸­çš„thisä¸æ˜¯å½“å‰å…ƒç´ è€Œæ˜¯windowï¼

> ä»¥ä¸Šå°±æ˜¯IE6~8ä¸­DOM2çº§äº‹ä»¶çš„å…¼å®¹é—®é¢˜ï¼
  
----------

## è¯¾æ—¶118ï¼šdon2å…¼å®¹å¤„ç†thisé—®é¢˜

- åœ¨ä½¿ç”¨`addEventListener`å’Œ`removeEventListener`æ—¶ï¼Œç›´æ¥ç¬¬ä¸‰å‚æ•°è®¾ç½®ä¸º`false`ï¼Œåªèƒ½æ”¾å†’æ³¡é˜¶æ®µï¼Œå› ä¸º`attachEvent`å’Œ`detachEvent`åªæ”¯æŒå†’æ³¡ã€‚

- è§£å†³thisé—®é¢˜ä¹‹ç»‘å®šï¼šå…ˆç…§ç›¸ï¼Œå†åŒ–å¦†ï¼Œç„¶åå¾€è‡ªå·±å®¹å™¨è‡ªå®šä¹‰å±æ€§ä¸­ä¸¢ä¸€ä»½ï¼Œå†å¾€æµè§ˆå™¨è‡ªå¸¦æ—¶é—´æ± ä¸­ä¸¢ä¸€ä»½ï¼›
- è§£å†³thisé—®é¢˜ä¹‹è§£ç»‘ï¼šé€šè¿‡å¾ªç¯è‡ªå·±å®¹å™¨ä¸­è‡ªå®šä¹‰å±æ€§ä¸­æ‹¿åŒ–å¦†å‰çš„ç…§ç‰‡å»æ‰¾åŒ¹é…çš„å¯¹è±¡ï¼Œæ‰¾åˆ°å°±ç›´æ¥è§£ç»‘åå†å»å®¹å™¨è‡ªå®šä¹‰å±æ€§ä¸­ç§»é™¤ï¼Œå®Œäº‹ã€‚

----------

## è¯¾æ—¶119ï¼šdom2å…¼å®¹å¤„ç†é‡å¤é—®é¢˜

- pushæ•°ç»„å‰åˆ¤æ–­ï¼Œé‡å¤å°±ç›´æ¥`return`ï¼Œä¸ç•™é¢å­ï¼

----------

## è¯¾æ—¶120ï¼šdom2å…¼å®¹å¤„ç†é¡ºåºé—®é¢˜

![zf-lesson120.png-199.1kB][4]

- è§£å†³é¡ºåºé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ç”¨æµè§ˆå™¨è‡ªå¸¦çš„äº‹ä»¶æ± ï¼Œè€Œæ˜¯ç”¨è‡ªå·±æ¨¡æ‹Ÿæ ‡å‡†æµè§ˆå™¨äº‹ä»¶æ± çš„å®ç°!

```javascript
//åˆ›å»ºäº‹ä»¶æ± ï¼Œå¹¶ä¸”æŠŠéœ€è¦ç»™å½“å‰å…ƒç´ ç»‘å®šçš„æ–¹æ³•ä¾æ¬¡çš„å¢åŠ åˆ°äº‹ä»¶æ± ä¸­
function on(curEle, type, fn) {
  //åˆ¤æ–­å½“å‰å…ƒç´ çš„æŸè¡Œä¸ºäº‹ä»¶æ± æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±èµ‹ç©ºæ•°ç»„
  !curEle["myEvent" + type] ? curEle["myEvent" + type] = [] : null;
  var ary = curEle["myEvent" + type];
  for (var i = 0, len = ary.length; i < len; i++) {
    var cur = ary[i];
    if (cur === fn) return;
  }
  ary.push(fn);
  //curEle.addEventListener(type, run, false);//æ‰§è¡Œonçš„æ—¶å€™éšå¸¦ç»™å½“å‰å…ƒç´ ç»‘å®šä¸€ä¸ªç‚¹å‡»è¡Œä¸ºï¼Œç‚¹å‡»æ—¶æ‰§è¡Œrunæ–¹æ³•ï¼Œrunæ–¹æ³•ä¸­thisæ˜¯å½“å‰å…ƒç´ curEleï¼Œå¹¶ä¸”æµè§ˆå™¨ç»™runä¼ é€’äº†ä¸€ä¸ªMouseEventäº‹ä»¶å¯¹è±¡
  bind(curEle, type, run); //ä½¿ç”¨å·²ç»å®ç°å…¼å®¹ä¸”å¤„ç†è¿‡é‡å¤å’Œthisé—®é¢˜çš„ç»‘å®šæ–¹æ³•
}
//åœ¨è‡ªå·±çš„äº‹ä»¶æ± ä¸­å§æŸä¸€ä¸ªæ–¹æ³•ç§»é™¤
function off(curEle, type, fn) {
  var ary = curEle["myEvent" + type];
  for (var i=0, len=ary.length; i< len; i++) {
    if (ary[i] === fn) {
      ary.splice(i,1);
      break;// å®Œå…¨ä¸éœ€è¦æ‰§è¡Œè¡Œä¸ºï¼Œä»…ä»…æ˜¯åˆ é™¤äº‹ä»¶æ± ä¸­çš„äº‹ä»¶è€Œå·²ã€‚
    }
  }
}

// åªç»™å½“å‰å…ƒç´ çš„ç‚¹å‡»è¡Œä¸ºç»‘å®šä¸€ä¸ªæ–¹æ³•æ¶¦ï¼Œå½“è§¦å‘æŸè¡Œä¸ºæ—¶æ‰§è¡Œçš„ä¹Ÿå°±æ˜¯runæ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨runæ–¹æ³•ä¸­æ ¹æ®è‡ªå·±å­˜å‚¨çš„æ–¹æ³•æ–°é¡ºåºåˆ†åˆ«æ‰§è¡Œæ‰€è¿™äº›æ–¹æ³•å³å¯
function run(e) {
  e = e || window.event;
  var flag = !!e.target; // åˆ¤æ–­å½“å‰æµè§ˆå™¨æ˜¯å¦æ˜¯IE6~8ï¼Œfalseä¸ºIE6~8
  if (!flag) {
    // å¤„ç†IEå…¼å®¹é—®é¢˜
    e.target = e.target || e.srcElement;
    e.pageX = e.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft);
    e.pageY = e.clientY + (document.documentElement.scrollTop || document.body.scrollTop);
    e.preventDefault = function () {
      e.returnValue = false;
    };
    e.stopPropagation = function () {
      e.cancelBubble = true;
    }
  }

  // è·å–è‡ªå·±äº‹ä»¶æ± ä¸­ç»‘å®šçš„é‚£äº›æ–¹æ³•ï¼Œå¹¶ä¸”è®©è¿™äº›æ–¹æ³•ä¾æ¬¡æ‰§è¡Œ
  var ary = this["myEvent" + e.type];
  for (var i = 0, len = ary.length; i < len; i++) {
    ary[i].call(this, e); // æ‰§è¡Œæ—¶è®°å¾—ä¿®æ”¹thiså’Œä¼ é€’mouseEventå¯¹è±¡~
  }
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>lesson 120</title>
    <style type="text/css">
        #box {
            position: absolute;
            width: 100px;
            height: 100px;
            top: 50px;
            left: 400px;
            background: red;
        }
    </style>
</head>
<body>
<div id="box"></div>
<script type="text/javascript" src="../event.js"></script>
<script type="text/javascript">
  var box = document.getElementById('box'),
      count = 0;

  function fn1() {
    console.log(1);
  }
  function fn2() {
    console.log(2);
  }
  function fn3() {
    console.log(3);
  }
  function fn4() {
    console.log(4);
  }
  function fn5() {
    console.log(5);
  }
  function fn6() {
    console.log(6);
  }
  function fn7() {
    console.log(7);
  }
  function fn8() {
    console.log(8);
  }
  function fn9() {
    console.log(9);
    count++;
    if(count>= 3) {
      off(box, 'click', fn1);
      off(box, 'click', fn9);
      //return; // å¦‚æœreturnæ³¨é‡Šæ‰çš„è¯ï¼Œå°±èƒ½è¾“å‡ºä¸‰æ¬¡9ï¼
    }
  }

  on(box, 'click', fn1);
  on(box, 'click', fn2);
  on(box, 'click', fn3);
  on(box, 'click', fn4);
  on(box, 'click', fn5);
  on(box, 'click', fn6);
  on(box, 'click', fn7);
  on(box, 'click', fn8);
  on(box, 'click', fn9);
</script>
</body>
</html>
```

----------

## è¯¾æ—¶121ï¼šå¤ä¹ ä¸“ç”¨-dom2å…¼å®¹å¤„ç† thisé—®é¢˜

```javascript
// -> æ ‡å‡†æµè§ˆå™¨ä¸­
var fn = function () { };
document.addEventListener('click', fn);
document.removeEventListener('click', fn);

// -> IE6~8æµè§ˆå™¨ä¸­
document.attachEvent('onclick', fn);
document.detachEvent('onclick', fn);

// å®Œæ•´ä»£ç åœ¨122
```

----------

## è¯¾æ—¶122ï¼šå¤ä¹ ä¸“ç”¨-dom2å…¼å®¹å¤„ç†é¡ºåºé—®é¢˜

- è¯¾æ—¶121å’Œè¯¾æ—¶122éƒ½æ˜¯å¤ä¹ è¯¾ï¼Œæ—¶é—´è®²çš„é•¿äº†ç‚¹ï¼Œæˆ‘ç¨åç”¨è‡ªå·±ç”»çš„ä¸‰ä¸ªå›¾(bindå®ç°åŸç†å›¾ã€æ ‡å‡†æµè§ˆå™¨äº‹ä»¶æ± åŸç†å›¾å’Œè‡ªå·±å®ç°äº‹ä»¶æ± åŸç†å›¾)å†æ¬¡å¤ä¹ å¹¶å¤å†™äº‹ä»¶åº“å°±ç®—è¿‡å…³äº†ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>lesson121</title>
    <style type="text/css">
        #box {
            position: absolute;
            left: 300px;
            top: 200px;
            width: 200px;
            height: 200px;
            background: red;
        }
    </style>
</head>
<body>
<div id="box"></div>
<script type="text/javascript" src="zyEvent.js"></script>
<script type="text/javascript">
  // æ ‡å‡†æµè§ˆå™¨å’ŒIE6~8æµè§ˆå™¨ä¹‹é—´å…³äºdom2çº§äº‹ä»¶æœºåˆ¶çš„ä¸€äº›é‡è¦åŒºåˆ«ï¼š
  // 1.thisé—®é¢˜ï¼šæ ‡å‡†æµè§ˆå™¨ä¸­ç»™ä¸€ä¸ªå…ƒç´ çš„æŸä¸€ä¸ªè¡Œä¸ºç»‘å®šæ–¹æ³•ï¼Œå½“è¡Œä¸ºè§¦å‘æ‰§è¡Œå¯¹åº”æ–¹æ³•æ—¶ï¼Œæ–¹æ³•ä¸­çš„thiså°±æ˜¯å½“å‰å…ƒç´ ï¼›è€Œåœ¨IE6~8ï¼Œæ­¤æ–¹æ³•æ‰§è¡Œæ—¶æ–¹æ³•ä¸­çš„thiså´æ˜¯windowã€‚
  // 2.é‡å¤é—®é¢˜ï¼šæ ‡å‡†æµè§ˆå™¨ä¸­ä¸èƒ½ç»™åŒä¸€å…ƒç´ çš„åŒä¸€è¡Œä¸ºç»‘å®šå¤šä¸ªç›¸åŒçš„æ–¹æ³•ï¼›ä½†åœ¨IE6~8ä¸­queryå¯ä»¥ç»‘å®šï¼›
  // 3.é¡ºåºé—®é¢˜ï¼šæ ‡å‡†æµè§ˆå™¨ç»‘å®šè¡Œä¸ºæ—¶ï¼Œæ˜¯æŒ‰ç…§é¡ºåºä¾æ¬¡æŠŠæ–¹æ³•æ·»åŠ æ‰“åˆ°äº‹ä»¶æ± ä¸­ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ·»åŠ æ—¶ï¼Œé¦–å…ˆçœ‹ç°æœ‰äº‹ä»¶æ± ä¸­æ˜¯å¦å·²æœ‰è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœé‡å¤å°±ä¸å†æ·»åŠ ï¼Œå¹¶ä¸”å½“è¡Œä¸ºåœ¨è§¦å‘æ—¶ï¼Œä¼šåˆ°äº‹ä»¶æ± ä¸­æŒ‰ç…§æ·»åŠ çš„é¡ºåºä¾æ¬¡æ‰§è¡Œæ–¹æ³•ï¼›è€Œåœ¨IE6~8ä¸­ï¼Œæ‰€ç»‘å®šçš„æ–¹æ³•å¹¶ä¸æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ˜¯æ— åºçš„ã€‚

  var box = document.getElementById('box');

  function fn1 (e) {
    console.log('ç»‘å®šæˆåŠŸ');
    console.dir(e);
    console.dir(this);
    unbind(box, 'click', fn1);
    console.log('è§£ç»‘æˆåŠŸ');
  }

  function fn2 (e) {
    console.log('ç»‘å®šï¼šé¼ æ ‡åœ¨boxå…ƒç´ é‡ŒæŒ‰ä¸‹äº†');
    off(box, 'click', fn2);
    console.log('è§£ç»‘æˆåŠŸ');
  }

  bind(box, 'click', fn1);
  on(box, 'click', fn2);
</script>
</body>
</html>
```

```javascript
Function.prototype.myBind = function myBind(context) {
  // å®ç°bindï¼ŒåŸç†æ˜¯åŒ¿åå‡½æ•°å¤–åŒ…ä¸€å±‚ï¼Œæ¯æ¬¡æ‰§è¡ŒmyBindå°±äº§ç”Ÿä¸€ä¸ªæ–°ä½œç”¨åŸŸ
  // ç”¨çš„æ—¶å€™è¿™æ ·ç”¨hi.myBind(obj)ï¼Œè¿™ä¸ªæ—¶å€™è¿”å›çš„æ˜¯ä¸€ä¸ªå †å†…å­˜å’Œä¸ä¹‹é“¾æ¥çš„ä½œç”¨åŸŸ
  // è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦å…ˆå°†thisä¿å­˜èµ·æ¥ï¼Œè¿™ä¸ªthiså°±æ˜¯hiæ–¹æ³•çš„å †å†…å­˜åœ°å€~
  var _this = this;
  // æ¥æ”¶ä¸€ä¸‹ç”¨myBindæ—¶ä¼ å…¥çš„å¤–å±‚å‚æ•°ï¼Œæ³¨æ„ï¼Œè¿™é‡Œargumentsæ˜¯ç±»æ•°ç»„
  // è¿™é‡Œä»ç´¢å¼•1å¼€å§‹è½¬æ•°ç»„ï¼Œç´¢å¼•0æ˜¯contextä¸éœ€è¦ã€‚
  var outerArg = Array.prototype.slice.call(arguments, 1);
  // å¯ä»¥å‡†å¤‡è¿”å›å †å†…å­˜äº†ï¼Œå°±æ˜¯è¿”å›åŒ¿åå‡½æ•°~
  return function () {
    // è¿›æ¥é¦–å…ˆä¹Ÿæ˜¯å‡†å¤‡æ¥æ”¶å®ƒçš„å‚æ•°ï¼Œè¿™é‡Œå¾—ä»ç´¢å¼•0å¼€å§‹è½¬æ¢æ•°ç»„äº†
    var innerArg = [].__proto__.slice.call(arguments, 0);
    // å‡†å¤‡è¦æ‰§è¡Œäº†ï¼Œæˆ‘ä»¬å…ˆå»ä¸Šçº§ä½œç”¨åŸŸæ‹¿åˆ°è¦ä¿®æ”¹thisçš„æ–¹æ³•hiçš„å †å†…å­˜ï¼Œåœ¨_thisä¸­ä¿å­˜
    // æ›¿æ¢hiæ–¹æ³•çš„thisç”¨ä¸Šçº§ä½œç”¨åŸŸä¼ å…¥å½¢å‚context~
    // é“¾æ¥ä¸¤ä¸ªå‚æ•°æ•°ç»„æ—¶ï¼Œæ³¨æ„é¡ºåºï¼Œouteråé¢è·Ÿinner
    _this.apply(context, outerArg.concat(innerArg));
  }; // æ‰“å®Œæ”¶å·¥
};
/////////////â†“â†“â†“â†“â†“ä»¥ä¸‹æ˜¯myBindæµ‹è¯•â†“â†“â†“â†“â†“///////////////
//   function hi(one, two) {
//     console.log(this.hello + ', ' + one + ' ' + two + '.')
//   }
//
//   var o = {hello: 'hello'};
//   hi.myBind(o, 'jerry')('shi'); //ç›´æ¥æ‰§è¡Œ
//   var fn1 = hi.myBind(o, 'jerry'); //èµ‹å€¼å †åœ°å€ç­‰å¾…æ‰§è¡Œ
//   fn1('shi');
/////////////â†‘â†‘â†‘â†‘â†‘ä»¥ä¸Šæ˜¯myBindæµ‹è¯•â†‘â†‘â†‘â†‘â†‘///////////////

function bind(curEle, type, fn) {
  // å…¼å®¹æ€§åˆ¤æ–­ï¼Œå¦‚æœå…¼å®¹å°±ç”¨æ ‡å‡†æµè§ˆå™¨çš„æ–¹æ³•
  if ("addEventListener" in window) {
    curEle.addEventListener(type, fn);
    return;
  }
  // ä»¥ä¸‹ä¸ºIE6~8
  // å–å‡ºå½“å‰å…ƒç´ äº‹ä»¶æ± æ•°ç»„
  // åˆ¤æ–­äº‹ä»¶æ± æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨èµ‹å€¼ç©ºæ•°ç»„
  var ary = curEle['zyBind' + type];
  ary = ary ? null : [];
  // forå¾ªç¯æ£€æµ‹è¯¥æ–¹æ³•æ˜¯å¦å·²ç»å­˜åœ¨äº‹ä»¶æ± ä¸­
  for (var i = 0, len = ary.length; i < len; i++) {
    // å–åŒ…è£…å‰çš„åŸå§‹å¯¹è±¡å¯¹æ¯”
    if (ary[i].proto === fn) {
      // å¦‚æœå­˜åœ¨åˆ™ç›´æ¥returnæ•´ä¸ªå‡½æ•°(å…ˆé€€forå¾ªç¯åå†é€€æ•´ä¸ªå‡½æ•°)ï¼Œä¸èƒ½é‡å¤ç»‘å®š
      return;
    }
  }
  // è¿‡äº†ä¸Šé¢çš„æ£€æŸ¥ï¼Œå†åˆ›å»ºä¸€ä¸ªåŒ…è£…å¯¹è±¡
  // var tmpFn = function (e) {
  //   fn.call(curEle, e);
  // };
    var tmpFn = fn.myBind(curEle);
  // å°†è¿™ä¸ªåŒ…è£…å¯¹è±¡çš„åŸå§‹å¯¹è±¡ä¹Ÿå­˜å…¥è‡ªå®šä¹‰å±æ€§ï¼Œä¸ºäº†è¾¨è®¤ï¼
  // æˆ‘é ï¼Œæˆ‘æ‰å‘ç°è¿™é‡Œæ˜¯ç»™å‡½æ•°è¿™ä¸ªå¯¹è±¡æ·»åŠ è‡ªå®šä¹‰å±æ€§ï¼Œå¯¹äºJSè¿™é—¨è¯­è¨€æˆ‘ä¹Ÿæ˜¯é†‰äº†~
  tmpFn.proto = fn;
  // å°†åŒ…è£…å¯¹è±¡å­˜å…¥å…ƒç´ äº‹ä»¶æ± æ•°ç»„
  ary.push(tmpFn);
  curEle.attachEvent("on" + type, tmpFn);
}

function unbind(curEle, type, fn) {
  if ("removeEventListener" in window) {
    curEle.removeEventListener(type, fn);
    return;
  }
  // ä»¥ä¸‹ä¸ºIE6~8
  var ary = curEle['zyBind' + type];
  if (ary) {
      for (var i = 0; i < ary.length; i++) {
          if (ary[i].proto === fn) {
              // åˆ é™¤IEç»‘å®š
              curEle.detach("on" + type, curEle.proto);
              // åˆ é™¤å½“å‰å…ƒç´ äº‹ä»¶æ± æ•°ç»„ä¸Šçš„è¯¥æ–¹æ³•
              ary.splice(i, 1);
              return; // åˆ é™¤å®Œæˆç›´æ¥é€€å‡ºæ•´ä¸ªå‡½æ•°
          }
      }
  }
}

function on (curEle, type, fn) {
  // zyBind å’Œ zyEventæ˜¯ä¸¤ä¸ªæ•°ç»„~
  // è¿™é‡Œå¦‚æœäº‹ä»¶æ± ä¸å­˜åœ¨undefinedï¼Œaryå°±æ˜¯undefinedï¼Œ
  // æ„æ€å°±æ˜¯aryæ²¡æ‹¿åˆ°å†…å­˜åœ°å€ï¼Œèµ‹å€¼ä¸ªç©ºæ•°ç»„ç»™undefinedä¹Ÿæ²¡æ„æ€
  //curEle['zyEvent' + type] ? null : curEle['zyEvent' + type] = [];
  if (!curEle['zyEvent' + type]) curEle['zyEvent' + type] = [];
  var ary = curEle['zyEvent' + type];
  for (var i=0, len=ary.length; i<len; i++) {
    if (ary[i] === fn) {
      // å¦‚æœäº‹ä»¶æ± æ•°ç»„ä¸­å·²ç»ç»‘å®šè¯¥æ–¹æ³•å°±ç›´æ¥è¿”å›
      return;
    }
  }
  // æ£€æŸ¥é€šè¿‡åå°†æ–¹æ³•å­˜åœ¨äº‹ä»¶æ± æ•°ç»„ä¸­
  ary.push(fn);
  // æ³¨æ„ï¼šå› ä¸ºbindæ–¹æ³•é‡Œæˆ‘ä»¬å¤„ç†äº†é‡å¤é—®é¢˜ï¼Œæ‰€ä»¥å¯ä»¥é‡å¤ç»‘å®šrunæ–¹æ³•ï¼Œæ²¡äº‹
  bind(curEle, 'click', run);
}

function off (curEle, type, fn) {
  // offå°±ç®€å•äº†ï¼Œåªéœ€è¦æ“ä½œä¸€ä¸‹äº‹ä»¶æ± æ•°ç»„å°±è¡Œäº†
  var ary = curEle['zyEvent' + type];
  if (ary) {
    for (var i=0; i< ary.length; i++) {
      if(ary[i] === fn) {
        ary.splice(i, 1);
        // ary[i] = null;
        return;
      }
    }
  }
}

// runæ–¹æ³•å°†ä¼šç»‘å®šåˆ°å…ƒç´ æœ‰è§¦å‘çš„æ‰€æœ‰è¡Œä¸ºä¸Šï¼Œ
//   é€šè¿‡runæ–¹æ³•è·å–è¯¥å…ƒç´ è‡ªå®šä¹‰å±æ€§å¯¹åº”çš„è¡Œä¸ºäº‹ä»¶æ± æ± çš„æ•°ç»„ï¼Œç„¶åé€ä¸€æ‰§è¡Œã€‚
function run(e) {
  // åœ¨bindæ–¹æ³•é‡Œï¼Œä¼šå°†è¡Œä¸ºè§¦å‘å…¨éƒ¨ç»‘å®šåˆ°runä¸Šï¼Œrunå¦‚è¦åšçš„å°±æ˜¯æ‹¿åˆ°å…ƒç´ å’Œäº‹ä»¶ç±»å‹
  e = e || window.event;
  e.target = e.target || e.srcElement;
  var type = e.type,
      ary = this['zyEvent' + type];
  //ary = e.target['zyEvent' + type];
  if (ary) {
      // for (var i = 0; i < ary.length; i++) { ä¸èƒ½è¿™æ ·è®¾ç½®lenäº†ï¼Œå› ä¸ºè¦åˆ é™¤æ•°ç»„ï¼Œç”¨è¿™æ–¹å¼ä¼šæ•°ç»„å¡Œé™·ï¼
      for (var i = 0, len = ary.length; i < len; i++) {
          if(typeof(ary[i]) === "function") {
              ary[i].call(this, e); // ä¼ å…¥å½“å‰å…ƒç´ thiså’ŒEventå¯¹è±¡
          } else {
              // å¦‚æœä¸æ˜¯å‡½æ•°ç›´æ¥åˆ é™¤å½“å‰é¡¹
              ary.splice(i, 1);
              i--;
          }
      }
  }
}
```

----------

## è¯¾æ—¶123ï¼šå¤ä¹ ä¸“ç”¨-ä½¿ç”¨è‡ªå·±çš„äº‹ä»¶åº“

- ä½¿ç”¨è‡ªå·±çš„äº‹ä»¶åº“å®Œæˆè¯¾æ—¶120çš„æ‹–æ‹½ç»ƒä¹ 

```javascript

```

----------

## è¯¾æ—¶124ï¼šå¼¹æ€§åŠ¿èƒ½åŠ¨ç”» æŠ›ç‰©çº¿è¿åŠ¨


  [1]: http://static.zybuluo.com/szy0syz/l5ie96tnnns94qvvmdoau62u/zf-lesson107.png
  [2]: http://static.zybuluo.com/szy0syz/wli79p74bzsuqvlqm6hgzfkm/lesson115-mouseDrag.png
  [3]: http://static.zybuluo.com/szy0syz/1hyf18t8bdk9noxne0pdrvjp/zf-lesson117.png
  [4]: http://static.zybuluo.com/szy0syz/yk5rfstg2uaokp56lrvo2qxy/zf-lesson120.png
  
  
