(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{185:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"ubuntu安装及node-js生产环境部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu安装及node-js生产环境部署","aria-hidden":"true"}},[s._v("#")]),s._v(" Ubuntu安装及Node.js生产环境部署")]),n("h2",{attrs:{id:"下载镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像","aria-hidden":"true"}},[s._v("#")]),s._v(" 下载镜像")]),n("p",[s._v("使用阿里云镜像下载镜像，速度很快。")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# 目录")]),s._v("\nhttp://mirrors.aliyun.com/ubuntu-releases/\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 测试机32位系统即可")]),s._v("\nhttp://mirrors.aliyun.com/ubuntu-releases/16.04.3/ubuntu-16.04.3-server-i386.iso\n")])])]),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装")]),n("p",[s._v("安装完系统首先去更新下源，待会我们update和upgrade时会快一点。")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("cd")]),s._v(" /etc/apt/sources.list.d\n"),n("span",{attrs:{class:"token function"}},[s._v("touch")]),s._v(" sources-cn.list\nvim sources-cn.list\n")])])]),n("p",[s._v("到 "),n("code",[s._v("http://wiki.ubuntu.org.cn")]),s._v(" 找个sources的模板，这里用16.04：")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("deb http://cn.archive.ubuntu.com/ubuntu/ xenial main restricted universe multiverse\ndeb http://cn.archive.ubuntu.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb http://cn.archive.ubuntu.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb http://cn.archive.ubuntu.com/ubuntu/ xenial-backports main restricted universe multiverse\n"),n("span",{attrs:{class:"token comment"}},[s._v("##測試版源")]),s._v("\ndeb http://cn.archive.ubuntu.com/ubuntu/ xenial-proposed main restricted universe multiverse\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 源碼")]),s._v("\ndeb-src http://cn.archive.ubuntu.com/ubuntu/ xenial main restricted universe multiverse\ndeb-src http://cn.archive.ubuntu.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb-src http://cn.archive.ubuntu.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb-src http://cn.archive.ubuntu.com/ubuntu/ xenial-backports main restricted universe multiverse\n"),n("span",{attrs:{class:"token comment"}},[s._v("##測試版源")]),s._v("\ndeb-src http://cn.archive.ubuntu.com/ubuntu/ xenial-proposed main restricted universe multiverse\n"),n("span",{attrs:{class:"token comment"}},[s._v("# Canonical 合作夥伴和附加")]),s._v("\ndeb http://archive.canonical.com/ubuntu/ xenial partner\ndeb http://extras.ubuntu.com/ubuntu/ xenial main\n")])])]),n("p",[s._v("其中也可以将以上源中的"),n("code",[s._v("http://cn.archive.ubuntu.com/ubuntu/")]),s._v("替换成阿里云、网易、中科院等等")]),n("p",[s._v("更新系统及安装常用软件")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# 从源中更新软件列表到本地")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 如果报一个和cdrom没法获取数据的错，需把deb cdrom:[]注销")]),s._v("\nvim /etc/apt/sources.list\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 一键更新软件包")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" upgrade\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 升级管理器")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" update-manager -d\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 安装一些比用软件")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("git")]),s._v(" vim openssl build-essential libssh-dev "),n("span",{attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("curl")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 安装nvm")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("curl")]),s._v(" -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh "),n("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 生效nvm")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("source")]),s._v(" ~/.bashrc\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 安装node.js")]),s._v("\nnvm "),n("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" 8.9.4\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 配置npm源")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" registry https://registry.npm.taobao.org\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# Ubuntu安装yarn")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sS https://dl.yarnpkg.com/debian/pubkey.gpg "),n("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key add -\n"),n("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"deb https://dl.yarnpkg.com/debian/ stable main"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/yarn.list\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" yarn\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 安装ssh")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   先看是否安装ssh")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("ps")]),s._v(" -e"),n("span",{attrs:{class:"token operator"}},[s._v("|")]),n("span",{attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("ssh")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   如果缺少就安装")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" openssh-server\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   启动服务")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/ssh start\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   备份ssh配置")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/ssh/sshd_config /etc/ssh/sshd_config.bak\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   修改ssh配置")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" vim /etc/ssh/sshd_config\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   PermitEmptyPasswords no     # 禁止空密码登录")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   RSAAuthentication yes       # 启用 RSA 认证")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   PubkeyAuthentication yes    # 启用公钥认证")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   ServerKeyBits 1024          # 将ServerKey强度改为1024比特")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   重启以生效")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/ssh restart\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   sudo service ssh restart")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# 初始化ssh(服务器和开发端)")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   生成公钥和秘钥 空密码")]),s._v("\nssh-keygen -t rsa -C "),n("span",{attrs:{class:"token string"}},[s._v('"szy0syz@gmail.com"')]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   将开发端公钥改名")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("cp")]),s._v(" id_rsa.pub jerry@4790MAC\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   发送authorized_keys到服务端 和修改权限")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("scp")]),s._v(" jerry@4790MAC szy0syz@192.168.2.36:~/\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   切到服务器将公钥放")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("cat")]),s._v(" jerry@4790MAC "),n("span",{attrs:{class:"token operator"}},[s._v(">>")]),s._v(" ~/.ssh/authorized_keys\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 755 ~/.ssh\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 600 ~/.ssh/authorized_keys\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   将ssh key添加到ssh-agent")]),s._v("\nssh-add ~/.ssh/id_rsa\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   重启ssh-server")]),s._v("\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/ssh restart\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   sudo service ssh restart")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#   开发端添加ssh host")]),s._v("\nvim ~/.ssh/config\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    格式如下：")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    Host ynamp")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#      User root")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#      HostName 47.92.154.146")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#      Port 22")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#      IdentityFile ~/.ssh/id_rsa")]),s._v("\n")])])]),n("p",[s._v("如果客户端使用git报错")]),n("p",[n("code",[s._v("Permanently added the RSA host key for IP address to the list of known hosts.")])]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# vim ~/.ssh/config")]),s._v("\nHost *\n   StrictHostKeyChecking no\n   UserKnownHostsFile /dev/null\n   LogLevel ERROR\n")])])]),n("h2",{attrs:{id:"pm2部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pm2部署","aria-hidden":"true"}},[s._v("#")]),s._v(" pm2部署")]),n("p",[s._v("如果"),n("code",[s._v("pm2 deploy")]),s._v("报错提示找不到"),n("code",[s._v("npm")]),s._v("或"),n("code",[s._v("pm2")]),s._v("时，编辑.bashrc文件，nvm配置提到最前面。")]),n("h2",{attrs:{id:"安装lnmp中nginx和ssl证书"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装lnmp中nginx和ssl证书","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装lnmp中Nginx和ssl证书")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# 安装lnmp (不要装多余的，如php、mysql，装了也能通用或删除)")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    部署ssl证书错误时，可以尝试升级Nginx版本，有时过低的Nginx会部署ssl失败")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    在http://nginx.org/查看最新版本")]),s._v("\n./upgrade.sh nginx\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    最后来添加ssl证书")]),s._v("\nlnmp ssl add \n"),n("span",{attrs:{class:"token comment"}},[s._v("#    升级后还失败，就是系统安装了py2的原因，得删除py2，安装py3，然后再来操作 https://segmentfault.com/a/1190000010693933")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("#    ubuntu系统以来pythone2.7，应该删除掉，把ubunt版本换成14.04即可正常使用。")]),s._v("\n")])])]),n("h2",{attrs:{id:"ssl-https后nginx配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssl-https后nginx配置","aria-hidden":"true"}},[s._v("#")]),s._v(" ssl/https后nginx配置")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# 将所有的http请求通过rewrite重写到https上")]),s._v("\nrewrite ^"),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$  https://"),n("span",{attrs:{class:"token variable"}},[s._v("$host")]),n("span",{attrs:{class:"token variable"}},[s._v("$1")]),s._v(" permanent"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("# nginx最简模板")]),s._v("\nserver "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  listen       8080"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  listen       443 ssl"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  server_name  localhost"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  ssl_certificate  /etc/nginx/ssl/server.crt\n  ssl_certificate_key /etc/nginx/ssl/server.key\n\n  location / "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    proxy_pass http://localhost:3000"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_http_version 1.1"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header Upgrade "),n("span",{attrs:{class:"token variable"}},[s._v("$http_upgrade")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header Connection "),n("span",{attrs:{class:"token string"}},[s._v("'upgrade'")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_set_header Host "),n("span",{attrs:{class:"token variable"}},[s._v("$host")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy_cache_bypass "),n("span",{attrs:{class:"token variable"}},[s._v("$http_upgrade")]),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  location /public "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    root /usr/local/var/www"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),n("h2",{attrs:{id:"npm设置淘宝源"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#npm设置淘宝源","aria-hidden":"true"}},[s._v("#")]),s._v(" npm设置淘宝源")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("npm")]),s._v(" config "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" registry http://registry.npm.taobao.org/\n")])])]),n("h2",{attrs:{id:"ubuntu-16-04-安装-yarn"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-16-04-安装-yarn","aria-hidden":"true"}},[s._v("#")]),s._v(" Ubuntu 16.04 安装 Yarn")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sS https://dl.yarnpkg.com/debian/pubkey.gpg "),n("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" apt-key add -\n\n"),n("span",{attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),n("span",{attrs:{class:"token string"}},[s._v('"deb https://dl.yarnpkg.com/debian/ stable main"')]),s._v(" "),n("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("tee")]),s._v(" /etc/apt/sources.list.d/yarn.list\n\n"),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),n("span",{attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" yarn\n")])])]),n("h2",{attrs:{id:"ubuntu-16-修改设备名hostname"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-16-修改设备名hostname","aria-hidden":"true"}},[s._v("#")]),s._v(" Ubuntu 16 修改设备名hostname")]),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("vim /etc/hostname\n")])])])])}],!1,null,null,null);t.default=e.exports}}]);